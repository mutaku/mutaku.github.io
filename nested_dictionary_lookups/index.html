
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dictionary Lookup - Exploring the Depths &#8212; Mutaku  documentation</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="author" title="About these documents" href="../about/" />
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" /> 
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" /> 
<link
  rel="alternate"
  type="application/atom+xml"
  href="../blog/atom.xml"
  title="Mutaku"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="../">
    
      <img src="../_static/plot_header.png" class="logo" alt="logo" />
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../about/">About Matthew Martz</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/mutaku/" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
          <li class="nav-item">
            <a class="nav-link" href="https://twitter.com/backpropagating" target="_blank" rel="noopener">
              <span><i class="fab fa-twitter-square"></i></span>
            </a>
          </li>
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><div class="logo"><img src="../_static/profile.jpg"></div>
<div class="snippet">
    <div class="name">Matthew Martz, PhD</div>
    <div class="title">Director of Data Science/ML/AI and Technical Lead / Strategic Vision</div>
    <div class="specialties">Machine learning | Predictive Modeling | Data Science | Biomedical Research | Strategy and Vision | Leadership | Clinical AI | Startups</div>
</div>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#introduction" class="nav-link">Introduction</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#the-bread-and-butter" class="nav-link">The Bread and Butter</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#a-simple-example" class="nav-link">A Simple Example</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#summarizing-our-toy-data-experiments" class="nav-link">Summarizing Our Toy Data Experiments</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#moving-beyond-our-toy-data-let-s-make-some-real-improvements" class="nav-link">Moving Beyond Our Toy Data - Let’s Make Some Real Improvements</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#revisiting-an-old-friend" class="nav-link">Revisiting an Old Friend</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#what-about-the-simple-approach" class="nav-link">What About the Simple Approach</a>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                 <div class="section" id="dictionary-lookup-exploring-the-depths">
<h1>Dictionary Lookup - Exploring the Depths<a class="headerlink" href="#dictionary-lookup-exploring-the-depths" title="Permalink to this headline">¶</a></h1>
<p>Exploring methods of performant Python dictionary lookups</p>
<div class="sphinx-bs container pb-4 docutils">
<div class="row docutils">
<div class="d-flex col-lg-12 p-0 docutils">
<div class="card w-100 shadow docutils">
<div class="card-header font-weight-bold bg-info docutils">
<p class="card-text">Note</p>
</div>
<div class="card-body docutils">
<p class="card-text">This is an in-progress draft.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Some introduction text here.</p>
</div>
<div class="section" id="the-bread-and-butter">
<h2>The Bread and Butter<a class="headerlink" href="#the-bread-and-butter" title="Permalink to this headline">¶</a></h2>
<p>Let us start with a simple, nested dictionary lookup.</p>
<div class="sphinx-bs container pb-4 docutils">
<div class="row docutils">
<div class="d-flex col-lg-12 p-0 docutils">
<div class="card w-100 shadow docutils">
<div class="card-header text-secondary docutils">
<p class="card-text">Find the value of our nested key</p>
</div>
<div class="card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;this&#39;</span><span class="p">][</span><span class="s1">&#39;that&#39;</span><span class="p">][</span><span class="s1">&#39;the_other&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>As you likely know, we will raise a KeyError exception if any of the keys within our
lookup chain are missing. If we want to fallback to a default value, we can wrap this
to return our default with a failed retrieval.</p>
<div class="sphinx-bs container pb-4 docutils">
<div class="row docutils">
<div class="d-flex col-lg-12 p-0 docutils">
<div class="card w-100 shadow docutils">
<div class="card-header text-secondary docutils">
<p class="card-text">Example Code</p>
</div>
<div class="card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;this&#39;</span><span class="p">][</span><span class="s1">&#39;that&#39;</span><span class="p">][</span><span class="s1">&#39;the_other&#39;</span><span class="p">]</span>
<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">default</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="a-simple-example">
<h2>A Simple Example<a class="headerlink" href="#a-simple-example" title="Permalink to this headline">¶</a></h2>
<p>Setup the example here before we define things.</p>
<p><code class="docutils literal notranslate"><span class="pre">data_dict</span></code> is a dict where we expect in a perfect world we would have
our expected structure and could simply query the deepest nested level
for <code class="docutils literal notranslate"><span class="pre">our_key</span></code> and default to <code class="docutils literal notranslate"><span class="pre">default_value</span></code>. But we know we can’t
expect anything either than <code class="docutils literal notranslate"><span class="pre">data_dict</span></code> exists and is a dict</p>
<div class="sphinx-bs container pb-4 docutils">
<div class="row docutils">
<div class="d-flex col-lg-12 p-0 docutils">
<div class="card w-100 shadow docutils">
<div class="card-header text-secondary docutils">
<p class="card-text">Three example methods for key lookup</p>
</div>
<div class="card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">default_value</span> <span class="o">=</span> <span class="mf">1.0</span>


<span class="k">def</span> <span class="nf">old_style</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Old style (Python &lt; 3.8)&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;top_level&#39;</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;lower_level&#39;</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;top_level&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s1">&#39;our_key&#39;</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;top_level&#39;</span><span class="p">][</span><span class="s1">&#39;lower_level&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;top_level&#39;</span><span class="p">][</span><span class="s1">&#39;lower_level&#39;</span><span class="p">][</span><span class="s1">&#39;our_key&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default_value</span>


<span class="k">def</span> <span class="nf">walrus_style</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Walrus operator cleans this up&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">top</span> <span class="p">:</span><span class="o">=</span> <span class="n">data_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;top_level&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lower</span> <span class="p">:</span><span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lower_level&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">lower</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;our_key&#39;</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default_value</span>


<span class="k">def</span> <span class="nf">chaining_style</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Chaining with object defaults&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">data_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;top_level&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lower_level&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;our_key&quot;</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Try with an empty <code class="docutils literal notranslate"><span class="pre">data_dict</span></code> We should expect the first two to be
faster as they break quicker</p>
<div class="sphinx-bs container pb-4 docutils">
<div class="row docutils">
<div class="d-flex col-lg-12 p-0 docutils">
<div class="card w-100 shadow docutils">
<div class="card-header text-secondary docutils">
<p class="card-text">Timing our methods</p>
</div>
<div class="card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">timeit</span> <span class="n">old_style</span><span class="p">()</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">walrus_style</span><span class="p">()</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">chaining_style</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>152 ns ± 0.825 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
204 ns ± 2.71 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
366 ns ± 1.66 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Indeed, if we do not have our initial key, our chained lookup is longer
since it proceeds through multiple lookups. Our walrus method is a
little slower since we make an assignment. So the simple nested hash
lookups will fail faster.</p>
<p>Now let’s use a semi-populated <code class="docutils literal notranslate"><span class="pre">data_dict</span></code> We should expect some
convergence on timing now that we remove the early fail</p>
<div class="sphinx-bs container pb-4 docutils">
<div class="row docutils">
<div class="d-flex col-lg-12 p-0 docutils">
<div class="card w-100 shadow docutils">
<div class="card-header text-secondary docutils">
<p class="card-text">Failing early in our lookup</p>
</div>
<div class="card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;top_level&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;lower_level&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;not_our_key&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}}</span>
<span class="p">}</span>

<span class="o">%</span><span class="n">timeit</span> <span class="n">old_style</span><span class="p">()</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">walrus_style</span><span class="p">()</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">chaining_style</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>303 ns ± 1.31 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
373 ns ± 0.586 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
359 ns ± 0.543 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Now we do see a bit more convergence on timing since we have to recurse
with all methods. And the first method still wins by using only hash
lookups as opposed to multiple rounds of assignment. What intrigues me
is that the chained assignment is faster than the walrus operator method
(will do some PEP research, this is a good CS exercise).</p>
<p>Now let’s try the last scenario when our key is indeed in our structure</p>
<div class="sphinx-bs container pb-4 docutils">
<div class="row docutils">
<div class="d-flex col-lg-12 p-0 docutils">
<div class="card w-100 shadow docutils">
<div class="card-header text-secondary docutils">
<p class="card-text">Finding our nested key</p>
</div>
<div class="card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;top_level&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;lower_level&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;our_key&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}}}</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">old_style</span><span class="p">()</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">walrus_style</span><span class="p">()</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">chaining_style</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>404 ns ± 5.23 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
370 ns ± 1.45 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
372 ns ± 1.74 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Now we get interesting. If we have our key, the first method only using
hash lookups is slower when we will end up getting our key of interest.
We have to identify lookup, then ultimately do it all again to get our
value. However, with walrus and chaining assignment, we are doing a
lookup <em>and</em> storing of the value as we go. So when we get to the final
level of recursion we can simply return what we have. We also now see
that the walrus and chaining methods have equalized.</p>
</div>
<div class="section" id="summarizing-our-toy-data-experiments">
<h2>Summarizing Our Toy Data Experiments<a class="headerlink" href="#summarizing-our-toy-data-experiments" title="Permalink to this headline">¶</a></h2>
<p>To summarize, continual assignment works nice when we can fairly
confidently expect to recurse through most of our data structure and not
fail immediately. The walrus operator introduced in Python 3.8 is truly
wonderful, and one of my favorite Python 3 additions (I know, you
probably said Async or division). Without further testing, we are left
primarily to a style decision.</p>
<p>While I often use the chaining approach with empty dict structures as
defaults to continue the chain, and personally find it a clean syntax,
the walrus operator approach has (at least) two primary benefits: 1)
while debugging we would have the value of the last successful lookup
regardless of where it failed, and 2) I think it’s a bit more
understandable to someone who might not be as familiar with the idea of
chaining an object. As an additional note regarding the first point, we
could obtain the value of our last lookup by assigning it. However, when
we do that, we are simply performing the task the walrus operator was
introduced to provide. Another [+1] for the walrus operator method.</p>
<p>Further, if we would be working with large, messy nesting and
performance was critical – and we will presume so – we know from many
nights of banging our heads against the keyboard that we can never
expect a consistent data structure. I know we are all thinking of that
master piece of a JSON dump we get from some third party service we are
required to utilize that contains inconsistent structure and data types.
That one for which we will have to parse at 3am again and again.
Therefore, our method should be performant at any level of lookup
failure. Our chaining method will always get or assign all the way
through the intended structure. If we expect a very large recursion, but
we don’t actually have it, we would have to use the time and memory to
unecessarily work through all of that failure. That would leave us with
the nested if/else or the walrus style. So again, another [+1] for the
walrus operator method. Are you seeing the theme?</p>
</div>
<div class="section" id="moving-beyond-our-toy-data-let-s-make-some-real-improvements">
<h2>Moving Beyond Our Toy Data - Let’s Make Some Real Improvements<a class="headerlink" href="#moving-beyond-our-toy-data-let-s-make-some-real-improvements" title="Permalink to this headline">¶</a></h2>
<p>We used some fixed key lookups here. This works okay for a shallow
search depth. However, I would say that anything beyond four keys is a
bit unwieldy. In this case, and likely if we are going to do any depth
of search consistently in a a module, we should create a more
programmatic approach that might step through a list of keys. I’ll end
with a very quick example of how I might implement such an approach, but
note, we would want to write some tests around this – it is merely a
quick starting block.</p>
<div class="sphinx-bs container pb-4 docutils">
<div class="row docutils">
<div class="d-flex col-lg-12 p-0 docutils">
<div class="card w-100 shadow docutils">
<div class="card-header text-secondary docutils">
<p class="card-text">A programmatic and modular method</p>
</div>
<div class="card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">programmatic_depth_search</span><span class="p">(</span><span class="n">data_dict</span><span class="p">,</span> <span class="n">key_list</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">current_depth_value</span> <span class="o">=</span> <span class="n">data_dict</span>
    <span class="k">while</span> <span class="n">key_list</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lookup_key</span> <span class="o">=</span> <span class="n">key_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="n">current_depth_value</span> <span class="p">:</span><span class="o">=</span> <span class="n">current_depth_value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lookup_key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="n">default_value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default_value</span>

    <span class="k">return</span> <span class="n">current_depth_value</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Then we might try the following examples:</p>
<div class="sphinx-bs container pb-4 docutils">
<div class="row docutils">
<div class="d-flex col-lg-12 p-0 docutils">
<div class="card w-100 shadow docutils">
<div class="card-header text-secondary docutils">
<p class="card-text">Timing our methods</p>
</div>
<div class="card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">search_value</span> <span class="o">=</span> <span class="n">programmatic_depth_search</span><span class="p">(</span>
    <span class="n">data_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;top_level&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;lower_level&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;our_key&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}}},</span>
    <span class="n">key_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;top_level&#39;</span><span class="p">,</span> <span class="s1">&#39;lower_level&#39;</span><span class="p">],</span>
    <span class="n">default_value</span><span class="o">=</span><span class="s1">&#39;Not Found&#39;</span>
<span class="p">)</span>
<span class="c1"># Returns: {&#39;our_key&#39;: 3}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sphinx-bs container pb-4 docutils">
<div class="row docutils">
<div class="d-flex col-lg-12 p-0 docutils">
<div class="card w-100 shadow docutils">
<div class="card-header text-secondary docutils">
<p class="card-text">Timing our methods</p>
</div>
<div class="card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">search_value</span> <span class="o">=</span> <span class="n">programmatic_depth_search</span><span class="p">(</span>
    <span class="n">data_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;top_level&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;lower_level&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;our_key&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}}},</span>
    <span class="n">key_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;top_level&#39;</span><span class="p">,</span> <span class="s1">&#39;lower_level&#39;</span><span class="p">,</span> <span class="s1">&#39;our_key&#39;</span><span class="p">],</span>
    <span class="n">default_value</span><span class="o">=</span><span class="s1">&#39;Not Found&#39;</span>
<span class="p">)</span>
<span class="c1"># Returns: 3</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sphinx-bs container pb-4 docutils">
<div class="row docutils">
<div class="d-flex col-lg-12 p-0 docutils">
<div class="card w-100 shadow docutils">
<div class="card-header text-secondary docutils">
<p class="card-text">Timing our methods</p>
</div>
<div class="card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">search_value</span> <span class="o">=</span> <span class="n">programmatic_depth_search</span><span class="p">(</span>
    <span class="n">data_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;top_level&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;lower_level&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;our_key&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}}},</span>
    <span class="n">key_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;top_level&#39;</span><span class="p">,</span> <span class="s1">&#39;lower_level&#39;</span><span class="p">,</span> <span class="s1">&#39;our_key&#39;</span><span class="p">,</span> <span class="s1">&#39;fail_key&#39;</span><span class="p">],</span>
    <span class="n">default_value</span><span class="o">=</span><span class="s1">&#39;Not Found&#39;</span>
<span class="p">)</span>
<span class="c1"># Returns: &#39;Not Found&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="revisiting-an-old-friend">
<h2>Revisiting an Old Friend<a class="headerlink" href="#revisiting-an-old-friend" title="Permalink to this headline">¶</a></h2>
<p>With the hindsight of writing a testable and modularized version of our
dictionary searcher, let’s revisit our first three comparisons. We were
essentially comparing by always assuming we would either find
<code class="docutils literal notranslate"><span class="pre">our_key</span></code> and return it’s value, or it would not be found and we would
return <code class="docutils literal notranslate"><span class="pre">default_value</span></code>. However, let’s try this:</p>
<div class="sphinx-bs container pb-4 docutils">
<div class="row docutils">
<div class="d-flex col-lg-12 p-0 docutils">
<div class="card w-100 shadow docutils">
<div class="card-header text-secondary docutils">
<p class="card-text">Breaking our original functions with unexpected types</p>
</div>
<div class="card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;top_level&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;lower_level&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
<span class="n">old_style</span><span class="p">()</span>
<span class="c1"># Returns: TypeError: argument of type &#39;int&#39; is not iterable</span>

<span class="n">walrus_style</span><span class="p">()</span>
<span class="c1"># Returns: AttributeError: &#39;int&#39; object has no attribute &#39;get&#39;</span>

<span class="n">chaining_style</span><span class="p">()</span>
<span class="c1"># Returns: AttributeError: &#39;int&#39; object has no attribute &#39;get&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>As you can clearly see, our fixed methods, while sufficient for our
specific initital example case, they break easily. We have tricked them
into finding a key at a particular level, but it is now an integer and
not a <code class="docutils literal notranslate"><span class="pre">dict</span></code>. I wanted to highlight this to highlight that in
modularizing our experiment, we also added robustness against the
unexpected – something we know is key. To prove this, let’s now run
this with our modularized version:</p>
<div class="sphinx-bs container pb-4 docutils">
<div class="row docutils">
<div class="d-flex col-lg-12 p-0 docutils">
<div class="card w-100 shadow docutils">
<div class="card-header text-secondary docutils">
<p class="card-text">Robustness with our programmatic approach</p>
</div>
<div class="card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">search_value</span> <span class="o">=</span> <span class="n">programmatic_depth_search</span><span class="p">(</span>
    <span class="n">data_dict</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;top_level&#39;</span><span class="p">,</span> <span class="s1">&#39;lower_level&#39;</span><span class="p">,</span> <span class="s1">&#39;our_key&#39;</span><span class="p">],</span> <span class="kc">None</span>
<span class="p">)</span>
<span class="c1"># Returns: None (our default value)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Neat!</p>
</div>
<div class="section" id="what-about-the-simple-approach">
<h2>What About the Simple Approach<a class="headerlink" href="#what-about-the-simple-approach" title="Permalink to this headline">¶</a></h2>
<div class="sphinx-bs container pb-4 docutils">
<div class="row docutils">
<div class="d-flex col-lg-12 p-0 docutils">
<div class="card w-100 shadow docutils">
<div class="card-header text-secondary docutils">
<p class="card-text">A simple, fixed lookup</p>
</div>
<div class="card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">normal</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;top_level&#39;</span><span class="p">][</span><span class="s1">&#39;lower_level&#39;</span><span class="p">][</span><span class="s1">&#39;our_key&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sphinx-bs container pb-4 docutils">
<div class="row docutils">
<div class="d-flex col-lg-6 col-md-6 col-sm-6 col-xs-12 p-2 docutils">
<div class="card w-100 shadow docutils">
<div class="card-header docutils">
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">column</dt>
<dd class="field-odd"><p class="card-text">col-lg-12 p-0</p>
</dd>
<dt class="field-even">header</dt>
<dd class="field-even"><p class="card-text">text-secondary</p>
</dd>
</dl>
</div></blockquote>
<p class="card-text">Comparing a fixed lookup to our programmatic approach</p>
</div>
<div class="card-body docutils">
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span>%timeit normal
154 ns ± 13.1 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)

%timeit programmatic_depth_search(data_dict, key_list)
158 ns ± 9.12 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)

key_list = [&#39;top_level&#39;, &#39;lower_level&#39;, &#39;our_key&#39;]

%timeit programmatic_depth_search(data_dict, key_list)
156 ns ± 22.6 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
</pre></div>
</div>
</div></blockquote>
</div>
</div>
</div>
</div>
</div>
<div class="sphinx-bs container pb-4 docutils">
<div class="row docutils">
<div class="d-flex col-lg-12 p-0 docutils">
<div class="card w-100 shadow docutils">
<div class="card-header text-secondary docutils">
<p class="card-text">Trying with a failure</p>
</div>
<div class="card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">normal</span><span class="p">(</span><span class="n">default_value</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;top_level&#39;</span><span class="p">][</span><span class="s1">&#39;lower_level&#39;</span><span class="p">][</span><span class="s1">&#39;fail_key&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>%timeit normal(1)
528 ns ± 98.3 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)

key_list = [&#39;top_level&#39;, &#39;lower_level&#39;, &#39;fail_key&#39;]

data_dict = {&#39;top_level&#39;: {&#39;lower_level&#39;: {&#39;our_key&#39;: 3}}}

%timeit programmatic_depth_search(data_dict, key_list, 1)
164 ns ± 21.8 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)

key_list = [&#39;top_level&#39;, &#39;fail_key&#39;, &#39;our_level&#39;]

%timeit programmatic_depth_search(data_dict, key_list, 1)
163 ns ± 30 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sphinx-bs container pb-4 docutils">
<div class="row docutils">
<div class="d-flex col-lg-12 p-0 docutils">
<div class="card w-100 shadow docutils">
<div class="card-header text-secondary docutils">
<p class="card-text">Breaking our original functions with unexpected types</p>
</div>
<div class="card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">normal</span><span class="p">(</span><span class="n">default_value</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;top_level&#39;</span><span class="p">][</span><span class="s1">&#39;fail_key&#39;</span><span class="p">][</span><span class="s1">&#39;our_key&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>%timeit normal(1)
390 ns ± 11 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

<div class="section">
    

<div class="section">
  <span style="float: left">
    
  </span>
  <span>&nbsp;</span>
  <span style="float: right">
     Next: 
    <a href="../python_generators_and_comprehension/">
      Python Generators and Comprehension 
    </a>
    
  </span>
</div>
  
</div>

              </div>
              
              
              <div class='prev-next-bottom'>
                

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2023, Matthew Martz.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>