<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Expert in AI, machine learning, and data science with focus on clinical applications and digital health innovation"><meta name=author content="Matthew Martz"><link href=https://mutaku.io/blog/category/technology/ rel=canonical><link href=../research/ rel=prev><link href=../../archive/2023/ rel=next><link rel=icon href=../../../assets/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.22"><title>Technology - Matthew Martz, PhD - Data Science & AI Leader</title><link rel=stylesheet href=../../../assets/stylesheets/main.84d31ad4.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"Fira Code"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#technology class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="Matthew Martz, PhD - Data Science & AI Leader" class="md-header__button md-logo" aria-label="Matthew Martz, PhD - Data Science & AI Leader" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 19.2c-2.5 0-4.71-1.28-6-3.2.03-2 4-3.1 6-3.1s5.97 1.1 6 3.1a7.23 7.23 0 0 1-6 3.2M12 5a3 3 0 0 1 3 3 3 3 0 0 1-3 3 3 3 0 0 1-3-3 3 3 0 0 1 3-3m0-3A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10c0-5.53-4.5-10-10-10"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Matthew Martz, PhD - Data Science & AI Leader </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Technology </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=deep-purple aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue-grey data-md-color-accent=deep-purple aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/mutaku/mutaku.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> mutaku/mutaku.github.io </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../about/ class=md-tabs__link> About </a> </li> <li class=md-tabs__item> <a href=../../../research/ class=md-tabs__link> Research Focus </a> </li> <li class=md-tabs__item> <a href=../../../experience/current/ class=md-tabs__link> Experience </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../ class=md-tabs__link> Blog </a> </li> <li class=md-tabs__item> <a href=../../../projects/ class=md-tabs__link> Projects </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Matthew Martz, PhD - Data Science & AI Leader" class="md-nav__button md-logo" aria-label="Matthew Martz, PhD - Data Science & AI Leader" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 19.2c-2.5 0-4.71-1.28-6-3.2.03-2 4-3.1 6-3.1s5.97 1.1 6 3.1a7.23 7.23 0 0 1-6 3.2M12 5a3 3 0 0 1 3 3 3 3 0 0 1-3 3 3 3 0 0 1-3-3 3 3 0 0 1 3-3m0-3A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10c0-5.53-4.5-10-10-10"/></svg> </a> Matthew Martz, PhD - Data Science & AI Leader </label> <div class=md-nav__source> <a href=https://github.com/mutaku/mutaku.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> mutaku/mutaku.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../about/ class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> <li class=md-nav__item> <a href=../../../research/ class=md-nav__link> <span class=md-ellipsis> Research Focus </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Experience </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Experience </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../experience/current/ class=md-nav__link> <span class=md-ellipsis> Current Role </span> </a> </li> <li class=md-nav__item> <a href=../../../experience/previous/ class=md-nav__link> <span class=md-ellipsis> Previous Positions </span> </a> </li> <li class=md-nav__item> <a href=../../../experience/achievements/ class=md-nav__link> <span class=md-ellipsis> Patents & Publications </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Blog </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ class=md-nav__link> <span class=md-ellipsis> Blog </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex> <span class=md-ellipsis> Archive </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> Archive </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../archive/2023/ class=md-nav__link> <span class=md-ellipsis> 2023 </span> </a> </li> <li class=md-nav__item> <a href=../../archive/2020/ class=md-nav__link> <span class=md-ellipsis> 2020 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3 checked> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex> <span class=md-ellipsis> Categories </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=true> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> Categories </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aiml/ class=md-nav__link> <span class=md-ellipsis> AI/ML </span> </a> </li> <li class=md-nav__item> <a href=../data-science/ class=md-nav__link> <span class=md-ellipsis> Data Science </span> </a> </li> <li class=md-nav__item> <a href=../research/ class=md-nav__link> <span class=md-ellipsis> Research </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Technology </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../projects/ class=md-nav__link> <span class=md-ellipsis> Projects </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <div class=md-content__inner> <header class=md-typeset> <h1 id=technology>Technology<a class=headerlink href=#technology title="Permanent link">&para;</a></h1> </header> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=https://github.com/mutaku.png alt="Matthew Martz, PhD"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2023-12-01 00:00:00+00:00">Friday, December 1, 2023</time></li> <li class=md-meta__item> in <a href=./ class=md-meta__link>Technology</a></li> <li class=md-meta__item> 11 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=python-generators-and-comprehensions-a-deep-dive><a href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/ class=toclink>Python Generators and Comprehensions: A Deep Dive</a></h2> <p>This comprehensive guide explores Python generators and comprehensions - powerful constructs that can dramatically improve your code's performance, readability, and memory efficiency. We'll cover everything from basic syntax to advanced patterns, including real-world applications and performance comparisons.</p> <h3 id=table-of-contents><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#table-of-contents>Table of Contents</a></h3> <ol> <li><a href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#introduction>Introduction</a></li> <li><a href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#list-comprehensions>List Comprehensions</a></li> <li><a href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#dictionary-and-set-comprehensions>Dictionary and Set Comprehensions</a></li> <li><a href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#generator-expressions>Generator Expressions</a></li> <li><a href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#generator-functions>Generator Functions</a></li> <li><a href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#advanced-generator-patterns>Advanced Generator Patterns</a></li> <li><a href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#performance-analysis>Performance Analysis</a></li> <li><a href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#real-world-applications>Real-World Applications</a></li> <li><a href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#best-practices>Best Practices</a></li> <li><a href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#common-pitfalls>Common Pitfalls</a></li> </ol> <h3 id=introduction><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#introduction>Introduction</a></h3> <p>Python generators and comprehensions are among the language's most elegant features. They provide concise, readable ways to create sequences, transform data, and handle large datasets efficiently. Understanding these constructs is crucial for writing Pythonic code that performs well at scale.</p> <h4 id=why-generators-and-comprehensions-matter><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#why-generators-and-comprehensions-matter>Why Generators and Comprehensions Matter</a></h4> <ul> <li><strong>Memory Efficiency</strong>: Generators produce items on-demand, using minimal memory</li> <li><strong>Performance</strong>: Often significantly faster than equivalent loops</li> <li><strong>Readability</strong>: Express complex operations in clear, declarative syntax</li> <li><strong>Composability</strong>: Chain operations together naturally</li> </ul> <h3 id=list-comprehensions><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#list-comprehensions>List Comprehensions</a></h3> <p>List comprehensions provide a concise way to create lists based on existing sequences.</p> <h4 id=basic-syntax><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#basic-syntax>Basic Syntax</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-52-1><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=c1># Basic form: [expression for item in iterable]</span>
</span><span id=__span-52-2><a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=n>squares</span> <span class=o>=</span> <span class=p>[</span><span class=n>x</span><span class=o>**</span><span class=mi>2</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>)]</span>
</span><span id=__span-52-3><a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=nb>print</span><span class=p>(</span><span class=n>squares</span><span class=p>)</span>  <span class=c1># [0, 1, 4, 9, 16, 25, 36, 49, 64, 81]</span>
</span><span id=__span-52-4><a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a>
</span><span id=__span-52-5><a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a><span class=c1># With condition: [expression for item in iterable if condition]</span>
</span><span id=__span-52-6><a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a><span class=n>even_squares</span> <span class=o>=</span> <span class=p>[</span><span class=n>x</span><span class=o>**</span><span class=mi>2</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span> <span class=k>if</span> <span class=n>x</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>0</span><span class=p>]</span>
</span><span id=__span-52-7><a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a><span class=nb>print</span><span class=p>(</span><span class=n>even_squares</span><span class=p>)</span>  <span class=c1># [0, 4, 16, 36, 64]</span>
</span></code></pre></div> <h4 id=nested-loops-in-comprehensions><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#nested-loops-in-comprehensions>Nested Loops in Comprehensions</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-53-1><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=c1># Traditional nested loops</span>
</span><span id=__span-53-2><a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a><span class=n>matrix</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-53-3><a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span><span id=__span-53-4><a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a>    <span class=n>row</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-53-5><a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span><span id=__span-53-6><a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a>        <span class=n>row</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>i</span> <span class=o>*</span> <span class=n>j</span><span class=p>)</span>
</span><span id=__span-53-7><a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a>    <span class=n>matrix</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>row</span><span class=p>)</span>
</span><span id=__span-53-8><a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a>
</span><span id=__span-53-9><a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a><span class=c1># List comprehension equivalent</span>
</span><span id=__span-53-10><a id=__codelineno-53-10 name=__codelineno-53-10 href=#__codelineno-53-10></a><span class=n>matrix</span> <span class=o>=</span> <span class=p>[[</span><span class=n>i</span> <span class=o>*</span> <span class=n>j</span> <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>)]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>)]</span>
</span><span id=__span-53-11><a id=__codelineno-53-11 name=__codelineno-53-11 href=#__codelineno-53-11></a><span class=nb>print</span><span class=p>(</span><span class=n>matrix</span><span class=p>)</span>  <span class=c1># [[0, 0, 0], [0, 1, 2], [0, 2, 4]]</span>
</span><span id=__span-53-12><a id=__codelineno-53-12 name=__codelineno-53-12 href=#__codelineno-53-12></a>
</span><span id=__span-53-13><a id=__codelineno-53-13 name=__codelineno-53-13 href=#__codelineno-53-13></a><span class=c1># Flattening nested structures</span>
</span><span id=__span-53-14><a id=__codelineno-53-14 name=__codelineno-53-14 href=#__codelineno-53-14></a><span class=n>nested</span> <span class=o>=</span> <span class=p>[[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=p>[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>],</span> <span class=p>[</span><span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>9</span><span class=p>]]</span>
</span><span id=__span-53-15><a id=__codelineno-53-15 name=__codelineno-53-15 href=#__codelineno-53-15></a><span class=n>flattened</span> <span class=o>=</span> <span class=p>[</span><span class=n>item</span> <span class=k>for</span> <span class=n>sublist</span> <span class=ow>in</span> <span class=n>nested</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>sublist</span><span class=p>]</span>
</span><span id=__span-53-16><a id=__codelineno-53-16 name=__codelineno-53-16 href=#__codelineno-53-16></a><span class=nb>print</span><span class=p>(</span><span class=n>flattened</span><span class=p>)</span>  <span class=c1># [1, 2, 3, 4, 5, 6, 7, 8, 9]</span>
</span></code></pre></div> <h4 id=complex-transformations><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#complex-transformations>Complex Transformations</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-54-1><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=c1># String processing</span>
</span><span id=__span-54-2><a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=n>words</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;hello&quot;</span><span class=p>,</span> <span class=s2>&quot;world&quot;</span><span class=p>,</span> <span class=s2>&quot;python&quot;</span><span class=p>,</span> <span class=s2>&quot;comprehensions&quot;</span><span class=p>]</span>
</span><span id=__span-54-3><a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a><span class=n>title_case</span> <span class=o>=</span> <span class=p>[</span><span class=n>word</span><span class=o>.</span><span class=n>title</span><span class=p>()</span> <span class=k>for</span> <span class=n>word</span> <span class=ow>in</span> <span class=n>words</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>word</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>5</span><span class=p>]</span>
</span><span id=__span-54-4><a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a><span class=nb>print</span><span class=p>(</span><span class=n>title_case</span><span class=p>)</span>  <span class=c1># [&#39;Python&#39;, &#39;Comprehensions&#39;]</span>
</span><span id=__span-54-5><a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a>
</span><span id=__span-54-6><a id=__codelineno-54-6 name=__codelineno-54-6 href=#__codelineno-54-6></a><span class=c1># Working with objects</span>
</span><span id=__span-54-7><a id=__codelineno-54-7 name=__codelineno-54-7 href=#__codelineno-54-7></a><span class=k>class</span><span class=w> </span><span class=nc>User</span><span class=p>:</span>
</span><span id=__span-54-8><a id=__codelineno-54-8 name=__codelineno-54-8 href=#__codelineno-54-8></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>age</span><span class=p>,</span> <span class=n>active</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
</span><span id=__span-54-9><a id=__codelineno-54-9 name=__codelineno-54-9 href=#__codelineno-54-9></a>        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span>
</span><span id=__span-54-10><a id=__codelineno-54-10 name=__codelineno-54-10 href=#__codelineno-54-10></a>        <span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>=</span> <span class=n>age</span>
</span><span id=__span-54-11><a id=__codelineno-54-11 name=__codelineno-54-11 href=#__codelineno-54-11></a>        <span class=bp>self</span><span class=o>.</span><span class=n>active</span> <span class=o>=</span> <span class=n>active</span>
</span><span id=__span-54-12><a id=__codelineno-54-12 name=__codelineno-54-12 href=#__codelineno-54-12></a>
</span><span id=__span-54-13><a id=__codelineno-54-13 name=__codelineno-54-13 href=#__codelineno-54-13></a>    <span class=k>def</span><span class=w> </span><span class=fm>__repr__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-54-14><a id=__codelineno-54-14 name=__codelineno-54-14 href=#__codelineno-54-14></a>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;User(&#39;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>&#39;, </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>age</span><span class=si>}</span><span class=s2>, </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>active</span><span class=si>}</span><span class=s2>)&quot;</span>
</span><span id=__span-54-15><a id=__codelineno-54-15 name=__codelineno-54-15 href=#__codelineno-54-15></a>
</span><span id=__span-54-16><a id=__codelineno-54-16 name=__codelineno-54-16 href=#__codelineno-54-16></a><span class=n>users</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-54-17><a id=__codelineno-54-17 name=__codelineno-54-17 href=#__codelineno-54-17></a>    <span class=n>User</span><span class=p>(</span><span class=s2>&quot;Alice&quot;</span><span class=p>,</span> <span class=mi>25</span><span class=p>),</span>
</span><span id=__span-54-18><a id=__codelineno-54-18 name=__codelineno-54-18 href=#__codelineno-54-18></a>    <span class=n>User</span><span class=p>(</span><span class=s2>&quot;Bob&quot;</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=kc>False</span><span class=p>),</span>
</span><span id=__span-54-19><a id=__codelineno-54-19 name=__codelineno-54-19 href=#__codelineno-54-19></a>    <span class=n>User</span><span class=p>(</span><span class=s2>&quot;Charlie&quot;</span><span class=p>,</span> <span class=mi>35</span><span class=p>),</span>
</span><span id=__span-54-20><a id=__codelineno-54-20 name=__codelineno-54-20 href=#__codelineno-54-20></a>    <span class=n>User</span><span class=p>(</span><span class=s2>&quot;Diana&quot;</span><span class=p>,</span> <span class=mi>28</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
</span><span id=__span-54-21><a id=__codelineno-54-21 name=__codelineno-54-21 href=#__codelineno-54-21></a><span class=p>]</span>
</span><span id=__span-54-22><a id=__codelineno-54-22 name=__codelineno-54-22 href=#__codelineno-54-22></a>
</span><span id=__span-54-23><a id=__codelineno-54-23 name=__codelineno-54-23 href=#__codelineno-54-23></a><span class=c1># Extract names of active users over 25</span>
</span><span id=__span-54-24><a id=__codelineno-54-24 name=__codelineno-54-24 href=#__codelineno-54-24></a><span class=n>active_senior_names</span> <span class=o>=</span> <span class=p>[</span><span class=n>user</span><span class=o>.</span><span class=n>name</span> <span class=k>for</span> <span class=n>user</span> <span class=ow>in</span> <span class=n>users</span>
</span><span id=__span-54-25><a id=__codelineno-54-25 name=__codelineno-54-25 href=#__codelineno-54-25></a>                      <span class=k>if</span> <span class=n>user</span><span class=o>.</span><span class=n>active</span> <span class=ow>and</span> <span class=n>user</span><span class=o>.</span><span class=n>age</span> <span class=o>&gt;</span> <span class=mi>25</span><span class=p>]</span>
</span><span id=__span-54-26><a id=__codelineno-54-26 name=__codelineno-54-26 href=#__codelineno-54-26></a><span class=nb>print</span><span class=p>(</span><span class=n>active_senior_names</span><span class=p>)</span>  <span class=c1># [&#39;Alice&#39;, &#39;Charlie&#39;]</span>
</span><span id=__span-54-27><a id=__codelineno-54-27 name=__codelineno-54-27 href=#__codelineno-54-27></a>
</span><span id=__span-54-28><a id=__codelineno-54-28 name=__codelineno-54-28 href=#__codelineno-54-28></a><span class=c1># Transform user data</span>
</span><span id=__span-54-29><a id=__codelineno-54-29 name=__codelineno-54-29 href=#__codelineno-54-29></a><span class=n>user_summaries</span> <span class=o>=</span> <span class=p>[</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>user</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> (</span><span class=si>{</span><span class=n>user</span><span class=o>.</span><span class=n>age</span><span class=si>}</span><span class=s2>)&quot;</span> <span class=k>for</span> <span class=n>user</span> <span class=ow>in</span> <span class=n>users</span> <span class=k>if</span> <span class=n>user</span><span class=o>.</span><span class=n>active</span><span class=p>]</span>
</span><span id=__span-54-30><a id=__codelineno-54-30 name=__codelineno-54-30 href=#__codelineno-54-30></a><span class=nb>print</span><span class=p>(</span><span class=n>user_summaries</span><span class=p>)</span>  <span class=c1># [&#39;Alice (25)&#39;, &#39;Charlie (35)&#39;]</span>
</span></code></pre></div> <h3 id=dictionary-and-set-comprehensions><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#dictionary-and-set-comprehensions>Dictionary and Set Comprehensions</a></h3> <p>Python extends comprehension syntax to dictionaries and sets.</p> <h4 id=dictionary-comprehensions><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#dictionary-comprehensions>Dictionary Comprehensions</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-55-1><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=c1># Basic dictionary comprehension</span>
</span><span id=__span-55-2><a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a><span class=n>squares_dict</span> <span class=o>=</span> <span class=p>{</span><span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>**</span><span class=mi>2</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>)}</span>
</span><span id=__span-55-3><a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a><span class=nb>print</span><span class=p>(</span><span class=n>squares_dict</span><span class=p>)</span>  <span class=c1># {0: 0, 1: 1, 2: 4, 3: 9, 4: 16}</span>
</span><span id=__span-55-4><a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a>
</span><span id=__span-55-5><a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a><span class=c1># From two lists</span>
</span><span id=__span-55-6><a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a><span class=n>keys</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>,</span> <span class=s1>&#39;d&#39;</span><span class=p>]</span>
</span><span id=__span-55-7><a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a><span class=n>values</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>]</span>
</span><span id=__span-55-8><a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a><span class=n>mapping</span> <span class=o>=</span> <span class=p>{</span><span class=n>k</span><span class=p>:</span> <span class=n>v</span> <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>keys</span><span class=p>,</span> <span class=n>values</span><span class=p>)}</span>
</span><span id=__span-55-9><a id=__codelineno-55-9 name=__codelineno-55-9 href=#__codelineno-55-9></a><span class=nb>print</span><span class=p>(</span><span class=n>mapping</span><span class=p>)</span>  <span class=c1># {&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4}</span>
</span><span id=__span-55-10><a id=__codelineno-55-10 name=__codelineno-55-10 href=#__codelineno-55-10></a>
</span><span id=__span-55-11><a id=__codelineno-55-11 name=__codelineno-55-11 href=#__codelineno-55-11></a><span class=c1># Conditional dictionary creation</span>
</span><span id=__span-55-12><a id=__codelineno-55-12 name=__codelineno-55-12 href=#__codelineno-55-12></a><span class=n>users_dict</span> <span class=o>=</span> <span class=p>{</span><span class=n>user</span><span class=o>.</span><span class=n>name</span><span class=p>:</span> <span class=n>user</span><span class=o>.</span><span class=n>age</span> <span class=k>for</span> <span class=n>user</span> <span class=ow>in</span> <span class=n>users</span> <span class=k>if</span> <span class=n>user</span><span class=o>.</span><span class=n>active</span><span class=p>}</span>
</span><span id=__span-55-13><a id=__codelineno-55-13 name=__codelineno-55-13 href=#__codelineno-55-13></a><span class=nb>print</span><span class=p>(</span><span class=n>users_dict</span><span class=p>)</span>  <span class=c1># {&#39;Alice&#39;: 25, &#39;Charlie&#39;: 35}</span>
</span><span id=__span-55-14><a id=__codelineno-55-14 name=__codelineno-55-14 href=#__codelineno-55-14></a>
</span><span id=__span-55-15><a id=__codelineno-55-15 name=__codelineno-55-15 href=#__codelineno-55-15></a><span class=c1># Swapping keys and values</span>
</span><span id=__span-55-16><a id=__codelineno-55-16 name=__codelineno-55-16 href=#__codelineno-55-16></a><span class=n>original</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>:</span> <span class=mi>3</span><span class=p>}</span>
</span><span id=__span-55-17><a id=__codelineno-55-17 name=__codelineno-55-17 href=#__codelineno-55-17></a><span class=n>swapped</span> <span class=o>=</span> <span class=p>{</span><span class=n>v</span><span class=p>:</span> <span class=n>k</span> <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>original</span><span class=o>.</span><span class=n>items</span><span class=p>()}</span>
</span><span id=__span-55-18><a id=__codelineno-55-18 name=__codelineno-55-18 href=#__codelineno-55-18></a><span class=nb>print</span><span class=p>(</span><span class=n>swapped</span><span class=p>)</span>  <span class=c1># {1: &#39;a&#39;, 2: &#39;b&#39;, 3: &#39;c&#39;}</span>
</span></code></pre></div> <h4 id=set-comprehensions><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#set-comprehensions>Set Comprehensions</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-56-1><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a><span class=c1># Basic set comprehension</span>
</span><span id=__span-56-2><a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a><span class=n>unique_lengths</span> <span class=o>=</span> <span class=p>{</span><span class=nb>len</span><span class=p>(</span><span class=n>word</span><span class=p>)</span> <span class=k>for</span> <span class=n>word</span> <span class=ow>in</span> <span class=n>words</span><span class=p>}</span>
</span><span id=__span-56-3><a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a><span class=nb>print</span><span class=p>(</span><span class=n>unique_lengths</span><span class=p>)</span>  <span class=c1># {5, 6, 13}</span>
</span><span id=__span-56-4><a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a>
</span><span id=__span-56-5><a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a><span class=c1># Removing duplicates with transformation</span>
</span><span id=__span-56-6><a id=__codelineno-56-6 name=__codelineno-56-6 href=#__codelineno-56-6></a><span class=n>numbers</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>]</span>
</span><span id=__span-56-7><a id=__codelineno-56-7 name=__codelineno-56-7 href=#__codelineno-56-7></a><span class=n>unique_squares</span> <span class=o>=</span> <span class=p>{</span><span class=n>x</span><span class=o>**</span><span class=mi>2</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>numbers</span><span class=p>}</span>
</span><span id=__span-56-8><a id=__codelineno-56-8 name=__codelineno-56-8 href=#__codelineno-56-8></a><span class=nb>print</span><span class=p>(</span><span class=n>unique_squares</span><span class=p>)</span>  <span class=c1># {1, 4, 9, 16}</span>
</span><span id=__span-56-9><a id=__codelineno-56-9 name=__codelineno-56-9 href=#__codelineno-56-9></a>
</span><span id=__span-56-10><a id=__codelineno-56-10 name=__codelineno-56-10 href=#__codelineno-56-10></a><span class=c1># Complex filtering</span>
</span><span id=__span-56-11><a id=__codelineno-56-11 name=__codelineno-56-11 href=#__codelineno-56-11></a><span class=kn>import</span><span class=w> </span><span class=nn>re</span>
</span><span id=__span-56-12><a id=__codelineno-56-12 name=__codelineno-56-12 href=#__codelineno-56-12></a><span class=n>text</span> <span class=o>=</span> <span class=s2>&quot;The quick brown fox jumps over the lazy dog&quot;</span>
</span><span id=__span-56-13><a id=__codelineno-56-13 name=__codelineno-56-13 href=#__codelineno-56-13></a><span class=n>word_pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;\b\w+\b&#39;</span><span class=p>)</span>
</span><span id=__span-56-14><a id=__codelineno-56-14 name=__codelineno-56-14 href=#__codelineno-56-14></a><span class=n>unique_word_starts</span> <span class=o>=</span> <span class=p>{</span><span class=n>word</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=k>for</span> <span class=n>word</span> <span class=ow>in</span> <span class=n>word_pattern</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>text</span><span class=p>)}</span>
</span><span id=__span-56-15><a id=__codelineno-56-15 name=__codelineno-56-15 href=#__codelineno-56-15></a><span class=nb>print</span><span class=p>(</span><span class=n>unique_word_starts</span><span class=p>)</span>  <span class=c1># {&#39;b&#39;, &#39;d&#39;, &#39;f&#39;, &#39;j&#39;, &#39;l&#39;, &#39;o&#39;, &#39;q&#39;, &#39;t&#39;, &#39;u&#39;, &#39;w&#39;}</span>
</span></code></pre></div> <h3 id=generator-expressions><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#generator-expressions>Generator Expressions</a></h3> <p>Generator expressions are similar to list comprehensions but create generator objects instead of lists.</p> <h4 id=basic-generator-expressions><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#basic-generator-expressions>Basic Generator Expressions</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-57-1><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a><span class=c1># Generator expression syntax: (expression for item in iterable)</span>
</span><span id=__span-57-2><a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a><span class=n>squares_gen</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span><span class=o>**</span><span class=mi>2</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>))</span>
</span><span id=__span-57-3><a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a><span class=nb>print</span><span class=p>(</span><span class=nb>type</span><span class=p>(</span><span class=n>squares_gen</span><span class=p>))</span>  <span class=c1># &lt;class &#39;generator&#39;&gt;</span>
</span><span id=__span-57-4><a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a>
</span><span id=__span-57-5><a id=__codelineno-57-5 name=__codelineno-57-5 href=#__codelineno-57-5></a><span class=c1># Generators are iterators</span>
</span><span id=__span-57-6><a id=__codelineno-57-6 name=__codelineno-57-6 href=#__codelineno-57-6></a><span class=nb>print</span><span class=p>(</span><span class=nb>next</span><span class=p>(</span><span class=n>squares_gen</span><span class=p>))</span>  <span class=c1># 0</span>
</span><span id=__span-57-7><a id=__codelineno-57-7 name=__codelineno-57-7 href=#__codelineno-57-7></a><span class=nb>print</span><span class=p>(</span><span class=nb>next</span><span class=p>(</span><span class=n>squares_gen</span><span class=p>))</span>  <span class=c1># 1</span>
</span><span id=__span-57-8><a id=__codelineno-57-8 name=__codelineno-57-8 href=#__codelineno-57-8></a><span class=nb>print</span><span class=p>(</span><span class=nb>next</span><span class=p>(</span><span class=n>squares_gen</span><span class=p>))</span>  <span class=c1># 4</span>
</span><span id=__span-57-9><a id=__codelineno-57-9 name=__codelineno-57-9 href=#__codelineno-57-9></a>
</span><span id=__span-57-10><a id=__codelineno-57-10 name=__codelineno-57-10 href=#__codelineno-57-10></a><span class=c1># Converting to list when needed</span>
</span><span id=__span-57-11><a id=__codelineno-57-11 name=__codelineno-57-11 href=#__codelineno-57-11></a><span class=n>remaining_squares</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>squares_gen</span><span class=p>)</span>
</span><span id=__span-57-12><a id=__codelineno-57-12 name=__codelineno-57-12 href=#__codelineno-57-12></a><span class=nb>print</span><span class=p>(</span><span class=n>remaining_squares</span><span class=p>)</span>  <span class=c1># [9, 16, 25, 36, 49, 64, 81]</span>
</span></code></pre></div> <h4 id=memory-efficiency-demonstration><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#memory-efficiency-demonstration>Memory Efficiency Demonstration</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-58-1><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=kn>import</span><span class=w> </span><span class=nn>sys</span>
</span><span id=__span-58-2><a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a>
</span><span id=__span-58-3><a id=__codelineno-58-3 name=__codelineno-58-3 href=#__codelineno-58-3></a><span class=c1># List comprehension - creates all items in memory</span>
</span><span id=__span-58-4><a id=__codelineno-58-4 name=__codelineno-58-4 href=#__codelineno-58-4></a><span class=n>list_comp</span> <span class=o>=</span> <span class=p>[</span><span class=n>x</span><span class=o>**</span><span class=mi>2</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1000000</span><span class=p>)]</span>
</span><span id=__span-58-5><a id=__codelineno-58-5 name=__codelineno-58-5 href=#__codelineno-58-5></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;List size: </span><span class=si>{</span><span class=n>sys</span><span class=o>.</span><span class=n>getsizeof</span><span class=p>(</span><span class=n>list_comp</span><span class=p>)</span><span class=si>}</span><span class=s2> bytes&quot;</span><span class=p>)</span>
</span><span id=__span-58-6><a id=__codelineno-58-6 name=__codelineno-58-6 href=#__codelineno-58-6></a>
</span><span id=__span-58-7><a id=__codelineno-58-7 name=__codelineno-58-7 href=#__codelineno-58-7></a><span class=c1># Generator expression - creates iterator, minimal memory</span>
</span><span id=__span-58-8><a id=__codelineno-58-8 name=__codelineno-58-8 href=#__codelineno-58-8></a><span class=n>gen_exp</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span><span class=o>**</span><span class=mi>2</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1000000</span><span class=p>))</span>
</span><span id=__span-58-9><a id=__codelineno-58-9 name=__codelineno-58-9 href=#__codelineno-58-9></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Generator size: </span><span class=si>{</span><span class=n>sys</span><span class=o>.</span><span class=n>getsizeof</span><span class=p>(</span><span class=n>gen_exp</span><span class=p>)</span><span class=si>}</span><span class=s2> bytes&quot;</span><span class=p>)</span>
</span><span id=__span-58-10><a id=__codelineno-58-10 name=__codelineno-58-10 href=#__codelineno-58-10></a>
</span><span id=__span-58-11><a id=__codelineno-58-11 name=__codelineno-58-11 href=#__codelineno-58-11></a><span class=c1># The difference is dramatic:</span>
</span><span id=__span-58-12><a id=__codelineno-58-12 name=__codelineno-58-12 href=#__codelineno-58-12></a><span class=c1># List size: 8697464 bytes</span>
</span><span id=__span-58-13><a id=__codelineno-58-13 name=__codelineno-58-13 href=#__codelineno-58-13></a><span class=c1># Generator size: 104 bytes</span>
</span></code></pre></div> <h4 id=generator-expressions-in-functions><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#generator-expressions-in-functions>Generator Expressions in Functions</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-59-1><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=c1># Passing generators to functions</span>
</span><span id=__span-59-2><a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a><span class=k>def</span><span class=w> </span><span class=nf>sum_of_squares</span><span class=p>(</span><span class=n>iterable</span><span class=p>):</span>
</span><span id=__span-59-3><a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a>    <span class=k>return</span> <span class=nb>sum</span><span class=p>(</span><span class=n>x</span><span class=o>**</span><span class=mi>2</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>iterable</span><span class=p>)</span>
</span><span id=__span-59-4><a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a>
</span><span id=__span-59-5><a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a><span class=n>result</span> <span class=o>=</span> <span class=n>sum_of_squares</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>))</span>
</span><span id=__span-59-6><a id=__codelineno-59-6 name=__codelineno-59-6 href=#__codelineno-59-6></a><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>  <span class=c1># 328350</span>
</span><span id=__span-59-7><a id=__codelineno-59-7 name=__codelineno-59-7 href=#__codelineno-59-7></a>
</span><span id=__span-59-8><a id=__codelineno-59-8 name=__codelineno-59-8 href=#__codelineno-59-8></a><span class=c1># Multiple generator expressions</span>
</span><span id=__span-59-9><a id=__codelineno-59-9 name=__codelineno-59-9 href=#__codelineno-59-9></a><span class=k>def</span><span class=w> </span><span class=nf>process_data</span><span class=p>(</span><span class=n>numbers</span><span class=p>):</span>
</span><span id=__span-59-10><a id=__codelineno-59-10 name=__codelineno-59-10 href=#__codelineno-59-10></a>    <span class=c1># Chain multiple transformations</span>
</span><span id=__span-59-11><a id=__codelineno-59-11 name=__codelineno-59-11 href=#__codelineno-59-11></a>    <span class=n>filtered</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>numbers</span> <span class=k>if</span> <span class=n>x</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span><span id=__span-59-12><a id=__codelineno-59-12 name=__codelineno-59-12 href=#__codelineno-59-12></a>    <span class=n>squared</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span><span class=o>**</span><span class=mi>2</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>filtered</span><span class=p>)</span>
</span><span id=__span-59-13><a id=__codelineno-59-13 name=__codelineno-59-13 href=#__codelineno-59-13></a>    <span class=n>normalized</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span> <span class=o>/</span> <span class=nb>max</span><span class=p>(</span><span class=n>squared</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>squared</span><span class=p>)</span>
</span><span id=__span-59-14><a id=__codelineno-59-14 name=__codelineno-59-14 href=#__codelineno-59-14></a>    <span class=k>return</span> <span class=nb>list</span><span class=p>(</span><span class=n>normalized</span><span class=p>)</span>
</span><span id=__span-59-15><a id=__codelineno-59-15 name=__codelineno-59-15 href=#__codelineno-59-15></a>
</span><span id=__span-59-16><a id=__codelineno-59-16 name=__codelineno-59-16 href=#__codelineno-59-16></a><span class=n>data</span> <span class=o>=</span> <span class=p>[</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>]</span>
</span><span id=__span-59-17><a id=__codelineno-59-17 name=__codelineno-59-17 href=#__codelineno-59-17></a><span class=n>processed</span> <span class=o>=</span> <span class=n>process_data</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span><span id=__span-59-18><a id=__codelineno-59-18 name=__codelineno-59-18 href=#__codelineno-59-18></a><span class=nb>print</span><span class=p>(</span><span class=n>processed</span><span class=p>)</span>
</span></code></pre></div> <h3 id=generator-functions><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#generator-functions>Generator Functions</a></h3> <p>Generator functions use the <code>yield</code> keyword to create generators that can maintain state between calls.</p> <h4 id=basic-generator-functions><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#basic-generator-functions>Basic Generator Functions</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-60-1><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a><span class=k>def</span><span class=w> </span><span class=nf>simple_generator</span><span class=p>():</span>
</span><span id=__span-60-2><a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a>    <span class=k>yield</span> <span class=mi>1</span>
</span><span id=__span-60-3><a id=__codelineno-60-3 name=__codelineno-60-3 href=#__codelineno-60-3></a>    <span class=k>yield</span> <span class=mi>2</span>
</span><span id=__span-60-4><a id=__codelineno-60-4 name=__codelineno-60-4 href=#__codelineno-60-4></a>    <span class=k>yield</span> <span class=mi>3</span>
</span><span id=__span-60-5><a id=__codelineno-60-5 name=__codelineno-60-5 href=#__codelineno-60-5></a>
</span><span id=__span-60-6><a id=__codelineno-60-6 name=__codelineno-60-6 href=#__codelineno-60-6></a><span class=n>gen</span> <span class=o>=</span> <span class=n>simple_generator</span><span class=p>()</span>
</span><span id=__span-60-7><a id=__codelineno-60-7 name=__codelineno-60-7 href=#__codelineno-60-7></a><span class=nb>print</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>gen</span><span class=p>))</span>  <span class=c1># [1, 2, 3]</span>
</span><span id=__span-60-8><a id=__codelineno-60-8 name=__codelineno-60-8 href=#__codelineno-60-8></a>
</span><span id=__span-60-9><a id=__codelineno-60-9 name=__codelineno-60-9 href=#__codelineno-60-9></a><span class=c1># Generators with loops</span>
</span><span id=__span-60-10><a id=__codelineno-60-10 name=__codelineno-60-10 href=#__codelineno-60-10></a><span class=k>def</span><span class=w> </span><span class=nf>countdown</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span><span id=__span-60-11><a id=__codelineno-60-11 name=__codelineno-60-11 href=#__codelineno-60-11></a>    <span class=k>while</span> <span class=n>n</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-60-12><a id=__codelineno-60-12 name=__codelineno-60-12 href=#__codelineno-60-12></a>        <span class=k>yield</span> <span class=n>n</span>
</span><span id=__span-60-13><a id=__codelineno-60-13 name=__codelineno-60-13 href=#__codelineno-60-13></a>        <span class=n>n</span> <span class=o>-=</span> <span class=mi>1</span>
</span><span id=__span-60-14><a id=__codelineno-60-14 name=__codelineno-60-14 href=#__codelineno-60-14></a>
</span><span id=__span-60-15><a id=__codelineno-60-15 name=__codelineno-60-15 href=#__codelineno-60-15></a><span class=k>for</span> <span class=n>num</span> <span class=ow>in</span> <span class=n>countdown</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span><span id=__span-60-16><a id=__codelineno-60-16 name=__codelineno-60-16 href=#__codelineno-60-16></a>    <span class=nb>print</span><span class=p>(</span><span class=n>num</span><span class=p>)</span>  <span class=c1># 5, 4, 3, 2, 1</span>
</span></code></pre></div> <h4 id=fibonacci-generator><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#fibonacci-generator>Fibonacci Generator</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-61-1><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=k>def</span><span class=w> </span><span class=nf>fibonacci</span><span class=p>():</span>
</span><span id=__span-61-2><a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a>    <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span>
</span><span id=__span-61-3><a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span><span id=__span-61-4><a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a>        <span class=k>yield</span> <span class=n>a</span>
</span><span id=__span-61-5><a id=__codelineno-61-5 name=__codelineno-61-5 href=#__codelineno-61-5></a>        <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>b</span><span class=p>,</span> <span class=n>a</span> <span class=o>+</span> <span class=n>b</span>
</span><span id=__span-61-6><a id=__codelineno-61-6 name=__codelineno-61-6 href=#__codelineno-61-6></a>
</span><span id=__span-61-7><a id=__codelineno-61-7 name=__codelineno-61-7 href=#__codelineno-61-7></a><span class=c1># Generate first 10 Fibonacci numbers</span>
</span><span id=__span-61-8><a id=__codelineno-61-8 name=__codelineno-61-8 href=#__codelineno-61-8></a><span class=n>fib_gen</span> <span class=o>=</span> <span class=n>fibonacci</span><span class=p>()</span>
</span><span id=__span-61-9><a id=__codelineno-61-9 name=__codelineno-61-9 href=#__codelineno-61-9></a><span class=n>first_ten</span> <span class=o>=</span> <span class=p>[</span><span class=nb>next</span><span class=p>(</span><span class=n>fib_gen</span><span class=p>)</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>)]</span>
</span><span id=__span-61-10><a id=__codelineno-61-10 name=__codelineno-61-10 href=#__codelineno-61-10></a><span class=nb>print</span><span class=p>(</span><span class=n>first_ten</span><span class=p>)</span>  <span class=c1># [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]</span>
</span></code></pre></div> <h4 id=file-processing-generator><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#file-processing-generator>File Processing Generator</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-62-1><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a><span class=k>def</span><span class=w> </span><span class=nf>read_large_file</span><span class=p>(</span><span class=n>filename</span><span class=p>):</span>
</span><span id=__span-62-2><a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Read a large file line by line without loading it entirely into memory.&quot;&quot;&quot;</span>
</span><span id=__span-62-3><a id=__codelineno-62-3 name=__codelineno-62-3 href=#__codelineno-62-3></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-62-4><a id=__codelineno-62-4 name=__codelineno-62-4 href=#__codelineno-62-4></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-62-5><a id=__codelineno-62-5 name=__codelineno-62-5 href=#__codelineno-62-5></a>            <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-62-6><a id=__codelineno-62-6 name=__codelineno-62-6 href=#__codelineno-62-6></a>                <span class=k>yield</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-62-7><a id=__codelineno-62-7 name=__codelineno-62-7 href=#__codelineno-62-7></a>    <span class=k>except</span> <span class=ne>FileNotFoundError</span><span class=p>:</span>
</span><span id=__span-62-8><a id=__codelineno-62-8 name=__codelineno-62-8 href=#__codelineno-62-8></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;File </span><span class=si>{</span><span class=n>filename</span><span class=si>}</span><span class=s2> not found&quot;</span><span class=p>)</span>
</span><span id=__span-62-9><a id=__codelineno-62-9 name=__codelineno-62-9 href=#__codelineno-62-9></a>        <span class=k>return</span>
</span><span id=__span-62-10><a id=__codelineno-62-10 name=__codelineno-62-10 href=#__codelineno-62-10></a>
</span><span id=__span-62-11><a id=__codelineno-62-11 name=__codelineno-62-11 href=#__codelineno-62-11></a><span class=c1># Usage example (would work with actual file)</span>
</span><span id=__span-62-12><a id=__codelineno-62-12 name=__codelineno-62-12 href=#__codelineno-62-12></a><span class=c1># for line in read_large_file(&#39;large_data.txt&#39;):</span>
</span><span id=__span-62-13><a id=__codelineno-62-13 name=__codelineno-62-13 href=#__codelineno-62-13></a><span class=c1>#     process_line(line)</span>
</span></code></pre></div> <h4 id=stateful-generators><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#stateful-generators>Stateful Generators</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-63-1><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a><span class=k>def</span><span class=w> </span><span class=nf>running_average</span><span class=p>():</span>
</span><span id=__span-63-2><a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Generate running average of sent values.&quot;&quot;&quot;</span>
</span><span id=__span-63-3><a id=__codelineno-63-3 name=__codelineno-63-3 href=#__codelineno-63-3></a>    <span class=n>total</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-63-4><a id=__codelineno-63-4 name=__codelineno-63-4 href=#__codelineno-63-4></a>    <span class=n>count</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-63-5><a id=__codelineno-63-5 name=__codelineno-63-5 href=#__codelineno-63-5></a>    <span class=n>average</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-63-6><a id=__codelineno-63-6 name=__codelineno-63-6 href=#__codelineno-63-6></a>
</span><span id=__span-63-7><a id=__codelineno-63-7 name=__codelineno-63-7 href=#__codelineno-63-7></a>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span><span id=__span-63-8><a id=__codelineno-63-8 name=__codelineno-63-8 href=#__codelineno-63-8></a>        <span class=n>value</span> <span class=o>=</span> <span class=k>yield</span> <span class=n>average</span>
</span><span id=__span-63-9><a id=__codelineno-63-9 name=__codelineno-63-9 href=#__codelineno-63-9></a>        <span class=k>if</span> <span class=n>value</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-63-10><a id=__codelineno-63-10 name=__codelineno-63-10 href=#__codelineno-63-10></a>            <span class=n>total</span> <span class=o>+=</span> <span class=n>value</span>
</span><span id=__span-63-11><a id=__codelineno-63-11 name=__codelineno-63-11 href=#__codelineno-63-11></a>            <span class=n>count</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-63-12><a id=__codelineno-63-12 name=__codelineno-63-12 href=#__codelineno-63-12></a>            <span class=n>average</span> <span class=o>=</span> <span class=n>total</span> <span class=o>/</span> <span class=n>count</span>
</span><span id=__span-63-13><a id=__codelineno-63-13 name=__codelineno-63-13 href=#__codelineno-63-13></a>
</span><span id=__span-63-14><a id=__codelineno-63-14 name=__codelineno-63-14 href=#__codelineno-63-14></a><span class=c1># Usage</span>
</span><span id=__span-63-15><a id=__codelineno-63-15 name=__codelineno-63-15 href=#__codelineno-63-15></a><span class=n>avg_gen</span> <span class=o>=</span> <span class=n>running_average</span><span class=p>()</span>
</span><span id=__span-63-16><a id=__codelineno-63-16 name=__codelineno-63-16 href=#__codelineno-63-16></a><span class=nb>next</span><span class=p>(</span><span class=n>avg_gen</span><span class=p>)</span>  <span class=c1># Prime the generator</span>
</span><span id=__span-63-17><a id=__codelineno-63-17 name=__codelineno-63-17 href=#__codelineno-63-17></a>
</span><span id=__span-63-18><a id=__codelineno-63-18 name=__codelineno-63-18 href=#__codelineno-63-18></a><span class=nb>print</span><span class=p>(</span><span class=n>avg_gen</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=mi>10</span><span class=p>))</span>    <span class=c1># 10.0</span>
</span><span id=__span-63-19><a id=__codelineno-63-19 name=__codelineno-63-19 href=#__codelineno-63-19></a><span class=nb>print</span><span class=p>(</span><span class=n>avg_gen</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=mi>20</span><span class=p>))</span>    <span class=c1># 15.0</span>
</span><span id=__span-63-20><a id=__codelineno-63-20 name=__codelineno-63-20 href=#__codelineno-63-20></a><span class=nb>print</span><span class=p>(</span><span class=n>avg_gen</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=mi>30</span><span class=p>))</span>    <span class=c1># 20.0</span>
</span></code></pre></div> <h3 id=advanced-generator-patterns><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#advanced-generator-patterns>Advanced Generator Patterns</a></h3> <h4 id=generator-chaining><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#generator-chaining>Generator Chaining</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-64-1><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a><span class=k>def</span><span class=w> </span><span class=nf>filter_positive</span><span class=p>(</span><span class=n>numbers</span><span class=p>):</span>
</span><span id=__span-64-2><a id=__codelineno-64-2 name=__codelineno-64-2 href=#__codelineno-64-2></a>    <span class=k>for</span> <span class=n>num</span> <span class=ow>in</span> <span class=n>numbers</span><span class=p>:</span>
</span><span id=__span-64-3><a id=__codelineno-64-3 name=__codelineno-64-3 href=#__codelineno-64-3></a>        <span class=k>if</span> <span class=n>num</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-64-4><a id=__codelineno-64-4 name=__codelineno-64-4 href=#__codelineno-64-4></a>            <span class=k>yield</span> <span class=n>num</span>
</span><span id=__span-64-5><a id=__codelineno-64-5 name=__codelineno-64-5 href=#__codelineno-64-5></a>
</span><span id=__span-64-6><a id=__codelineno-64-6 name=__codelineno-64-6 href=#__codelineno-64-6></a><span class=k>def</span><span class=w> </span><span class=nf>square_numbers</span><span class=p>(</span><span class=n>numbers</span><span class=p>):</span>
</span><span id=__span-64-7><a id=__codelineno-64-7 name=__codelineno-64-7 href=#__codelineno-64-7></a>    <span class=k>for</span> <span class=n>num</span> <span class=ow>in</span> <span class=n>numbers</span><span class=p>:</span>
</span><span id=__span-64-8><a id=__codelineno-64-8 name=__codelineno-64-8 href=#__codelineno-64-8></a>        <span class=k>yield</span> <span class=n>num</span> <span class=o>**</span> <span class=mi>2</span>
</span><span id=__span-64-9><a id=__codelineno-64-9 name=__codelineno-64-9 href=#__codelineno-64-9></a>
</span><span id=__span-64-10><a id=__codelineno-64-10 name=__codelineno-64-10 href=#__codelineno-64-10></a><span class=k>def</span><span class=w> </span><span class=nf>limit_results</span><span class=p>(</span><span class=n>numbers</span><span class=p>,</span> <span class=n>limit</span><span class=p>):</span>
</span><span id=__span-64-11><a id=__codelineno-64-11 name=__codelineno-64-11 href=#__codelineno-64-11></a>    <span class=n>count</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-64-12><a id=__codelineno-64-12 name=__codelineno-64-12 href=#__codelineno-64-12></a>    <span class=k>for</span> <span class=n>num</span> <span class=ow>in</span> <span class=n>numbers</span><span class=p>:</span>
</span><span id=__span-64-13><a id=__codelineno-64-13 name=__codelineno-64-13 href=#__codelineno-64-13></a>        <span class=k>if</span> <span class=n>count</span> <span class=o>&gt;=</span> <span class=n>limit</span><span class=p>:</span>
</span><span id=__span-64-14><a id=__codelineno-64-14 name=__codelineno-64-14 href=#__codelineno-64-14></a>            <span class=k>break</span>
</span><span id=__span-64-15><a id=__codelineno-64-15 name=__codelineno-64-15 href=#__codelineno-64-15></a>        <span class=k>yield</span> <span class=n>num</span>
</span><span id=__span-64-16><a id=__codelineno-64-16 name=__codelineno-64-16 href=#__codelineno-64-16></a>        <span class=n>count</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-64-17><a id=__codelineno-64-17 name=__codelineno-64-17 href=#__codelineno-64-17></a>
</span><span id=__span-64-18><a id=__codelineno-64-18 name=__codelineno-64-18 href=#__codelineno-64-18></a><span class=c1># Chain generators together</span>
</span><span id=__span-64-19><a id=__codelineno-64-19 name=__codelineno-64-19 href=#__codelineno-64-19></a><span class=n>data</span> <span class=o>=</span> <span class=p>[</span><span class=o>-</span><span class=mi>3</span><span class=p>,</span> <span class=o>-</span><span class=mi>2</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>10</span><span class=p>]</span>
</span><span id=__span-64-20><a id=__codelineno-64-20 name=__codelineno-64-20 href=#__codelineno-64-20></a><span class=n>result</span> <span class=o>=</span> <span class=n>limit_results</span><span class=p>(</span><span class=n>square_numbers</span><span class=p>(</span><span class=n>filter_positive</span><span class=p>(</span><span class=n>data</span><span class=p>)),</span> <span class=mi>5</span><span class=p>)</span>
</span><span id=__span-64-21><a id=__codelineno-64-21 name=__codelineno-64-21 href=#__codelineno-64-21></a><span class=nb>print</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>result</span><span class=p>))</span>  <span class=c1># [1, 4, 9, 16, 25]</span>
</span></code></pre></div> <h4 id=generator-pipelines><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#generator-pipelines>Generator Pipelines</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-65-1><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a><span class=k>def</span><span class=w> </span><span class=nf>pipeline</span><span class=p>(</span><span class=o>*</span><span class=n>functions</span><span class=p>):</span>
</span><span id=__span-65-2><a id=__codelineno-65-2 name=__codelineno-65-2 href=#__codelineno-65-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Create a pipeline of generator functions.&quot;&quot;&quot;</span>
</span><span id=__span-65-3><a id=__codelineno-65-3 name=__codelineno-65-3 href=#__codelineno-65-3></a>    <span class=k>def</span><span class=w> </span><span class=nf>generator</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span><span id=__span-65-4><a id=__codelineno-65-4 name=__codelineno-65-4 href=#__codelineno-65-4></a>        <span class=n>result</span> <span class=o>=</span> <span class=n>data</span>
</span><span id=__span-65-5><a id=__codelineno-65-5 name=__codelineno-65-5 href=#__codelineno-65-5></a>        <span class=k>for</span> <span class=n>func</span> <span class=ow>in</span> <span class=n>functions</span><span class=p>:</span>
</span><span id=__span-65-6><a id=__codelineno-65-6 name=__codelineno-65-6 href=#__codelineno-65-6></a>            <span class=n>result</span> <span class=o>=</span> <span class=n>func</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span><span id=__span-65-7><a id=__codelineno-65-7 name=__codelineno-65-7 href=#__codelineno-65-7></a>        <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-65-8><a id=__codelineno-65-8 name=__codelineno-65-8 href=#__codelineno-65-8></a>    <span class=k>return</span> <span class=n>generator</span>
</span><span id=__span-65-9><a id=__codelineno-65-9 name=__codelineno-65-9 href=#__codelineno-65-9></a>
</span><span id=__span-65-10><a id=__codelineno-65-10 name=__codelineno-65-10 href=#__codelineno-65-10></a><span class=c1># Create processing pipeline</span>
</span><span id=__span-65-11><a id=__codelineno-65-11 name=__codelineno-65-11 href=#__codelineno-65-11></a><span class=n>process_pipeline</span> <span class=o>=</span> <span class=n>pipeline</span><span class=p>(</span>
</span><span id=__span-65-12><a id=__codelineno-65-12 name=__codelineno-65-12 href=#__codelineno-65-12></a>    <span class=n>filter_positive</span><span class=p>,</span>
</span><span id=__span-65-13><a id=__codelineno-65-13 name=__codelineno-65-13 href=#__codelineno-65-13></a>    <span class=n>square_numbers</span><span class=p>,</span>
</span><span id=__span-65-14><a id=__codelineno-65-14 name=__codelineno-65-14 href=#__codelineno-65-14></a>    <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>limit_results</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span><span id=__span-65-15><a id=__codelineno-65-15 name=__codelineno-65-15 href=#__codelineno-65-15></a><span class=p>)</span>
</span><span id=__span-65-16><a id=__codelineno-65-16 name=__codelineno-65-16 href=#__codelineno-65-16></a>
</span><span id=__span-65-17><a id=__codelineno-65-17 name=__codelineno-65-17 href=#__codelineno-65-17></a><span class=n>data</span> <span class=o>=</span> <span class=p>[</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>]</span>
</span><span id=__span-65-18><a id=__codelineno-65-18 name=__codelineno-65-18 href=#__codelineno-65-18></a><span class=n>result</span> <span class=o>=</span> <span class=n>process_pipeline</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span><span id=__span-65-19><a id=__codelineno-65-19 name=__codelineno-65-19 href=#__codelineno-65-19></a><span class=nb>print</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>result</span><span class=p>))</span>  <span class=c1># [1, 4, 9]</span>
</span></code></pre></div> <h4 id=coroutines-with-generators><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#coroutines-with-generators>Coroutines with Generators</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-66-1><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a><span class=k>def</span><span class=w> </span><span class=nf>coroutine</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
</span><span id=__span-66-2><a id=__codelineno-66-2 name=__codelineno-66-2 href=#__codelineno-66-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Decorator to prime a coroutine.&quot;&quot;&quot;</span>
</span><span id=__span-66-3><a id=__codelineno-66-3 name=__codelineno-66-3 href=#__codelineno-66-3></a>    <span class=k>def</span><span class=w> </span><span class=nf>wrapper</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-66-4><a id=__codelineno-66-4 name=__codelineno-66-4 href=#__codelineno-66-4></a>        <span class=n>gen</span> <span class=o>=</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-66-5><a id=__codelineno-66-5 name=__codelineno-66-5 href=#__codelineno-66-5></a>        <span class=nb>next</span><span class=p>(</span><span class=n>gen</span><span class=p>)</span>
</span><span id=__span-66-6><a id=__codelineno-66-6 name=__codelineno-66-6 href=#__codelineno-66-6></a>        <span class=k>return</span> <span class=n>gen</span>
</span><span id=__span-66-7><a id=__codelineno-66-7 name=__codelineno-66-7 href=#__codelineno-66-7></a>    <span class=k>return</span> <span class=n>wrapper</span>
</span><span id=__span-66-8><a id=__codelineno-66-8 name=__codelineno-66-8 href=#__codelineno-66-8></a>
</span><span id=__span-66-9><a id=__codelineno-66-9 name=__codelineno-66-9 href=#__codelineno-66-9></a><span class=nd>@coroutine</span>
</span><span id=__span-66-10><a id=__codelineno-66-10 name=__codelineno-66-10 href=#__codelineno-66-10></a><span class=k>def</span><span class=w> </span><span class=nf>moving_average</span><span class=p>(</span><span class=n>window_size</span><span class=p>):</span>
</span><span id=__span-66-11><a id=__codelineno-66-11 name=__codelineno-66-11 href=#__codelineno-66-11></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Calculate moving average with specified window size.&quot;&quot;&quot;</span>
</span><span id=__span-66-12><a id=__codelineno-66-12 name=__codelineno-66-12 href=#__codelineno-66-12></a>    <span class=n>values</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-66-13><a id=__codelineno-66-13 name=__codelineno-66-13 href=#__codelineno-66-13></a>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span><span id=__span-66-14><a id=__codelineno-66-14 name=__codelineno-66-14 href=#__codelineno-66-14></a>        <span class=n>value</span> <span class=o>=</span> <span class=k>yield</span>
</span><span id=__span-66-15><a id=__codelineno-66-15 name=__codelineno-66-15 href=#__codelineno-66-15></a>        <span class=n>values</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span><span id=__span-66-16><a id=__codelineno-66-16 name=__codelineno-66-16 href=#__codelineno-66-16></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>values</span><span class=p>)</span> <span class=o>&gt;</span> <span class=n>window_size</span><span class=p>:</span>
</span><span id=__span-66-17><a id=__codelineno-66-17 name=__codelineno-66-17 href=#__codelineno-66-17></a>            <span class=n>values</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-66-18><a id=__codelineno-66-18 name=__codelineno-66-18 href=#__codelineno-66-18></a>        <span class=n>average</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>values</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>values</span><span class=p>)</span>
</span><span id=__span-66-19><a id=__codelineno-66-19 name=__codelineno-66-19 href=#__codelineno-66-19></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Current average: </span><span class=si>{</span><span class=n>average</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-66-20><a id=__codelineno-66-20 name=__codelineno-66-20 href=#__codelineno-66-20></a>
</span><span id=__span-66-21><a id=__codelineno-66-21 name=__codelineno-66-21 href=#__codelineno-66-21></a><span class=c1># Usage</span>
</span><span id=__span-66-22><a id=__codelineno-66-22 name=__codelineno-66-22 href=#__codelineno-66-22></a><span class=n>ma</span> <span class=o>=</span> <span class=n>moving_average</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span><span id=__span-66-23><a id=__codelineno-66-23 name=__codelineno-66-23 href=#__codelineno-66-23></a><span class=n>ma</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>  <span class=c1># Current average: 10.00</span>
</span><span id=__span-66-24><a id=__codelineno-66-24 name=__codelineno-66-24 href=#__codelineno-66-24></a><span class=n>ma</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span>  <span class=c1># Current average: 15.00</span>
</span><span id=__span-66-25><a id=__codelineno-66-25 name=__codelineno-66-25 href=#__codelineno-66-25></a><span class=n>ma</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span>  <span class=c1># Current average: 20.00</span>
</span><span id=__span-66-26><a id=__codelineno-66-26 name=__codelineno-66-26 href=#__codelineno-66-26></a><span class=n>ma</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=mi>40</span><span class=p>)</span>  <span class=c1># Current average: 30.00</span>
</span></code></pre></div> <h3 id=performance-analysis><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#performance-analysis>Performance Analysis</a></h3> <p>Let's compare the performance of different approaches to common tasks.</p> <h4 id=performance-testing-framework><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#performance-testing-framework>Performance Testing Framework</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-67-1><a id=__codelineno-67-1 name=__codelineno-67-1 href=#__codelineno-67-1></a><span class=kn>import</span><span class=w> </span><span class=nn>time</span>
</span><span id=__span-67-2><a id=__codelineno-67-2 name=__codelineno-67-2 href=#__codelineno-67-2></a><span class=kn>import</span><span class=w> </span><span class=nn>functools</span>
</span><span id=__span-67-3><a id=__codelineno-67-3 name=__codelineno-67-3 href=#__codelineno-67-3></a>
</span><span id=__span-67-4><a id=__codelineno-67-4 name=__codelineno-67-4 href=#__codelineno-67-4></a><span class=k>def</span><span class=w> </span><span class=nf>timing_decorator</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
</span><span id=__span-67-5><a id=__codelineno-67-5 name=__codelineno-67-5 href=#__codelineno-67-5></a>    <span class=nd>@functools</span><span class=o>.</span><span class=n>wraps</span><span class=p>(</span><span class=n>func</span><span class=p>)</span>
</span><span id=__span-67-6><a id=__codelineno-67-6 name=__codelineno-67-6 href=#__codelineno-67-6></a>    <span class=k>def</span><span class=w> </span><span class=nf>wrapper</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-67-7><a id=__codelineno-67-7 name=__codelineno-67-7 href=#__codelineno-67-7></a>        <span class=n>start</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span>
</span><span id=__span-67-8><a id=__codelineno-67-8 name=__codelineno-67-8 href=#__codelineno-67-8></a>        <span class=n>result</span> <span class=o>=</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-67-9><a id=__codelineno-67-9 name=__codelineno-67-9 href=#__codelineno-67-9></a>        <span class=n>end</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span>
</span><span id=__span-67-10><a id=__codelineno-67-10 name=__codelineno-67-10 href=#__codelineno-67-10></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>func</span><span class=o>.</span><span class=vm>__name__</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>end</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>start</span><span class=si>:</span><span class=s2>.6f</span><span class=si>}</span><span class=s2> seconds&quot;</span><span class=p>)</span>
</span><span id=__span-67-11><a id=__codelineno-67-11 name=__codelineno-67-11 href=#__codelineno-67-11></a>        <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-67-12><a id=__codelineno-67-12 name=__codelineno-67-12 href=#__codelineno-67-12></a>    <span class=k>return</span> <span class=n>wrapper</span>
</span><span id=__span-67-13><a id=__codelineno-67-13 name=__codelineno-67-13 href=#__codelineno-67-13></a>
</span><span id=__span-67-14><a id=__codelineno-67-14 name=__codelineno-67-14 href=#__codelineno-67-14></a><span class=nd>@timing_decorator</span>
</span><span id=__span-67-15><a id=__codelineno-67-15 name=__codelineno-67-15 href=#__codelineno-67-15></a><span class=k>def</span><span class=w> </span><span class=nf>list_comprehension_test</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span><span id=__span-67-16><a id=__codelineno-67-16 name=__codelineno-67-16 href=#__codelineno-67-16></a>    <span class=k>return</span> <span class=p>[</span><span class=n>x</span><span class=o>**</span><span class=mi>2</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=k>if</span> <span class=n>x</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>0</span><span class=p>]</span>
</span><span id=__span-67-17><a id=__codelineno-67-17 name=__codelineno-67-17 href=#__codelineno-67-17></a>
</span><span id=__span-67-18><a id=__codelineno-67-18 name=__codelineno-67-18 href=#__codelineno-67-18></a><span class=nd>@timing_decorator</span>
</span><span id=__span-67-19><a id=__codelineno-67-19 name=__codelineno-67-19 href=#__codelineno-67-19></a><span class=k>def</span><span class=w> </span><span class=nf>generator_expression_test</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span><span id=__span-67-20><a id=__codelineno-67-20 name=__codelineno-67-20 href=#__codelineno-67-20></a>    <span class=k>return</span> <span class=nb>list</span><span class=p>(</span><span class=n>x</span><span class=o>**</span><span class=mi>2</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=k>if</span> <span class=n>x</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span><span id=__span-67-21><a id=__codelineno-67-21 name=__codelineno-67-21 href=#__codelineno-67-21></a>
</span><span id=__span-67-22><a id=__codelineno-67-22 name=__codelineno-67-22 href=#__codelineno-67-22></a><span class=nd>@timing_decorator</span>
</span><span id=__span-67-23><a id=__codelineno-67-23 name=__codelineno-67-23 href=#__codelineno-67-23></a><span class=k>def</span><span class=w> </span><span class=nf>traditional_loop_test</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span><span id=__span-67-24><a id=__codelineno-67-24 name=__codelineno-67-24 href=#__codelineno-67-24></a>    <span class=n>result</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-67-25><a id=__codelineno-67-25 name=__codelineno-67-25 href=#__codelineno-67-25></a>    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span><span id=__span-67-26><a id=__codelineno-67-26 name=__codelineno-67-26 href=#__codelineno-67-26></a>        <span class=k>if</span> <span class=n>x</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-67-27><a id=__codelineno-67-27 name=__codelineno-67-27 href=#__codelineno-67-27></a>            <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>x</span><span class=o>**</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-67-28><a id=__codelineno-67-28 name=__codelineno-67-28 href=#__codelineno-67-28></a>    <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-67-29><a id=__codelineno-67-29 name=__codelineno-67-29 href=#__codelineno-67-29></a>
</span><span id=__span-67-30><a id=__codelineno-67-30 name=__codelineno-67-30 href=#__codelineno-67-30></a><span class=nd>@timing_decorator</span>
</span><span id=__span-67-31><a id=__codelineno-67-31 name=__codelineno-67-31 href=#__codelineno-67-31></a><span class=k>def</span><span class=w> </span><span class=nf>filter_map_test</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span><span id=__span-67-32><a id=__codelineno-67-32 name=__codelineno-67-32 href=#__codelineno-67-32></a>    <span class=k>return</span> <span class=nb>list</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>**</span><span class=mi>2</span><span class=p>,</span> <span class=nb>filter</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>0</span><span class=p>,</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span><span class=p>))))</span>
</span><span id=__span-67-33><a id=__codelineno-67-33 name=__codelineno-67-33 href=#__codelineno-67-33></a>
</span><span id=__span-67-34><a id=__codelineno-67-34 name=__codelineno-67-34 href=#__codelineno-67-34></a><span class=c1># Run performance tests</span>
</span><span id=__span-67-35><a id=__codelineno-67-35 name=__codelineno-67-35 href=#__codelineno-67-35></a><span class=n>n</span> <span class=o>=</span> <span class=mi>1000000</span>
</span><span id=__span-67-36><a id=__codelineno-67-36 name=__codelineno-67-36 href=#__codelineno-67-36></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Performance comparison for n =&quot;</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span><span id=__span-67-37><a id=__codelineno-67-37 name=__codelineno-67-37 href=#__codelineno-67-37></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;-&quot;</span> <span class=o>*</span> <span class=mi>40</span><span class=p>)</span>
</span><span id=__span-67-38><a id=__codelineno-67-38 name=__codelineno-67-38 href=#__codelineno-67-38></a>
</span><span id=__span-67-39><a id=__codelineno-67-39 name=__codelineno-67-39 href=#__codelineno-67-39></a><span class=n>result1</span> <span class=o>=</span> <span class=n>list_comprehension_test</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span><span id=__span-67-40><a id=__codelineno-67-40 name=__codelineno-67-40 href=#__codelineno-67-40></a><span class=n>result2</span> <span class=o>=</span> <span class=n>generator_expression_test</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span><span id=__span-67-41><a id=__codelineno-67-41 name=__codelineno-67-41 href=#__codelineno-67-41></a><span class=n>result3</span> <span class=o>=</span> <span class=n>traditional_loop_test</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span><span id=__span-67-42><a id=__codelineno-67-42 name=__codelineno-67-42 href=#__codelineno-67-42></a><span class=n>result4</span> <span class=o>=</span> <span class=n>filter_map_test</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span><span id=__span-67-43><a id=__codelineno-67-43 name=__codelineno-67-43 href=#__codelineno-67-43></a>
</span><span id=__span-67-44><a id=__codelineno-67-44 name=__codelineno-67-44 href=#__codelineno-67-44></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;All results equal: </span><span class=si>{</span><span class=n>result1</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>result2</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>result3</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>result4</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div> <h4 id=memory-usage-comparison><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#memory-usage-comparison>Memory Usage Comparison</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-68-1><a id=__codelineno-68-1 name=__codelineno-68-1 href=#__codelineno-68-1></a><span class=kn>import</span><span class=w> </span><span class=nn>tracemalloc</span>
</span><span id=__span-68-2><a id=__codelineno-68-2 name=__codelineno-68-2 href=#__codelineno-68-2></a>
</span><span id=__span-68-3><a id=__codelineno-68-3 name=__codelineno-68-3 href=#__codelineno-68-3></a><span class=k>def</span><span class=w> </span><span class=nf>memory_usage_test</span><span class=p>():</span>
</span><span id=__span-68-4><a id=__codelineno-68-4 name=__codelineno-68-4 href=#__codelineno-68-4></a>    <span class=c1># Test memory usage of different approaches</span>
</span><span id=__span-68-5><a id=__codelineno-68-5 name=__codelineno-68-5 href=#__codelineno-68-5></a>    <span class=n>test_size</span> <span class=o>=</span> <span class=mi>100000</span>
</span><span id=__span-68-6><a id=__codelineno-68-6 name=__codelineno-68-6 href=#__codelineno-68-6></a>
</span><span id=__span-68-7><a id=__codelineno-68-7 name=__codelineno-68-7 href=#__codelineno-68-7></a>    <span class=c1># List comprehension</span>
</span><span id=__span-68-8><a id=__codelineno-68-8 name=__codelineno-68-8 href=#__codelineno-68-8></a>    <span class=n>tracemalloc</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span><span id=__span-68-9><a id=__codelineno-68-9 name=__codelineno-68-9 href=#__codelineno-68-9></a>    <span class=n>list_result</span> <span class=o>=</span> <span class=p>[</span><span class=n>x</span><span class=o>**</span><span class=mi>2</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>test_size</span><span class=p>)]</span>
</span><span id=__span-68-10><a id=__codelineno-68-10 name=__codelineno-68-10 href=#__codelineno-68-10></a>    <span class=n>current</span><span class=p>,</span> <span class=n>peak</span> <span class=o>=</span> <span class=n>tracemalloc</span><span class=o>.</span><span class=n>get_traced_memory</span><span class=p>()</span>
</span><span id=__span-68-11><a id=__codelineno-68-11 name=__codelineno-68-11 href=#__codelineno-68-11></a>    <span class=n>tracemalloc</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span><span id=__span-68-12><a id=__codelineno-68-12 name=__codelineno-68-12 href=#__codelineno-68-12></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;List comprehension - Current: </span><span class=si>{</span><span class=n>current</span><span class=si>}</span><span class=s2> bytes, Peak: </span><span class=si>{</span><span class=n>peak</span><span class=si>}</span><span class=s2> bytes&quot;</span><span class=p>)</span>
</span><span id=__span-68-13><a id=__codelineno-68-13 name=__codelineno-68-13 href=#__codelineno-68-13></a>
</span><span id=__span-68-14><a id=__codelineno-68-14 name=__codelineno-68-14 href=#__codelineno-68-14></a>    <span class=c1># Generator expression (not materialized)</span>
</span><span id=__span-68-15><a id=__codelineno-68-15 name=__codelineno-68-15 href=#__codelineno-68-15></a>    <span class=n>tracemalloc</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span><span id=__span-68-16><a id=__codelineno-68-16 name=__codelineno-68-16 href=#__codelineno-68-16></a>    <span class=n>gen_result</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span><span class=o>**</span><span class=mi>2</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>test_size</span><span class=p>))</span>
</span><span id=__span-68-17><a id=__codelineno-68-17 name=__codelineno-68-17 href=#__codelineno-68-17></a>    <span class=n>current</span><span class=p>,</span> <span class=n>peak</span> <span class=o>=</span> <span class=n>tracemalloc</span><span class=o>.</span><span class=n>get_traced_memory</span><span class=p>()</span>
</span><span id=__span-68-18><a id=__codelineno-68-18 name=__codelineno-68-18 href=#__codelineno-68-18></a>    <span class=n>tracemalloc</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span><span id=__span-68-19><a id=__codelineno-68-19 name=__codelineno-68-19 href=#__codelineno-68-19></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Generator expression - Current: </span><span class=si>{</span><span class=n>current</span><span class=si>}</span><span class=s2> bytes, Peak: </span><span class=si>{</span><span class=n>peak</span><span class=si>}</span><span class=s2> bytes&quot;</span><span class=p>)</span>
</span><span id=__span-68-20><a id=__codelineno-68-20 name=__codelineno-68-20 href=#__codelineno-68-20></a>
</span><span id=__span-68-21><a id=__codelineno-68-21 name=__codelineno-68-21 href=#__codelineno-68-21></a>    <span class=c1># Generator expression (materialized)</span>
</span><span id=__span-68-22><a id=__codelineno-68-22 name=__codelineno-68-22 href=#__codelineno-68-22></a>    <span class=n>tracemalloc</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span><span id=__span-68-23><a id=__codelineno-68-23 name=__codelineno-68-23 href=#__codelineno-68-23></a>    <span class=n>gen_materialized</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>x</span><span class=o>**</span><span class=mi>2</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>test_size</span><span class=p>))</span>
</span><span id=__span-68-24><a id=__codelineno-68-24 name=__codelineno-68-24 href=#__codelineno-68-24></a>    <span class=n>current</span><span class=p>,</span> <span class=n>peak</span> <span class=o>=</span> <span class=n>tracemalloc</span><span class=o>.</span><span class=n>get_traced_memory</span><span class=p>()</span>
</span><span id=__span-68-25><a id=__codelineno-68-25 name=__codelineno-68-25 href=#__codelineno-68-25></a>    <span class=n>tracemalloc</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span><span id=__span-68-26><a id=__codelineno-68-26 name=__codelineno-68-26 href=#__codelineno-68-26></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Generator materialized - Current: </span><span class=si>{</span><span class=n>current</span><span class=si>}</span><span class=s2> bytes, Peak: </span><span class=si>{</span><span class=n>peak</span><span class=si>}</span><span class=s2> bytes&quot;</span><span class=p>)</span>
</span><span id=__span-68-27><a id=__codelineno-68-27 name=__codelineno-68-27 href=#__codelineno-68-27></a>
</span><span id=__span-68-28><a id=__codelineno-68-28 name=__codelineno-68-28 href=#__codelineno-68-28></a><span class=n>memory_usage_test</span><span class=p>()</span>
</span></code></pre></div> <h3 id=real-world-applications><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#real-world-applications>Real-World Applications</a></h3> <h4 id=data-processing-pipeline><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#data-processing-pipeline>Data Processing Pipeline</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-69-1><a id=__codelineno-69-1 name=__codelineno-69-1 href=#__codelineno-69-1></a><span class=k>def</span><span class=w> </span><span class=nf>process_log_file</span><span class=p>(</span><span class=n>filename</span><span class=p>):</span>
</span><span id=__span-69-2><a id=__codelineno-69-2 name=__codelineno-69-2 href=#__codelineno-69-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Process a log file using generators for memory efficiency.&quot;&quot;&quot;</span>
</span><span id=__span-69-3><a id=__codelineno-69-3 name=__codelineno-69-3 href=#__codelineno-69-3></a>
</span><span id=__span-69-4><a id=__codelineno-69-4 name=__codelineno-69-4 href=#__codelineno-69-4></a>    <span class=k>def</span><span class=w> </span><span class=nf>read_lines</span><span class=p>(</span><span class=n>filename</span><span class=p>):</span>
</span><span id=__span-69-5><a id=__codelineno-69-5 name=__codelineno-69-5 href=#__codelineno-69-5></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-69-6><a id=__codelineno-69-6 name=__codelineno-69-6 href=#__codelineno-69-6></a>            <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-69-7><a id=__codelineno-69-7 name=__codelineno-69-7 href=#__codelineno-69-7></a>                <span class=k>yield</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-69-8><a id=__codelineno-69-8 name=__codelineno-69-8 href=#__codelineno-69-8></a>
</span><span id=__span-69-9><a id=__codelineno-69-9 name=__codelineno-69-9 href=#__codelineno-69-9></a>    <span class=k>def</span><span class=w> </span><span class=nf>parse_log_entry</span><span class=p>(</span><span class=n>lines</span><span class=p>):</span>
</span><span id=__span-69-10><a id=__codelineno-69-10 name=__codelineno-69-10 href=#__codelineno-69-10></a>        <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>lines</span><span class=p>:</span>
</span><span id=__span-69-11><a id=__codelineno-69-11 name=__codelineno-69-11 href=#__codelineno-69-11></a>            <span class=k>if</span> <span class=n>line</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>line</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;#&#39;</span><span class=p>):</span>
</span><span id=__span-69-12><a id=__codelineno-69-12 name=__codelineno-69-12 href=#__codelineno-69-12></a>                <span class=n>parts</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>)</span>
</span><span id=__span-69-13><a id=__codelineno-69-13 name=__codelineno-69-13 href=#__codelineno-69-13></a>                <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>parts</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>4</span><span class=p>:</span>
</span><span id=__span-69-14><a id=__codelineno-69-14 name=__codelineno-69-14 href=#__codelineno-69-14></a>                    <span class=k>yield</span> <span class=p>{</span>
</span><span id=__span-69-15><a id=__codelineno-69-15 name=__codelineno-69-15 href=#__codelineno-69-15></a>                        <span class=s1>&#39;ip&#39;</span><span class=p>:</span> <span class=n>parts</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
</span><span id=__span-69-16><a id=__codelineno-69-16 name=__codelineno-69-16 href=#__codelineno-69-16></a>                        <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>parts</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span>
</span><span id=__span-69-17><a id=__codelineno-69-17 name=__codelineno-69-17 href=#__codelineno-69-17></a>                        <span class=s1>&#39;method&#39;</span><span class=p>:</span> <span class=n>parts</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span>
</span><span id=__span-69-18><a id=__codelineno-69-18 name=__codelineno-69-18 href=#__codelineno-69-18></a>                        <span class=s1>&#39;path&#39;</span><span class=p>:</span> <span class=n>parts</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span>
</span><span id=__span-69-19><a id=__codelineno-69-19 name=__codelineno-69-19 href=#__codelineno-69-19></a>                        <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=n>parts</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>parts</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>4</span> <span class=k>else</span> <span class=kc>None</span>
</span><span id=__span-69-20><a id=__codelineno-69-20 name=__codelineno-69-20 href=#__codelineno-69-20></a>                    <span class=p>}</span>
</span><span id=__span-69-21><a id=__codelineno-69-21 name=__codelineno-69-21 href=#__codelineno-69-21></a>
</span><span id=__span-69-22><a id=__codelineno-69-22 name=__codelineno-69-22 href=#__codelineno-69-22></a>    <span class=k>def</span><span class=w> </span><span class=nf>filter_errors</span><span class=p>(</span><span class=n>entries</span><span class=p>):</span>
</span><span id=__span-69-23><a id=__codelineno-69-23 name=__codelineno-69-23 href=#__codelineno-69-23></a>        <span class=k>for</span> <span class=n>entry</span> <span class=ow>in</span> <span class=n>entries</span><span class=p>:</span>
</span><span id=__span-69-24><a id=__codelineno-69-24 name=__codelineno-69-24 href=#__codelineno-69-24></a>            <span class=k>if</span> <span class=n>entry</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>400</span><span class=p>:</span>
</span><span id=__span-69-25><a id=__codelineno-69-25 name=__codelineno-69-25 href=#__codelineno-69-25></a>                <span class=k>yield</span> <span class=n>entry</span>
</span><span id=__span-69-26><a id=__codelineno-69-26 name=__codelineno-69-26 href=#__codelineno-69-26></a>
</span><span id=__span-69-27><a id=__codelineno-69-27 name=__codelineno-69-27 href=#__codelineno-69-27></a>    <span class=k>def</span><span class=w> </span><span class=nf>group_by_ip</span><span class=p>(</span><span class=n>entries</span><span class=p>):</span>
</span><span id=__span-69-28><a id=__codelineno-69-28 name=__codelineno-69-28 href=#__codelineno-69-28></a>        <span class=n>ip_groups</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-69-29><a id=__codelineno-69-29 name=__codelineno-69-29 href=#__codelineno-69-29></a>        <span class=k>for</span> <span class=n>entry</span> <span class=ow>in</span> <span class=n>entries</span><span class=p>:</span>
</span><span id=__span-69-30><a id=__codelineno-69-30 name=__codelineno-69-30 href=#__codelineno-69-30></a>            <span class=n>ip</span> <span class=o>=</span> <span class=n>entry</span><span class=p>[</span><span class=s1>&#39;ip&#39;</span><span class=p>]</span>
</span><span id=__span-69-31><a id=__codelineno-69-31 name=__codelineno-69-31 href=#__codelineno-69-31></a>            <span class=k>if</span> <span class=n>ip</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>ip_groups</span><span class=p>:</span>
</span><span id=__span-69-32><a id=__codelineno-69-32 name=__codelineno-69-32 href=#__codelineno-69-32></a>                <span class=n>ip_groups</span><span class=p>[</span><span class=n>ip</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-69-33><a id=__codelineno-69-33 name=__codelineno-69-33 href=#__codelineno-69-33></a>            <span class=n>ip_groups</span><span class=p>[</span><span class=n>ip</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>entry</span><span class=p>)</span>
</span><span id=__span-69-34><a id=__codelineno-69-34 name=__codelineno-69-34 href=#__codelineno-69-34></a>        <span class=k>return</span> <span class=n>ip_groups</span>
</span><span id=__span-69-35><a id=__codelineno-69-35 name=__codelineno-69-35 href=#__codelineno-69-35></a>
</span><span id=__span-69-36><a id=__codelineno-69-36 name=__codelineno-69-36 href=#__codelineno-69-36></a>    <span class=c1># Chain the generators</span>
</span><span id=__span-69-37><a id=__codelineno-69-37 name=__codelineno-69-37 href=#__codelineno-69-37></a>    <span class=n>lines</span> <span class=o>=</span> <span class=n>read_lines</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
</span><span id=__span-69-38><a id=__codelineno-69-38 name=__codelineno-69-38 href=#__codelineno-69-38></a>    <span class=n>entries</span> <span class=o>=</span> <span class=n>parse_log_entry</span><span class=p>(</span><span class=n>lines</span><span class=p>)</span>
</span><span id=__span-69-39><a id=__codelineno-69-39 name=__codelineno-69-39 href=#__codelineno-69-39></a>    <span class=n>errors</span> <span class=o>=</span> <span class=n>filter_errors</span><span class=p>(</span><span class=n>entries</span><span class=p>)</span>
</span><span id=__span-69-40><a id=__codelineno-69-40 name=__codelineno-69-40 href=#__codelineno-69-40></a>
</span><span id=__span-69-41><a id=__codelineno-69-41 name=__codelineno-69-41 href=#__codelineno-69-41></a>    <span class=k>return</span> <span class=n>group_by_ip</span><span class=p>(</span><span class=n>errors</span><span class=p>)</span>
</span><span id=__span-69-42><a id=__codelineno-69-42 name=__codelineno-69-42 href=#__codelineno-69-42></a>
</span><span id=__span-69-43><a id=__codelineno-69-43 name=__codelineno-69-43 href=#__codelineno-69-43></a><span class=c1># Usage (would work with actual log file)</span>
</span><span id=__span-69-44><a id=__codelineno-69-44 name=__codelineno-69-44 href=#__codelineno-69-44></a><span class=c1># error_summary = process_log_file(&#39;access.log&#39;)</span>
</span></code></pre></div> <h4 id=user-data-processing><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#user-data-processing>User Data Processing</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-70-1><a id=__codelineno-70-1 name=__codelineno-70-1 href=#__codelineno-70-1></a><span class=k>class</span><span class=w> </span><span class=nc>User</span><span class=p>:</span>
</span><span id=__span-70-2><a id=__codelineno-70-2 name=__codelineno-70-2 href=#__codelineno-70-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>age</span><span class=p>,</span> <span class=n>email</span><span class=p>,</span> <span class=n>active</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>subscription_level</span><span class=o>=</span><span class=s1>&#39;basic&#39;</span><span class=p>):</span>
</span><span id=__span-70-3><a id=__codelineno-70-3 name=__codelineno-70-3 href=#__codelineno-70-3></a>        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span>
</span><span id=__span-70-4><a id=__codelineno-70-4 name=__codelineno-70-4 href=#__codelineno-70-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>=</span> <span class=n>age</span>
</span><span id=__span-70-5><a id=__codelineno-70-5 name=__codelineno-70-5 href=#__codelineno-70-5></a>        <span class=bp>self</span><span class=o>.</span><span class=n>email</span> <span class=o>=</span> <span class=n>email</span>
</span><span id=__span-70-6><a id=__codelineno-70-6 name=__codelineno-70-6 href=#__codelineno-70-6></a>        <span class=bp>self</span><span class=o>.</span><span class=n>active</span> <span class=o>=</span> <span class=n>active</span>
</span><span id=__span-70-7><a id=__codelineno-70-7 name=__codelineno-70-7 href=#__codelineno-70-7></a>        <span class=bp>self</span><span class=o>.</span><span class=n>subscription_level</span> <span class=o>=</span> <span class=n>subscription_level</span>
</span><span id=__span-70-8><a id=__codelineno-70-8 name=__codelineno-70-8 href=#__codelineno-70-8></a>
</span><span id=__span-70-9><a id=__codelineno-70-9 name=__codelineno-70-9 href=#__codelineno-70-9></a>    <span class=k>def</span><span class=w> </span><span class=fm>__repr__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-70-10><a id=__codelineno-70-10 name=__codelineno-70-10 href=#__codelineno-70-10></a>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;User(&#39;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>&#39;, </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>age</span><span class=si>}</span><span class=s2>, &#39;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>email</span><span class=si>}</span><span class=s2>&#39;, </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>active</span><span class=si>}</span><span class=s2>, &#39;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>subscription_level</span><span class=si>}</span><span class=s2>&#39;)&quot;</span>
</span><span id=__span-70-11><a id=__codelineno-70-11 name=__codelineno-70-11 href=#__codelineno-70-11></a>
</span><span id=__span-70-12><a id=__codelineno-70-12 name=__codelineno-70-12 href=#__codelineno-70-12></a><span class=k>def</span><span class=w> </span><span class=nf>create_sample_users</span><span class=p>():</span>
</span><span id=__span-70-13><a id=__codelineno-70-13 name=__codelineno-70-13 href=#__codelineno-70-13></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Create sample user data for demonstration.&quot;&quot;&quot;</span>
</span><span id=__span-70-14><a id=__codelineno-70-14 name=__codelineno-70-14 href=#__codelineno-70-14></a>    <span class=kn>import</span><span class=w> </span><span class=nn>random</span>
</span><span id=__span-70-15><a id=__codelineno-70-15 name=__codelineno-70-15 href=#__codelineno-70-15></a>    <span class=n>names</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;Alice&#39;</span><span class=p>,</span> <span class=s1>&#39;Bob&#39;</span><span class=p>,</span> <span class=s1>&#39;Charlie&#39;</span><span class=p>,</span> <span class=s1>&#39;Diana&#39;</span><span class=p>,</span> <span class=s1>&#39;Eve&#39;</span><span class=p>,</span> <span class=s1>&#39;Frank&#39;</span><span class=p>,</span> <span class=s1>&#39;Grace&#39;</span><span class=p>,</span> <span class=s1>&#39;Henry&#39;</span><span class=p>]</span>
</span><span id=__span-70-16><a id=__codelineno-70-16 name=__codelineno-70-16 href=#__codelineno-70-16></a>    <span class=n>domains</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;gmail.com&#39;</span><span class=p>,</span> <span class=s1>&#39;yahoo.com&#39;</span><span class=p>,</span> <span class=s1>&#39;outlook.com&#39;</span><span class=p>,</span> <span class=s1>&#39;company.com&#39;</span><span class=p>]</span>
</span><span id=__span-70-17><a id=__codelineno-70-17 name=__codelineno-70-17 href=#__codelineno-70-17></a>    <span class=n>levels</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;basic&#39;</span><span class=p>,</span> <span class=s1>&#39;premium&#39;</span><span class=p>,</span> <span class=s1>&#39;enterprise&#39;</span><span class=p>]</span>
</span><span id=__span-70-18><a id=__codelineno-70-18 name=__codelineno-70-18 href=#__codelineno-70-18></a>
</span><span id=__span-70-19><a id=__codelineno-70-19 name=__codelineno-70-19 href=#__codelineno-70-19></a>    <span class=n>users</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-70-20><a id=__codelineno-70-20 name=__codelineno-70-20 href=#__codelineno-70-20></a>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>name</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>names</span> <span class=o>*</span> <span class=mi>10</span><span class=p>):</span>  <span class=c1># 80 users total</span>
</span><span id=__span-70-21><a id=__codelineno-70-21 name=__codelineno-70-21 href=#__codelineno-70-21></a>        <span class=n>age</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>18</span><span class=p>,</span> <span class=mi>65</span><span class=p>)</span>
</span><span id=__span-70-22><a id=__codelineno-70-22 name=__codelineno-70-22 href=#__codelineno-70-22></a>        <span class=n>email</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>name</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span><span class=si>}{</span><span class=n>i</span><span class=si>}</span><span class=s2>@</span><span class=si>{</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>domains</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-70-23><a id=__codelineno-70-23 name=__codelineno-70-23 href=#__codelineno-70-23></a>        <span class=n>active</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=kc>True</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=kc>False</span><span class=p>])</span>  <span class=c1># 75% active</span>
</span><span id=__span-70-24><a id=__codelineno-70-24 name=__codelineno-70-24 href=#__codelineno-70-24></a>        <span class=n>level</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>levels</span><span class=p>)</span>
</span><span id=__span-70-25><a id=__codelineno-70-25 name=__codelineno-70-25 href=#__codelineno-70-25></a>        <span class=n>users</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>User</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>age</span><span class=p>,</span> <span class=n>email</span><span class=p>,</span> <span class=n>active</span><span class=p>,</span> <span class=n>level</span><span class=p>))</span>
</span><span id=__span-70-26><a id=__codelineno-70-26 name=__codelineno-70-26 href=#__codelineno-70-26></a>
</span><span id=__span-70-27><a id=__codelineno-70-27 name=__codelineno-70-27 href=#__codelineno-70-27></a>    <span class=k>return</span> <span class=n>users</span>
</span><span id=__span-70-28><a id=__codelineno-70-28 name=__codelineno-70-28 href=#__codelineno-70-28></a>
</span><span id=__span-70-29><a id=__codelineno-70-29 name=__codelineno-70-29 href=#__codelineno-70-29></a><span class=k>def</span><span class=w> </span><span class=nf>analyze_users</span><span class=p>(</span><span class=n>users</span><span class=p>):</span>
</span><span id=__span-70-30><a id=__codelineno-70-30 name=__codelineno-70-30 href=#__codelineno-70-30></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Analyze user data using comprehensions and generators.&quot;&quot;&quot;</span>
</span><span id=__span-70-31><a id=__codelineno-70-31 name=__codelineno-70-31 href=#__codelineno-70-31></a>
</span><span id=__span-70-32><a id=__codelineno-70-32 name=__codelineno-70-32 href=#__codelineno-70-32></a>    <span class=c1># Active users summary</span>
</span><span id=__span-70-33><a id=__codelineno-70-33 name=__codelineno-70-33 href=#__codelineno-70-33></a>    <span class=n>active_users</span> <span class=o>=</span> <span class=p>[</span><span class=n>user</span> <span class=k>for</span> <span class=n>user</span> <span class=ow>in</span> <span class=n>users</span> <span class=k>if</span> <span class=n>user</span><span class=o>.</span><span class=n>active</span><span class=p>]</span>
</span><span id=__span-70-34><a id=__codelineno-70-34 name=__codelineno-70-34 href=#__codelineno-70-34></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Active users: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>active_users</span><span class=p>)</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>users</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-70-35><a id=__codelineno-70-35 name=__codelineno-70-35 href=#__codelineno-70-35></a>
</span><span id=__span-70-36><a id=__codelineno-70-36 name=__codelineno-70-36 href=#__codelineno-70-36></a>    <span class=c1># Age distribution of active users</span>
</span><span id=__span-70-37><a id=__codelineno-70-37 name=__codelineno-70-37 href=#__codelineno-70-37></a>    <span class=n>age_groups</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-70-38><a id=__codelineno-70-38 name=__codelineno-70-38 href=#__codelineno-70-38></a>        <span class=s1>&#39;18-25&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>([</span><span class=n>u</span> <span class=k>for</span> <span class=n>u</span> <span class=ow>in</span> <span class=n>active_users</span> <span class=k>if</span> <span class=mi>18</span> <span class=o>&lt;=</span> <span class=n>u</span><span class=o>.</span><span class=n>age</span> <span class=o>&lt;=</span> <span class=mi>25</span><span class=p>]),</span>
</span><span id=__span-70-39><a id=__codelineno-70-39 name=__codelineno-70-39 href=#__codelineno-70-39></a>        <span class=s1>&#39;26-35&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>([</span><span class=n>u</span> <span class=k>for</span> <span class=n>u</span> <span class=ow>in</span> <span class=n>active_users</span> <span class=k>if</span> <span class=mi>26</span> <span class=o>&lt;=</span> <span class=n>u</span><span class=o>.</span><span class=n>age</span> <span class=o>&lt;=</span> <span class=mi>35</span><span class=p>]),</span>
</span><span id=__span-70-40><a id=__codelineno-70-40 name=__codelineno-70-40 href=#__codelineno-70-40></a>        <span class=s1>&#39;36-45&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>([</span><span class=n>u</span> <span class=k>for</span> <span class=n>u</span> <span class=ow>in</span> <span class=n>active_users</span> <span class=k>if</span> <span class=mi>36</span> <span class=o>&lt;=</span> <span class=n>u</span><span class=o>.</span><span class=n>age</span> <span class=o>&lt;=</span> <span class=mi>45</span><span class=p>]),</span>
</span><span id=__span-70-41><a id=__codelineno-70-41 name=__codelineno-70-41 href=#__codelineno-70-41></a>        <span class=s1>&#39;46-65&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>([</span><span class=n>u</span> <span class=k>for</span> <span class=n>u</span> <span class=ow>in</span> <span class=n>active_users</span> <span class=k>if</span> <span class=mi>46</span> <span class=o>&lt;=</span> <span class=n>u</span><span class=o>.</span><span class=n>age</span> <span class=o>&lt;=</span> <span class=mi>65</span><span class=p>])</span>
</span><span id=__span-70-42><a id=__codelineno-70-42 name=__codelineno-70-42 href=#__codelineno-70-42></a>    <span class=p>}</span>
</span><span id=__span-70-43><a id=__codelineno-70-43 name=__codelineno-70-43 href=#__codelineno-70-43></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Age distribution: </span><span class=si>{</span><span class=n>age_groups</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-70-44><a id=__codelineno-70-44 name=__codelineno-70-44 href=#__codelineno-70-44></a>
</span><span id=__span-70-45><a id=__codelineno-70-45 name=__codelineno-70-45 href=#__codelineno-70-45></a>    <span class=c1># Subscription level breakdown</span>
</span><span id=__span-70-46><a id=__codelineno-70-46 name=__codelineno-70-46 href=#__codelineno-70-46></a>    <span class=n>subscription_breakdown</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-70-47><a id=__codelineno-70-47 name=__codelineno-70-47 href=#__codelineno-70-47></a>    <span class=k>for</span> <span class=n>user</span> <span class=ow>in</span> <span class=n>active_users</span><span class=p>:</span>
</span><span id=__span-70-48><a id=__codelineno-70-48 name=__codelineno-70-48 href=#__codelineno-70-48></a>        <span class=n>level</span> <span class=o>=</span> <span class=n>user</span><span class=o>.</span><span class=n>subscription_level</span>
</span><span id=__span-70-49><a id=__codelineno-70-49 name=__codelineno-70-49 href=#__codelineno-70-49></a>        <span class=n>subscription_breakdown</span><span class=p>[</span><span class=n>level</span><span class=p>]</span> <span class=o>=</span> <span class=n>subscription_breakdown</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>level</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span>
</span><span id=__span-70-50><a id=__codelineno-70-50 name=__codelineno-70-50 href=#__codelineno-70-50></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Subscription breakdown: </span><span class=si>{</span><span class=n>subscription_breakdown</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-70-51><a id=__codelineno-70-51 name=__codelineno-70-51 href=#__codelineno-70-51></a>
</span><span id=__span-70-52><a id=__codelineno-70-52 name=__codelineno-70-52 href=#__codelineno-70-52></a>    <span class=c1># Email domain analysis</span>
</span><span id=__span-70-53><a id=__codelineno-70-53 name=__codelineno-70-53 href=#__codelineno-70-53></a>    <span class=n>email_domains</span> <span class=o>=</span> <span class=p>{</span><span class=n>user</span><span class=o>.</span><span class=n>email</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;@&#39;</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span> <span class=k>for</span> <span class=n>user</span> <span class=ow>in</span> <span class=n>active_users</span><span class=p>}</span>
</span><span id=__span-70-54><a id=__codelineno-70-54 name=__codelineno-70-54 href=#__codelineno-70-54></a>    <span class=n>domain_counts</span> <span class=o>=</span> <span class=p>{</span><span class=n>domain</span><span class=p>:</span> <span class=nb>len</span><span class=p>([</span><span class=n>u</span> <span class=k>for</span> <span class=n>u</span> <span class=ow>in</span> <span class=n>active_users</span>
</span><span id=__span-70-55><a id=__codelineno-70-55 name=__codelineno-70-55 href=#__codelineno-70-55></a>                                 <span class=k>if</span> <span class=n>u</span><span class=o>.</span><span class=n>email</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=n>domain</span><span class=p>)])</span>
</span><span id=__span-70-56><a id=__codelineno-70-56 name=__codelineno-70-56 href=#__codelineno-70-56></a>                    <span class=k>for</span> <span class=n>domain</span> <span class=ow>in</span> <span class=n>email_domains</span><span class=p>}</span>
</span><span id=__span-70-57><a id=__codelineno-70-57 name=__codelineno-70-57 href=#__codelineno-70-57></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Email domains: </span><span class=si>{</span><span class=n>domain_counts</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-70-58><a id=__codelineno-70-58 name=__codelineno-70-58 href=#__codelineno-70-58></a>
</span><span id=__span-70-59><a id=__codelineno-70-59 name=__codelineno-70-59 href=#__codelineno-70-59></a>    <span class=c1># Premium user generator</span>
</span><span id=__span-70-60><a id=__codelineno-70-60 name=__codelineno-70-60 href=#__codelineno-70-60></a>    <span class=k>def</span><span class=w> </span><span class=nf>premium_users</span><span class=p>():</span>
</span><span id=__span-70-61><a id=__codelineno-70-61 name=__codelineno-70-61 href=#__codelineno-70-61></a>        <span class=k>for</span> <span class=n>user</span> <span class=ow>in</span> <span class=n>users</span><span class=p>:</span>
</span><span id=__span-70-62><a id=__codelineno-70-62 name=__codelineno-70-62 href=#__codelineno-70-62></a>            <span class=k>if</span> <span class=n>user</span><span class=o>.</span><span class=n>active</span> <span class=ow>and</span> <span class=n>user</span><span class=o>.</span><span class=n>subscription_level</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;premium&#39;</span><span class=p>,</span> <span class=s1>&#39;enterprise&#39;</span><span class=p>]:</span>
</span><span id=__span-70-63><a id=__codelineno-70-63 name=__codelineno-70-63 href=#__codelineno-70-63></a>                <span class=k>yield</span> <span class=n>user</span>
</span><span id=__span-70-64><a id=__codelineno-70-64 name=__codelineno-70-64 href=#__codelineno-70-64></a>
</span><span id=__span-70-65><a id=__codelineno-70-65 name=__codelineno-70-65 href=#__codelineno-70-65></a>    <span class=n>premium_count</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=mi>1</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>premium_users</span><span class=p>())</span>
</span><span id=__span-70-66><a id=__codelineno-70-66 name=__codelineno-70-66 href=#__codelineno-70-66></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Premium users: </span><span class=si>{</span><span class=n>premium_count</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-70-67><a id=__codelineno-70-67 name=__codelineno-70-67 href=#__codelineno-70-67></a>
</span><span id=__span-70-68><a id=__codelineno-70-68 name=__codelineno-70-68 href=#__codelineno-70-68></a>    <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-70-69><a id=__codelineno-70-69 name=__codelineno-70-69 href=#__codelineno-70-69></a>        <span class=s1>&#39;total_users&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>users</span><span class=p>),</span>
</span><span id=__span-70-70><a id=__codelineno-70-70 name=__codelineno-70-70 href=#__codelineno-70-70></a>        <span class=s1>&#39;active_users&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>active_users</span><span class=p>),</span>
</span><span id=__span-70-71><a id=__codelineno-70-71 name=__codelineno-70-71 href=#__codelineno-70-71></a>        <span class=s1>&#39;age_groups&#39;</span><span class=p>:</span> <span class=n>age_groups</span><span class=p>,</span>
</span><span id=__span-70-72><a id=__codelineno-70-72 name=__codelineno-70-72 href=#__codelineno-70-72></a>        <span class=s1>&#39;subscription_breakdown&#39;</span><span class=p>:</span> <span class=n>subscription_breakdown</span><span class=p>,</span>
</span><span id=__span-70-73><a id=__codelineno-70-73 name=__codelineno-70-73 href=#__codelineno-70-73></a>        <span class=s1>&#39;domain_counts&#39;</span><span class=p>:</span> <span class=n>domain_counts</span><span class=p>,</span>
</span><span id=__span-70-74><a id=__codelineno-70-74 name=__codelineno-70-74 href=#__codelineno-70-74></a>        <span class=s1>&#39;premium_count&#39;</span><span class=p>:</span> <span class=n>premium_count</span>
</span><span id=__span-70-75><a id=__codelineno-70-75 name=__codelineno-70-75 href=#__codelineno-70-75></a>    <span class=p>}</span>
</span><span id=__span-70-76><a id=__codelineno-70-76 name=__codelineno-70-76 href=#__codelineno-70-76></a>
</span><span id=__span-70-77><a id=__codelineno-70-77 name=__codelineno-70-77 href=#__codelineno-70-77></a><span class=c1># Run analysis</span>
</span><span id=__span-70-78><a id=__codelineno-70-78 name=__codelineno-70-78 href=#__codelineno-70-78></a><span class=n>sample_users</span> <span class=o>=</span> <span class=n>create_sample_users</span><span class=p>()</span>
</span><span id=__span-70-79><a id=__codelineno-70-79 name=__codelineno-70-79 href=#__codelineno-70-79></a><span class=n>analysis_results</span> <span class=o>=</span> <span class=n>analyze_users</span><span class=p>(</span><span class=n>sample_users</span><span class=p>)</span>
</span></code></pre></div> <h4 id=batch-processing-with-generators><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#batch-processing-with-generators>Batch Processing with Generators</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-71-1><a id=__codelineno-71-1 name=__codelineno-71-1 href=#__codelineno-71-1></a><span class=k>def</span><span class=w> </span><span class=nf>batch_process</span><span class=p>(</span><span class=n>items</span><span class=p>,</span> <span class=n>batch_size</span><span class=o>=</span><span class=mi>100</span><span class=p>):</span>
</span><span id=__span-71-2><a id=__codelineno-71-2 name=__codelineno-71-2 href=#__codelineno-71-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Process items in batches using generators.&quot;&quot;&quot;</span>
</span><span id=__span-71-3><a id=__codelineno-71-3 name=__codelineno-71-3 href=#__codelineno-71-3></a>    <span class=n>batch</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-71-4><a id=__codelineno-71-4 name=__codelineno-71-4 href=#__codelineno-71-4></a>    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>items</span><span class=p>:</span>
</span><span id=__span-71-5><a id=__codelineno-71-5 name=__codelineno-71-5 href=#__codelineno-71-5></a>        <span class=n>batch</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
</span><span id=__span-71-6><a id=__codelineno-71-6 name=__codelineno-71-6 href=#__codelineno-71-6></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>batch</span><span class=p>)</span> <span class=o>==</span> <span class=n>batch_size</span><span class=p>:</span>
</span><span id=__span-71-7><a id=__codelineno-71-7 name=__codelineno-71-7 href=#__codelineno-71-7></a>            <span class=k>yield</span> <span class=n>batch</span>
</span><span id=__span-71-8><a id=__codelineno-71-8 name=__codelineno-71-8 href=#__codelineno-71-8></a>            <span class=n>batch</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-71-9><a id=__codelineno-71-9 name=__codelineno-71-9 href=#__codelineno-71-9></a>
</span><span id=__span-71-10><a id=__codelineno-71-10 name=__codelineno-71-10 href=#__codelineno-71-10></a>    <span class=c1># Yield remaining items</span>
</span><span id=__span-71-11><a id=__codelineno-71-11 name=__codelineno-71-11 href=#__codelineno-71-11></a>    <span class=k>if</span> <span class=n>batch</span><span class=p>:</span>
</span><span id=__span-71-12><a id=__codelineno-71-12 name=__codelineno-71-12 href=#__codelineno-71-12></a>        <span class=k>yield</span> <span class=n>batch</span>
</span><span id=__span-71-13><a id=__codelineno-71-13 name=__codelineno-71-13 href=#__codelineno-71-13></a>
</span><span id=__span-71-14><a id=__codelineno-71-14 name=__codelineno-71-14 href=#__codelineno-71-14></a><span class=k>def</span><span class=w> </span><span class=nf>process_user_batch</span><span class=p>(</span><span class=n>user_batch</span><span class=p>):</span>
</span><span id=__span-71-15><a id=__codelineno-71-15 name=__codelineno-71-15 href=#__codelineno-71-15></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Process a batch of users.&quot;&quot;&quot;</span>
</span><span id=__span-71-16><a id=__codelineno-71-16 name=__codelineno-71-16 href=#__codelineno-71-16></a>    <span class=n>processed</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-71-17><a id=__codelineno-71-17 name=__codelineno-71-17 href=#__codelineno-71-17></a>    <span class=k>for</span> <span class=n>user</span> <span class=ow>in</span> <span class=n>user_batch</span><span class=p>:</span>
</span><span id=__span-71-18><a id=__codelineno-71-18 name=__codelineno-71-18 href=#__codelineno-71-18></a>        <span class=c1># Simulate processing</span>
</span><span id=__span-71-19><a id=__codelineno-71-19 name=__codelineno-71-19 href=#__codelineno-71-19></a>        <span class=n>processed_user</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-71-20><a id=__codelineno-71-20 name=__codelineno-71-20 href=#__codelineno-71-20></a>            <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=n>user</span><span class=o>.</span><span class=n>name</span><span class=o>.</span><span class=n>upper</span><span class=p>(),</span>
</span><span id=__span-71-21><a id=__codelineno-71-21 name=__codelineno-71-21 href=#__codelineno-71-21></a>            <span class=s1>&#39;email_domain&#39;</span><span class=p>:</span> <span class=n>user</span><span class=o>.</span><span class=n>email</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;@&#39;</span><span class=p>)[</span><span class=mi>1</span><span class=p>],</span>
</span><span id=__span-71-22><a id=__codelineno-71-22 name=__codelineno-71-22 href=#__codelineno-71-22></a>            <span class=s1>&#39;age_group&#39;</span><span class=p>:</span> <span class=s1>&#39;young&#39;</span> <span class=k>if</span> <span class=n>user</span><span class=o>.</span><span class=n>age</span> <span class=o>&lt;</span> <span class=mi>30</span> <span class=k>else</span> <span class=s1>&#39;senior&#39;</span><span class=p>,</span>
</span><span id=__span-71-23><a id=__codelineno-71-23 name=__codelineno-71-23 href=#__codelineno-71-23></a>            <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;active&#39;</span> <span class=k>if</span> <span class=n>user</span><span class=o>.</span><span class=n>active</span> <span class=k>else</span> <span class=s1>&#39;inactive&#39;</span>
</span><span id=__span-71-24><a id=__codelineno-71-24 name=__codelineno-71-24 href=#__codelineno-71-24></a>        <span class=p>}</span>
</span><span id=__span-71-25><a id=__codelineno-71-25 name=__codelineno-71-25 href=#__codelineno-71-25></a>        <span class=n>processed</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>processed_user</span><span class=p>)</span>
</span><span id=__span-71-26><a id=__codelineno-71-26 name=__codelineno-71-26 href=#__codelineno-71-26></a>    <span class=k>return</span> <span class=n>processed</span>
</span><span id=__span-71-27><a id=__codelineno-71-27 name=__codelineno-71-27 href=#__codelineno-71-27></a>
</span><span id=__span-71-28><a id=__codelineno-71-28 name=__codelineno-71-28 href=#__codelineno-71-28></a><span class=k>def</span><span class=w> </span><span class=nf>bulk_process_users</span><span class=p>(</span><span class=n>users</span><span class=p>,</span> <span class=n>batch_size</span><span class=o>=</span><span class=mi>10</span><span class=p>):</span>
</span><span id=__span-71-29><a id=__codelineno-71-29 name=__codelineno-71-29 href=#__codelineno-71-29></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Process users in batches.&quot;&quot;&quot;</span>
</span><span id=__span-71-30><a id=__codelineno-71-30 name=__codelineno-71-30 href=#__codelineno-71-30></a>    <span class=n>total_processed</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-71-31><a id=__codelineno-71-31 name=__codelineno-71-31 href=#__codelineno-71-31></a>    <span class=n>all_results</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-71-32><a id=__codelineno-71-32 name=__codelineno-71-32 href=#__codelineno-71-32></a>
</span><span id=__span-71-33><a id=__codelineno-71-33 name=__codelineno-71-33 href=#__codelineno-71-33></a>    <span class=k>for</span> <span class=n>batch</span> <span class=ow>in</span> <span class=n>batch_process</span><span class=p>(</span><span class=n>users</span><span class=p>,</span> <span class=n>batch_size</span><span class=p>):</span>
</span><span id=__span-71-34><a id=__codelineno-71-34 name=__codelineno-71-34 href=#__codelineno-71-34></a>        <span class=n>batch_results</span> <span class=o>=</span> <span class=n>process_user_batch</span><span class=p>(</span><span class=n>batch</span><span class=p>)</span>
</span><span id=__span-71-35><a id=__codelineno-71-35 name=__codelineno-71-35 href=#__codelineno-71-35></a>        <span class=n>all_results</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>batch_results</span><span class=p>)</span>
</span><span id=__span-71-36><a id=__codelineno-71-36 name=__codelineno-71-36 href=#__codelineno-71-36></a>        <span class=n>total_processed</span> <span class=o>+=</span> <span class=nb>len</span><span class=p>(</span><span class=n>batch</span><span class=p>)</span>
</span><span id=__span-71-37><a id=__codelineno-71-37 name=__codelineno-71-37 href=#__codelineno-71-37></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Processed batch: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>batch</span><span class=p>)</span><span class=si>}</span><span class=s2> users (Total: </span><span class=si>{</span><span class=n>total_processed</span><span class=si>}</span><span class=s2>)&quot;</span><span class=p>)</span>
</span><span id=__span-71-38><a id=__codelineno-71-38 name=__codelineno-71-38 href=#__codelineno-71-38></a>
</span><span id=__span-71-39><a id=__codelineno-71-39 name=__codelineno-71-39 href=#__codelineno-71-39></a>    <span class=k>return</span> <span class=n>all_results</span>
</span><span id=__span-71-40><a id=__codelineno-71-40 name=__codelineno-71-40 href=#__codelineno-71-40></a>
</span><span id=__span-71-41><a id=__codelineno-71-41 name=__codelineno-71-41 href=#__codelineno-71-41></a><span class=c1># Process users in batches</span>
</span><span id=__span-71-42><a id=__codelineno-71-42 name=__codelineno-71-42 href=#__codelineno-71-42></a><span class=n>sample_users</span> <span class=o>=</span> <span class=n>create_sample_users</span><span class=p>()</span>
</span><span id=__span-71-43><a id=__codelineno-71-43 name=__codelineno-71-43 href=#__codelineno-71-43></a><span class=n>processed_results</span> <span class=o>=</span> <span class=n>bulk_process_users</span><span class=p>(</span><span class=n>sample_users</span><span class=p>[:</span><span class=mi>50</span><span class=p>],</span> <span class=n>batch_size</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span><span id=__span-71-44><a id=__codelineno-71-44 name=__codelineno-71-44 href=#__codelineno-71-44></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Final results count: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>processed_results</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div> <h3 id=best-practices><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#best-practices>Best Practices</a></h3> <h4 id=when-to-use-each-construct><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#when-to-use-each-construct>When to Use Each Construct</a></h4> <ol> <li><strong>List Comprehensions</strong>: When you need the entire list immediately and memory usage isn't a concern</li> <li><strong>Generator Expressions</strong>: When processing large datasets or when you only need to iterate once</li> <li><strong>Generator Functions</strong>: When you need complex logic, state management, or infinite sequences</li> <li><strong>Dictionary/Set Comprehensions</strong>: When transforming or filtering data into these specific structures</li> </ol> <h4 id=performance-guidelines><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#performance-guidelines>Performance Guidelines</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-72-1><a id=__codelineno-72-1 name=__codelineno-72-1 href=#__codelineno-72-1></a><span class=c1># Good: Use generator for large datasets</span>
</span><span id=__span-72-2><a id=__codelineno-72-2 name=__codelineno-72-2 href=#__codelineno-72-2></a><span class=k>def</span><span class=w> </span><span class=nf>process_large_dataset</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span><span id=__span-72-3><a id=__codelineno-72-3 name=__codelineno-72-3 href=#__codelineno-72-3></a>    <span class=k>return</span> <span class=p>(</span><span class=n>transform</span><span class=p>(</span><span class=n>item</span><span class=p>)</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>data</span> <span class=k>if</span> <span class=n>condition</span><span class=p>(</span><span class=n>item</span><span class=p>))</span>
</span><span id=__span-72-4><a id=__codelineno-72-4 name=__codelineno-72-4 href=#__codelineno-72-4></a>
</span><span id=__span-72-5><a id=__codelineno-72-5 name=__codelineno-72-5 href=#__codelineno-72-5></a><span class=c1># Bad: Creates unnecessary intermediate list</span>
</span><span id=__span-72-6><a id=__codelineno-72-6 name=__codelineno-72-6 href=#__codelineno-72-6></a><span class=k>def</span><span class=w> </span><span class=nf>process_large_dataset_bad</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span><span id=__span-72-7><a id=__codelineno-72-7 name=__codelineno-72-7 href=#__codelineno-72-7></a>    <span class=k>return</span> <span class=p>[</span><span class=n>transform</span><span class=p>(</span><span class=n>item</span><span class=p>)</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>data</span> <span class=k>if</span> <span class=n>condition</span><span class=p>(</span><span class=n>item</span><span class=p>)]</span>
</span><span id=__span-72-8><a id=__codelineno-72-8 name=__codelineno-72-8 href=#__codelineno-72-8></a>
</span><span id=__span-72-9><a id=__codelineno-72-9 name=__codelineno-72-9 href=#__codelineno-72-9></a><span class=c1># Good: Chain operations efficiently</span>
</span><span id=__span-72-10><a id=__codelineno-72-10 name=__codelineno-72-10 href=#__codelineno-72-10></a><span class=k>def</span><span class=w> </span><span class=nf>efficient_pipeline</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span><span id=__span-72-11><a id=__codelineno-72-11 name=__codelineno-72-11 href=#__codelineno-72-11></a>    <span class=n>filtered</span> <span class=o>=</span> <span class=p>(</span><span class=n>item</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>data</span> <span class=k>if</span> <span class=n>item</span><span class=o>.</span><span class=n>is_valid</span><span class=p>())</span>
</span><span id=__span-72-12><a id=__codelineno-72-12 name=__codelineno-72-12 href=#__codelineno-72-12></a>    <span class=n>transformed</span> <span class=o>=</span> <span class=p>(</span><span class=n>transform</span><span class=p>(</span><span class=n>item</span><span class=p>)</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>filtered</span><span class=p>)</span>
</span><span id=__span-72-13><a id=__codelineno-72-13 name=__codelineno-72-13 href=#__codelineno-72-13></a>    <span class=k>return</span> <span class=nb>list</span><span class=p>(</span><span class=n>transformed</span><span class=p>)</span>
</span><span id=__span-72-14><a id=__codelineno-72-14 name=__codelineno-72-14 href=#__codelineno-72-14></a>
</span><span id=__span-72-15><a id=__codelineno-72-15 name=__codelineno-72-15 href=#__codelineno-72-15></a><span class=c1># Bad: Multiple passes through data</span>
</span><span id=__span-72-16><a id=__codelineno-72-16 name=__codelineno-72-16 href=#__codelineno-72-16></a><span class=k>def</span><span class=w> </span><span class=nf>inefficient_pipeline</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span><span id=__span-72-17><a id=__codelineno-72-17 name=__codelineno-72-17 href=#__codelineno-72-17></a>    <span class=n>filtered</span> <span class=o>=</span> <span class=p>[</span><span class=n>item</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>data</span> <span class=k>if</span> <span class=n>item</span><span class=o>.</span><span class=n>is_valid</span><span class=p>()]</span>
</span><span id=__span-72-18><a id=__codelineno-72-18 name=__codelineno-72-18 href=#__codelineno-72-18></a>    <span class=n>transformed</span> <span class=o>=</span> <span class=p>[</span><span class=n>transform</span><span class=p>(</span><span class=n>item</span><span class=p>)</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>filtered</span><span class=p>]</span>
</span><span id=__span-72-19><a id=__codelineno-72-19 name=__codelineno-72-19 href=#__codelineno-72-19></a>    <span class=k>return</span> <span class=n>transformed</span>
</span></code></pre></div> <h4 id=readability-guidelines><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#readability-guidelines>Readability Guidelines</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-73-1><a id=__codelineno-73-1 name=__codelineno-73-1 href=#__codelineno-73-1></a><span class=c1># Good: Clear, readable comprehension</span>
</span><span id=__span-73-2><a id=__codelineno-73-2 name=__codelineno-73-2 href=#__codelineno-73-2></a><span class=n>user_emails</span> <span class=o>=</span> <span class=p>[</span><span class=n>user</span><span class=o>.</span><span class=n>email</span> <span class=k>for</span> <span class=n>user</span> <span class=ow>in</span> <span class=n>users</span> <span class=k>if</span> <span class=n>user</span><span class=o>.</span><span class=n>active</span><span class=p>]</span>
</span><span id=__span-73-3><a id=__codelineno-73-3 name=__codelineno-73-3 href=#__codelineno-73-3></a>
</span><span id=__span-73-4><a id=__codelineno-73-4 name=__codelineno-73-4 href=#__codelineno-73-4></a><span class=c1># Bad: Too complex for comprehension</span>
</span><span id=__span-73-5><a id=__codelineno-73-5 name=__codelineno-73-5 href=#__codelineno-73-5></a><span class=c1># user_data = [complex_transform(user) for user in users</span>
</span><span id=__span-73-6><a id=__codelineno-73-6 name=__codelineno-73-6 href=#__codelineno-73-6></a><span class=c1>#              if user.active and user.subscription_level == &#39;premium&#39;</span>
</span><span id=__span-73-7><a id=__codelineno-73-7 name=__codelineno-73-7 href=#__codelineno-73-7></a><span class=c1>#              and user.last_login &gt; some_date and validate_user(user)]</span>
</span><span id=__span-73-8><a id=__codelineno-73-8 name=__codelineno-73-8 href=#__codelineno-73-8></a>
</span><span id=__span-73-9><a id=__codelineno-73-9 name=__codelineno-73-9 href=#__codelineno-73-9></a><span class=c1># Better: Break down complex logic</span>
</span><span id=__span-73-10><a id=__codelineno-73-10 name=__codelineno-73-10 href=#__codelineno-73-10></a><span class=k>def</span><span class=w> </span><span class=nf>is_eligible_user</span><span class=p>(</span><span class=n>user</span><span class=p>):</span>
</span><span id=__span-73-11><a id=__codelineno-73-11 name=__codelineno-73-11 href=#__codelineno-73-11></a>    <span class=k>return</span> <span class=p>(</span><span class=n>user</span><span class=o>.</span><span class=n>active</span> <span class=ow>and</span>
</span><span id=__span-73-12><a id=__codelineno-73-12 name=__codelineno-73-12 href=#__codelineno-73-12></a>            <span class=n>user</span><span class=o>.</span><span class=n>subscription_level</span> <span class=o>==</span> <span class=s1>&#39;premium&#39;</span> <span class=ow>and</span>
</span><span id=__span-73-13><a id=__codelineno-73-13 name=__codelineno-73-13 href=#__codelineno-73-13></a>            <span class=n>user</span><span class=o>.</span><span class=n>last_login</span> <span class=o>&gt;</span> <span class=n>some_date</span> <span class=ow>and</span>
</span><span id=__span-73-14><a id=__codelineno-73-14 name=__codelineno-73-14 href=#__codelineno-73-14></a>            <span class=n>validate_user</span><span class=p>(</span><span class=n>user</span><span class=p>))</span>
</span><span id=__span-73-15><a id=__codelineno-73-15 name=__codelineno-73-15 href=#__codelineno-73-15></a>
</span><span id=__span-73-16><a id=__codelineno-73-16 name=__codelineno-73-16 href=#__codelineno-73-16></a><span class=n>user_data</span> <span class=o>=</span> <span class=p>[</span><span class=n>complex_transform</span><span class=p>(</span><span class=n>user</span><span class=p>)</span> <span class=k>for</span> <span class=n>user</span> <span class=ow>in</span> <span class=n>users</span> <span class=k>if</span> <span class=n>is_eligible_user</span><span class=p>(</span><span class=n>user</span><span class=p>)]</span>
</span></code></pre></div> <h3 id=common-pitfalls><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#common-pitfalls>Common Pitfalls</a></h3> <h4 id=generator-exhaustion><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#generator-exhaustion>Generator Exhaustion</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-74-1><a id=__codelineno-74-1 name=__codelineno-74-1 href=#__codelineno-74-1></a><span class=c1># Pitfall: Generators can only be iterated once</span>
</span><span id=__span-74-2><a id=__codelineno-74-2 name=__codelineno-74-2 href=#__codelineno-74-2></a><span class=n>numbers</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>))</span>
</span><span id=__span-74-3><a id=__codelineno-74-3 name=__codelineno-74-3 href=#__codelineno-74-3></a><span class=nb>print</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>numbers</span><span class=p>))</span>  <span class=c1># [0, 1, 2, 3, 4]</span>
</span><span id=__span-74-4><a id=__codelineno-74-4 name=__codelineno-74-4 href=#__codelineno-74-4></a><span class=nb>print</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>numbers</span><span class=p>))</span>  <span class=c1># [] - Empty! Generator is exhausted</span>
</span><span id=__span-74-5><a id=__codelineno-74-5 name=__codelineno-74-5 href=#__codelineno-74-5></a>
</span><span id=__span-74-6><a id=__codelineno-74-6 name=__codelineno-74-6 href=#__codelineno-74-6></a><span class=c1># Solution: Recreate generator or convert to list if needed multiple times</span>
</span><span id=__span-74-7><a id=__codelineno-74-7 name=__codelineno-74-7 href=#__codelineno-74-7></a><span class=k>def</span><span class=w> </span><span class=nf>number_generator</span><span class=p>():</span>
</span><span id=__span-74-8><a id=__codelineno-74-8 name=__codelineno-74-8 href=#__codelineno-74-8></a>    <span class=k>return</span> <span class=p>(</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>))</span>
</span><span id=__span-74-9><a id=__codelineno-74-9 name=__codelineno-74-9 href=#__codelineno-74-9></a>
</span><span id=__span-74-10><a id=__codelineno-74-10 name=__codelineno-74-10 href=#__codelineno-74-10></a><span class=n>gen1</span> <span class=o>=</span> <span class=n>number_generator</span><span class=p>()</span>
</span><span id=__span-74-11><a id=__codelineno-74-11 name=__codelineno-74-11 href=#__codelineno-74-11></a><span class=n>gen2</span> <span class=o>=</span> <span class=n>number_generator</span><span class=p>()</span>
</span><span id=__span-74-12><a id=__codelineno-74-12 name=__codelineno-74-12 href=#__codelineno-74-12></a><span class=nb>print</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>gen1</span><span class=p>))</span>  <span class=c1># [0, 1, 2, 3, 4]</span>
</span><span id=__span-74-13><a id=__codelineno-74-13 name=__codelineno-74-13 href=#__codelineno-74-13></a><span class=nb>print</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>gen2</span><span class=p>))</span>  <span class=c1># [0, 1, 2, 3, 4]</span>
</span></code></pre></div> <h4 id=late-binding-in-comprehensions><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#late-binding-in-comprehensions>Late Binding in Comprehensions</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-75-1><a id=__codelineno-75-1 name=__codelineno-75-1 href=#__codelineno-75-1></a><span class=c1># Pitfall: Variable binding in nested functions</span>
</span><span id=__span-75-2><a id=__codelineno-75-2 name=__codelineno-75-2 href=#__codelineno-75-2></a><span class=n>funcs</span> <span class=o>=</span> <span class=p>[</span><span class=k>lambda</span><span class=p>:</span> <span class=n>i</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>)]</span>
</span><span id=__span-75-3><a id=__codelineno-75-3 name=__codelineno-75-3 href=#__codelineno-75-3></a><span class=n>results</span> <span class=o>=</span> <span class=p>[</span><span class=n>f</span><span class=p>()</span> <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>funcs</span><span class=p>]</span>
</span><span id=__span-75-4><a id=__codelineno-75-4 name=__codelineno-75-4 href=#__codelineno-75-4></a><span class=nb>print</span><span class=p>(</span><span class=n>results</span><span class=p>)</span>  <span class=c1># [4, 4, 4, 4, 4] - All return 4!</span>
</span><span id=__span-75-5><a id=__codelineno-75-5 name=__codelineno-75-5 href=#__codelineno-75-5></a>
</span><span id=__span-75-6><a id=__codelineno-75-6 name=__codelineno-75-6 href=#__codelineno-75-6></a><span class=c1># Solution: Capture variable explicitly</span>
</span><span id=__span-75-7><a id=__codelineno-75-7 name=__codelineno-75-7 href=#__codelineno-75-7></a><span class=n>funcs</span> <span class=o>=</span> <span class=p>[</span><span class=k>lambda</span> <span class=n>x</span><span class=o>=</span><span class=n>i</span><span class=p>:</span> <span class=n>x</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>)]</span>
</span><span id=__span-75-8><a id=__codelineno-75-8 name=__codelineno-75-8 href=#__codelineno-75-8></a><span class=n>results</span> <span class=o>=</span> <span class=p>[</span><span class=n>f</span><span class=p>()</span> <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>funcs</span><span class=p>]</span>
</span><span id=__span-75-9><a id=__codelineno-75-9 name=__codelineno-75-9 href=#__codelineno-75-9></a><span class=nb>print</span><span class=p>(</span><span class=n>results</span><span class=p>)</span>  <span class=c1># [0, 1, 2, 3, 4] - Correct!</span>
</span></code></pre></div> <h4 id=memory-leaks-with-generators><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#memory-leaks-with-generators>Memory Leaks with Generators</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-76-1><a id=__codelineno-76-1 name=__codelineno-76-1 href=#__codelineno-76-1></a><span class=c1># Pitfall: Keeping references to generators can prevent garbage collection</span>
</span><span id=__span-76-2><a id=__codelineno-76-2 name=__codelineno-76-2 href=#__codelineno-76-2></a><span class=k>class</span><span class=w> </span><span class=nc>DataProcessor</span><span class=p>:</span>
</span><span id=__span-76-3><a id=__codelineno-76-3 name=__codelineno-76-3 href=#__codelineno-76-3></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-76-4><a id=__codelineno-76-4 name=__codelineno-76-4 href=#__codelineno-76-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>1000000</span><span class=p>))</span>
</span><span id=__span-76-5><a id=__codelineno-76-5 name=__codelineno-76-5 href=#__codelineno-76-5></a>
</span><span id=__span-76-6><a id=__codelineno-76-6 name=__codelineno-76-6 href=#__codelineno-76-6></a>    <span class=k>def</span><span class=w> </span><span class=nf>process</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-76-7><a id=__codelineno-76-7 name=__codelineno-76-7 href=#__codelineno-76-7></a>        <span class=c1># This creates a reference cycle if not handled properly</span>
</span><span id=__span-76-8><a id=__codelineno-76-8 name=__codelineno-76-8 href=#__codelineno-76-8></a>        <span class=k>return</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=p>)</span>
</span><span id=__span-76-9><a id=__codelineno-76-9 name=__codelineno-76-9 href=#__codelineno-76-9></a>
</span><span id=__span-76-10><a id=__codelineno-76-10 name=__codelineno-76-10 href=#__codelineno-76-10></a>    <span class=k>def</span><span class=w> </span><span class=nf>transform</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>):</span>
</span><span id=__span-76-11><a id=__codelineno-76-11 name=__codelineno-76-11 href=#__codelineno-76-11></a>        <span class=k>return</span> <span class=n>x</span> <span class=o>*</span> <span class=mi>2</span>
</span><span id=__span-76-12><a id=__codelineno-76-12 name=__codelineno-76-12 href=#__codelineno-76-12></a>
</span><span id=__span-76-13><a id=__codelineno-76-13 name=__codelineno-76-13 href=#__codelineno-76-13></a><span class=c1># Solution: Be mindful of object lifecycles</span>
</span><span id=__span-76-14><a id=__codelineno-76-14 name=__codelineno-76-14 href=#__codelineno-76-14></a><span class=n>processor</span> <span class=o>=</span> <span class=n>DataProcessor</span><span class=p>()</span>
</span><span id=__span-76-15><a id=__codelineno-76-15 name=__codelineno-76-15 href=#__codelineno-76-15></a><span class=n>results</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>processor</span><span class=o>.</span><span class=n>process</span><span class=p>())</span>  <span class=c1># Consume immediately</span>
</span><span id=__span-76-16><a id=__codelineno-76-16 name=__codelineno-76-16 href=#__codelineno-76-16></a><span class=k>del</span> <span class=n>processor</span>  <span class=c1># Allow garbage collection</span>
</span></code></pre></div> <h4 id=comprehension-complexity><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#comprehension-complexity>Comprehension Complexity</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-77-1><a id=__codelineno-77-1 name=__codelineno-77-1 href=#__codelineno-77-1></a><span class=c1># Pitfall: Overly complex comprehensions</span>
</span><span id=__span-77-2><a id=__codelineno-77-2 name=__codelineno-77-2 href=#__codelineno-77-2></a><span class=c1># Bad: Hard to read and debug</span>
</span><span id=__span-77-3><a id=__codelineno-77-3 name=__codelineno-77-3 href=#__codelineno-77-3></a><span class=n>result</span> <span class=o>=</span> <span class=p>[</span><span class=n>func</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>data1</span> <span class=k>for</span> <span class=n>y</span> <span class=ow>in</span> <span class=n>data2</span>
</span><span id=__span-77-4><a id=__codelineno-77-4 name=__codelineno-77-4 href=#__codelineno-77-4></a>          <span class=k>if</span> <span class=n>complex_condition</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=ow>and</span> <span class=n>another_condition</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span><span id=__span-77-5><a id=__codelineno-77-5 name=__codelineno-77-5 href=#__codelineno-77-5></a>          <span class=ow>and</span> <span class=n>yet_another_condition</span><span class=p>(</span><span class=n>y</span><span class=p>)]</span>
</span><span id=__span-77-6><a id=__codelineno-77-6 name=__codelineno-77-6 href=#__codelineno-77-6></a>
</span><span id=__span-77-7><a id=__codelineno-77-7 name=__codelineno-77-7 href=#__codelineno-77-7></a><span class=c1># Better: Break into steps</span>
</span><span id=__span-77-8><a id=__codelineno-77-8 name=__codelineno-77-8 href=#__codelineno-77-8></a><span class=k>def</span><span class=w> </span><span class=nf>should_process</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>):</span>
</span><span id=__span-77-9><a id=__codelineno-77-9 name=__codelineno-77-9 href=#__codelineno-77-9></a>    <span class=k>return</span> <span class=p>(</span><span class=n>complex_condition</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=ow>and</span>
</span><span id=__span-77-10><a id=__codelineno-77-10 name=__codelineno-77-10 href=#__codelineno-77-10></a>            <span class=n>another_condition</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=ow>and</span>
</span><span id=__span-77-11><a id=__codelineno-77-11 name=__codelineno-77-11 href=#__codelineno-77-11></a>            <span class=n>yet_another_condition</span><span class=p>(</span><span class=n>y</span><span class=p>))</span>
</span><span id=__span-77-12><a id=__codelineno-77-12 name=__codelineno-77-12 href=#__codelineno-77-12></a>
</span><span id=__span-77-13><a id=__codelineno-77-13 name=__codelineno-77-13 href=#__codelineno-77-13></a><span class=n>valid_pairs</span> <span class=o>=</span> <span class=p>[(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>data1</span> <span class=k>for</span> <span class=n>y</span> <span class=ow>in</span> <span class=n>data2</span> <span class=k>if</span> <span class=n>should_process</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)]</span>
</span><span id=__span-77-14><a id=__codelineno-77-14 name=__codelineno-77-14 href=#__codelineno-77-14></a><span class=n>result</span> <span class=o>=</span> <span class=p>[</span><span class=n>func</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=ow>in</span> <span class=n>valid_pairs</span><span class=p>]</span>
</span></code></pre></div> <h3 id=conclusion><a class=toclink href=../../2023/12/01/python_generators_and_comprehensions_a_deep_dive/#conclusion>Conclusion</a></h3> <p>Python generators and comprehensions are powerful tools that can significantly improve your code's performance, readability, and maintainability. Key takeaways:</p> <ol> <li><strong>Use comprehensions for simple transformations and filtering</strong></li> <li><strong>Leverage generators for memory-efficient processing of large datasets</strong></li> <li><strong>Chain generators together to create elegant processing pipelines</strong></li> <li><strong>Be aware of generator exhaustion and late binding issues</strong></li> <li><strong>Balance conciseness with readability</strong></li> </ol> <p>By mastering these constructs, you'll write more Pythonic code that scales well and expresses intent clearly. Remember that the best solution depends on your specific use case - consider memory requirements, performance needs, and code maintainability when choosing between different approaches.</p> <p>The examples and patterns shown here provide a foundation for using generators and comprehensions effectively in real-world applications. Practice with these concepts and gradually incorporate them into your codebase to see the benefits firsthand.</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=https://github.com/mutaku.png alt="Matthew Martz, PhD"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2023-11-20 00:00:00+00:00">Monday, November 20, 2023</time></li> <li class=md-meta__item> in <a href=../data-science/ class=md-meta__link>Data Science</a>, <a href=./ class=md-meta__link>Technology</a></li> <li class=md-meta__item> 11 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=nested-dictionary-lookups-methods-performance-and-best-practices><a href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/ class=toclink>Nested Dictionary Lookups: Methods, Performance, and Best Practices</a></h2> <p>When working with complex data structures in Python, nested dictionaries are ubiquitous. Whether you're processing JSON APIs, configuration files, or hierarchical data, you'll frequently need to safely access deeply nested values. This article explores various methods for nested dictionary lookups, compares their performance, and provides robust solutions for real-world applications.</p> <h3 id=table-of-contents><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#table-of-contents>Table of Contents</a></h3> <ol> <li><a href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#the-problem>The Problem with Nested Dictionary Access</a></li> <li><a href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#traditional-approaches>Traditional Approaches</a></li> <li><a href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#walrus-operator>The Walrus Operator Solution</a></li> <li><a href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#chaining-methods>Chaining Methods</a></li> <li><a href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#programmatic-depth-search>Programmatic Depth Search</a></li> <li><a href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#performance-comparison>Performance Comparison</a></li> <li><a href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#error-handling>Error Handling and Robustness</a></li> <li><a href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#real-world-applications>Real-World Applications</a></li> <li><a href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#best-practices>Best Practices</a></li> </ol> <h3 id=the-problem><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#the-problem>The Problem with Nested Dictionary Access</a></h3> <p>Consider this common scenario: you have a nested dictionary representing user data from an API response, and you need to safely extract a deeply nested value:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=n>user_data</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>    <span class=s1>&#39;user&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a>        <span class=s1>&#39;profile&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a>            <span class=s1>&#39;preferences&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a>                <span class=s1>&#39;notifications&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a>                    <span class=s1>&#39;email&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-36-7><a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a>                    <span class=s1>&#39;push&#39;</span><span class=p>:</span> <span class=kc>False</span>
</span><span id=__span-36-8><a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a>                <span class=p>}</span>
</span><span id=__span-36-9><a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a>            <span class=p>}</span>
</span><span id=__span-36-10><a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a>        <span class=p>}</span>
</span><span id=__span-36-11><a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a>    <span class=p>}</span>
</span><span id=__span-36-12><a id=__codelineno-36-12 name=__codelineno-36-12 href=#__codelineno-36-12></a><span class=p>}</span>
</span><span id=__span-36-13><a id=__codelineno-36-13 name=__codelineno-36-13 href=#__codelineno-36-13></a>
</span><span id=__span-36-14><a id=__codelineno-36-14 name=__codelineno-36-14 href=#__codelineno-36-14></a><span class=c1># Goal: Get user.profile.preferences.notifications.email</span>
</span><span id=__span-36-15><a id=__codelineno-36-15 name=__codelineno-36-15 href=#__codelineno-36-15></a><span class=c1># Challenge: Any level might be missing, causing KeyError</span>
</span></code></pre></div> <p>The naive approach fails spectacularly:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=c1># This will raise KeyError if any key is missing</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=n>email_pref</span> <span class=o>=</span> <span class=n>user_data</span><span class=p>[</span><span class=s1>&#39;user&#39;</span><span class=p>][</span><span class=s1>&#39;profile&#39;</span><span class=p>][</span><span class=s1>&#39;preferences&#39;</span><span class=p>][</span><span class=s1>&#39;notifications&#39;</span><span class=p>][</span><span class=s1>&#39;email&#39;</span><span class=p>]</span>
</span></code></pre></div> <h3 id=traditional-approaches><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#traditional-approaches>Traditional Approaches</a></h3> <h4 id=method-1-nested-tryexcept><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#method-1-nested-tryexcept>Method 1: Nested try/except</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=k>def</span><span class=w> </span><span class=nf>get_nested_try_except</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a>        <span class=k>return</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;user&#39;</span><span class=p>][</span><span class=s1>&#39;profile&#39;</span><span class=p>][</span><span class=s1>&#39;preferences&#39;</span><span class=p>][</span><span class=s1>&#39;notifications&#39;</span><span class=p>][</span><span class=s1>&#39;email&#39;</span><span class=p>]</span>
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a>    <span class=k>except</span> <span class=ne>KeyError</span><span class=p>:</span>
</span><span id=__span-38-5><a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a>        <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-38-6><a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a>
</span><span id=__span-38-7><a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a><span class=n>result</span> <span class=o>=</span> <span class=n>get_nested_try_except</span><span class=p>(</span><span class=n>user_data</span><span class=p>)</span>
</span><span id=__span-38-8><a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>  <span class=c1># True</span>
</span></code></pre></div> <p><strong>Pros:</strong> - Simple and straightforward - Handles missing keys gracefully</p> <p><strong>Cons:</strong> - Catches all KeyErrors, potentially masking bugs - Not reusable for different paths - Poor performance when keys are missing</p> <h4 id=method-2-step-by-step-with-get><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#method-2-step-by-step-with-get>Method 2: Step-by-step with get()</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=k>def</span><span class=w> </span><span class=nf>get_nested_step_by_step</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>    <span class=n>user</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;user&#39;</span><span class=p>)</span>
</span><span id=__span-39-3><a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a>    <span class=k>if</span> <span class=n>user</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-39-4><a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a>        <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-39-5><a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a>
</span><span id=__span-39-6><a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a>    <span class=n>profile</span> <span class=o>=</span> <span class=n>user</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;profile&#39;</span><span class=p>)</span>
</span><span id=__span-39-7><a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a>    <span class=k>if</span> <span class=n>profile</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-39-8><a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a>        <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-39-9><a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a>
</span><span id=__span-39-10><a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a>    <span class=n>preferences</span> <span class=o>=</span> <span class=n>profile</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;preferences&#39;</span><span class=p>)</span>
</span><span id=__span-39-11><a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a>    <span class=k>if</span> <span class=n>preferences</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-39-12><a id=__codelineno-39-12 name=__codelineno-39-12 href=#__codelineno-39-12></a>        <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-39-13><a id=__codelineno-39-13 name=__codelineno-39-13 href=#__codelineno-39-13></a>
</span><span id=__span-39-14><a id=__codelineno-39-14 name=__codelineno-39-14 href=#__codelineno-39-14></a>    <span class=n>notifications</span> <span class=o>=</span> <span class=n>preferences</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;notifications&#39;</span><span class=p>)</span>
</span><span id=__span-39-15><a id=__codelineno-39-15 name=__codelineno-39-15 href=#__codelineno-39-15></a>    <span class=k>if</span> <span class=n>notifications</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-39-16><a id=__codelineno-39-16 name=__codelineno-39-16 href=#__codelineno-39-16></a>        <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-39-17><a id=__codelineno-39-17 name=__codelineno-39-17 href=#__codelineno-39-17></a>
</span><span id=__span-39-18><a id=__codelineno-39-18 name=__codelineno-39-18 href=#__codelineno-39-18></a>    <span class=k>return</span> <span class=n>notifications</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;email&#39;</span><span class=p>)</span>
</span><span id=__span-39-19><a id=__codelineno-39-19 name=__codelineno-39-19 href=#__codelineno-39-19></a>
</span><span id=__span-39-20><a id=__codelineno-39-20 name=__codelineno-39-20 href=#__codelineno-39-20></a><span class=n>result</span> <span class=o>=</span> <span class=n>get_nested_step_by_step</span><span class=p>(</span><span class=n>user_data</span><span class=p>)</span>
</span><span id=__span-39-21><a id=__codelineno-39-21 name=__codelineno-39-21 href=#__codelineno-39-21></a><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>  <span class=c1># True</span>
</span></code></pre></div> <p><strong>Pros:</strong> - Clear control flow - Explicit null checking - Easy to debug</p> <p><strong>Cons:</strong> - Verbose and repetitive - Hard to maintain for deep nesting - Not reusable</p> <h4 id=method-3-chained-get-calls><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#method-3-chained-get-calls>Method 3: Chained get() calls</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=k>def</span><span class=w> </span><span class=nf>get_nested_chained_old</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a>    <span class=k>return</span> <span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a>            <span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;profile&#39;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-40-4><a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a>            <span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;preferences&#39;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-40-5><a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a>            <span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;notifications&#39;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-40-6><a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a>            <span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;email&#39;</span><span class=p>))</span>
</span><span id=__span-40-7><a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a>
</span><span id=__span-40-8><a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a><span class=n>result</span> <span class=o>=</span> <span class=n>get_nested_chained_old</span><span class=p>(</span><span class=n>user_data</span><span class=p>)</span>
</span><span id=__span-40-9><a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>  <span class=c1># True</span>
</span><span id=__span-40-10><a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a>
</span><span id=__span-40-11><a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a><span class=c1># Test with missing data</span>
</span><span id=__span-40-12><a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a><span class=n>incomplete_data</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;user&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;profile&#39;</span><span class=p>:</span> <span class=p>{}}}</span>
</span><span id=__span-40-13><a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a><span class=n>result_incomplete</span> <span class=o>=</span> <span class=n>get_nested_chained_old</span><span class=p>(</span><span class=n>incomplete_data</span><span class=p>)</span>
</span><span id=__span-40-14><a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a><span class=nb>print</span><span class=p>(</span><span class=n>result_incomplete</span><span class=p>)</span>  <span class=c1># None</span>
</span></code></pre></div> <p><strong>Pros:</strong> - Concise and readable - Safe handling of missing keys - Reasonably good performance</p> <p><strong>Cons:</strong> - Creates empty dictionaries at each level - Still not easily reusable for different paths</p> <h3 id=the-walrus-operator-solution><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#the-walrus-operator-solution>The Walrus Operator Solution</a></h3> <p>Python 3.8 introduced the walrus operator (<code>:=</code>), which allows assignment within expressions. This opens up new possibilities for nested dictionary access:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=k>def</span><span class=w> </span><span class=nf>get_nested_walrus</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a>    <span class=k>if</span> <span class=p>(</span><span class=n>user</span> <span class=o>:=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;user&#39;</span><span class=p>))</span> <span class=ow>and</span> \
</span><span id=__span-41-3><a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a>       <span class=p>(</span><span class=n>profile</span> <span class=o>:=</span> <span class=n>user</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;profile&#39;</span><span class=p>))</span> <span class=ow>and</span> \
</span><span id=__span-41-4><a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a>       <span class=p>(</span><span class=n>preferences</span> <span class=o>:=</span> <span class=n>profile</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;preferences&#39;</span><span class=p>))</span> <span class=ow>and</span> \
</span><span id=__span-41-5><a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a>       <span class=p>(</span><span class=n>notifications</span> <span class=o>:=</span> <span class=n>preferences</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;notifications&#39;</span><span class=p>)):</span>
</span><span id=__span-41-6><a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a>        <span class=k>return</span> <span class=n>notifications</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;email&#39;</span><span class=p>)</span>
</span><span id=__span-41-7><a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a>    <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-41-8><a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a>
</span><span id=__span-41-9><a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a><span class=n>result</span> <span class=o>=</span> <span class=n>get_nested_walrus</span><span class=p>(</span><span class=n>user_data</span><span class=p>)</span>
</span><span id=__span-41-10><a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>  <span class=c1># True</span>
</span><span id=__span-41-11><a id=__codelineno-41-11 name=__codelineno-41-11 href=#__codelineno-41-11></a>
</span><span id=__span-41-12><a id=__codelineno-41-12 name=__codelineno-41-12 href=#__codelineno-41-12></a><span class=c1># Test with partial data</span>
</span><span id=__span-41-13><a id=__codelineno-41-13 name=__codelineno-41-13 href=#__codelineno-41-13></a><span class=n>partial_data</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;user&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;profile&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;preferences&#39;</span><span class=p>:</span> <span class=p>{}}}}</span>
</span><span id=__span-41-14><a id=__codelineno-41-14 name=__codelineno-41-14 href=#__codelineno-41-14></a><span class=n>result_partial</span> <span class=o>=</span> <span class=n>get_nested_walrus</span><span class=p>(</span><span class=n>partial_data</span><span class=p>)</span>
</span><span id=__span-41-15><a id=__codelineno-41-15 name=__codelineno-41-15 href=#__codelineno-41-15></a><span class=nb>print</span><span class=p>(</span><span class=n>result_partial</span><span class=p>)</span>  <span class=c1># None</span>
</span></code></pre></div> <p><strong>Pros:</strong> - Efficient - stops at first missing key - No unnecessary object creation - Compact syntax - Clear short-circuiting behavior</p> <p><strong>Cons:</strong> - Requires Python 3.8+ - Can be less readable for very deep nesting - Still not easily reusable</p> <h3 id=chaining-methods><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#chaining-methods>Chaining Methods</a></h3> <h4 id=method-4-reduce-based-approach><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#method-4-reduce-based-approach>Method 4: Reduce-based approach</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=kn>from</span><span class=w> </span><span class=nn>functools</span><span class=w> </span><span class=kn>import</span> <span class=n>reduce</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a>
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=k>def</span><span class=w> </span><span class=nf>get_nested_reduce</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>path</span><span class=p>):</span>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get nested value using reduce.&quot;&quot;&quot;</span>
</span><span id=__span-42-5><a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-42-6><a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a>        <span class=k>return</span> <span class=n>reduce</span><span class=p>(</span><span class=k>lambda</span> <span class=n>d</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=n>d</span><span class=p>[</span><span class=n>key</span><span class=p>],</span> <span class=n>path</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span><span id=__span-42-7><a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a>    <span class=k>except</span> <span class=p>(</span><span class=ne>KeyError</span><span class=p>,</span> <span class=ne>TypeError</span><span class=p>):</span>
</span><span id=__span-42-8><a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a>        <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-42-9><a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a>
</span><span id=__span-42-10><a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a><span class=c1># Usage</span>
</span><span id=__span-42-11><a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a><span class=n>path</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;profile&#39;</span><span class=p>,</span> <span class=s1>&#39;preferences&#39;</span><span class=p>,</span> <span class=s1>&#39;notifications&#39;</span><span class=p>,</span> <span class=s1>&#39;email&#39;</span><span class=p>]</span>
</span><span id=__span-42-12><a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a><span class=n>result</span> <span class=o>=</span> <span class=n>get_nested_reduce</span><span class=p>(</span><span class=n>user_data</span><span class=p>,</span> <span class=n>path</span><span class=p>)</span>
</span><span id=__span-42-13><a id=__codelineno-42-13 name=__codelineno-42-13 href=#__codelineno-42-13></a><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>  <span class=c1># True</span>
</span><span id=__span-42-14><a id=__codelineno-42-14 name=__codelineno-42-14 href=#__codelineno-42-14></a>
</span><span id=__span-42-15><a id=__codelineno-42-15 name=__codelineno-42-15 href=#__codelineno-42-15></a><span class=c1># Test with missing path</span>
</span><span id=__span-42-16><a id=__codelineno-42-16 name=__codelineno-42-16 href=#__codelineno-42-16></a><span class=n>result_missing</span> <span class=o>=</span> <span class=n>get_nested_reduce</span><span class=p>(</span><span class=n>user_data</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;missing&#39;</span><span class=p>,</span> <span class=s1>&#39;key&#39;</span><span class=p>])</span>
</span><span id=__span-42-17><a id=__codelineno-42-17 name=__codelineno-42-17 href=#__codelineno-42-17></a><span class=nb>print</span><span class=p>(</span><span class=n>result_missing</span><span class=p>)</span>  <span class=c1># None</span>
</span></code></pre></div> <h4 id=method-5-safe-reduce-with-get><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#method-5-safe-reduce-with-get>Method 5: Safe reduce with get()</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=k>def</span><span class=w> </span><span class=nf>get_nested_safe_reduce</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Safely get nested value using reduce with get().&quot;&quot;&quot;</span>
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a>    <span class=k>return</span> <span class=n>reduce</span><span class=p>(</span>
</span><span id=__span-43-4><a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a>        <span class=k>lambda</span> <span class=n>d</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=n>d</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=p>{})</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>d</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=k>else</span> <span class=p>{},</span>
</span><span id=__span-43-5><a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a>        <span class=n>path</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span>
</span><span id=__span-43-6><a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a>        <span class=n>data</span>
</span><span id=__span-43-7><a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a>    <span class=p>)</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>path</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=n>default</span><span class=p>)</span> <span class=k>if</span> <span class=n>path</span> <span class=k>else</span> <span class=n>default</span>
</span><span id=__span-43-8><a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a>
</span><span id=__span-43-9><a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=n>result</span> <span class=o>=</span> <span class=n>get_nested_safe_reduce</span><span class=p>(</span><span class=n>user_data</span><span class=p>,</span> <span class=n>path</span><span class=p>)</span>
</span><span id=__span-43-10><a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>  <span class=c1># True</span>
</span><span id=__span-43-11><a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a>
</span><span id=__span-43-12><a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a><span class=c1># Works with partial paths</span>
</span><span id=__span-43-13><a id=__codelineno-43-13 name=__codelineno-43-13 href=#__codelineno-43-13></a><span class=n>result_partial</span> <span class=o>=</span> <span class=n>get_nested_safe_reduce</span><span class=p>(</span><span class=n>user_data</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;missing&#39;</span><span class=p>])</span>
</span><span id=__span-43-14><a id=__codelineno-43-14 name=__codelineno-43-14 href=#__codelineno-43-14></a><span class=nb>print</span><span class=p>(</span><span class=n>result_partial</span><span class=p>)</span>  <span class=c1># None</span>
</span></code></pre></div> <h3 id=programmatic-depth-search><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#programmatic-depth-search>Programmatic Depth Search</a></h3> <p>For maximum flexibility, here's a robust function that can handle various edge cases:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=k>def</span><span class=w> </span><span class=nf>programmatic_depth_search</span><span class=p>(</span><span class=n>dictionary</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-44-3><a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=sd>    Recursively search through a nested dictionary using a list of keys.</span>
</span><span id=__span-44-4><a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a>
</span><span id=__span-44-5><a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a><span class=sd>    Args:</span>
</span><span id=__span-44-6><a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=sd>        dictionary: The dictionary to search through</span>
</span><span id=__span-44-7><a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a><span class=sd>        path: List of keys representing the path to the desired value</span>
</span><span id=__span-44-8><a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a><span class=sd>        default: Value to return if path is not found</span>
</span><span id=__span-44-9><a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a>
</span><span id=__span-44-10><a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a><span class=sd>    Returns:</span>
</span><span id=__span-44-11><a id=__codelineno-44-11 name=__codelineno-44-11 href=#__codelineno-44-11></a><span class=sd>        The value at the specified path, or default if not found</span>
</span><span id=__span-44-12><a id=__codelineno-44-12 name=__codelineno-44-12 href=#__codelineno-44-12></a>
</span><span id=__span-44-13><a id=__codelineno-44-13 name=__codelineno-44-13 href=#__codelineno-44-13></a><span class=sd>    Examples:</span>
</span><span id=__span-44-14><a id=__codelineno-44-14 name=__codelineno-44-14 href=#__codelineno-44-14></a><span class=sd>        &gt;&gt;&gt; data = {&#39;a&#39;: {&#39;b&#39;: {&#39;c&#39;: 42}}}</span>
</span><span id=__span-44-15><a id=__codelineno-44-15 name=__codelineno-44-15 href=#__codelineno-44-15></a><span class=sd>        &gt;&gt;&gt; programmatic_depth_search(data, [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;])</span>
</span><span id=__span-44-16><a id=__codelineno-44-16 name=__codelineno-44-16 href=#__codelineno-44-16></a><span class=sd>        42</span>
</span><span id=__span-44-17><a id=__codelineno-44-17 name=__codelineno-44-17 href=#__codelineno-44-17></a><span class=sd>        &gt;&gt;&gt; programmatic_depth_search(data, [&#39;a&#39;, &#39;b&#39;, &#39;missing&#39;], &#39;not found&#39;)</span>
</span><span id=__span-44-18><a id=__codelineno-44-18 name=__codelineno-44-18 href=#__codelineno-44-18></a><span class=sd>        &#39;not found&#39;</span>
</span><span id=__span-44-19><a id=__codelineno-44-19 name=__codelineno-44-19 href=#__codelineno-44-19></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-44-20><a id=__codelineno-44-20 name=__codelineno-44-20 href=#__codelineno-44-20></a>    <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>dictionary</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>path</span><span class=p>:</span>
</span><span id=__span-44-21><a id=__codelineno-44-21 name=__codelineno-44-21 href=#__codelineno-44-21></a>        <span class=k>return</span> <span class=n>default</span>
</span><span id=__span-44-22><a id=__codelineno-44-22 name=__codelineno-44-22 href=#__codelineno-44-22></a>
</span><span id=__span-44-23><a id=__codelineno-44-23 name=__codelineno-44-23 href=#__codelineno-44-23></a>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>path</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span><span id=__span-44-24><a id=__codelineno-44-24 name=__codelineno-44-24 href=#__codelineno-44-24></a>        <span class=k>return</span> <span class=n>dictionary</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>path</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>default</span><span class=p>)</span>
</span><span id=__span-44-25><a id=__codelineno-44-25 name=__codelineno-44-25 href=#__codelineno-44-25></a>
</span><span id=__span-44-26><a id=__codelineno-44-26 name=__codelineno-44-26 href=#__codelineno-44-26></a>    <span class=n>next_level</span> <span class=o>=</span> <span class=n>dictionary</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>path</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span><span id=__span-44-27><a id=__codelineno-44-27 name=__codelineno-44-27 href=#__codelineno-44-27></a>    <span class=k>if</span> <span class=n>next_level</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-44-28><a id=__codelineno-44-28 name=__codelineno-44-28 href=#__codelineno-44-28></a>        <span class=k>return</span> <span class=n>default</span>
</span><span id=__span-44-29><a id=__codelineno-44-29 name=__codelineno-44-29 href=#__codelineno-44-29></a>
</span><span id=__span-44-30><a id=__codelineno-44-30 name=__codelineno-44-30 href=#__codelineno-44-30></a>    <span class=k>return</span> <span class=n>programmatic_depth_search</span><span class=p>(</span><span class=n>next_level</span><span class=p>,</span> <span class=n>path</span><span class=p>[</span><span class=mi>1</span><span class=p>:],</span> <span class=n>default</span><span class=p>)</span>
</span><span id=__span-44-31><a id=__codelineno-44-31 name=__codelineno-44-31 href=#__codelineno-44-31></a>
</span><span id=__span-44-32><a id=__codelineno-44-32 name=__codelineno-44-32 href=#__codelineno-44-32></a><span class=c1># Test with various scenarios</span>
</span><span id=__span-44-33><a id=__codelineno-44-33 name=__codelineno-44-33 href=#__codelineno-44-33></a><span class=n>test_data</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-44-34><a id=__codelineno-44-34 name=__codelineno-44-34 href=#__codelineno-44-34></a>    <span class=s1>&#39;level1&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-44-35><a id=__codelineno-44-35 name=__codelineno-44-35 href=#__codelineno-44-35></a>        <span class=s1>&#39;level2&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-44-36><a id=__codelineno-44-36 name=__codelineno-44-36 href=#__codelineno-44-36></a>            <span class=s1>&#39;level3&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-44-37><a id=__codelineno-44-37 name=__codelineno-44-37 href=#__codelineno-44-37></a>                <span class=s1>&#39;target&#39;</span><span class=p>:</span> <span class=s1>&#39;found it!&#39;</span><span class=p>,</span>
</span><span id=__span-44-38><a id=__codelineno-44-38 name=__codelineno-44-38 href=#__codelineno-44-38></a>                <span class=s1>&#39;number&#39;</span><span class=p>:</span> <span class=mi>42</span><span class=p>,</span>
</span><span id=__span-44-39><a id=__codelineno-44-39 name=__codelineno-44-39 href=#__codelineno-44-39></a>                <span class=s1>&#39;boolean&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-44-40><a id=__codelineno-44-40 name=__codelineno-44-40 href=#__codelineno-44-40></a>                <span class=s1>&#39;null_value&#39;</span><span class=p>:</span> <span class=kc>None</span>
</span><span id=__span-44-41><a id=__codelineno-44-41 name=__codelineno-44-41 href=#__codelineno-44-41></a>            <span class=p>}</span>
</span><span id=__span-44-42><a id=__codelineno-44-42 name=__codelineno-44-42 href=#__codelineno-44-42></a>        <span class=p>}</span>
</span><span id=__span-44-43><a id=__codelineno-44-43 name=__codelineno-44-43 href=#__codelineno-44-43></a>    <span class=p>},</span>
</span><span id=__span-44-44><a id=__codelineno-44-44 name=__codelineno-44-44 href=#__codelineno-44-44></a>    <span class=s1>&#39;empty_dict&#39;</span><span class=p>:</span> <span class=p>{},</span>
</span><span id=__span-44-45><a id=__codelineno-44-45 name=__codelineno-44-45 href=#__codelineno-44-45></a>    <span class=s1>&#39;list_value&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
</span><span id=__span-44-46><a id=__codelineno-44-46 name=__codelineno-44-46 href=#__codelineno-44-46></a>    <span class=s1>&#39;string_value&#39;</span><span class=p>:</span> <span class=s1>&#39;hello&#39;</span>
</span><span id=__span-44-47><a id=__codelineno-44-47 name=__codelineno-44-47 href=#__codelineno-44-47></a><span class=p>}</span>
</span><span id=__span-44-48><a id=__codelineno-44-48 name=__codelineno-44-48 href=#__codelineno-44-48></a>
</span><span id=__span-44-49><a id=__codelineno-44-49 name=__codelineno-44-49 href=#__codelineno-44-49></a><span class=c1># Successful lookups</span>
</span><span id=__span-44-50><a id=__codelineno-44-50 name=__codelineno-44-50 href=#__codelineno-44-50></a><span class=nb>print</span><span class=p>(</span><span class=n>programmatic_depth_search</span><span class=p>(</span><span class=n>test_data</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;level1&#39;</span><span class=p>,</span> <span class=s1>&#39;level2&#39;</span><span class=p>,</span> <span class=s1>&#39;level3&#39;</span><span class=p>,</span> <span class=s1>&#39;target&#39;</span><span class=p>]))</span>
</span><span id=__span-44-51><a id=__codelineno-44-51 name=__codelineno-44-51 href=#__codelineno-44-51></a><span class=c1># Output: found it!</span>
</span><span id=__span-44-52><a id=__codelineno-44-52 name=__codelineno-44-52 href=#__codelineno-44-52></a>
</span><span id=__span-44-53><a id=__codelineno-44-53 name=__codelineno-44-53 href=#__codelineno-44-53></a><span class=nb>print</span><span class=p>(</span><span class=n>programmatic_depth_search</span><span class=p>(</span><span class=n>test_data</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;level1&#39;</span><span class=p>,</span> <span class=s1>&#39;level2&#39;</span><span class=p>,</span> <span class=s1>&#39;level3&#39;</span><span class=p>,</span> <span class=s1>&#39;number&#39;</span><span class=p>]))</span>
</span><span id=__span-44-54><a id=__codelineno-44-54 name=__codelineno-44-54 href=#__codelineno-44-54></a><span class=c1># Output: 42</span>
</span><span id=__span-44-55><a id=__codelineno-44-55 name=__codelineno-44-55 href=#__codelineno-44-55></a>
</span><span id=__span-44-56><a id=__codelineno-44-56 name=__codelineno-44-56 href=#__codelineno-44-56></a><span class=c1># Missing path</span>
</span><span id=__span-44-57><a id=__codelineno-44-57 name=__codelineno-44-57 href=#__codelineno-44-57></a><span class=nb>print</span><span class=p>(</span><span class=n>programmatic_depth_search</span><span class=p>(</span><span class=n>test_data</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;level1&#39;</span><span class=p>,</span> <span class=s1>&#39;missing&#39;</span><span class=p>,</span> <span class=s1>&#39;key&#39;</span><span class=p>],</span> <span class=s1>&#39;default&#39;</span><span class=p>))</span>
</span><span id=__span-44-58><a id=__codelineno-44-58 name=__codelineno-44-58 href=#__codelineno-44-58></a><span class=c1># Output: default</span>
</span><span id=__span-44-59><a id=__codelineno-44-59 name=__codelineno-44-59 href=#__codelineno-44-59></a>
</span><span id=__span-44-60><a id=__codelineno-44-60 name=__codelineno-44-60 href=#__codelineno-44-60></a><span class=c1># Empty path</span>
</span><span id=__span-44-61><a id=__codelineno-44-61 name=__codelineno-44-61 href=#__codelineno-44-61></a><span class=nb>print</span><span class=p>(</span><span class=n>programmatic_depth_search</span><span class=p>(</span><span class=n>test_data</span><span class=p>,</span> <span class=p>[],</span> <span class=s1>&#39;empty_path&#39;</span><span class=p>))</span>
</span><span id=__span-44-62><a id=__codelineno-44-62 name=__codelineno-44-62 href=#__codelineno-44-62></a><span class=c1># Output: empty_path</span>
</span><span id=__span-44-63><a id=__codelineno-44-63 name=__codelineno-44-63 href=#__codelineno-44-63></a>
</span><span id=__span-44-64><a id=__codelineno-44-64 name=__codelineno-44-64 href=#__codelineno-44-64></a><span class=c1># Path through non-dict</span>
</span><span id=__span-44-65><a id=__codelineno-44-65 name=__codelineno-44-65 href=#__codelineno-44-65></a><span class=nb>print</span><span class=p>(</span><span class=n>programmatic_depth_search</span><span class=p>(</span><span class=n>test_data</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;string_value&#39;</span><span class=p>,</span> <span class=s1>&#39;nested&#39;</span><span class=p>],</span> <span class=s1>&#39;not_dict&#39;</span><span class=p>))</span>
</span><span id=__span-44-66><a id=__codelineno-44-66 name=__codelineno-44-66 href=#__codelineno-44-66></a><span class=c1># Output: not_dict</span>
</span></code></pre></div> <h4 id=enhanced-version-with-type-checking><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#enhanced-version-with-type-checking>Enhanced Version with Type Checking</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=k>def</span><span class=w> </span><span class=nf>enhanced_depth_search</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>strict_types</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span><span id=__span-45-2><a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-45-3><a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=sd>    Enhanced version with additional type checking and options.</span>
</span><span id=__span-45-4><a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a>
</span><span id=__span-45-5><a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=sd>    Args:</span>
</span><span id=__span-45-6><a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a><span class=sd>        data: The data structure to search</span>
</span><span id=__span-45-7><a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a><span class=sd>        path: List of keys/indices for the path</span>
</span><span id=__span-45-8><a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a><span class=sd>        default: Default value if path not found</span>
</span><span id=__span-45-9><a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a><span class=sd>        strict_types: If True, only allow dict traversal</span>
</span><span id=__span-45-10><a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a>
</span><span id=__span-45-11><a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a><span class=sd>    Returns:</span>
</span><span id=__span-45-12><a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a><span class=sd>        Value at path or default</span>
</span><span id=__span-45-13><a id=__codelineno-45-13 name=__codelineno-45-13 href=#__codelineno-45-13></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-45-14><a id=__codelineno-45-14 name=__codelineno-45-14 href=#__codelineno-45-14></a>    <span class=n>current</span> <span class=o>=</span> <span class=n>data</span>
</span><span id=__span-45-15><a id=__codelineno-45-15 name=__codelineno-45-15 href=#__codelineno-45-15></a>
</span><span id=__span-45-16><a id=__codelineno-45-16 name=__codelineno-45-16 href=#__codelineno-45-16></a>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>key</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
</span><span id=__span-45-17><a id=__codelineno-45-17 name=__codelineno-45-17 href=#__codelineno-45-17></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>current</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
</span><span id=__span-45-18><a id=__codelineno-45-18 name=__codelineno-45-18 href=#__codelineno-45-18></a>            <span class=n>current</span> <span class=o>=</span> <span class=n>current</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span><span id=__span-45-19><a id=__codelineno-45-19 name=__codelineno-45-19 href=#__codelineno-45-19></a>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>current</span><span class=p>,</span> <span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>))</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>strict_types</span><span class=p>:</span>
</span><span id=__span-45-20><a id=__codelineno-45-20 name=__codelineno-45-20 href=#__codelineno-45-20></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-45-21><a id=__codelineno-45-21 name=__codelineno-45-21 href=#__codelineno-45-21></a>                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=nb>int</span><span class=p>)</span> <span class=ow>and</span> <span class=mi>0</span> <span class=o>&lt;=</span> <span class=n>key</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>current</span><span class=p>):</span>
</span><span id=__span-45-22><a id=__codelineno-45-22 name=__codelineno-45-22 href=#__codelineno-45-22></a>                    <span class=n>current</span> <span class=o>=</span> <span class=n>current</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
</span><span id=__span-45-23><a id=__codelineno-45-23 name=__codelineno-45-23 href=#__codelineno-45-23></a>                <span class=k>else</span><span class=p>:</span>
</span><span id=__span-45-24><a id=__codelineno-45-24 name=__codelineno-45-24 href=#__codelineno-45-24></a>                    <span class=k>return</span> <span class=n>default</span>
</span><span id=__span-45-25><a id=__codelineno-45-25 name=__codelineno-45-25 href=#__codelineno-45-25></a>            <span class=k>except</span> <span class=p>(</span><span class=ne>IndexError</span><span class=p>,</span> <span class=ne>TypeError</span><span class=p>):</span>
</span><span id=__span-45-26><a id=__codelineno-45-26 name=__codelineno-45-26 href=#__codelineno-45-26></a>                <span class=k>return</span> <span class=n>default</span>
</span><span id=__span-45-27><a id=__codelineno-45-27 name=__codelineno-45-27 href=#__codelineno-45-27></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-45-28><a id=__codelineno-45-28 name=__codelineno-45-28 href=#__codelineno-45-28></a>            <span class=k>return</span> <span class=n>default</span>
</span><span id=__span-45-29><a id=__codelineno-45-29 name=__codelineno-45-29 href=#__codelineno-45-29></a>
</span><span id=__span-45-30><a id=__codelineno-45-30 name=__codelineno-45-30 href=#__codelineno-45-30></a>        <span class=k>if</span> <span class=n>current</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-45-31><a id=__codelineno-45-31 name=__codelineno-45-31 href=#__codelineno-45-31></a>            <span class=k>return</span> <span class=n>default</span>
</span><span id=__span-45-32><a id=__codelineno-45-32 name=__codelineno-45-32 href=#__codelineno-45-32></a>
</span><span id=__span-45-33><a id=__codelineno-45-33 name=__codelineno-45-33 href=#__codelineno-45-33></a>    <span class=k>return</span> <span class=n>current</span>
</span><span id=__span-45-34><a id=__codelineno-45-34 name=__codelineno-45-34 href=#__codelineno-45-34></a>
</span><span id=__span-45-35><a id=__codelineno-45-35 name=__codelineno-45-35 href=#__codelineno-45-35></a><span class=c1># Test with mixed data types</span>
</span><span id=__span-45-36><a id=__codelineno-45-36 name=__codelineno-45-36 href=#__codelineno-45-36></a><span class=n>mixed_data</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-45-37><a id=__codelineno-45-37 name=__codelineno-45-37 href=#__codelineno-45-37></a>    <span class=s1>&#39;users&#39;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-45-38><a id=__codelineno-45-38 name=__codelineno-45-38 href=#__codelineno-45-38></a>        <span class=p>{</span><span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;Alice&#39;</span><span class=p>,</span> <span class=s1>&#39;settings&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;theme&#39;</span><span class=p>:</span> <span class=s1>&#39;dark&#39;</span><span class=p>}},</span>
</span><span id=__span-45-39><a id=__codelineno-45-39 name=__codelineno-45-39 href=#__codelineno-45-39></a>        <span class=p>{</span><span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;Bob&#39;</span><span class=p>,</span> <span class=s1>&#39;settings&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;theme&#39;</span><span class=p>:</span> <span class=s1>&#39;light&#39;</span><span class=p>}}</span>
</span><span id=__span-45-40><a id=__codelineno-45-40 name=__codelineno-45-40 href=#__codelineno-45-40></a>    <span class=p>],</span>
</span><span id=__span-45-41><a id=__codelineno-45-41 name=__codelineno-45-41 href=#__codelineno-45-41></a>    <span class=s1>&#39;config&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-45-42><a id=__codelineno-45-42 name=__codelineno-45-42 href=#__codelineno-45-42></a>        <span class=s1>&#39;database&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-45-43><a id=__codelineno-45-43 name=__codelineno-45-43 href=#__codelineno-45-43></a>            <span class=s1>&#39;host&#39;</span><span class=p>:</span> <span class=s1>&#39;localhost&#39;</span><span class=p>,</span>
</span><span id=__span-45-44><a id=__codelineno-45-44 name=__codelineno-45-44 href=#__codelineno-45-44></a>            <span class=s1>&#39;port&#39;</span><span class=p>:</span> <span class=mi>5432</span>
</span><span id=__span-45-45><a id=__codelineno-45-45 name=__codelineno-45-45 href=#__codelineno-45-45></a>        <span class=p>}</span>
</span><span id=__span-45-46><a id=__codelineno-45-46 name=__codelineno-45-46 href=#__codelineno-45-46></a>    <span class=p>}</span>
</span><span id=__span-45-47><a id=__codelineno-45-47 name=__codelineno-45-47 href=#__codelineno-45-47></a><span class=p>}</span>
</span><span id=__span-45-48><a id=__codelineno-45-48 name=__codelineno-45-48 href=#__codelineno-45-48></a>
</span><span id=__span-45-49><a id=__codelineno-45-49 name=__codelineno-45-49 href=#__codelineno-45-49></a><span class=c1># Access array element then nested dict</span>
</span><span id=__span-45-50><a id=__codelineno-45-50 name=__codelineno-45-50 href=#__codelineno-45-50></a><span class=n>alice_theme</span> <span class=o>=</span> <span class=n>enhanced_depth_search</span><span class=p>(</span><span class=n>mixed_data</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;users&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;settings&#39;</span><span class=p>,</span> <span class=s1>&#39;theme&#39;</span><span class=p>])</span>
</span><span id=__span-45-51><a id=__codelineno-45-51 name=__codelineno-45-51 href=#__codelineno-45-51></a><span class=nb>print</span><span class=p>(</span><span class=n>alice_theme</span><span class=p>)</span>  <span class=c1># dark</span>
</span><span id=__span-45-52><a id=__codelineno-45-52 name=__codelineno-45-52 href=#__codelineno-45-52></a>
</span><span id=__span-45-53><a id=__codelineno-45-53 name=__codelineno-45-53 href=#__codelineno-45-53></a><span class=c1># Access second user</span>
</span><span id=__span-45-54><a id=__codelineno-45-54 name=__codelineno-45-54 href=#__codelineno-45-54></a><span class=n>bob_theme</span> <span class=o>=</span> <span class=n>enhanced_depth_search</span><span class=p>(</span><span class=n>mixed_data</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;users&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;settings&#39;</span><span class=p>,</span> <span class=s1>&#39;theme&#39;</span><span class=p>])</span>
</span><span id=__span-45-55><a id=__codelineno-45-55 name=__codelineno-45-55 href=#__codelineno-45-55></a><span class=nb>print</span><span class=p>(</span><span class=n>bob_theme</span><span class=p>)</span>  <span class=c1># light</span>
</span><span id=__span-45-56><a id=__codelineno-45-56 name=__codelineno-45-56 href=#__codelineno-45-56></a>
</span><span id=__span-45-57><a id=__codelineno-45-57 name=__codelineno-45-57 href=#__codelineno-45-57></a><span class=c1># Access config</span>
</span><span id=__span-45-58><a id=__codelineno-45-58 name=__codelineno-45-58 href=#__codelineno-45-58></a><span class=n>db_host</span> <span class=o>=</span> <span class=n>enhanced_depth_search</span><span class=p>(</span><span class=n>mixed_data</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;config&#39;</span><span class=p>,</span> <span class=s1>&#39;database&#39;</span><span class=p>,</span> <span class=s1>&#39;host&#39;</span><span class=p>])</span>
</span><span id=__span-45-59><a id=__codelineno-45-59 name=__codelineno-45-59 href=#__codelineno-45-59></a><span class=nb>print</span><span class=p>(</span><span class=n>db_host</span><span class=p>)</span>  <span class=c1># localhost</span>
</span></code></pre></div> <h3 id=performance-comparison><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#performance-comparison>Performance Comparison</a></h3> <p>Let's benchmark the different approaches to understand their performance characteristics:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=kn>import</span><span class=w> </span><span class=nn>time</span>
</span><span id=__span-46-2><a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a><span class=kn>import</span><span class=w> </span><span class=nn>random</span>
</span><span id=__span-46-3><a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=kn>from</span><span class=w> </span><span class=nn>functools</span><span class=w> </span><span class=kn>import</span> <span class=n>reduce</span>
</span><span id=__span-46-4><a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a>
</span><span id=__span-46-5><a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=k>def</span><span class=w> </span><span class=nf>create_test_data</span><span class=p>(</span><span class=n>depth</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span> <span class=n>width</span><span class=o>=</span><span class=mi>3</span><span class=p>):</span>
</span><span id=__span-46-6><a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Create nested test data of specified depth and width.&quot;&quot;&quot;</span>
</span><span id=__span-46-7><a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a>    <span class=k>if</span> <span class=n>depth</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-46-8><a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a>        <span class=k>return</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span>
</span><span id=__span-46-9><a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a>
</span><span id=__span-46-10><a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a>    <span class=k>return</span> <span class=p>{</span><span class=sa>f</span><span class=s1>&#39;key_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>:</span> <span class=n>create_test_data</span><span class=p>(</span><span class=n>depth</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=n>width</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>width</span><span class=p>)}</span>
</span><span id=__span-46-11><a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a>
</span><span id=__span-46-12><a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a><span class=k>def</span><span class=w> </span><span class=nf>create_test_paths</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>max_depth</span><span class=o>=</span><span class=mi>5</span><span class=p>):</span>
</span><span id=__span-46-13><a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Create valid and invalid test paths.&quot;&quot;&quot;</span>
</span><span id=__span-46-14><a id=__codelineno-46-14 name=__codelineno-46-14 href=#__codelineno-46-14></a>    <span class=n>valid_paths</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-46-15><a id=__codelineno-46-15 name=__codelineno-46-15 href=#__codelineno-46-15></a>    <span class=n>invalid_paths</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-46-16><a id=__codelineno-46-16 name=__codelineno-46-16 href=#__codelineno-46-16></a>
</span><span id=__span-46-17><a id=__codelineno-46-17 name=__codelineno-46-17 href=#__codelineno-46-17></a>    <span class=c1># Create some valid paths</span>
</span><span id=__span-46-18><a id=__codelineno-46-18 name=__codelineno-46-18 href=#__codelineno-46-18></a>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>max_depth</span><span class=p>):</span>
</span><span id=__span-46-19><a id=__codelineno-46-19 name=__codelineno-46-19 href=#__codelineno-46-19></a>        <span class=n>path</span> <span class=o>=</span> <span class=p>[</span><span class=sa>f</span><span class=s1>&#39;key_</span><span class=si>{</span><span class=n>j</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>3</span><span class=si>}</span><span class=s1>&#39;</span> <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)]</span>
</span><span id=__span-46-20><a id=__codelineno-46-20 name=__codelineno-46-20 href=#__codelineno-46-20></a>        <span class=n>valid_paths</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
</span><span id=__span-46-21><a id=__codelineno-46-21 name=__codelineno-46-21 href=#__codelineno-46-21></a>
</span><span id=__span-46-22><a id=__codelineno-46-22 name=__codelineno-46-22 href=#__codelineno-46-22></a>    <span class=c1># Create some invalid paths</span>
</span><span id=__span-46-23><a id=__codelineno-46-23 name=__codelineno-46-23 href=#__codelineno-46-23></a>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>max_depth</span><span class=p>):</span>
</span><span id=__span-46-24><a id=__codelineno-46-24 name=__codelineno-46-24 href=#__codelineno-46-24></a>        <span class=n>path</span> <span class=o>=</span> <span class=p>[</span><span class=sa>f</span><span class=s1>&#39;key_</span><span class=si>{</span><span class=n>j</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>3</span><span class=si>}</span><span class=s1>&#39;</span> <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>i</span><span class=p>)]</span> <span class=o>+</span> <span class=p>[</span><span class=s1>&#39;invalid_key&#39;</span><span class=p>]</span>
</span><span id=__span-46-25><a id=__codelineno-46-25 name=__codelineno-46-25 href=#__codelineno-46-25></a>        <span class=n>invalid_paths</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
</span><span id=__span-46-26><a id=__codelineno-46-26 name=__codelineno-46-26 href=#__codelineno-46-26></a>
</span><span id=__span-46-27><a id=__codelineno-46-27 name=__codelineno-46-27 href=#__codelineno-46-27></a>    <span class=k>return</span> <span class=n>valid_paths</span><span class=p>,</span> <span class=n>invalid_paths</span>
</span><span id=__span-46-28><a id=__codelineno-46-28 name=__codelineno-46-28 href=#__codelineno-46-28></a>
</span><span id=__span-46-29><a id=__codelineno-46-29 name=__codelineno-46-29 href=#__codelineno-46-29></a><span class=c1># Create test data</span>
</span><span id=__span-46-30><a id=__codelineno-46-30 name=__codelineno-46-30 href=#__codelineno-46-30></a><span class=n>test_data</span> <span class=o>=</span> <span class=n>create_test_data</span><span class=p>(</span><span class=n>depth</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span> <span class=n>width</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span><span id=__span-46-31><a id=__codelineno-46-31 name=__codelineno-46-31 href=#__codelineno-46-31></a><span class=n>valid_paths</span><span class=p>,</span> <span class=n>invalid_paths</span> <span class=o>=</span> <span class=n>create_test_paths</span><span class=p>(</span><span class=n>test_data</span><span class=p>,</span> <span class=n>max_depth</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span><span id=__span-46-32><a id=__codelineno-46-32 name=__codelineno-46-32 href=#__codelineno-46-32></a>
</span><span id=__span-46-33><a id=__codelineno-46-33 name=__codelineno-46-33 href=#__codelineno-46-33></a><span class=k>def</span><span class=w> </span><span class=nf>benchmark_function</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=n>paths</span><span class=p>,</span> <span class=n>iterations</span><span class=o>=</span><span class=mi>10000</span><span class=p>):</span>
</span><span id=__span-46-34><a id=__codelineno-46-34 name=__codelineno-46-34 href=#__codelineno-46-34></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Benchmark a function with given data and paths.&quot;&quot;&quot;</span>
</span><span id=__span-46-35><a id=__codelineno-46-35 name=__codelineno-46-35 href=#__codelineno-46-35></a>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span>
</span><span id=__span-46-36><a id=__codelineno-46-36 name=__codelineno-46-36 href=#__codelineno-46-36></a>
</span><span id=__span-46-37><a id=__codelineno-46-37 name=__codelineno-46-37 href=#__codelineno-46-37></a>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>iterations</span><span class=p>):</span>
</span><span id=__span-46-38><a id=__codelineno-46-38 name=__codelineno-46-38 href=#__codelineno-46-38></a>        <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>paths</span><span class=p>:</span>
</span><span id=__span-46-39><a id=__codelineno-46-39 name=__codelineno-46-39 href=#__codelineno-46-39></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-46-40><a id=__codelineno-46-40 name=__codelineno-46-40 href=#__codelineno-46-40></a>                <span class=n>func</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>path</span><span class=p>)</span>
</span><span id=__span-46-41><a id=__codelineno-46-41 name=__codelineno-46-41 href=#__codelineno-46-41></a>            <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-46-42><a id=__codelineno-46-42 name=__codelineno-46-42 href=#__codelineno-46-42></a>                <span class=k>pass</span>  <span class=c1># Ignore errors for benchmarking</span>
</span><span id=__span-46-43><a id=__codelineno-46-43 name=__codelineno-46-43 href=#__codelineno-46-43></a>
</span><span id=__span-46-44><a id=__codelineno-46-44 name=__codelineno-46-44 href=#__codelineno-46-44></a>    <span class=n>end_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span>
</span><span id=__span-46-45><a id=__codelineno-46-45 name=__codelineno-46-45 href=#__codelineno-46-45></a>    <span class=k>return</span> <span class=n>end_time</span> <span class=o>-</span> <span class=n>start_time</span>
</span><span id=__span-46-46><a id=__codelineno-46-46 name=__codelineno-46-46 href=#__codelineno-46-46></a>
</span><span id=__span-46-47><a id=__codelineno-46-47 name=__codelineno-46-47 href=#__codelineno-46-47></a><span class=c1># Define functions to test</span>
</span><span id=__span-46-48><a id=__codelineno-46-48 name=__codelineno-46-48 href=#__codelineno-46-48></a><span class=k>def</span><span class=w> </span><span class=nf>method_chained_get</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>path</span><span class=p>):</span>
</span><span id=__span-46-49><a id=__codelineno-46-49 name=__codelineno-46-49 href=#__codelineno-46-49></a>    <span class=n>result</span> <span class=o>=</span> <span class=n>data</span>
</span><span id=__span-46-50><a id=__codelineno-46-50 name=__codelineno-46-50 href=#__codelineno-46-50></a>    <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>path</span><span class=p>:</span>
</span><span id=__span-46-51><a id=__codelineno-46-51 name=__codelineno-46-51 href=#__codelineno-46-51></a>        <span class=n>result</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-46-52><a id=__codelineno-46-52 name=__codelineno-46-52 href=#__codelineno-46-52></a>    <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-46-53><a id=__codelineno-46-53 name=__codelineno-46-53 href=#__codelineno-46-53></a>
</span><span id=__span-46-54><a id=__codelineno-46-54 name=__codelineno-46-54 href=#__codelineno-46-54></a><span class=k>def</span><span class=w> </span><span class=nf>method_try_except</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>path</span><span class=p>):</span>
</span><span id=__span-46-55><a id=__codelineno-46-55 name=__codelineno-46-55 href=#__codelineno-46-55></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-46-56><a id=__codelineno-46-56 name=__codelineno-46-56 href=#__codelineno-46-56></a>        <span class=n>result</span> <span class=o>=</span> <span class=n>data</span>
</span><span id=__span-46-57><a id=__codelineno-46-57 name=__codelineno-46-57 href=#__codelineno-46-57></a>        <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>path</span><span class=p>:</span>
</span><span id=__span-46-58><a id=__codelineno-46-58 name=__codelineno-46-58 href=#__codelineno-46-58></a>            <span class=n>result</span> <span class=o>=</span> <span class=n>result</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
</span><span id=__span-46-59><a id=__codelineno-46-59 name=__codelineno-46-59 href=#__codelineno-46-59></a>        <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-46-60><a id=__codelineno-46-60 name=__codelineno-46-60 href=#__codelineno-46-60></a>    <span class=k>except</span> <span class=ne>KeyError</span><span class=p>:</span>
</span><span id=__span-46-61><a id=__codelineno-46-61 name=__codelineno-46-61 href=#__codelineno-46-61></a>        <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-46-62><a id=__codelineno-46-62 name=__codelineno-46-62 href=#__codelineno-46-62></a>
</span><span id=__span-46-63><a id=__codelineno-46-63 name=__codelineno-46-63 href=#__codelineno-46-63></a><span class=k>def</span><span class=w> </span><span class=nf>method_reduce_safe</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>path</span><span class=p>):</span>
</span><span id=__span-46-64><a id=__codelineno-46-64 name=__codelineno-46-64 href=#__codelineno-46-64></a>    <span class=k>return</span> <span class=n>reduce</span><span class=p>(</span>
</span><span id=__span-46-65><a id=__codelineno-46-65 name=__codelineno-46-65 href=#__codelineno-46-65></a>        <span class=k>lambda</span> <span class=n>d</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=n>d</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=p>{})</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>d</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=k>else</span> <span class=p>{},</span>
</span><span id=__span-46-66><a id=__codelineno-46-66 name=__codelineno-46-66 href=#__codelineno-46-66></a>        <span class=n>path</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span>
</span><span id=__span-46-67><a id=__codelineno-46-67 name=__codelineno-46-67 href=#__codelineno-46-67></a>        <span class=n>data</span>
</span><span id=__span-46-68><a id=__codelineno-46-68 name=__codelineno-46-68 href=#__codelineno-46-68></a>    <span class=p>)</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>path</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span> <span class=k>if</span> <span class=n>path</span> <span class=k>else</span> <span class=kc>None</span>
</span><span id=__span-46-69><a id=__codelineno-46-69 name=__codelineno-46-69 href=#__codelineno-46-69></a>
</span><span id=__span-46-70><a id=__codelineno-46-70 name=__codelineno-46-70 href=#__codelineno-46-70></a><span class=c1># Run benchmarks</span>
</span><span id=__span-46-71><a id=__codelineno-46-71 name=__codelineno-46-71 href=#__codelineno-46-71></a><span class=n>functions</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-46-72><a id=__codelineno-46-72 name=__codelineno-46-72 href=#__codelineno-46-72></a>    <span class=p>(</span><span class=s1>&#39;Chained get()&#39;</span><span class=p>,</span> <span class=n>method_chained_get</span><span class=p>),</span>
</span><span id=__span-46-73><a id=__codelineno-46-73 name=__codelineno-46-73 href=#__codelineno-46-73></a>    <span class=p>(</span><span class=s1>&#39;Try/except&#39;</span><span class=p>,</span> <span class=n>method_try_except</span><span class=p>),</span>
</span><span id=__span-46-74><a id=__codelineno-46-74 name=__codelineno-46-74 href=#__codelineno-46-74></a>    <span class=p>(</span><span class=s1>&#39;Reduce safe&#39;</span><span class=p>,</span> <span class=n>method_reduce_safe</span><span class=p>),</span>
</span><span id=__span-46-75><a id=__codelineno-46-75 name=__codelineno-46-75 href=#__codelineno-46-75></a>    <span class=p>(</span><span class=s1>&#39;Programmatic search&#39;</span><span class=p>,</span> <span class=n>programmatic_depth_search</span><span class=p>)</span>
</span><span id=__span-46-76><a id=__codelineno-46-76 name=__codelineno-46-76 href=#__codelineno-46-76></a><span class=p>]</span>
</span><span id=__span-46-77><a id=__codelineno-46-77 name=__codelineno-46-77 href=#__codelineno-46-77></a>
</span><span id=__span-46-78><a id=__codelineno-46-78 name=__codelineno-46-78 href=#__codelineno-46-78></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Performance Benchmark Results&quot;</span><span class=p>)</span>
</span><span id=__span-46-79><a id=__codelineno-46-79 name=__codelineno-46-79 href=#__codelineno-46-79></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;=&quot;</span> <span class=o>*</span> <span class=mi>50</span><span class=p>)</span>
</span><span id=__span-46-80><a id=__codelineno-46-80 name=__codelineno-46-80 href=#__codelineno-46-80></a>
</span><span id=__span-46-81><a id=__codelineno-46-81 name=__codelineno-46-81 href=#__codelineno-46-81></a><span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>func</span> <span class=ow>in</span> <span class=n>functions</span><span class=p>:</span>
</span><span id=__span-46-82><a id=__codelineno-46-82 name=__codelineno-46-82 href=#__codelineno-46-82></a>    <span class=c1># Test with valid paths</span>
</span><span id=__span-46-83><a id=__codelineno-46-83 name=__codelineno-46-83 href=#__codelineno-46-83></a>    <span class=n>valid_time</span> <span class=o>=</span> <span class=n>benchmark_function</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=n>test_data</span><span class=p>,</span> <span class=n>valid_paths</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)</span>
</span><span id=__span-46-84><a id=__codelineno-46-84 name=__codelineno-46-84 href=#__codelineno-46-84></a>
</span><span id=__span-46-85><a id=__codelineno-46-85 name=__codelineno-46-85 href=#__codelineno-46-85></a>    <span class=c1># Test with invalid paths</span>
</span><span id=__span-46-86><a id=__codelineno-46-86 name=__codelineno-46-86 href=#__codelineno-46-86></a>    <span class=n>invalid_time</span> <span class=o>=</span> <span class=n>benchmark_function</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=n>test_data</span><span class=p>,</span> <span class=n>invalid_paths</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)</span>
</span><span id=__span-46-87><a id=__codelineno-46-87 name=__codelineno-46-87 href=#__codelineno-46-87></a>
</span><span id=__span-46-88><a id=__codelineno-46-88 name=__codelineno-46-88 href=#__codelineno-46-88></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>name</span><span class=si>:</span><span class=s2>20</span><span class=si>}</span><span class=s2> | Valid: </span><span class=si>{</span><span class=n>valid_time</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>s | Invalid: </span><span class=si>{</span><span class=n>invalid_time</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>s&quot;</span><span class=p>)</span>
</span></code></pre></div> <h4 id=performance-results-analysis><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#performance-results-analysis>Performance Results Analysis</a></h4> <p>Based on typical benchmark results:</p> <ol> <li><strong>Try/except method</strong>: Fastest for valid paths, but slow for invalid paths due to exception overhead</li> <li><strong>Chained get()</strong>: Consistent performance, good balance between valid and invalid paths</li> <li><strong>Reduce-based</strong>: Slightly slower due to function call overhead</li> <li><strong>Programmatic search</strong>: Good performance with additional type safety</li> </ol> <h3 id=error-handling-and-robustness><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#error-handling-and-robustness>Error Handling and Robustness</a></h3> <h4 id=comprehensive-error-handling><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#comprehensive-error-handling>Comprehensive Error Handling</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=k>class</span><span class=w> </span><span class=nc>NestedLookupError</span><span class=p>(</span><span class=ne>Exception</span><span class=p>):</span>
</span><span id=__span-47-2><a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Custom exception for nested lookup errors.&quot;&quot;&quot;</span>
</span><span id=__span-47-3><a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a>    <span class=k>pass</span>
</span><span id=__span-47-4><a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a>
</span><span id=__span-47-5><a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a><span class=k>def</span><span class=w> </span><span class=nf>robust_nested_lookup</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>strict</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-47-6><a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a>                        <span class=n>allowed_types</span><span class=o>=</span><span class=p>(</span><span class=nb>dict</span><span class=p>,),</span> <span class=n>max_depth</span><span class=o>=</span><span class=mi>50</span><span class=p>):</span>
</span><span id=__span-47-7><a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-47-8><a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a><span class=sd>    Robust nested lookup with comprehensive error handling.</span>
</span><span id=__span-47-9><a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a>
</span><span id=__span-47-10><a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a><span class=sd>    Args:</span>
</span><span id=__span-47-11><a id=__codelineno-47-11 name=__codelineno-47-11 href=#__codelineno-47-11></a><span class=sd>        data: The data structure to search</span>
</span><span id=__span-47-12><a id=__codelineno-47-12 name=__codelineno-47-12 href=#__codelineno-47-12></a><span class=sd>        path: List of keys for the path</span>
</span><span id=__span-47-13><a id=__codelineno-47-13 name=__codelineno-47-13 href=#__codelineno-47-13></a><span class=sd>        default: Default value if lookup fails</span>
</span><span id=__span-47-14><a id=__codelineno-47-14 name=__codelineno-47-14 href=#__codelineno-47-14></a><span class=sd>        strict: If True, raise exceptions instead of returning default</span>
</span><span id=__span-47-15><a id=__codelineno-47-15 name=__codelineno-47-15 href=#__codelineno-47-15></a><span class=sd>        allowed_types: Tuple of types allowed for traversal</span>
</span><span id=__span-47-16><a id=__codelineno-47-16 name=__codelineno-47-16 href=#__codelineno-47-16></a><span class=sd>        max_depth: Maximum recursion depth to prevent infinite loops</span>
</span><span id=__span-47-17><a id=__codelineno-47-17 name=__codelineno-47-17 href=#__codelineno-47-17></a>
</span><span id=__span-47-18><a id=__codelineno-47-18 name=__codelineno-47-18 href=#__codelineno-47-18></a><span class=sd>    Returns:</span>
</span><span id=__span-47-19><a id=__codelineno-47-19 name=__codelineno-47-19 href=#__codelineno-47-19></a><span class=sd>        Value at path or default</span>
</span><span id=__span-47-20><a id=__codelineno-47-20 name=__codelineno-47-20 href=#__codelineno-47-20></a>
</span><span id=__span-47-21><a id=__codelineno-47-21 name=__codelineno-47-21 href=#__codelineno-47-21></a><span class=sd>    Raises:</span>
</span><span id=__span-47-22><a id=__codelineno-47-22 name=__codelineno-47-22 href=#__codelineno-47-22></a><span class=sd>        NestedLookupError: If strict=True and lookup fails</span>
</span><span id=__span-47-23><a id=__codelineno-47-23 name=__codelineno-47-23 href=#__codelineno-47-23></a><span class=sd>        RecursionError: If max_depth exceeded</span>
</span><span id=__span-47-24><a id=__codelineno-47-24 name=__codelineno-47-24 href=#__codelineno-47-24></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-47-25><a id=__codelineno-47-25 name=__codelineno-47-25 href=#__codelineno-47-25></a>    <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>)):</span>
</span><span id=__span-47-26><a id=__codelineno-47-26 name=__codelineno-47-26 href=#__codelineno-47-26></a>        <span class=k>if</span> <span class=n>strict</span><span class=p>:</span>
</span><span id=__span-47-27><a id=__codelineno-47-27 name=__codelineno-47-27 href=#__codelineno-47-27></a>            <span class=k>raise</span> <span class=n>NestedLookupError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Path must be list or tuple, got </span><span class=si>{</span><span class=nb>type</span><span class=p>(</span><span class=n>path</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-47-28><a id=__codelineno-47-28 name=__codelineno-47-28 href=#__codelineno-47-28></a>        <span class=k>return</span> <span class=n>default</span>
</span><span id=__span-47-29><a id=__codelineno-47-29 name=__codelineno-47-29 href=#__codelineno-47-29></a>
</span><span id=__span-47-30><a id=__codelineno-47-30 name=__codelineno-47-30 href=#__codelineno-47-30></a>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>path</span><span class=p>)</span> <span class=o>&gt;</span> <span class=n>max_depth</span><span class=p>:</span>
</span><span id=__span-47-31><a id=__codelineno-47-31 name=__codelineno-47-31 href=#__codelineno-47-31></a>        <span class=k>if</span> <span class=n>strict</span><span class=p>:</span>
</span><span id=__span-47-32><a id=__codelineno-47-32 name=__codelineno-47-32 href=#__codelineno-47-32></a>            <span class=k>raise</span> <span class=n>NestedLookupError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Path depth </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>path</span><span class=p>)</span><span class=si>}</span><span class=s2> exceeds maximum </span><span class=si>{</span><span class=n>max_depth</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-47-33><a id=__codelineno-47-33 name=__codelineno-47-33 href=#__codelineno-47-33></a>        <span class=k>return</span> <span class=n>default</span>
</span><span id=__span-47-34><a id=__codelineno-47-34 name=__codelineno-47-34 href=#__codelineno-47-34></a>
</span><span id=__span-47-35><a id=__codelineno-47-35 name=__codelineno-47-35 href=#__codelineno-47-35></a>    <span class=n>current</span> <span class=o>=</span> <span class=n>data</span>
</span><span id=__span-47-36><a id=__codelineno-47-36 name=__codelineno-47-36 href=#__codelineno-47-36></a>
</span><span id=__span-47-37><a id=__codelineno-47-37 name=__codelineno-47-37 href=#__codelineno-47-37></a>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>key</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
</span><span id=__span-47-38><a id=__codelineno-47-38 name=__codelineno-47-38 href=#__codelineno-47-38></a>        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>current</span><span class=p>,</span> <span class=n>allowed_types</span><span class=p>):</span>
</span><span id=__span-47-39><a id=__codelineno-47-39 name=__codelineno-47-39 href=#__codelineno-47-39></a>            <span class=k>if</span> <span class=n>strict</span><span class=p>:</span>
</span><span id=__span-47-40><a id=__codelineno-47-40 name=__codelineno-47-40 href=#__codelineno-47-40></a>                <span class=k>raise</span> <span class=n>NestedLookupError</span><span class=p>(</span>
</span><span id=__span-47-41><a id=__codelineno-47-41 name=__codelineno-47-41 href=#__codelineno-47-41></a>                    <span class=sa>f</span><span class=s2>&quot;Expected </span><span class=si>{</span><span class=n>allowed_types</span><span class=si>}</span><span class=s2> at path step </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>, got </span><span class=si>{</span><span class=nb>type</span><span class=p>(</span><span class=n>current</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-47-42><a id=__codelineno-47-42 name=__codelineno-47-42 href=#__codelineno-47-42></a>                <span class=p>)</span>
</span><span id=__span-47-43><a id=__codelineno-47-43 name=__codelineno-47-43 href=#__codelineno-47-43></a>            <span class=k>return</span> <span class=n>default</span>
</span><span id=__span-47-44><a id=__codelineno-47-44 name=__codelineno-47-44 href=#__codelineno-47-44></a>
</span><span id=__span-47-45><a id=__codelineno-47-45 name=__codelineno-47-45 href=#__codelineno-47-45></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>current</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
</span><span id=__span-47-46><a id=__codelineno-47-46 name=__codelineno-47-46 href=#__codelineno-47-46></a>            <span class=k>if</span> <span class=n>key</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>current</span><span class=p>:</span>
</span><span id=__span-47-47><a id=__codelineno-47-47 name=__codelineno-47-47 href=#__codelineno-47-47></a>                <span class=k>if</span> <span class=n>strict</span><span class=p>:</span>
</span><span id=__span-47-48><a id=__codelineno-47-48 name=__codelineno-47-48 href=#__codelineno-47-48></a>                    <span class=k>raise</span> <span class=n>NestedLookupError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Key &#39;</span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>&#39; not found at path step </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-47-49><a id=__codelineno-47-49 name=__codelineno-47-49 href=#__codelineno-47-49></a>                <span class=k>return</span> <span class=n>default</span>
</span><span id=__span-47-50><a id=__codelineno-47-50 name=__codelineno-47-50 href=#__codelineno-47-50></a>            <span class=n>current</span> <span class=o>=</span> <span class=n>current</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
</span><span id=__span-47-51><a id=__codelineno-47-51 name=__codelineno-47-51 href=#__codelineno-47-51></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-47-52><a id=__codelineno-47-52 name=__codelineno-47-52 href=#__codelineno-47-52></a>            <span class=c1># Handle other allowed types (lists, custom objects, etc.)</span>
</span><span id=__span-47-53><a id=__codelineno-47-53 name=__codelineno-47-53 href=#__codelineno-47-53></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-47-54><a id=__codelineno-47-54 name=__codelineno-47-54 href=#__codelineno-47-54></a>                <span class=n>current</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>current</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span> <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>current</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span> <span class=k>else</span> <span class=n>current</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
</span><span id=__span-47-55><a id=__codelineno-47-55 name=__codelineno-47-55 href=#__codelineno-47-55></a>            <span class=k>except</span> <span class=p>(</span><span class=ne>KeyError</span><span class=p>,</span> <span class=ne>IndexError</span><span class=p>,</span> <span class=ne>AttributeError</span><span class=p>,</span> <span class=ne>TypeError</span><span class=p>):</span>
</span><span id=__span-47-56><a id=__codelineno-47-56 name=__codelineno-47-56 href=#__codelineno-47-56></a>                <span class=k>if</span> <span class=n>strict</span><span class=p>:</span>
</span><span id=__span-47-57><a id=__codelineno-47-57 name=__codelineno-47-57 href=#__codelineno-47-57></a>                    <span class=k>raise</span> <span class=n>NestedLookupError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Cannot access &#39;</span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>&#39; at path step </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-47-58><a id=__codelineno-47-58 name=__codelineno-47-58 href=#__codelineno-47-58></a>                <span class=k>return</span> <span class=n>default</span>
</span><span id=__span-47-59><a id=__codelineno-47-59 name=__codelineno-47-59 href=#__codelineno-47-59></a>
</span><span id=__span-47-60><a id=__codelineno-47-60 name=__codelineno-47-60 href=#__codelineno-47-60></a>    <span class=k>return</span> <span class=n>current</span>
</span><span id=__span-47-61><a id=__codelineno-47-61 name=__codelineno-47-61 href=#__codelineno-47-61></a>
</span><span id=__span-47-62><a id=__codelineno-47-62 name=__codelineno-47-62 href=#__codelineno-47-62></a><span class=c1># Test robust lookup</span>
</span><span id=__span-47-63><a id=__codelineno-47-63 name=__codelineno-47-63 href=#__codelineno-47-63></a><span class=n>test_cases</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-47-64><a id=__codelineno-47-64 name=__codelineno-47-64 href=#__codelineno-47-64></a>    <span class=c1># (data, path, expected_result)</span>
</span><span id=__span-47-65><a id=__codelineno-47-65 name=__codelineno-47-65 href=#__codelineno-47-65></a>    <span class=p>({</span><span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=mi>42</span><span class=p>}},</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>],</span> <span class=mi>42</span><span class=p>),</span>
</span><span id=__span-47-66><a id=__codelineno-47-66 name=__codelineno-47-66 href=#__codelineno-47-66></a>    <span class=p>({</span><span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=mi>42</span><span class=p>}},</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>],</span> <span class=kc>None</span><span class=p>),</span>
</span><span id=__span-47-67><a id=__codelineno-47-67 name=__codelineno-47-67 href=#__codelineno-47-67></a>    <span class=p>({</span><span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=mi>42</span><span class=p>}},</span> <span class=p>[</span><span class=s1>&#39;c&#39;</span><span class=p>],</span> <span class=kc>None</span><span class=p>),</span>
</span><span id=__span-47-68><a id=__codelineno-47-68 name=__codelineno-47-68 href=#__codelineno-47-68></a>    <span class=p>({},</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>],</span> <span class=kc>None</span><span class=p>),</span>
</span><span id=__span-47-69><a id=__codelineno-47-69 name=__codelineno-47-69 href=#__codelineno-47-69></a>    <span class=p>({</span><span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=kc>None</span><span class=p>},</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>],</span> <span class=kc>None</span><span class=p>),</span>
</span><span id=__span-47-70><a id=__codelineno-47-70 name=__codelineno-47-70 href=#__codelineno-47-70></a>    <span class=p>({</span><span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;c&#39;</span><span class=p>:</span> <span class=p>[]}}},</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>],</span> <span class=p>[]),</span>
</span><span id=__span-47-71><a id=__codelineno-47-71 name=__codelineno-47-71 href=#__codelineno-47-71></a><span class=p>]</span>
</span><span id=__span-47-72><a id=__codelineno-47-72 name=__codelineno-47-72 href=#__codelineno-47-72></a>
</span><span id=__span-47-73><a id=__codelineno-47-73 name=__codelineno-47-73 href=#__codelineno-47-73></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Robust Lookup Test Results&quot;</span><span class=p>)</span>
</span><span id=__span-47-74><a id=__codelineno-47-74 name=__codelineno-47-74 href=#__codelineno-47-74></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;-&quot;</span> <span class=o>*</span> <span class=mi>40</span><span class=p>)</span>
</span><span id=__span-47-75><a id=__codelineno-47-75 name=__codelineno-47-75 href=#__codelineno-47-75></a>
</span><span id=__span-47-76><a id=__codelineno-47-76 name=__codelineno-47-76 href=#__codelineno-47-76></a><span class=k>for</span> <span class=n>data</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>expected</span> <span class=ow>in</span> <span class=n>test_cases</span><span class=p>:</span>
</span><span id=__span-47-77><a id=__codelineno-47-77 name=__codelineno-47-77 href=#__codelineno-47-77></a>    <span class=n>result</span> <span class=o>=</span> <span class=n>robust_nested_lookup</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>path</span><span class=p>)</span>
</span><span id=__span-47-78><a id=__codelineno-47-78 name=__codelineno-47-78 href=#__codelineno-47-78></a>    <span class=n>status</span> <span class=o>=</span> <span class=s2>&quot;✓&quot;</span> <span class=k>if</span> <span class=n>result</span> <span class=o>==</span> <span class=n>expected</span> <span class=k>else</span> <span class=s2>&quot;✗&quot;</span>
</span><span id=__span-47-79><a id=__codelineno-47-79 name=__codelineno-47-79 href=#__codelineno-47-79></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>status</span><span class=si>}</span><span class=s2> Path </span><span class=si>{</span><span class=n>path</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2> (expected: </span><span class=si>{</span><span class=n>expected</span><span class=si>}</span><span class=s2>)&quot;</span><span class=p>)</span>
</span><span id=__span-47-80><a id=__codelineno-47-80 name=__codelineno-47-80 href=#__codelineno-47-80></a>
</span><span id=__span-47-81><a id=__codelineno-47-81 name=__codelineno-47-81 href=#__codelineno-47-81></a><span class=c1># Test strict mode</span>
</span><span id=__span-47-82><a id=__codelineno-47-82 name=__codelineno-47-82 href=#__codelineno-47-82></a><span class=k>try</span><span class=p>:</span>
</span><span id=__span-47-83><a id=__codelineno-47-83 name=__codelineno-47-83 href=#__codelineno-47-83></a>    <span class=n>robust_nested_lookup</span><span class=p>({</span><span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>},</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>],</span> <span class=n>strict</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-47-84><a id=__codelineno-47-84 name=__codelineno-47-84 href=#__codelineno-47-84></a><span class=k>except</span> <span class=n>NestedLookupError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-47-85><a id=__codelineno-47-85 name=__codelineno-47-85 href=#__codelineno-47-85></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>Strict mode error (expected): </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div> <h3 id=real-world-applications><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#real-world-applications>Real-World Applications</a></h3> <h4 id=api-response-processing><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#api-response-processing>API Response Processing</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-48-1><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=k>def</span><span class=w> </span><span class=nf>extract_user_info</span><span class=p>(</span><span class=n>api_response</span><span class=p>):</span>
</span><span id=__span-48-2><a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Extract user information from a complex API response.&quot;&quot;&quot;</span>
</span><span id=__span-48-3><a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a>
</span><span id=__span-48-4><a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a>    <span class=c1># Define extraction mappings</span>
</span><span id=__span-48-5><a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a>    <span class=n>extractions</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-48-6><a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a>        <span class=s1>&#39;user_id&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>,</span> <span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;id&#39;</span><span class=p>],</span>
</span><span id=__span-48-7><a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a>        <span class=s1>&#39;username&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>,</span> <span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;profile&#39;</span><span class=p>,</span> <span class=s1>&#39;username&#39;</span><span class=p>],</span>
</span><span id=__span-48-8><a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a>        <span class=s1>&#39;email&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>,</span> <span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;contact&#39;</span><span class=p>,</span> <span class=s1>&#39;email&#39;</span><span class=p>],</span>
</span><span id=__span-48-9><a id=__codelineno-48-9 name=__codelineno-48-9 href=#__codelineno-48-9></a>        <span class=s1>&#39;avatar_url&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>,</span> <span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;profile&#39;</span><span class=p>,</span> <span class=s1>&#39;avatar&#39;</span><span class=p>,</span> <span class=s1>&#39;large_url&#39;</span><span class=p>],</span>
</span><span id=__span-48-10><a id=__codelineno-48-10 name=__codelineno-48-10 href=#__codelineno-48-10></a>        <span class=s1>&#39;last_login&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>,</span> <span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;activity&#39;</span><span class=p>,</span> <span class=s1>&#39;last_login&#39;</span><span class=p>,</span> <span class=s1>&#39;timestamp&#39;</span><span class=p>],</span>
</span><span id=__span-48-11><a id=__codelineno-48-11 name=__codelineno-48-11 href=#__codelineno-48-11></a>        <span class=s1>&#39;subscription_type&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>,</span> <span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;subscription&#39;</span><span class=p>,</span> <span class=s1>&#39;plan&#39;</span><span class=p>,</span> <span class=s1>&#39;type&#39;</span><span class=p>],</span>
</span><span id=__span-48-12><a id=__codelineno-48-12 name=__codelineno-48-12 href=#__codelineno-48-12></a>        <span class=s1>&#39;preferences&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-48-13><a id=__codelineno-48-13 name=__codelineno-48-13 href=#__codelineno-48-13></a>            <span class=s1>&#39;notifications&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>,</span> <span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;settings&#39;</span><span class=p>,</span> <span class=s1>&#39;notifications&#39;</span><span class=p>,</span> <span class=s1>&#39;enabled&#39;</span><span class=p>],</span>
</span><span id=__span-48-14><a id=__codelineno-48-14 name=__codelineno-48-14 href=#__codelineno-48-14></a>            <span class=s1>&#39;theme&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>,</span> <span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;settings&#39;</span><span class=p>,</span> <span class=s1>&#39;ui&#39;</span><span class=p>,</span> <span class=s1>&#39;theme&#39;</span><span class=p>],</span>
</span><span id=__span-48-15><a id=__codelineno-48-15 name=__codelineno-48-15 href=#__codelineno-48-15></a>            <span class=s1>&#39;language&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>,</span> <span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;settings&#39;</span><span class=p>,</span> <span class=s1>&#39;locale&#39;</span><span class=p>,</span> <span class=s1>&#39;language&#39;</span><span class=p>]</span>
</span><span id=__span-48-16><a id=__codelineno-48-16 name=__codelineno-48-16 href=#__codelineno-48-16></a>        <span class=p>}</span>
</span><span id=__span-48-17><a id=__codelineno-48-17 name=__codelineno-48-17 href=#__codelineno-48-17></a>    <span class=p>}</span>
</span><span id=__span-48-18><a id=__codelineno-48-18 name=__codelineno-48-18 href=#__codelineno-48-18></a>
</span><span id=__span-48-19><a id=__codelineno-48-19 name=__codelineno-48-19 href=#__codelineno-48-19></a>    <span class=n>result</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-48-20><a id=__codelineno-48-20 name=__codelineno-48-20 href=#__codelineno-48-20></a>
</span><span id=__span-48-21><a id=__codelineno-48-21 name=__codelineno-48-21 href=#__codelineno-48-21></a>    <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>extractions</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-48-22><a id=__codelineno-48-22 name=__codelineno-48-22 href=#__codelineno-48-22></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
</span><span id=__span-48-23><a id=__codelineno-48-23 name=__codelineno-48-23 href=#__codelineno-48-23></a>            <span class=c1># Handle nested preferences</span>
</span><span id=__span-48-24><a id=__codelineno-48-24 name=__codelineno-48-24 href=#__codelineno-48-24></a>            <span class=n>result</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-48-25><a id=__codelineno-48-25 name=__codelineno-48-25 href=#__codelineno-48-25></a>            <span class=k>for</span> <span class=n>pref_key</span><span class=p>,</span> <span class=n>pref_path</span> <span class=ow>in</span> <span class=n>path</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-48-26><a id=__codelineno-48-26 name=__codelineno-48-26 href=#__codelineno-48-26></a>                <span class=n>result</span><span class=p>[</span><span class=n>key</span><span class=p>][</span><span class=n>pref_key</span><span class=p>]</span> <span class=o>=</span> <span class=n>programmatic_depth_search</span><span class=p>(</span>
</span><span id=__span-48-27><a id=__codelineno-48-27 name=__codelineno-48-27 href=#__codelineno-48-27></a>                    <span class=n>api_response</span><span class=p>,</span> <span class=n>pref_path</span><span class=p>,</span> <span class=s1>&#39;unknown&#39;</span>
</span><span id=__span-48-28><a id=__codelineno-48-28 name=__codelineno-48-28 href=#__codelineno-48-28></a>                <span class=p>)</span>
</span><span id=__span-48-29><a id=__codelineno-48-29 name=__codelineno-48-29 href=#__codelineno-48-29></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-48-30><a id=__codelineno-48-30 name=__codelineno-48-30 href=#__codelineno-48-30></a>            <span class=n>result</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>programmatic_depth_search</span><span class=p>(</span><span class=n>api_response</span><span class=p>,</span> <span class=n>path</span><span class=p>)</span>
</span><span id=__span-48-31><a id=__codelineno-48-31 name=__codelineno-48-31 href=#__codelineno-48-31></a>
</span><span id=__span-48-32><a id=__codelineno-48-32 name=__codelineno-48-32 href=#__codelineno-48-32></a>    <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-48-33><a id=__codelineno-48-33 name=__codelineno-48-33 href=#__codelineno-48-33></a>
</span><span id=__span-48-34><a id=__codelineno-48-34 name=__codelineno-48-34 href=#__codelineno-48-34></a><span class=c1># Sample API response</span>
</span><span id=__span-48-35><a id=__codelineno-48-35 name=__codelineno-48-35 href=#__codelineno-48-35></a><span class=n>sample_response</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-48-36><a id=__codelineno-48-36 name=__codelineno-48-36 href=#__codelineno-48-36></a>    <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;success&#39;</span><span class=p>,</span>
</span><span id=__span-48-37><a id=__codelineno-48-37 name=__codelineno-48-37 href=#__codelineno-48-37></a>    <span class=s1>&#39;data&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-48-38><a id=__codelineno-48-38 name=__codelineno-48-38 href=#__codelineno-48-38></a>        <span class=s1>&#39;user&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-48-39><a id=__codelineno-48-39 name=__codelineno-48-39 href=#__codelineno-48-39></a>            <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=mi>12345</span><span class=p>,</span>
</span><span id=__span-48-40><a id=__codelineno-48-40 name=__codelineno-48-40 href=#__codelineno-48-40></a>            <span class=s1>&#39;profile&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-48-41><a id=__codelineno-48-41 name=__codelineno-48-41 href=#__codelineno-48-41></a>                <span class=s1>&#39;username&#39;</span><span class=p>:</span> <span class=s1>&#39;john_doe&#39;</span><span class=p>,</span>
</span><span id=__span-48-42><a id=__codelineno-48-42 name=__codelineno-48-42 href=#__codelineno-48-42></a>                <span class=s1>&#39;avatar&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-48-43><a id=__codelineno-48-43 name=__codelineno-48-43 href=#__codelineno-48-43></a>                    <span class=s1>&#39;small_url&#39;</span><span class=p>:</span> <span class=s1>&#39;https://example.com/small.jpg&#39;</span><span class=p>,</span>
</span><span id=__span-48-44><a id=__codelineno-48-44 name=__codelineno-48-44 href=#__codelineno-48-44></a>                    <span class=s1>&#39;large_url&#39;</span><span class=p>:</span> <span class=s1>&#39;https://example.com/large.jpg&#39;</span>
</span><span id=__span-48-45><a id=__codelineno-48-45 name=__codelineno-48-45 href=#__codelineno-48-45></a>                <span class=p>}</span>
</span><span id=__span-48-46><a id=__codelineno-48-46 name=__codelineno-48-46 href=#__codelineno-48-46></a>            <span class=p>},</span>
</span><span id=__span-48-47><a id=__codelineno-48-47 name=__codelineno-48-47 href=#__codelineno-48-47></a>            <span class=s1>&#39;contact&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-48-48><a id=__codelineno-48-48 name=__codelineno-48-48 href=#__codelineno-48-48></a>                <span class=s1>&#39;email&#39;</span><span class=p>:</span> <span class=s1>&#39;john@example.com&#39;</span><span class=p>,</span>
</span><span id=__span-48-49><a id=__codelineno-48-49 name=__codelineno-48-49 href=#__codelineno-48-49></a>                <span class=s1>&#39;phone&#39;</span><span class=p>:</span> <span class=s1>&#39;+1-555-0123&#39;</span>
</span><span id=__span-48-50><a id=__codelineno-48-50 name=__codelineno-48-50 href=#__codelineno-48-50></a>            <span class=p>},</span>
</span><span id=__span-48-51><a id=__codelineno-48-51 name=__codelineno-48-51 href=#__codelineno-48-51></a>            <span class=s1>&#39;activity&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-48-52><a id=__codelineno-48-52 name=__codelineno-48-52 href=#__codelineno-48-52></a>                <span class=s1>&#39;last_login&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-48-53><a id=__codelineno-48-53 name=__codelineno-48-53 href=#__codelineno-48-53></a>                    <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=s1>&#39;2023-11-15T10:30:00Z&#39;</span><span class=p>,</span>
</span><span id=__span-48-54><a id=__codelineno-48-54 name=__codelineno-48-54 href=#__codelineno-48-54></a>                    <span class=s1>&#39;ip_address&#39;</span><span class=p>:</span> <span class=s1>&#39;192.168.1.100&#39;</span>
</span><span id=__span-48-55><a id=__codelineno-48-55 name=__codelineno-48-55 href=#__codelineno-48-55></a>                <span class=p>}</span>
</span><span id=__span-48-56><a id=__codelineno-48-56 name=__codelineno-48-56 href=#__codelineno-48-56></a>            <span class=p>},</span>
</span><span id=__span-48-57><a id=__codelineno-48-57 name=__codelineno-48-57 href=#__codelineno-48-57></a>            <span class=s1>&#39;subscription&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-48-58><a id=__codelineno-48-58 name=__codelineno-48-58 href=#__codelineno-48-58></a>                <span class=s1>&#39;plan&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-48-59><a id=__codelineno-48-59 name=__codelineno-48-59 href=#__codelineno-48-59></a>                    <span class=s1>&#39;type&#39;</span><span class=p>:</span> <span class=s1>&#39;premium&#39;</span><span class=p>,</span>
</span><span id=__span-48-60><a id=__codelineno-48-60 name=__codelineno-48-60 href=#__codelineno-48-60></a>                    <span class=s1>&#39;expires&#39;</span><span class=p>:</span> <span class=s1>&#39;2024-01-15&#39;</span>
</span><span id=__span-48-61><a id=__codelineno-48-61 name=__codelineno-48-61 href=#__codelineno-48-61></a>                <span class=p>}</span>
</span><span id=__span-48-62><a id=__codelineno-48-62 name=__codelineno-48-62 href=#__codelineno-48-62></a>            <span class=p>},</span>
</span><span id=__span-48-63><a id=__codelineno-48-63 name=__codelineno-48-63 href=#__codelineno-48-63></a>            <span class=s1>&#39;settings&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-48-64><a id=__codelineno-48-64 name=__codelineno-48-64 href=#__codelineno-48-64></a>                <span class=s1>&#39;notifications&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-48-65><a id=__codelineno-48-65 name=__codelineno-48-65 href=#__codelineno-48-65></a>                    <span class=s1>&#39;enabled&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-48-66><a id=__codelineno-48-66 name=__codelineno-48-66 href=#__codelineno-48-66></a>                    <span class=s1>&#39;frequency&#39;</span><span class=p>:</span> <span class=s1>&#39;daily&#39;</span>
</span><span id=__span-48-67><a id=__codelineno-48-67 name=__codelineno-48-67 href=#__codelineno-48-67></a>                <span class=p>},</span>
</span><span id=__span-48-68><a id=__codelineno-48-68 name=__codelineno-48-68 href=#__codelineno-48-68></a>                <span class=s1>&#39;ui&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-48-69><a id=__codelineno-48-69 name=__codelineno-48-69 href=#__codelineno-48-69></a>                    <span class=s1>&#39;theme&#39;</span><span class=p>:</span> <span class=s1>&#39;dark&#39;</span>
</span><span id=__span-48-70><a id=__codelineno-48-70 name=__codelineno-48-70 href=#__codelineno-48-70></a>                <span class=p>},</span>
</span><span id=__span-48-71><a id=__codelineno-48-71 name=__codelineno-48-71 href=#__codelineno-48-71></a>                <span class=s1>&#39;locale&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-48-72><a id=__codelineno-48-72 name=__codelineno-48-72 href=#__codelineno-48-72></a>                    <span class=s1>&#39;language&#39;</span><span class=p>:</span> <span class=s1>&#39;en&#39;</span><span class=p>,</span>
</span><span id=__span-48-73><a id=__codelineno-48-73 name=__codelineno-48-73 href=#__codelineno-48-73></a>                    <span class=s1>&#39;timezone&#39;</span><span class=p>:</span> <span class=s1>&#39;UTC&#39;</span>
</span><span id=__span-48-74><a id=__codelineno-48-74 name=__codelineno-48-74 href=#__codelineno-48-74></a>                <span class=p>}</span>
</span><span id=__span-48-75><a id=__codelineno-48-75 name=__codelineno-48-75 href=#__codelineno-48-75></a>            <span class=p>}</span>
</span><span id=__span-48-76><a id=__codelineno-48-76 name=__codelineno-48-76 href=#__codelineno-48-76></a>        <span class=p>}</span>
</span><span id=__span-48-77><a id=__codelineno-48-77 name=__codelineno-48-77 href=#__codelineno-48-77></a>    <span class=p>}</span>
</span><span id=__span-48-78><a id=__codelineno-48-78 name=__codelineno-48-78 href=#__codelineno-48-78></a><span class=p>}</span>
</span><span id=__span-48-79><a id=__codelineno-48-79 name=__codelineno-48-79 href=#__codelineno-48-79></a>
</span><span id=__span-48-80><a id=__codelineno-48-80 name=__codelineno-48-80 href=#__codelineno-48-80></a><span class=n>extracted_info</span> <span class=o>=</span> <span class=n>extract_user_info</span><span class=p>(</span><span class=n>sample_response</span><span class=p>)</span>
</span><span id=__span-48-81><a id=__codelineno-48-81 name=__codelineno-48-81 href=#__codelineno-48-81></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Extracted User Information:&quot;</span><span class=p>)</span>
</span><span id=__span-48-82><a id=__codelineno-48-82 name=__codelineno-48-82 href=#__codelineno-48-82></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;-&quot;</span> <span class=o>*</span> <span class=mi>30</span><span class=p>)</span>
</span><span id=__span-48-83><a id=__codelineno-48-83 name=__codelineno-48-83 href=#__codelineno-48-83></a><span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>extracted_info</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-48-84><a id=__codelineno-48-84 name=__codelineno-48-84 href=#__codelineno-48-84></a>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
</span><span id=__span-48-85><a id=__codelineno-48-85 name=__codelineno-48-85 href=#__codelineno-48-85></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>:&quot;</span><span class=p>)</span>
</span><span id=__span-48-86><a id=__codelineno-48-86 name=__codelineno-48-86 href=#__codelineno-48-86></a>        <span class=k>for</span> <span class=n>sub_key</span><span class=p>,</span> <span class=n>sub_value</span> <span class=ow>in</span> <span class=n>value</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-48-87><a id=__codelineno-48-87 name=__codelineno-48-87 href=#__codelineno-48-87></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  </span><span class=si>{</span><span class=n>sub_key</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>sub_value</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-48-88><a id=__codelineno-48-88 name=__codelineno-48-88 href=#__codelineno-48-88></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-48-89><a id=__codelineno-48-89 name=__codelineno-48-89 href=#__codelineno-48-89></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div> <h4 id=configuration-management><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#configuration-management>Configuration Management</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-49-1><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=k>class</span><span class=w> </span><span class=nc>ConfigManager</span><span class=p>:</span>
</span><span id=__span-49-2><a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Manage nested configuration with safe access patterns.&quot;&quot;&quot;</span>
</span><span id=__span-49-3><a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a>
</span><span id=__span-49-4><a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config_data</span><span class=p>):</span>
</span><span id=__span-49-5><a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a>        <span class=bp>self</span><span class=o>.</span><span class=n>config</span> <span class=o>=</span> <span class=n>config_data</span>
</span><span id=__span-49-6><a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-49-7><a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a>
</span><span id=__span-49-8><a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a>    <span class=k>def</span><span class=w> </span><span class=nf>get</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>cache</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
</span><span id=__span-49-9><a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get configuration value with caching.&quot;&quot;&quot;</span>
</span><span id=__span-49-10><a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a>        <span class=n>path_str</span> <span class=o>=</span> <span class=s1>&#39;.&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=n>path</span><span class=p>))</span>
</span><span id=__span-49-11><a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a>
</span><span id=__span-49-12><a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a>        <span class=k>if</span> <span class=n>cache</span> <span class=ow>and</span> <span class=n>path_str</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span><span class=p>:</span>
</span><span id=__span-49-13><a id=__codelineno-49-13 name=__codelineno-49-13 href=#__codelineno-49-13></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span><span class=p>[</span><span class=n>path_str</span><span class=p>]</span>
</span><span id=__span-49-14><a id=__codelineno-49-14 name=__codelineno-49-14 href=#__codelineno-49-14></a>
</span><span id=__span-49-15><a id=__codelineno-49-15 name=__codelineno-49-15 href=#__codelineno-49-15></a>        <span class=n>value</span> <span class=o>=</span> <span class=n>programmatic_depth_search</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>default</span><span class=p>)</span>
</span><span id=__span-49-16><a id=__codelineno-49-16 name=__codelineno-49-16 href=#__codelineno-49-16></a>
</span><span id=__span-49-17><a id=__codelineno-49-17 name=__codelineno-49-17 href=#__codelineno-49-17></a>        <span class=k>if</span> <span class=n>cache</span><span class=p>:</span>
</span><span id=__span-49-18><a id=__codelineno-49-18 name=__codelineno-49-18 href=#__codelineno-49-18></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span><span class=p>[</span><span class=n>path_str</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>
</span><span id=__span-49-19><a id=__codelineno-49-19 name=__codelineno-49-19 href=#__codelineno-49-19></a>
</span><span id=__span-49-20><a id=__codelineno-49-20 name=__codelineno-49-20 href=#__codelineno-49-20></a>        <span class=k>return</span> <span class=n>value</span>
</span><span id=__span-49-21><a id=__codelineno-49-21 name=__codelineno-49-21 href=#__codelineno-49-21></a>
</span><span id=__span-49-22><a id=__codelineno-49-22 name=__codelineno-49-22 href=#__codelineno-49-22></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_database_config</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-49-23><a id=__codelineno-49-23 name=__codelineno-49-23 href=#__codelineno-49-23></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get database configuration with defaults.&quot;&quot;&quot;</span>
</span><span id=__span-49-24><a id=__codelineno-49-24 name=__codelineno-49-24 href=#__codelineno-49-24></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-49-25><a id=__codelineno-49-25 name=__codelineno-49-25 href=#__codelineno-49-25></a>            <span class=s1>&#39;host&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>([</span><span class=s1>&#39;database&#39;</span><span class=p>,</span> <span class=s1>&#39;host&#39;</span><span class=p>],</span> <span class=s1>&#39;localhost&#39;</span><span class=p>),</span>
</span><span id=__span-49-26><a id=__codelineno-49-26 name=__codelineno-49-26 href=#__codelineno-49-26></a>            <span class=s1>&#39;port&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>([</span><span class=s1>&#39;database&#39;</span><span class=p>,</span> <span class=s1>&#39;port&#39;</span><span class=p>],</span> <span class=mi>5432</span><span class=p>),</span>
</span><span id=__span-49-27><a id=__codelineno-49-27 name=__codelineno-49-27 href=#__codelineno-49-27></a>            <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>([</span><span class=s1>&#39;database&#39;</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span><span class=p>],</span> <span class=s1>&#39;app_db&#39;</span><span class=p>),</span>
</span><span id=__span-49-28><a id=__codelineno-49-28 name=__codelineno-49-28 href=#__codelineno-49-28></a>            <span class=s1>&#39;user&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>([</span><span class=s1>&#39;database&#39;</span><span class=p>,</span> <span class=s1>&#39;credentials&#39;</span><span class=p>,</span> <span class=s1>&#39;username&#39;</span><span class=p>],</span> <span class=s1>&#39;user&#39;</span><span class=p>),</span>
</span><span id=__span-49-29><a id=__codelineno-49-29 name=__codelineno-49-29 href=#__codelineno-49-29></a>            <span class=s1>&#39;password&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>([</span><span class=s1>&#39;database&#39;</span><span class=p>,</span> <span class=s1>&#39;credentials&#39;</span><span class=p>,</span> <span class=s1>&#39;password&#39;</span><span class=p>],</span> <span class=s1>&#39;&#39;</span><span class=p>),</span>
</span><span id=__span-49-30><a id=__codelineno-49-30 name=__codelineno-49-30 href=#__codelineno-49-30></a>            <span class=s1>&#39;ssl&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>([</span><span class=s1>&#39;database&#39;</span><span class=p>,</span> <span class=s1>&#39;ssl&#39;</span><span class=p>,</span> <span class=s1>&#39;enabled&#39;</span><span class=p>],</span> <span class=kc>False</span><span class=p>),</span>
</span><span id=__span-49-31><a id=__codelineno-49-31 name=__codelineno-49-31 href=#__codelineno-49-31></a>            <span class=s1>&#39;pool_size&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>([</span><span class=s1>&#39;database&#39;</span><span class=p>,</span> <span class=s1>&#39;connection_pool&#39;</span><span class=p>,</span> <span class=s1>&#39;size&#39;</span><span class=p>],</span> <span class=mi>10</span><span class=p>)</span>
</span><span id=__span-49-32><a id=__codelineno-49-32 name=__codelineno-49-32 href=#__codelineno-49-32></a>        <span class=p>}</span>
</span><span id=__span-49-33><a id=__codelineno-49-33 name=__codelineno-49-33 href=#__codelineno-49-33></a>
</span><span id=__span-49-34><a id=__codelineno-49-34 name=__codelineno-49-34 href=#__codelineno-49-34></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_api_config</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-49-35><a id=__codelineno-49-35 name=__codelineno-49-35 href=#__codelineno-49-35></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get API configuration.&quot;&quot;&quot;</span>
</span><span id=__span-49-36><a id=__codelineno-49-36 name=__codelineno-49-36 href=#__codelineno-49-36></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-49-37><a id=__codelineno-49-37 name=__codelineno-49-37 href=#__codelineno-49-37></a>            <span class=s1>&#39;base_url&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>([</span><span class=s1>&#39;api&#39;</span><span class=p>,</span> <span class=s1>&#39;base_url&#39;</span><span class=p>],</span> <span class=s1>&#39;https://api.example.com&#39;</span><span class=p>),</span>
</span><span id=__span-49-38><a id=__codelineno-49-38 name=__codelineno-49-38 href=#__codelineno-49-38></a>            <span class=s1>&#39;timeout&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>([</span><span class=s1>&#39;api&#39;</span><span class=p>,</span> <span class=s1>&#39;timeout&#39;</span><span class=p>],</span> <span class=mi>30</span><span class=p>),</span>
</span><span id=__span-49-39><a id=__codelineno-49-39 name=__codelineno-49-39 href=#__codelineno-49-39></a>            <span class=s1>&#39;retries&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>([</span><span class=s1>&#39;api&#39;</span><span class=p>,</span> <span class=s1>&#39;retries&#39;</span><span class=p>],</span> <span class=mi>3</span><span class=p>),</span>
</span><span id=__span-49-40><a id=__codelineno-49-40 name=__codelineno-49-40 href=#__codelineno-49-40></a>            <span class=s1>&#39;rate_limit&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>([</span><span class=s1>&#39;api&#39;</span><span class=p>,</span> <span class=s1>&#39;rate_limit&#39;</span><span class=p>,</span> <span class=s1>&#39;requests_per_minute&#39;</span><span class=p>],</span> <span class=mi>60</span><span class=p>),</span>
</span><span id=__span-49-41><a id=__codelineno-49-41 name=__codelineno-49-41 href=#__codelineno-49-41></a>            <span class=s1>&#39;auth&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-49-42><a id=__codelineno-49-42 name=__codelineno-49-42 href=#__codelineno-49-42></a>                <span class=s1>&#39;method&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>([</span><span class=s1>&#39;api&#39;</span><span class=p>,</span> <span class=s1>&#39;auth&#39;</span><span class=p>,</span> <span class=s1>&#39;method&#39;</span><span class=p>],</span> <span class=s1>&#39;bearer&#39;</span><span class=p>),</span>
</span><span id=__span-49-43><a id=__codelineno-49-43 name=__codelineno-49-43 href=#__codelineno-49-43></a>                <span class=s1>&#39;token&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>([</span><span class=s1>&#39;api&#39;</span><span class=p>,</span> <span class=s1>&#39;auth&#39;</span><span class=p>,</span> <span class=s1>&#39;token&#39;</span><span class=p>],</span> <span class=s1>&#39;&#39;</span><span class=p>),</span>
</span><span id=__span-49-44><a id=__codelineno-49-44 name=__codelineno-49-44 href=#__codelineno-49-44></a>            <span class=p>}</span>
</span><span id=__span-49-45><a id=__codelineno-49-45 name=__codelineno-49-45 href=#__codelineno-49-45></a>        <span class=p>}</span>
</span><span id=__span-49-46><a id=__codelineno-49-46 name=__codelineno-49-46 href=#__codelineno-49-46></a>
</span><span id=__span-49-47><a id=__codelineno-49-47 name=__codelineno-49-47 href=#__codelineno-49-47></a>    <span class=k>def</span><span class=w> </span><span class=nf>validate_required_config</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>required_paths</span><span class=p>):</span>
</span><span id=__span-49-48><a id=__codelineno-49-48 name=__codelineno-49-48 href=#__codelineno-49-48></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Validate that required configuration paths exist.&quot;&quot;&quot;</span>
</span><span id=__span-49-49><a id=__codelineno-49-49 name=__codelineno-49-49 href=#__codelineno-49-49></a>        <span class=n>missing</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-49-50><a id=__codelineno-49-50 name=__codelineno-49-50 href=#__codelineno-49-50></a>        <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>required_paths</span><span class=p>:</span>
</span><span id=__span-49-51><a id=__codelineno-49-51 name=__codelineno-49-51 href=#__codelineno-49-51></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>path</span><span class=p>)</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-49-52><a id=__codelineno-49-52 name=__codelineno-49-52 href=#__codelineno-49-52></a>                <span class=n>missing</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=n>path</span><span class=p>)))</span>
</span><span id=__span-49-53><a id=__codelineno-49-53 name=__codelineno-49-53 href=#__codelineno-49-53></a>
</span><span id=__span-49-54><a id=__codelineno-49-54 name=__codelineno-49-54 href=#__codelineno-49-54></a>        <span class=k>if</span> <span class=n>missing</span><span class=p>:</span>
</span><span id=__span-49-55><a id=__codelineno-49-55 name=__codelineno-49-55 href=#__codelineno-49-55></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Missing required configuration: </span><span class=si>{</span><span class=s1>&#39;, &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>missing</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-49-56><a id=__codelineno-49-56 name=__codelineno-49-56 href=#__codelineno-49-56></a>
</span><span id=__span-49-57><a id=__codelineno-49-57 name=__codelineno-49-57 href=#__codelineno-49-57></a>        <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-49-58><a id=__codelineno-49-58 name=__codelineno-49-58 href=#__codelineno-49-58></a>
</span><span id=__span-49-59><a id=__codelineno-49-59 name=__codelineno-49-59 href=#__codelineno-49-59></a><span class=c1># Example configuration</span>
</span><span id=__span-49-60><a id=__codelineno-49-60 name=__codelineno-49-60 href=#__codelineno-49-60></a><span class=n>app_config</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-49-61><a id=__codelineno-49-61 name=__codelineno-49-61 href=#__codelineno-49-61></a>    <span class=s1>&#39;app&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-49-62><a id=__codelineno-49-62 name=__codelineno-49-62 href=#__codelineno-49-62></a>        <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;MyApp&#39;</span><span class=p>,</span>
</span><span id=__span-49-63><a id=__codelineno-49-63 name=__codelineno-49-63 href=#__codelineno-49-63></a>        <span class=s1>&#39;version&#39;</span><span class=p>:</span> <span class=s1>&#39;1.0.0&#39;</span><span class=p>,</span>
</span><span id=__span-49-64><a id=__codelineno-49-64 name=__codelineno-49-64 href=#__codelineno-49-64></a>        <span class=s1>&#39;debug&#39;</span><span class=p>:</span> <span class=kc>True</span>
</span><span id=__span-49-65><a id=__codelineno-49-65 name=__codelineno-49-65 href=#__codelineno-49-65></a>    <span class=p>},</span>
</span><span id=__span-49-66><a id=__codelineno-49-66 name=__codelineno-49-66 href=#__codelineno-49-66></a>    <span class=s1>&#39;database&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-49-67><a id=__codelineno-49-67 name=__codelineno-49-67 href=#__codelineno-49-67></a>        <span class=s1>&#39;host&#39;</span><span class=p>:</span> <span class=s1>&#39;db.example.com&#39;</span><span class=p>,</span>
</span><span id=__span-49-68><a id=__codelineno-49-68 name=__codelineno-49-68 href=#__codelineno-49-68></a>        <span class=s1>&#39;port&#39;</span><span class=p>:</span> <span class=mi>5432</span><span class=p>,</span>
</span><span id=__span-49-69><a id=__codelineno-49-69 name=__codelineno-49-69 href=#__codelineno-49-69></a>        <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;production_db&#39;</span><span class=p>,</span>
</span><span id=__span-49-70><a id=__codelineno-49-70 name=__codelineno-49-70 href=#__codelineno-49-70></a>        <span class=s1>&#39;credentials&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-49-71><a id=__codelineno-49-71 name=__codelineno-49-71 href=#__codelineno-49-71></a>            <span class=s1>&#39;username&#39;</span><span class=p>:</span> <span class=s1>&#39;app_user&#39;</span><span class=p>,</span>
</span><span id=__span-49-72><a id=__codelineno-49-72 name=__codelineno-49-72 href=#__codelineno-49-72></a>            <span class=s1>&#39;password&#39;</span><span class=p>:</span> <span class=s1>&#39;secret123&#39;</span>
</span><span id=__span-49-73><a id=__codelineno-49-73 name=__codelineno-49-73 href=#__codelineno-49-73></a>        <span class=p>},</span>
</span><span id=__span-49-74><a id=__codelineno-49-74 name=__codelineno-49-74 href=#__codelineno-49-74></a>        <span class=s1>&#39;ssl&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-49-75><a id=__codelineno-49-75 name=__codelineno-49-75 href=#__codelineno-49-75></a>            <span class=s1>&#39;enabled&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-49-76><a id=__codelineno-49-76 name=__codelineno-49-76 href=#__codelineno-49-76></a>            <span class=s1>&#39;cert_path&#39;</span><span class=p>:</span> <span class=s1>&#39;/path/to/cert&#39;</span>
</span><span id=__span-49-77><a id=__codelineno-49-77 name=__codelineno-49-77 href=#__codelineno-49-77></a>        <span class=p>}</span>
</span><span id=__span-49-78><a id=__codelineno-49-78 name=__codelineno-49-78 href=#__codelineno-49-78></a>    <span class=p>},</span>
</span><span id=__span-49-79><a id=__codelineno-49-79 name=__codelineno-49-79 href=#__codelineno-49-79></a>    <span class=s1>&#39;api&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-49-80><a id=__codelineno-49-80 name=__codelineno-49-80 href=#__codelineno-49-80></a>        <span class=s1>&#39;base_url&#39;</span><span class=p>:</span> <span class=s1>&#39;https://api.myapp.com&#39;</span><span class=p>,</span>
</span><span id=__span-49-81><a id=__codelineno-49-81 name=__codelineno-49-81 href=#__codelineno-49-81></a>        <span class=s1>&#39;timeout&#39;</span><span class=p>:</span> <span class=mi>60</span><span class=p>,</span>
</span><span id=__span-49-82><a id=__codelineno-49-82 name=__codelineno-49-82 href=#__codelineno-49-82></a>        <span class=s1>&#39;auth&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-49-83><a id=__codelineno-49-83 name=__codelineno-49-83 href=#__codelineno-49-83></a>            <span class=s1>&#39;method&#39;</span><span class=p>:</span> <span class=s1>&#39;bearer&#39;</span><span class=p>,</span>
</span><span id=__span-49-84><a id=__codelineno-49-84 name=__codelineno-49-84 href=#__codelineno-49-84></a>            <span class=s1>&#39;token&#39;</span><span class=p>:</span> <span class=s1>&#39;abc123xyz&#39;</span>
</span><span id=__span-49-85><a id=__codelineno-49-85 name=__codelineno-49-85 href=#__codelineno-49-85></a>        <span class=p>},</span>
</span><span id=__span-49-86><a id=__codelineno-49-86 name=__codelineno-49-86 href=#__codelineno-49-86></a>        <span class=s1>&#39;rate_limit&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-49-87><a id=__codelineno-49-87 name=__codelineno-49-87 href=#__codelineno-49-87></a>            <span class=s1>&#39;requests_per_minute&#39;</span><span class=p>:</span> <span class=mi>100</span>
</span><span id=__span-49-88><a id=__codelineno-49-88 name=__codelineno-49-88 href=#__codelineno-49-88></a>        <span class=p>}</span>
</span><span id=__span-49-89><a id=__codelineno-49-89 name=__codelineno-49-89 href=#__codelineno-49-89></a>    <span class=p>}</span>
</span><span id=__span-49-90><a id=__codelineno-49-90 name=__codelineno-49-90 href=#__codelineno-49-90></a><span class=p>}</span>
</span><span id=__span-49-91><a id=__codelineno-49-91 name=__codelineno-49-91 href=#__codelineno-49-91></a>
</span><span id=__span-49-92><a id=__codelineno-49-92 name=__codelineno-49-92 href=#__codelineno-49-92></a><span class=c1># Use configuration manager</span>
</span><span id=__span-49-93><a id=__codelineno-49-93 name=__codelineno-49-93 href=#__codelineno-49-93></a><span class=n>config_manager</span> <span class=o>=</span> <span class=n>ConfigManager</span><span class=p>(</span><span class=n>app_config</span><span class=p>)</span>
</span><span id=__span-49-94><a id=__codelineno-49-94 name=__codelineno-49-94 href=#__codelineno-49-94></a>
</span><span id=__span-49-95><a id=__codelineno-49-95 name=__codelineno-49-95 href=#__codelineno-49-95></a><span class=c1># Get database configuration</span>
</span><span id=__span-49-96><a id=__codelineno-49-96 name=__codelineno-49-96 href=#__codelineno-49-96></a><span class=n>db_config</span> <span class=o>=</span> <span class=n>config_manager</span><span class=o>.</span><span class=n>get_database_config</span><span class=p>()</span>
</span><span id=__span-49-97><a id=__codelineno-49-97 name=__codelineno-49-97 href=#__codelineno-49-97></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Database Configuration:&quot;</span><span class=p>)</span>
</span><span id=__span-49-98><a id=__codelineno-49-98 name=__codelineno-49-98 href=#__codelineno-49-98></a><span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>db_config</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-49-99><a id=__codelineno-49-99 name=__codelineno-49-99 href=#__codelineno-49-99></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-49-100><a id=__codelineno-49-100 name=__codelineno-49-100 href=#__codelineno-49-100></a>
</span><span id=__span-49-101><a id=__codelineno-49-101 name=__codelineno-49-101 href=#__codelineno-49-101></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>API Configuration:&quot;</span><span class=p>)</span>
</span><span id=__span-49-102><a id=__codelineno-49-102 name=__codelineno-49-102 href=#__codelineno-49-102></a><span class=n>api_config</span> <span class=o>=</span> <span class=n>config_manager</span><span class=o>.</span><span class=n>get_api_config</span><span class=p>()</span>
</span><span id=__span-49-103><a id=__codelineno-49-103 name=__codelineno-49-103 href=#__codelineno-49-103></a><span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>api_config</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-49-104><a id=__codelineno-49-104 name=__codelineno-49-104 href=#__codelineno-49-104></a>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
</span><span id=__span-49-105><a id=__codelineno-49-105 name=__codelineno-49-105 href=#__codelineno-49-105></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>:&quot;</span><span class=p>)</span>
</span><span id=__span-49-106><a id=__codelineno-49-106 name=__codelineno-49-106 href=#__codelineno-49-106></a>        <span class=k>for</span> <span class=n>sub_key</span><span class=p>,</span> <span class=n>sub_value</span> <span class=ow>in</span> <span class=n>value</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-49-107><a id=__codelineno-49-107 name=__codelineno-49-107 href=#__codelineno-49-107></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;    </span><span class=si>{</span><span class=n>sub_key</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>sub_value</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-49-108><a id=__codelineno-49-108 name=__codelineno-49-108 href=#__codelineno-49-108></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-49-109><a id=__codelineno-49-109 name=__codelineno-49-109 href=#__codelineno-49-109></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-49-110><a id=__codelineno-49-110 name=__codelineno-49-110 href=#__codelineno-49-110></a>
</span><span id=__span-49-111><a id=__codelineno-49-111 name=__codelineno-49-111 href=#__codelineno-49-111></a><span class=c1># Validate required configuration</span>
</span><span id=__span-49-112><a id=__codelineno-49-112 name=__codelineno-49-112 href=#__codelineno-49-112></a><span class=n>required_config</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-49-113><a id=__codelineno-49-113 name=__codelineno-49-113 href=#__codelineno-49-113></a>    <span class=p>[</span><span class=s1>&#39;database&#39;</span><span class=p>,</span> <span class=s1>&#39;host&#39;</span><span class=p>],</span>
</span><span id=__span-49-114><a id=__codelineno-49-114 name=__codelineno-49-114 href=#__codelineno-49-114></a>    <span class=p>[</span><span class=s1>&#39;database&#39;</span><span class=p>,</span> <span class=s1>&#39;credentials&#39;</span><span class=p>,</span> <span class=s1>&#39;username&#39;</span><span class=p>],</span>
</span><span id=__span-49-115><a id=__codelineno-49-115 name=__codelineno-49-115 href=#__codelineno-49-115></a>    <span class=p>[</span><span class=s1>&#39;api&#39;</span><span class=p>,</span> <span class=s1>&#39;base_url&#39;</span><span class=p>]</span>
</span><span id=__span-49-116><a id=__codelineno-49-116 name=__codelineno-49-116 href=#__codelineno-49-116></a><span class=p>]</span>
</span><span id=__span-49-117><a id=__codelineno-49-117 name=__codelineno-49-117 href=#__codelineno-49-117></a>
</span><span id=__span-49-118><a id=__codelineno-49-118 name=__codelineno-49-118 href=#__codelineno-49-118></a><span class=k>try</span><span class=p>:</span>
</span><span id=__span-49-119><a id=__codelineno-49-119 name=__codelineno-49-119 href=#__codelineno-49-119></a>    <span class=n>config_manager</span><span class=o>.</span><span class=n>validate_required_config</span><span class=p>(</span><span class=n>required_config</span><span class=p>)</span>
</span><span id=__span-49-120><a id=__codelineno-49-120 name=__codelineno-49-120 href=#__codelineno-49-120></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>✓ All required configuration is present&quot;</span><span class=p>)</span>
</span><span id=__span-49-121><a id=__codelineno-49-121 name=__codelineno-49-121 href=#__codelineno-49-121></a><span class=k>except</span> <span class=ne>ValueError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-49-122><a id=__codelineno-49-122 name=__codelineno-49-122 href=#__codelineno-49-122></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>✗ Configuration validation failed: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div> <h3 id=best-practices><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#best-practices>Best Practices</a></h3> <h4 id=1-choose-the-right-method-for-your-use-case><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#1-choose-the-right-method-for-your-use-case>1. Choose the Right Method for Your Use Case</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-50-1><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=c1># For simple, known paths with good error handling</span>
</span><span id=__span-50-2><a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=k>def</span><span class=w> </span><span class=nf>simple_case</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span><span id=__span-50-3><a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a>    <span class=k>return</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;profile&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>)</span>
</span><span id=__span-50-4><a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a>
</span><span id=__span-50-5><a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=c1># For dynamic paths or complex logic</span>
</span><span id=__span-50-6><a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a><span class=k>def</span><span class=w> </span><span class=nf>complex_case</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>path</span><span class=p>):</span>
</span><span id=__span-50-7><a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a>    <span class=k>return</span> <span class=n>programmatic_depth_search</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=s1>&#39;default_value&#39;</span><span class=p>)</span>
</span><span id=__span-50-8><a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a>
</span><span id=__span-50-9><a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a><span class=c1># For performance-critical code with known paths</span>
</span><span id=__span-50-10><a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a><span class=k>def</span><span class=w> </span><span class=nf>performance_critical</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span><span id=__span-50-11><a id=__codelineno-50-11 name=__codelineno-50-11 href=#__codelineno-50-11></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-50-12><a id=__codelineno-50-12 name=__codelineno-50-12 href=#__codelineno-50-12></a>        <span class=k>return</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;user&#39;</span><span class=p>][</span><span class=s1>&#39;profile&#39;</span><span class=p>][</span><span class=s1>&#39;name&#39;</span><span class=p>]</span>
</span><span id=__span-50-13><a id=__codelineno-50-13 name=__codelineno-50-13 href=#__codelineno-50-13></a>    <span class=k>except</span> <span class=ne>KeyError</span><span class=p>:</span>
</span><span id=__span-50-14><a id=__codelineno-50-14 name=__codelineno-50-14 href=#__codelineno-50-14></a>        <span class=k>return</span> <span class=kc>None</span>
</span></code></pre></div> <h4 id=2-use-type-hints-and-documentation><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#2-use-type-hints-and-documentation>2. Use Type Hints and Documentation</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-51-1><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Any</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>Optional</span><span class=p>,</span> <span class=n>Union</span>
</span><span id=__span-51-2><a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a>
</span><span id=__span-51-3><a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=k>def</span><span class=w> </span><span class=nf>safe_nested_get</span><span class=p>(</span>
</span><span id=__span-51-4><a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a>    <span class=n>data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
</span><span id=__span-51-5><a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a>    <span class=n>path</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span>
</span><span id=__span-51-6><a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a>    <span class=n>default</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-51-7><a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
</span><span id=__span-51-8><a id=__codelineno-51-8 name=__codelineno-51-8 href=#__codelineno-51-8></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-51-9><a id=__codelineno-51-9 name=__codelineno-51-9 href=#__codelineno-51-9></a><span class=sd>    Safely retrieve a nested value from a dictionary.</span>
</span><span id=__span-51-10><a id=__codelineno-51-10 name=__codelineno-51-10 href=#__codelineno-51-10></a>
</span><span id=__span-51-11><a id=__codelineno-51-11 name=__codelineno-51-11 href=#__codelineno-51-11></a><span class=sd>    Args:</span>
</span><span id=__span-51-12><a id=__codelineno-51-12 name=__codelineno-51-12 href=#__codelineno-51-12></a><span class=sd>        data: The dictionary to search</span>
</span><span id=__span-51-13><a id=__codelineno-51-13 name=__codelineno-51-13 href=#__codelineno-51-13></a><span class=sd>        path: List of keys representing the path</span>
</span><span id=__span-51-14><a id=__codelineno-51-14 name=__codelineno-51-14 href=#__codelineno-51-14></a><span class=sd>        default: Value to return if path is not found</span>
</span><span id=__span-51-15><a id=__codelineno-51-15 name=__codelineno-51-15 href=#__codelineno-51-15></a>
</span><span id=__span-51-16><a id=__codelineno-51-16 name=__codelineno-51-16 href=#__codelineno-51-16></a><span class=sd>    Returns:</span>
</span><span id=__span-51-17><a id=__codelineno-51-17 name=__codelineno-51-17 href=#__codelineno-51-17></a><span class=sd>        The value at the specified path, or default if not found</span>
</span><span id=__span-51-18><a id=__codelineno-51-18 name=__codelineno-51-18 href=#__codelineno-51-18></a>
</span><span id=__span-51-19><a id=__codelineno-51-19 name=__codelineno-51-19 href=#__codelineno-51-19></a><span class=sd>    Example:</span>
</span><span id=__span-51-20><a id=__codelineno-51-20 name=__codelineno-51-20 href=#__codelineno-51-20></a><span class=sd>        &gt;&gt;&gt; data = {&#39;a&#39;: {&#39;b&#39;: {&#39;c&#39;: 42}}}</span>
</span><span id=__span-51-21><a id=__codelineno-51-21 name=__codelineno-51-21 href=#__codelineno-51-21></a><span class=sd>        &gt;&gt;&gt; safe_nested_get(data, [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;])</span>
</span><span id=__span-51-22><a id=__codelineno-51-22 name=__codelineno-51-22 href=#__codelineno-51-22></a><span class=sd>        42</span>
</span><span id=__span-51-23><a id=__codelineno-51-23 name=__codelineno-51-23 href=#__codelineno-51-23></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-51-24><a id=__codelineno-51-24 name=__codelineno-51-24 href=#__codelineno-51-24></a>    <span class=k>return</span> <span class=n>programmatic_depth_search</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>default</span><span class=p>)</span>
</span></code></pre></div> <h4 id=3-consider-using-libraries-for-complex-cases><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#3-consider-using-libraries-for-complex-cases>3. Consider Using Libraries for Complex Cases</a></h4> <p>For very complex nested data manipulation, consider using specialized libraries:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-52-1><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=c1># Using jsonpath-ng for JSONPath-style queries</span>
</span><span id=__span-52-2><a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=c1># pip install jsonpath-ng</span>
</span><span id=__span-52-3><a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a>
</span><span id=__span-52-4><a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class=k>try</span><span class=p>:</span>
</span><span id=__span-52-5><a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a>    <span class=kn>from</span><span class=w> </span><span class=nn>jsonpath_ng</span><span class=w> </span><span class=kn>import</span> <span class=n>parse</span>
</span><span id=__span-52-6><a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a>
</span><span id=__span-52-7><a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a>    <span class=k>def</span><span class=w> </span><span class=nf>jsonpath_lookup</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>path_expression</span><span class=p>):</span>
</span><span id=__span-52-8><a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Use JSONPath for complex queries.&quot;&quot;&quot;</span>
</span><span id=__span-52-9><a id=__codelineno-52-9 name=__codelineno-52-9 href=#__codelineno-52-9></a>        <span class=n>jsonpath_expr</span> <span class=o>=</span> <span class=n>parse</span><span class=p>(</span><span class=n>path_expression</span><span class=p>)</span>
</span><span id=__span-52-10><a id=__codelineno-52-10 name=__codelineno-52-10 href=#__codelineno-52-10></a>        <span class=n>matches</span> <span class=o>=</span> <span class=p>[</span><span class=n>match</span><span class=o>.</span><span class=n>value</span> <span class=k>for</span> <span class=n>match</span> <span class=ow>in</span> <span class=n>jsonpath_expr</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=n>data</span><span class=p>)]</span>
</span><span id=__span-52-11><a id=__codelineno-52-11 name=__codelineno-52-11 href=#__codelineno-52-11></a>        <span class=k>return</span> <span class=n>matches</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=k>if</span> <span class=n>matches</span> <span class=k>else</span> <span class=kc>None</span>
</span><span id=__span-52-12><a id=__codelineno-52-12 name=__codelineno-52-12 href=#__codelineno-52-12></a>
</span><span id=__span-52-13><a id=__codelineno-52-13 name=__codelineno-52-13 href=#__codelineno-52-13></a>    <span class=c1># Example usage</span>
</span><span id=__span-52-14><a id=__codelineno-52-14 name=__codelineno-52-14 href=#__codelineno-52-14></a>    <span class=c1># jsonpath_lookup(data, &#39;$.user.profile.preferences.*.email&#39;)</span>
</span><span id=__span-52-15><a id=__codelineno-52-15 name=__codelineno-52-15 href=#__codelineno-52-15></a>
</span><span id=__span-52-16><a id=__codelineno-52-16 name=__codelineno-52-16 href=#__codelineno-52-16></a><span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span><span id=__span-52-17><a id=__codelineno-52-17 name=__codelineno-52-17 href=#__codelineno-52-17></a>    <span class=k>pass</span>  <span class=c1># Library not available</span>
</span><span id=__span-52-18><a id=__codelineno-52-18 name=__codelineno-52-18 href=#__codelineno-52-18></a>
</span><span id=__span-52-19><a id=__codelineno-52-19 name=__codelineno-52-19 href=#__codelineno-52-19></a><span class=c1># Using toolz for functional programming approach</span>
</span><span id=__span-52-20><a id=__codelineno-52-20 name=__codelineno-52-20 href=#__codelineno-52-20></a><span class=c1># pip install toolz</span>
</span><span id=__span-52-21><a id=__codelineno-52-21 name=__codelineno-52-21 href=#__codelineno-52-21></a>
</span><span id=__span-52-22><a id=__codelineno-52-22 name=__codelineno-52-22 href=#__codelineno-52-22></a><span class=k>try</span><span class=p>:</span>
</span><span id=__span-52-23><a id=__codelineno-52-23 name=__codelineno-52-23 href=#__codelineno-52-23></a>    <span class=kn>from</span><span class=w> </span><span class=nn>toolz</span><span class=w> </span><span class=kn>import</span> <span class=n>get_in</span>
</span><span id=__span-52-24><a id=__codelineno-52-24 name=__codelineno-52-24 href=#__codelineno-52-24></a>
</span><span id=__span-52-25><a id=__codelineno-52-25 name=__codelineno-52-25 href=#__codelineno-52-25></a>    <span class=k>def</span><span class=w> </span><span class=nf>toolz_lookup</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span><span id=__span-52-26><a id=__codelineno-52-26 name=__codelineno-52-26 href=#__codelineno-52-26></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Use toolz.get_in for nested access.&quot;&quot;&quot;</span>
</span><span id=__span-52-27><a id=__codelineno-52-27 name=__codelineno-52-27 href=#__codelineno-52-27></a>        <span class=k>return</span> <span class=n>get_in</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=n>default</span><span class=p>)</span>
</span><span id=__span-52-28><a id=__codelineno-52-28 name=__codelineno-52-28 href=#__codelineno-52-28></a>
</span><span id=__span-52-29><a id=__codelineno-52-29 name=__codelineno-52-29 href=#__codelineno-52-29></a><span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span><span id=__span-52-30><a id=__codelineno-52-30 name=__codelineno-52-30 href=#__codelineno-52-30></a>    <span class=k>pass</span>  <span class=c1># Library not available</span>
</span></code></pre></div> <h4 id=4-implement-caching-for-repeated-lookups><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#4-implement-caching-for-repeated-lookups>4. Implement Caching for Repeated Lookups</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-53-1><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=kn>from</span><span class=w> </span><span class=nn>functools</span><span class=w> </span><span class=kn>import</span> <span class=n>lru_cache</span>
</span><span id=__span-53-2><a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a>
</span><span id=__span-53-3><a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a><span class=k>class</span><span class=w> </span><span class=nc>CachedNestedLookup</span><span class=p>:</span>
</span><span id=__span-53-4><a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Cached nested lookup for performance.&quot;&quot;&quot;</span>
</span><span id=__span-53-5><a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a>
</span><span id=__span-53-6><a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span><span id=__span-53-7><a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=n>data</span>
</span><span id=__span-53-8><a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a>
</span><span id=__span-53-9><a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a>    <span class=nd>@lru_cache</span><span class=p>(</span><span class=n>maxsize</span><span class=o>=</span><span class=mi>256</span><span class=p>)</span>
</span><span id=__span-53-10><a id=__codelineno-53-10 name=__codelineno-53-10 href=#__codelineno-53-10></a>    <span class=k>def</span><span class=w> </span><span class=nf>get</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path_tuple</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span><span id=__span-53-11><a id=__codelineno-53-11 name=__codelineno-53-11 href=#__codelineno-53-11></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Cached lookup using tuple path (hashable).&quot;&quot;&quot;</span>
</span><span id=__span-53-12><a id=__codelineno-53-12 name=__codelineno-53-12 href=#__codelineno-53-12></a>        <span class=k>return</span> <span class=n>programmatic_depth_search</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=p>,</span> <span class=nb>list</span><span class=p>(</span><span class=n>path_tuple</span><span class=p>),</span> <span class=n>default</span><span class=p>)</span>
</span><span id=__span-53-13><a id=__codelineno-53-13 name=__codelineno-53-13 href=#__codelineno-53-13></a>
</span><span id=__span-53-14><a id=__codelineno-53-14 name=__codelineno-53-14 href=#__codelineno-53-14></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_path</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path_list</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span><span id=__span-53-15><a id=__codelineno-53-15 name=__codelineno-53-15 href=#__codelineno-53-15></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Convert list to tuple for caching.&quot;&quot;&quot;</span>
</span><span id=__span-53-16><a id=__codelineno-53-16 name=__codelineno-53-16 href=#__codelineno-53-16></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=nb>tuple</span><span class=p>(</span><span class=n>path_list</span><span class=p>),</span> <span class=n>default</span><span class=p>)</span>
</span><span id=__span-53-17><a id=__codelineno-53-17 name=__codelineno-53-17 href=#__codelineno-53-17></a>
</span><span id=__span-53-18><a id=__codelineno-53-18 name=__codelineno-53-18 href=#__codelineno-53-18></a><span class=c1># Usage</span>
</span><span id=__span-53-19><a id=__codelineno-53-19 name=__codelineno-53-19 href=#__codelineno-53-19></a><span class=n>lookup</span> <span class=o>=</span> <span class=n>CachedNestedLookup</span><span class=p>(</span><span class=n>large_nested_data</span><span class=p>)</span>
</span><span id=__span-53-20><a id=__codelineno-53-20 name=__codelineno-53-20 href=#__codelineno-53-20></a><span class=n>result1</span> <span class=o>=</span> <span class=n>lookup</span><span class=o>.</span><span class=n>get_path</span><span class=p>([</span><span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;profile&#39;</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span><span class=p>])</span>  <span class=c1># Computed</span>
</span><span id=__span-53-21><a id=__codelineno-53-21 name=__codelineno-53-21 href=#__codelineno-53-21></a><span class=n>result2</span> <span class=o>=</span> <span class=n>lookup</span><span class=o>.</span><span class=n>get_path</span><span class=p>([</span><span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;profile&#39;</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span><span class=p>])</span>  <span class=c1># Cached</span>
</span></code></pre></div> <h3 id=conclusion><a class=toclink href=../../2023/11/20/nested_dictionary_lookups_methods_performance_and_best_practices/#conclusion>Conclusion</a></h3> <p>Nested dictionary lookups are a common challenge in Python programming. The best approach depends on your specific requirements:</p> <ul> <li><strong>Use chained <code>.get()</code> calls</strong> for simple, known paths with minimal nesting</li> <li><strong>Use the walrus operator</strong> for efficient short-circuiting in Python 3.8+</li> <li><strong>Use programmatic depth search</strong> for dynamic paths and maximum flexibility</li> <li><strong>Use try/except</strong> only when you need maximum performance for known-good paths</li> <li><strong>Consider specialized libraries</strong> for complex query requirements</li> </ul> <p>Key principles to remember:</p> <ol> <li><strong>Safety first</strong>: Always handle missing keys gracefully</li> <li><strong>Performance matters</strong>: Choose the right method for your use case</li> <li><strong>Maintainability</strong>: Prefer readable code over micro-optimizations</li> <li><strong>Reusability</strong>: Create general-purpose functions for repeated use</li> <li><strong>Documentation</strong>: Clearly document expected data structures and behaviors</li> </ol> <p>The <code>programmatic_depth_search</code> function presented here provides a robust, reusable solution that handles edge cases while maintaining good performance. Use it as a starting point and adapt it to your specific needs.</p> <p>By mastering these techniques, you'll be well-equipped to handle complex nested data structures safely and efficiently in your Python applications.</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=https://github.com/mutaku.png alt="Matthew Martz, PhD"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2023-09-15 00:00:00+00:00">Friday, September 15, 2023</time></li> <li class=md-meta__item> in <a href=../aiml/ class=md-meta__link>AI/ML</a>, <a href=./ class=md-meta__link>Technology</a></li> <li class=md-meta__item> 18 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=notes-on-mlops-industry-analysis-and-practical-insights><a href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/ class=toclink>Notes on MLOps: Industry Analysis and Practical Insights</a></h2> <p><em>Originally written in response to industry discussions about MLOps maturity and adoption challenges</em></p> <p>This piece examines the current state of MLOps (Machine Learning Operations) through the lens of practical experience implementing ML systems in production environments. Written during my time at Firstleaf, these observations reflect real-world challenges and solutions in operationalizing machine learning at scale.</p> <h3 id=table-of-contents><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#table-of-contents>Table of Contents</a></h3> <ol> <li><a href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#mlops-maturity>The MLOps Maturity Question</a></li> <li><a href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#loop-closure>Loop Closure: The Foundation of Reliable ML</a></li> <li><a href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#declarative-systems>Declarative Systems vs. Imperative Approaches</a></li> <li><a href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#real-time-ml>Real-Time ML: Challenges and Solutions</a></li> <li><a href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#data-management>Data Management in Production ML</a></li> <li><a href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#business-integration>Business Integration and Value Realization</a></li> <li><a href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#talent-shortage>The Talent Shortage Reality</a></li> <li><a href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#cultural-adoption>Cultural Adoption and Organizational Change</a></li> <li><a href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#practical-recommendations>Practical Recommendations</a></li> </ol> <h3 id=mlops-maturity><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#mlops-maturity>The MLOps Maturity Question</a></h3> <p>The question of MLOps maturity in the industry is multifaceted. While many organizations claim to be "doing MLOps," the reality is that most are still in the early stages of true operational machine learning maturity.</p> <h4 id=current-state-assessment><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#current-state-assessment>Current State Assessment</a></h4> <p>From my experience implementing recommendation systems and ML pipelines at scale, I've observed that most organizations fall into one of three categories:</p> <ol> <li><strong>ML Experimentation Phase</strong>: Teams have data scientists building models in notebooks, but deployment is ad-hoc and monitoring is minimal</li> <li><strong>Basic Production ML</strong>: Models are deployed to production, but without proper versioning, monitoring, or automated retraining</li> <li><strong>Mature MLOps</strong>: Full lifecycle management with automated pipelines, comprehensive monitoring, and integrated feedback loops</li> </ol> <p>The majority of organizations I've encountered are still in categories 1 or 2, despite claims of having "mature MLOps practices."</p> <h4 id=the-complexity-challenge><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#the-complexity-challenge>The Complexity Challenge</a></h4> <p>MLOps is inherently more complex than traditional DevOps because:</p> <ul> <li><strong>Data drift</strong>: Models degrade over time as underlying data distributions change</li> <li><strong>Model complexity</strong>: Understanding and debugging ML models requires specialized knowledge</li> <li><strong>Feedback loops</strong>: The time between deployment and outcome measurement can be weeks or months</li> <li><strong>Regulatory requirements</strong>: Many industries have strict requirements for model explainability and audit trails</li> </ul> <div class="language-python highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=c1># Example: Simple model monitoring for data drift</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=kn>import</span><span class=w> </span><span class=nn>numpy</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>np</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=kn>from</span><span class=w> </span><span class=nn>scipy</span><span class=w> </span><span class=kn>import</span> <span class=n>stats</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a>
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=k>class</span><span class=w> </span><span class=nc>DataDriftMonitor</span><span class=p>:</span>
</span><span id=__span-32-6><a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>reference_data</span><span class=p>,</span> <span class=n>threshold</span><span class=o>=</span><span class=mf>0.05</span><span class=p>):</span>
</span><span id=__span-32-7><a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a>        <span class=bp>self</span><span class=o>.</span><span class=n>reference_data</span> <span class=o>=</span> <span class=n>reference_data</span>
</span><span id=__span-32-8><a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a>        <span class=bp>self</span><span class=o>.</span><span class=n>threshold</span> <span class=o>=</span> <span class=n>threshold</span>
</span><span id=__span-32-9><a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a>        <span class=bp>self</span><span class=o>.</span><span class=n>reference_stats</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_calculate_stats</span><span class=p>(</span><span class=n>reference_data</span><span class=p>)</span>
</span><span id=__span-32-10><a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a>
</span><span id=__span-32-11><a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a>    <span class=k>def</span><span class=w> </span><span class=nf>_calculate_stats</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span><span id=__span-32-12><a id=__codelineno-32-12 name=__codelineno-32-12 href=#__codelineno-32-12></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-32-13><a id=__codelineno-32-13 name=__codelineno-32-13 href=#__codelineno-32-13></a>            <span class=s1>&#39;mean&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>
</span><span id=__span-32-14><a id=__codelineno-32-14 name=__codelineno-32-14 href=#__codelineno-32-14></a>            <span class=s1>&#39;std&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>std</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>
</span><span id=__span-32-15><a id=__codelineno-32-15 name=__codelineno-32-15 href=#__codelineno-32-15></a>            <span class=s1>&#39;percentiles&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>percentile</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=p>[</span><span class=mi>25</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>75</span><span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-32-16><a id=__codelineno-32-16 name=__codelineno-32-16 href=#__codelineno-32-16></a>        <span class=p>}</span>
</span><span id=__span-32-17><a id=__codelineno-32-17 name=__codelineno-32-17 href=#__codelineno-32-17></a>
</span><span id=__span-32-18><a id=__codelineno-32-18 name=__codelineno-32-18 href=#__codelineno-32-18></a>    <span class=k>def</span><span class=w> </span><span class=nf>detect_drift</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>new_data</span><span class=p>):</span>
</span><span id=__span-32-19><a id=__codelineno-32-19 name=__codelineno-32-19 href=#__codelineno-32-19></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Detect data drift using statistical tests.&quot;&quot;&quot;</span>
</span><span id=__span-32-20><a id=__codelineno-32-20 name=__codelineno-32-20 href=#__codelineno-32-20></a>        <span class=n>drift_detected</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-32-21><a id=__codelineno-32-21 name=__codelineno-32-21 href=#__codelineno-32-21></a>        <span class=n>drift_features</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-32-22><a id=__codelineno-32-22 name=__codelineno-32-22 href=#__codelineno-32-22></a>
</span><span id=__span-32-23><a id=__codelineno-32-23 name=__codelineno-32-23 href=#__codelineno-32-23></a>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>new_data</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]):</span>
</span><span id=__span-32-24><a id=__codelineno-32-24 name=__codelineno-32-24 href=#__codelineno-32-24></a>            <span class=n>ref_feature</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>reference_data</span><span class=p>[:,</span> <span class=n>i</span><span class=p>]</span>
</span><span id=__span-32-25><a id=__codelineno-32-25 name=__codelineno-32-25 href=#__codelineno-32-25></a>            <span class=n>new_feature</span> <span class=o>=</span> <span class=n>new_data</span><span class=p>[:,</span> <span class=n>i</span><span class=p>]</span>
</span><span id=__span-32-26><a id=__codelineno-32-26 name=__codelineno-32-26 href=#__codelineno-32-26></a>
</span><span id=__span-32-27><a id=__codelineno-32-27 name=__codelineno-32-27 href=#__codelineno-32-27></a>            <span class=c1># Perform Kolmogorov-Smirnov test</span>
</span><span id=__span-32-28><a id=__codelineno-32-28 name=__codelineno-32-28 href=#__codelineno-32-28></a>            <span class=n>statistic</span><span class=p>,</span> <span class=n>p_value</span> <span class=o>=</span> <span class=n>stats</span><span class=o>.</span><span class=n>ks_2samp</span><span class=p>(</span><span class=n>ref_feature</span><span class=p>,</span> <span class=n>new_feature</span><span class=p>)</span>
</span><span id=__span-32-29><a id=__codelineno-32-29 name=__codelineno-32-29 href=#__codelineno-32-29></a>
</span><span id=__span-32-30><a id=__codelineno-32-30 name=__codelineno-32-30 href=#__codelineno-32-30></a>            <span class=k>if</span> <span class=n>p_value</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>threshold</span><span class=p>:</span>
</span><span id=__span-32-31><a id=__codelineno-32-31 name=__codelineno-32-31 href=#__codelineno-32-31></a>                <span class=n>drift_detected</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-32-32><a id=__codelineno-32-32 name=__codelineno-32-32 href=#__codelineno-32-32></a>                <span class=n>drift_features</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span><span id=__span-32-33><a id=__codelineno-32-33 name=__codelineno-32-33 href=#__codelineno-32-33></a>
</span><span id=__span-32-34><a id=__codelineno-32-34 name=__codelineno-32-34 href=#__codelineno-32-34></a>        <span class=k>return</span> <span class=n>drift_detected</span><span class=p>,</span> <span class=n>drift_features</span>
</span></code></pre></div> <h3 id=loop-closure><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#loop-closure>Loop Closure: The Foundation of Reliable ML</a></h3> <p>One of the most critical aspects of MLOps that many organizations struggle with is achieving proper "loop closure" - the ability to automatically detect when models are performing poorly and take corrective action.</p> <h4 id=the-feedback-loop-challenge><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#the-feedback-loop-challenge>The Feedback Loop Challenge</a></h4> <p>In traditional software, errors are typically immediate and obvious. A web application either loads or it doesn't. In machine learning, model degradation can be subtle and gradual:</p> <ul> <li>A recommendation system might slowly become less relevant</li> <li>A fraud detection model might miss new attack patterns</li> <li>A demand forecasting model might become less accurate due to market changes</li> </ul> <h4 id=implementing-effective-monitoring><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#implementing-effective-monitoring>Implementing Effective Monitoring</a></h4> <p>At Firstleaf, we implemented a comprehensive monitoring system for our recommendation engine that tracked multiple metrics:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=k>class</span><span class=w> </span><span class=nc>ModelPerformanceMonitor</span><span class=p>:</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>model_name</span><span class=p>,</span> <span class=n>metrics_config</span><span class=p>):</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a>        <span class=bp>self</span><span class=o>.</span><span class=n>model_name</span> <span class=o>=</span> <span class=n>model_name</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics_config</span> <span class=o>=</span> <span class=n>metrics_config</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a>        <span class=bp>self</span><span class=o>.</span><span class=n>alert_thresholds</span> <span class=o>=</span> <span class=n>metrics_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;alert_thresholds&#39;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a>
</span><span id=__span-33-7><a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a>    <span class=k>def</span><span class=w> </span><span class=nf>log_prediction</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>prediction_id</span><span class=p>,</span> <span class=n>features</span><span class=p>,</span> <span class=n>prediction</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>):</span>
</span><span id=__span-33-8><a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Log a prediction for later evaluation.&quot;&quot;&quot;</span>
</span><span id=__span-33-9><a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a>        <span class=bp>self</span><span class=o>.</span><span class=n>prediction_store</span><span class=o>.</span><span class=n>save</span><span class=p>({</span>
</span><span id=__span-33-10><a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a>            <span class=s1>&#39;prediction_id&#39;</span><span class=p>:</span> <span class=n>prediction_id</span><span class=p>,</span>
</span><span id=__span-33-11><a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a>            <span class=s1>&#39;model_name&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_name</span><span class=p>,</span>
</span><span id=__span-33-12><a id=__codelineno-33-12 name=__codelineno-33-12 href=#__codelineno-33-12></a>            <span class=s1>&#39;features&#39;</span><span class=p>:</span> <span class=n>features</span><span class=p>,</span>
</span><span id=__span-33-13><a id=__codelineno-33-13 name=__codelineno-33-13 href=#__codelineno-33-13></a>            <span class=s1>&#39;prediction&#39;</span><span class=p>:</span> <span class=n>prediction</span><span class=p>,</span>
</span><span id=__span-33-14><a id=__codelineno-33-14 name=__codelineno-33-14 href=#__codelineno-33-14></a>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>timestamp</span>
</span><span id=__span-33-15><a id=__codelineno-33-15 name=__codelineno-33-15 href=#__codelineno-33-15></a>        <span class=p>})</span>
</span><span id=__span-33-16><a id=__codelineno-33-16 name=__codelineno-33-16 href=#__codelineno-33-16></a>
</span><span id=__span-33-17><a id=__codelineno-33-17 name=__codelineno-33-17 href=#__codelineno-33-17></a>    <span class=k>def</span><span class=w> </span><span class=nf>log_outcome</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>prediction_id</span><span class=p>,</span> <span class=n>actual_outcome</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>):</span>
</span><span id=__span-33-18><a id=__codelineno-33-18 name=__codelineno-33-18 href=#__codelineno-33-18></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Log the actual outcome for a prediction.&quot;&quot;&quot;</span>
</span><span id=__span-33-19><a id=__codelineno-33-19 name=__codelineno-33-19 href=#__codelineno-33-19></a>        <span class=bp>self</span><span class=o>.</span><span class=n>outcome_store</span><span class=o>.</span><span class=n>save</span><span class=p>({</span>
</span><span id=__span-33-20><a id=__codelineno-33-20 name=__codelineno-33-20 href=#__codelineno-33-20></a>            <span class=s1>&#39;prediction_id&#39;</span><span class=p>:</span> <span class=n>prediction_id</span><span class=p>,</span>
</span><span id=__span-33-21><a id=__codelineno-33-21 name=__codelineno-33-21 href=#__codelineno-33-21></a>            <span class=s1>&#39;actual_outcome&#39;</span><span class=p>:</span> <span class=n>actual_outcome</span><span class=p>,</span>
</span><span id=__span-33-22><a id=__codelineno-33-22 name=__codelineno-33-22 href=#__codelineno-33-22></a>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>timestamp</span>
</span><span id=__span-33-23><a id=__codelineno-33-23 name=__codelineno-33-23 href=#__codelineno-33-23></a>        <span class=p>})</span>
</span><span id=__span-33-24><a id=__codelineno-33-24 name=__codelineno-33-24 href=#__codelineno-33-24></a>
</span><span id=__span-33-25><a id=__codelineno-33-25 name=__codelineno-33-25 href=#__codelineno-33-25></a>    <span class=k>def</span><span class=w> </span><span class=nf>calculate_performance_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>time_window</span><span class=o>=</span><span class=s1>&#39;1d&#39;</span><span class=p>):</span>
</span><span id=__span-33-26><a id=__codelineno-33-26 name=__codelineno-33-26 href=#__codelineno-33-26></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Calculate performance metrics over a time window.&quot;&quot;&quot;</span>
</span><span id=__span-33-27><a id=__codelineno-33-27 name=__codelineno-33-27 href=#__codelineno-33-27></a>        <span class=n>predictions</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_predictions_with_outcomes</span><span class=p>(</span><span class=n>time_window</span><span class=p>)</span>
</span><span id=__span-33-28><a id=__codelineno-33-28 name=__codelineno-33-28 href=#__codelineno-33-28></a>
</span><span id=__span-33-29><a id=__codelineno-33-29 name=__codelineno-33-29 href=#__codelineno-33-29></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>predictions</span><span class=p>)</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;min_samples&#39;</span><span class=p>,</span> <span class=mi>100</span><span class=p>):</span>
</span><span id=__span-33-30><a id=__codelineno-33-30 name=__codelineno-33-30 href=#__codelineno-33-30></a>            <span class=k>return</span> <span class=kc>None</span>  <span class=c1># Not enough data for reliable metrics</span>
</span><span id=__span-33-31><a id=__codelineno-33-31 name=__codelineno-33-31 href=#__codelineno-33-31></a>
</span><span id=__span-33-32><a id=__codelineno-33-32 name=__codelineno-33-32 href=#__codelineno-33-32></a>        <span class=n>metrics</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-33-33><a id=__codelineno-33-33 name=__codelineno-33-33 href=#__codelineno-33-33></a>
</span><span id=__span-33-34><a id=__codelineno-33-34 name=__codelineno-33-34 href=#__codelineno-33-34></a>        <span class=c1># Calculate accuracy metrics</span>
</span><span id=__span-33-35><a id=__codelineno-33-35 name=__codelineno-33-35 href=#__codelineno-33-35></a>        <span class=k>if</span> <span class=s1>&#39;accuracy&#39;</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics_config</span><span class=p>[</span><span class=s1>&#39;metrics&#39;</span><span class=p>]:</span>
</span><span id=__span-33-36><a id=__codelineno-33-36 name=__codelineno-33-36 href=#__codelineno-33-36></a>            <span class=n>correct</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=mi>1</span> <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>predictions</span> <span class=k>if</span> <span class=n>p</span><span class=p>[</span><span class=s1>&#39;prediction&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=n>p</span><span class=p>[</span><span class=s1>&#39;actual&#39;</span><span class=p>])</span>
</span><span id=__span-33-37><a id=__codelineno-33-37 name=__codelineno-33-37 href=#__codelineno-33-37></a>            <span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;accuracy&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>correct</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>predictions</span><span class=p>)</span>
</span><span id=__span-33-38><a id=__codelineno-33-38 name=__codelineno-33-38 href=#__codelineno-33-38></a>
</span><span id=__span-33-39><a id=__codelineno-33-39 name=__codelineno-33-39 href=#__codelineno-33-39></a>        <span class=c1># Calculate business metrics (e.g., click-through rate)</span>
</span><span id=__span-33-40><a id=__codelineno-33-40 name=__codelineno-33-40 href=#__codelineno-33-40></a>        <span class=k>if</span> <span class=s1>&#39;ctr&#39;</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics_config</span><span class=p>[</span><span class=s1>&#39;metrics&#39;</span><span class=p>]:</span>
</span><span id=__span-33-41><a id=__codelineno-33-41 name=__codelineno-33-41 href=#__codelineno-33-41></a>            <span class=n>clicks</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=mi>1</span> <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>predictions</span> <span class=k>if</span> <span class=n>p</span><span class=p>[</span><span class=s1>&#39;actual&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;click&#39;</span><span class=p>)</span>
</span><span id=__span-33-42><a id=__codelineno-33-42 name=__codelineno-33-42 href=#__codelineno-33-42></a>            <span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;ctr&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>clicks</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>predictions</span><span class=p>)</span>
</span><span id=__span-33-43><a id=__codelineno-33-43 name=__codelineno-33-43 href=#__codelineno-33-43></a>
</span><span id=__span-33-44><a id=__codelineno-33-44 name=__codelineno-33-44 href=#__codelineno-33-44></a>        <span class=k>return</span> <span class=n>metrics</span>
</span><span id=__span-33-45><a id=__codelineno-33-45 name=__codelineno-33-45 href=#__codelineno-33-45></a>
</span><span id=__span-33-46><a id=__codelineno-33-46 name=__codelineno-33-46 href=#__codelineno-33-46></a>    <span class=k>def</span><span class=w> </span><span class=nf>check_alerts</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>current_metrics</span><span class=p>):</span>
</span><span id=__span-33-47><a id=__codelineno-33-47 name=__codelineno-33-47 href=#__codelineno-33-47></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Check if current metrics trigger any alerts.&quot;&quot;&quot;</span>
</span><span id=__span-33-48><a id=__codelineno-33-48 name=__codelineno-33-48 href=#__codelineno-33-48></a>        <span class=n>alerts</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-33-49><a id=__codelineno-33-49 name=__codelineno-33-49 href=#__codelineno-33-49></a>
</span><span id=__span-33-50><a id=__codelineno-33-50 name=__codelineno-33-50 href=#__codelineno-33-50></a>        <span class=k>for</span> <span class=n>metric_name</span><span class=p>,</span> <span class=n>threshold</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>alert_thresholds</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-33-51><a id=__codelineno-33-51 name=__codelineno-33-51 href=#__codelineno-33-51></a>            <span class=k>if</span> <span class=n>metric_name</span> <span class=ow>in</span> <span class=n>current_metrics</span><span class=p>:</span>
</span><span id=__span-33-52><a id=__codelineno-33-52 name=__codelineno-33-52 href=#__codelineno-33-52></a>                <span class=k>if</span> <span class=n>current_metrics</span><span class=p>[</span><span class=n>metric_name</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>threshold</span><span class=p>:</span>
</span><span id=__span-33-53><a id=__codelineno-33-53 name=__codelineno-33-53 href=#__codelineno-33-53></a>                    <span class=n>alerts</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-33-54><a id=__codelineno-33-54 name=__codelineno-33-54 href=#__codelineno-33-54></a>                        <span class=s1>&#39;metric&#39;</span><span class=p>:</span> <span class=n>metric_name</span><span class=p>,</span>
</span><span id=__span-33-55><a id=__codelineno-33-55 name=__codelineno-33-55 href=#__codelineno-33-55></a>                        <span class=s1>&#39;current_value&#39;</span><span class=p>:</span> <span class=n>current_metrics</span><span class=p>[</span><span class=n>metric_name</span><span class=p>],</span>
</span><span id=__span-33-56><a id=__codelineno-33-56 name=__codelineno-33-56 href=#__codelineno-33-56></a>                        <span class=s1>&#39;threshold&#39;</span><span class=p>:</span> <span class=n>threshold</span><span class=p>,</span>
</span><span id=__span-33-57><a id=__codelineno-33-57 name=__codelineno-33-57 href=#__codelineno-33-57></a>                        <span class=s1>&#39;severity&#39;</span><span class=p>:</span> <span class=s1>&#39;high&#39;</span> <span class=k>if</span> <span class=n>current_metrics</span><span class=p>[</span><span class=n>metric_name</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>threshold</span> <span class=o>*</span> <span class=mf>0.8</span> <span class=k>else</span> <span class=s1>&#39;medium&#39;</span>
</span><span id=__span-33-58><a id=__codelineno-33-58 name=__codelineno-33-58 href=#__codelineno-33-58></a>                    <span class=p>})</span>
</span><span id=__span-33-59><a id=__codelineno-33-59 name=__codelineno-33-59 href=#__codelineno-33-59></a>
</span><span id=__span-33-60><a id=__codelineno-33-60 name=__codelineno-33-60 href=#__codelineno-33-60></a>        <span class=k>return</span> <span class=n>alerts</span>
</span></code></pre></div> <h4 id=automated-response-systems><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#automated-response-systems>Automated Response Systems</a></h4> <p>The key to effective loop closure is not just detection, but automated response:</p> <ol> <li><strong>Automatic retraining</strong>: When performance drops below thresholds, trigger retraining with recent data</li> <li><strong>Model rollback</strong>: Automatically revert to the previous model version if performance degrades</li> <li><strong>Feature engineering alerts</strong>: Notify data engineers when feature distributions change significantly</li> <li><strong>Business impact assessment</strong>: Calculate the business cost of model degradation</li> </ol> <h3 id=declarative-systems><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#declarative-systems>Declarative Systems vs. Imperative Approaches</a></h3> <p>One of the key architectural decisions in MLOps is whether to use declarative or imperative approaches to pipeline management.</p> <h4 id=the-declarative-advantage><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#the-declarative-advantage>The Declarative Advantage</a></h4> <p>Declarative systems, where you specify what you want rather than how to achieve it, offer several advantages for ML pipelines:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=c1># Example: Declarative ML pipeline configuration</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ml/v1</span>
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">MLPipeline</span>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=nt>metadata</span><span class=p>:</span>
</span><span id=__span-34-5><a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">recommendation-pipeline</span>
</span><span id=__span-34-6><a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a><span class=nt>spec</span><span class=p>:</span>
</span><span id=__span-34-7><a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a><span class=w>  </span><span class=nt>schedule</span><span class=p>:</span><span class=w> </span><span class=s>&quot;0</span><span class=nv> </span><span class=s>2</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*&quot;</span><span class=w>  </span><span class=c1># Daily at 2 AM</span>
</span><span id=__span-34-8><a id=__codelineno-34-8 name=__codelineno-34-8 href=#__codelineno-34-8></a><span class=w>  </span><span class=nt>stages</span><span class=p>:</span>
</span><span id=__span-34-9><a id=__codelineno-34-9 name=__codelineno-34-9 href=#__codelineno-34-9></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">data-extraction</span>
</span><span id=__span-34-10><a id=__codelineno-34-10 name=__codelineno-34-10 href=#__codelineno-34-10></a><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">data-extractor:v1.2.0</span>
</span><span id=__span-34-11><a id=__codelineno-34-11 name=__codelineno-34-11 href=#__codelineno-34-11></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-34-12><a id=__codelineno-34-12 name=__codelineno-34-12 href=#__codelineno-34-12></a><span class=w>        </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2&quot;</span>
</span><span id=__span-34-13><a id=__codelineno-34-13 name=__codelineno-34-13 href=#__codelineno-34-13></a><span class=w>        </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>&quot;4Gi&quot;</span>
</span><span id=__span-34-14><a id=__codelineno-34-14 name=__codelineno-34-14 href=#__codelineno-34-14></a><span class=w>      </span><span class=nt>inputs</span><span class=p>:</span>
</span><span id=__span-34-15><a id=__codelineno-34-15 name=__codelineno-34-15 href=#__codelineno-34-15></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">date_range</span>
</span><span id=__span-34-16><a id=__codelineno-34-16 name=__codelineno-34-16 href=#__codelineno-34-16></a><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>.Date.AddDays(-7)</span><span class=nv> </span><span class=s>}}</span><span class=nv> </span><span class=s>to</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>.Date</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-34-17><a id=__codelineno-34-17 name=__codelineno-34-17 href=#__codelineno-34-17></a><span class=w>      </span><span class=nt>outputs</span><span class=p>:</span>
</span><span id=__span-34-18><a id=__codelineno-34-18 name=__codelineno-34-18 href=#__codelineno-34-18></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">raw_data</span>
</span><span id=__span-34-19><a id=__codelineno-34-19 name=__codelineno-34-19 href=#__codelineno-34-19></a><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/data/raw/</span>
</span><span id=__span-34-20><a id=__codelineno-34-20 name=__codelineno-34-20 href=#__codelineno-34-20></a>
</span><span id=__span-34-21><a id=__codelineno-34-21 name=__codelineno-34-21 href=#__codelineno-34-21></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">feature-engineering</span>
</span><span id=__span-34-22><a id=__codelineno-34-22 name=__codelineno-34-22 href=#__codelineno-34-22></a><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">feature-engineer:v2.1.0</span>
</span><span id=__span-34-23><a id=__codelineno-34-23 name=__codelineno-34-23 href=#__codelineno-34-23></a><span class=w>      </span><span class=nt>dependsOn</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>data-extraction</span><span class="p p-Indicator">]</span>
</span><span id=__span-34-24><a id=__codelineno-34-24 name=__codelineno-34-24 href=#__codelineno-34-24></a><span class=w>      </span><span class=nt>inputs</span><span class=p>:</span>
</span><span id=__span-34-25><a id=__codelineno-34-25 name=__codelineno-34-25 href=#__codelineno-34-25></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">raw_data</span>
</span><span id=__span-34-26><a id=__codelineno-34-26 name=__codelineno-34-26 href=#__codelineno-34-26></a><span class=w>          </span><span class=nt>from</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">data-extraction.raw_data</span>
</span><span id=__span-34-27><a id=__codelineno-34-27 name=__codelineno-34-27 href=#__codelineno-34-27></a><span class=w>      </span><span class=nt>outputs</span><span class=p>:</span>
</span><span id=__span-34-28><a id=__codelineno-34-28 name=__codelineno-34-28 href=#__codelineno-34-28></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">features</span>
</span><span id=__span-34-29><a id=__codelineno-34-29 name=__codelineno-34-29 href=#__codelineno-34-29></a><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/data/features/</span>
</span><span id=__span-34-30><a id=__codelineno-34-30 name=__codelineno-34-30 href=#__codelineno-34-30></a>
</span><span id=__span-34-31><a id=__codelineno-34-31 name=__codelineno-34-31 href=#__codelineno-34-31></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">model-training</span>
</span><span id=__span-34-32><a id=__codelineno-34-32 name=__codelineno-34-32 href=#__codelineno-34-32></a><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">model-trainer:v1.5.0</span>
</span><span id=__span-34-33><a id=__codelineno-34-33 name=__codelineno-34-33 href=#__codelineno-34-33></a><span class=w>      </span><span class=nt>dependsOn</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>feature-engineering</span><span class="p p-Indicator">]</span>
</span><span id=__span-34-34><a id=__codelineno-34-34 name=__codelineno-34-34 href=#__codelineno-34-34></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-34-35><a id=__codelineno-34-35 name=__codelineno-34-35 href=#__codelineno-34-35></a><span class=w>        </span><span class=nt>gpu</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1&quot;</span>
</span><span id=__span-34-36><a id=__codelineno-34-36 name=__codelineno-34-36 href=#__codelineno-34-36></a><span class=w>        </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>&quot;8Gi&quot;</span>
</span><span id=__span-34-37><a id=__codelineno-34-37 name=__codelineno-34-37 href=#__codelineno-34-37></a><span class=w>      </span><span class=nt>inputs</span><span class=p>:</span>
</span><span id=__span-34-38><a id=__codelineno-34-38 name=__codelineno-34-38 href=#__codelineno-34-38></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">features</span>
</span><span id=__span-34-39><a id=__codelineno-34-39 name=__codelineno-34-39 href=#__codelineno-34-39></a><span class=w>          </span><span class=nt>from</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">feature-engineering.features</span>
</span><span id=__span-34-40><a id=__codelineno-34-40 name=__codelineno-34-40 href=#__codelineno-34-40></a><span class=w>      </span><span class=nt>outputs</span><span class=p>:</span>
</span><span id=__span-34-41><a id=__codelineno-34-41 name=__codelineno-34-41 href=#__codelineno-34-41></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">model</span>
</span><span id=__span-34-42><a id=__codelineno-34-42 name=__codelineno-34-42 href=#__codelineno-34-42></a><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/models/</span>
</span><span id=__span-34-43><a id=__codelineno-34-43 name=__codelineno-34-43 href=#__codelineno-34-43></a><span class=w>      </span><span class=nt>hyperparameters</span><span class=p>:</span>
</span><span id=__span-34-44><a id=__codelineno-34-44 name=__codelineno-34-44 href=#__codelineno-34-44></a><span class=w>        </span><span class=nt>learning_rate</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0.001</span>
</span><span id=__span-34-45><a id=__codelineno-34-45 name=__codelineno-34-45 href=#__codelineno-34-45></a><span class=w>        </span><span class=nt>batch_size</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">256</span>
</span><span id=__span-34-46><a id=__codelineno-34-46 name=__codelineno-34-46 href=#__codelineno-34-46></a><span class=w>        </span><span class=nt>epochs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
</span><span id=__span-34-47><a id=__codelineno-34-47 name=__codelineno-34-47 href=#__codelineno-34-47></a>
</span><span id=__span-34-48><a id=__codelineno-34-48 name=__codelineno-34-48 href=#__codelineno-34-48></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">model-validation</span>
</span><span id=__span-34-49><a id=__codelineno-34-49 name=__codelineno-34-49 href=#__codelineno-34-49></a><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">model-validator:v1.0.0</span>
</span><span id=__span-34-50><a id=__codelineno-34-50 name=__codelineno-34-50 href=#__codelineno-34-50></a><span class=w>      </span><span class=nt>dependsOn</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>model-training</span><span class="p p-Indicator">]</span>
</span><span id=__span-34-51><a id=__codelineno-34-51 name=__codelineno-34-51 href=#__codelineno-34-51></a><span class=w>      </span><span class=nt>inputs</span><span class=p>:</span>
</span><span id=__span-34-52><a id=__codelineno-34-52 name=__codelineno-34-52 href=#__codelineno-34-52></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">model</span>
</span><span id=__span-34-53><a id=__codelineno-34-53 name=__codelineno-34-53 href=#__codelineno-34-53></a><span class=w>          </span><span class=nt>from</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">model-training.model</span>
</span><span id=__span-34-54><a id=__codelineno-34-54 name=__codelineno-34-54 href=#__codelineno-34-54></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">validation_data</span>
</span><span id=__span-34-55><a id=__codelineno-34-55 name=__codelineno-34-55 href=#__codelineno-34-55></a><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/data/validation/</span>
</span><span id=__span-34-56><a id=__codelineno-34-56 name=__codelineno-34-56 href=#__codelineno-34-56></a><span class=w>      </span><span class=nt>validationRules</span><span class=p>:</span>
</span><span id=__span-34-57><a id=__codelineno-34-57 name=__codelineno-34-57 href=#__codelineno-34-57></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>metric</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">accuracy</span>
</span><span id=__span-34-58><a id=__codelineno-34-58 name=__codelineno-34-58 href=#__codelineno-34-58></a><span class=w>          </span><span class=nt>threshold</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0.85</span>
</span><span id=__span-34-59><a id=__codelineno-34-59 name=__codelineno-34-59 href=#__codelineno-34-59></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>metric</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">auc</span>
</span><span id=__span-34-60><a id=__codelineno-34-60 name=__codelineno-34-60 href=#__codelineno-34-60></a><span class=w>          </span><span class=nt>threshold</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0.90</span>
</span><span id=__span-34-61><a id=__codelineno-34-61 name=__codelineno-34-61 href=#__codelineno-34-61></a>
</span><span id=__span-34-62><a id=__codelineno-34-62 name=__codelineno-34-62 href=#__codelineno-34-62></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">model-deployment</span>
</span><span id=__span-34-63><a id=__codelineno-34-63 name=__codelineno-34-63 href=#__codelineno-34-63></a><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">model-deployer:v1.3.0</span>
</span><span id=__span-34-64><a id=__codelineno-34-64 name=__codelineno-34-64 href=#__codelineno-34-64></a><span class=w>      </span><span class=nt>dependsOn</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>model-validation</span><span class="p p-Indicator">]</span>
</span><span id=__span-34-65><a id=__codelineno-34-65 name=__codelineno-34-65 href=#__codelineno-34-65></a><span class=w>      </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>.Stages.model-validation.Success</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-34-66><a id=__codelineno-34-66 name=__codelineno-34-66 href=#__codelineno-34-66></a><span class=w>      </span><span class=nt>inputs</span><span class=p>:</span>
</span><span id=__span-34-67><a id=__codelineno-34-67 name=__codelineno-34-67 href=#__codelineno-34-67></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">model</span>
</span><span id=__span-34-68><a id=__codelineno-34-68 name=__codelineno-34-68 href=#__codelineno-34-68></a><span class=w>          </span><span class=nt>from</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">model-training.model</span>
</span><span id=__span-34-69><a id=__codelineno-34-69 name=__codelineno-34-69 href=#__codelineno-34-69></a><span class=w>      </span><span class=nt>deployment</span><span class=p>:</span>
</span><span id=__span-34-70><a id=__codelineno-34-70 name=__codelineno-34-70 href=#__codelineno-34-70></a><span class=w>        </span><span class=nt>strategy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">blue-green</span>
</span><span id=__span-34-71><a id=__codelineno-34-71 name=__codelineno-34-71 href=#__codelineno-34-71></a><span class=w>        </span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span></code></pre></div> <h4 id=benefits-of-declarative-mlops><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#benefits-of-declarative-mlops>Benefits of Declarative MLOps</a></h4> <ol> <li><strong>Reproducibility</strong>: The same declaration always produces the same pipeline</li> <li><strong>Version control</strong>: Pipeline definitions can be versioned and reviewed</li> <li><strong>Auditability</strong>: Clear record of what was intended vs. what actually happened</li> <li><strong>Portability</strong>: Pipelines can run on different infrastructure without modification</li> </ol> <h4 id=implementation-challenges><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#implementation-challenges>Implementation Challenges</a></h4> <p>However, declarative systems also present challenges:</p> <ul> <li><strong>Debugging complexity</strong>: When something goes wrong, it can be harder to understand why</li> <li><strong>Limited flexibility</strong>: Some edge cases require imperative logic</li> <li><strong>Tooling maturity</strong>: Declarative ML tools are still evolving</li> </ul> <h3 id=real-time-ml><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#real-time-ml>Real-Time ML: Challenges and Solutions</a></h3> <p>Real-time machine learning presents unique challenges that many organizations underestimate.</p> <h4 id=the-latency-challenge><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#the-latency-challenge>The Latency Challenge</a></h4> <p>At Firstleaf, our recommendation system needed to serve personalized recommendations with latency under 100ms. This required several architectural decisions:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=k>class</span><span class=w> </span><span class=nc>RealTimeModelServer</span><span class=p>:</span>
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>model_path</span><span class=p>,</span> <span class=n>feature_store_config</span><span class=p>):</span>
</span><span id=__span-35-3><a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a>        <span class=bp>self</span><span class=o>.</span><span class=n>model</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>load_model</span><span class=p>(</span><span class=n>model_path</span><span class=p>)</span>
</span><span id=__span-35-4><a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>feature_store</span> <span class=o>=</span> <span class=n>FeatureStore</span><span class=p>(</span><span class=n>feature_store_config</span><span class=p>)</span>
</span><span id=__span-35-5><a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a>        <span class=bp>self</span><span class=o>.</span><span class=n>cache</span> <span class=o>=</span> <span class=n>RedisCache</span><span class=p>()</span>
</span><span id=__span-35-6><a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span> <span class=o>=</span> <span class=n>MetricsCollector</span><span class=p>()</span>
</span><span id=__span-35-7><a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a>
</span><span id=__span-35-8><a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>predict</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span><span id=__span-35-9><a id=__codelineno-35-9 name=__codelineno-35-9 href=#__codelineno-35-9></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Generate real-time predictions with caching and fallbacks.&quot;&quot;&quot;</span>
</span><span id=__span-35-10><a id=__codelineno-35-10 name=__codelineno-35-10 href=#__codelineno-35-10></a>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span><span id=__span-35-11><a id=__codelineno-35-11 name=__codelineno-35-11 href=#__codelineno-35-11></a>
</span><span id=__span-35-12><a id=__codelineno-35-12 name=__codelineno-35-12 href=#__codelineno-35-12></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-35-13><a id=__codelineno-35-13 name=__codelineno-35-13 href=#__codelineno-35-13></a>            <span class=c1># Check cache first</span>
</span><span id=__span-35-14><a id=__codelineno-35-14 name=__codelineno-35-14 href=#__codelineno-35-14></a>            <span class=n>cache_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;prediction:</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=nb>hash</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>context</span><span class=p>))</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-35-15><a id=__codelineno-35-15 name=__codelineno-35-15 href=#__codelineno-35-15></a>            <span class=n>cached_result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>cache_key</span><span class=p>)</span>
</span><span id=__span-35-16><a id=__codelineno-35-16 name=__codelineno-35-16 href=#__codelineno-35-16></a>            <span class=k>if</span> <span class=n>cached_result</span><span class=p>:</span>
</span><span id=__span-35-17><a id=__codelineno-35-17 name=__codelineno-35-17 href=#__codelineno-35-17></a>                <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>record_cache_hit</span><span class=p>()</span>
</span><span id=__span-35-18><a id=__codelineno-35-18 name=__codelineno-35-18 href=#__codelineno-35-18></a>                <span class=k>return</span> <span class=n>cached_result</span>
</span><span id=__span-35-19><a id=__codelineno-35-19 name=__codelineno-35-19 href=#__codelineno-35-19></a>
</span><span id=__span-35-20><a id=__codelineno-35-20 name=__codelineno-35-20 href=#__codelineno-35-20></a>            <span class=c1># Fetch features (with timeout)</span>
</span><span id=__span-35-21><a id=__codelineno-35-21 name=__codelineno-35-21 href=#__codelineno-35-21></a>            <span class=n>features</span> <span class=o>=</span> <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>wait_for</span><span class=p>(</span>
</span><span id=__span-35-22><a id=__codelineno-35-22 name=__codelineno-35-22 href=#__codelineno-35-22></a>                <span class=bp>self</span><span class=o>.</span><span class=n>feature_store</span><span class=o>.</span><span class=n>get_user_features</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>context</span><span class=p>),</span>
</span><span id=__span-35-23><a id=__codelineno-35-23 name=__codelineno-35-23 href=#__codelineno-35-23></a>                <span class=n>timeout</span><span class=o>=</span><span class=mf>0.050</span>  <span class=c1># 50ms timeout for feature fetching</span>
</span><span id=__span-35-24><a id=__codelineno-35-24 name=__codelineno-35-24 href=#__codelineno-35-24></a>            <span class=p>)</span>
</span><span id=__span-35-25><a id=__codelineno-35-25 name=__codelineno-35-25 href=#__codelineno-35-25></a>
</span><span id=__span-35-26><a id=__codelineno-35-26 name=__codelineno-35-26 href=#__codelineno-35-26></a>            <span class=c1># Generate prediction</span>
</span><span id=__span-35-27><a id=__codelineno-35-27 name=__codelineno-35-27 href=#__codelineno-35-27></a>            <span class=n>prediction</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>features</span><span class=p>)</span>
</span><span id=__span-35-28><a id=__codelineno-35-28 name=__codelineno-35-28 href=#__codelineno-35-28></a>
</span><span id=__span-35-29><a id=__codelineno-35-29 name=__codelineno-35-29 href=#__codelineno-35-29></a>            <span class=c1># Cache result</span>
</span><span id=__span-35-30><a id=__codelineno-35-30 name=__codelineno-35-30 href=#__codelineno-35-30></a>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=n>cache_key</span><span class=p>,</span> <span class=n>prediction</span><span class=p>,</span> <span class=n>ttl</span><span class=o>=</span><span class=mi>300</span><span class=p>)</span>  <span class=c1># 5 min TTL</span>
</span><span id=__span-35-31><a id=__codelineno-35-31 name=__codelineno-35-31 href=#__codelineno-35-31></a>
</span><span id=__span-35-32><a id=__codelineno-35-32 name=__codelineno-35-32 href=#__codelineno-35-32></a>            <span class=c1># Record metrics</span>
</span><span id=__span-35-33><a id=__codelineno-35-33 name=__codelineno-35-33 href=#__codelineno-35-33></a>            <span class=n>latency</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span>
</span><span id=__span-35-34><a id=__codelineno-35-34 name=__codelineno-35-34 href=#__codelineno-35-34></a>            <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>record_prediction_latency</span><span class=p>(</span><span class=n>latency</span><span class=p>)</span>
</span><span id=__span-35-35><a id=__codelineno-35-35 name=__codelineno-35-35 href=#__codelineno-35-35></a>
</span><span id=__span-35-36><a id=__codelineno-35-36 name=__codelineno-35-36 href=#__codelineno-35-36></a>            <span class=k>return</span> <span class=n>prediction</span>
</span><span id=__span-35-37><a id=__codelineno-35-37 name=__codelineno-35-37 href=#__codelineno-35-37></a>
</span><span id=__span-35-38><a id=__codelineno-35-38 name=__codelineno-35-38 href=#__codelineno-35-38></a>        <span class=k>except</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>TimeoutError</span><span class=p>:</span>
</span><span id=__span-35-39><a id=__codelineno-35-39 name=__codelineno-35-39 href=#__codelineno-35-39></a>            <span class=c1># Feature fetching timeout - return fallback</span>
</span><span id=__span-35-40><a id=__codelineno-35-40 name=__codelineno-35-40 href=#__codelineno-35-40></a>            <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>record_fallback_used</span><span class=p>(</span><span class=s2>&quot;feature_timeout&quot;</span><span class=p>)</span>
</span><span id=__span-35-41><a id=__codelineno-35-41 name=__codelineno-35-41 href=#__codelineno-35-41></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_fallback_prediction</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>context</span><span class=p>)</span>
</span><span id=__span-35-42><a id=__codelineno-35-42 name=__codelineno-35-42 href=#__codelineno-35-42></a>
</span><span id=__span-35-43><a id=__codelineno-35-43 name=__codelineno-35-43 href=#__codelineno-35-43></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-35-44><a id=__codelineno-35-44 name=__codelineno-35-44 href=#__codelineno-35-44></a>            <span class=c1># Model prediction error - return fallback</span>
</span><span id=__span-35-45><a id=__codelineno-35-45 name=__codelineno-35-45 href=#__codelineno-35-45></a>            <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>record_error</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span><span id=__span-35-46><a id=__codelineno-35-46 name=__codelineno-35-46 href=#__codelineno-35-46></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_fallback_prediction</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>context</span><span class=p>)</span>
</span><span id=__span-35-47><a id=__codelineno-35-47 name=__codelineno-35-47 href=#__codelineno-35-47></a>
</span><span id=__span-35-48><a id=__codelineno-35-48 name=__codelineno-35-48 href=#__codelineno-35-48></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_fallback_prediction</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span><span id=__span-35-49><a id=__codelineno-35-49 name=__codelineno-35-49 href=#__codelineno-35-49></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Return a safe fallback prediction.&quot;&quot;&quot;</span>
</span><span id=__span-35-50><a id=__codelineno-35-50 name=__codelineno-35-50 href=#__codelineno-35-50></a>        <span class=c1># Use simple heuristics or popular items</span>
</span><span id=__span-35-51><a id=__codelineno-35-51 name=__codelineno-35-51 href=#__codelineno-35-51></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>popular_items_cache</span><span class=o>.</span><span class=n>get_popular_for_user_segment</span><span class=p>(</span>
</span><span id=__span-35-52><a id=__codelineno-35-52 name=__codelineno-35-52 href=#__codelineno-35-52></a>            <span class=bp>self</span><span class=o>.</span><span class=n>get_user_segment</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span><span id=__span-35-53><a id=__codelineno-35-53 name=__codelineno-35-53 href=#__codelineno-35-53></a>        <span class=p>)</span>
</span></code></pre></div> <h4 id=feature-stores-for-real-time-ml><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#feature-stores-for-real-time-ml>Feature Stores for Real-Time ML</a></h4> <p>One of the biggest challenges in real-time ML is ensuring that the features used in training are the same as those used in inference. Feature stores help solve this problem:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=k>class</span><span class=w> </span><span class=nc>ProductionFeatureStore</span><span class=p>:</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>):</span>
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a>        <span class=bp>self</span><span class=o>.</span><span class=n>offline_store</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;offline_store&#39;</span><span class=p>]</span>  <span class=c1># For training</span>
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>online_store</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;online_store&#39;</span><span class=p>]</span>    <span class=c1># For serving</span>
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a>        <span class=bp>self</span><span class=o>.</span><span class=n>feature_definitions</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;features&#39;</span><span class=p>]</span>
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a>
</span><span id=__span-36-7><a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>get_user_features</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span><span id=__span-36-8><a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get real-time features for a user.&quot;&quot;&quot;</span>
</span><span id=__span-36-9><a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a>        <span class=n>features</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-36-10><a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a>
</span><span id=__span-36-11><a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a>        <span class=c1># Get static user features (cached)</span>
</span><span id=__span-36-12><a id=__codelineno-36-12 name=__codelineno-36-12 href=#__codelineno-36-12></a>        <span class=n>user_profile</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>online_store</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;user:</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-36-13><a id=__codelineno-36-13 name=__codelineno-36-13 href=#__codelineno-36-13></a>        <span class=k>if</span> <span class=n>user_profile</span><span class=p>:</span>
</span><span id=__span-36-14><a id=__codelineno-36-14 name=__codelineno-36-14 href=#__codelineno-36-14></a>            <span class=n>features</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>user_profile</span><span class=p>)</span>
</span><span id=__span-36-15><a id=__codelineno-36-15 name=__codelineno-36-15 href=#__codelineno-36-15></a>
</span><span id=__span-36-16><a id=__codelineno-36-16 name=__codelineno-36-16 href=#__codelineno-36-16></a>        <span class=c1># Get dynamic context features</span>
</span><span id=__span-36-17><a id=__codelineno-36-17 name=__codelineno-36-17 href=#__codelineno-36-17></a>        <span class=k>if</span> <span class=n>context</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;timestamp&#39;</span><span class=p>):</span>
</span><span id=__span-36-18><a id=__codelineno-36-18 name=__codelineno-36-18 href=#__codelineno-36-18></a>            <span class=n>features</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>get_temporal_features</span><span class=p>(</span><span class=n>context</span><span class=p>[</span><span class=s1>&#39;timestamp&#39;</span><span class=p>]))</span>
</span><span id=__span-36-19><a id=__codelineno-36-19 name=__codelineno-36-19 href=#__codelineno-36-19></a>
</span><span id=__span-36-20><a id=__codelineno-36-20 name=__codelineno-36-20 href=#__codelineno-36-20></a>        <span class=k>if</span> <span class=n>context</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;location&#39;</span><span class=p>):</span>
</span><span id=__span-36-21><a id=__codelineno-36-21 name=__codelineno-36-21 href=#__codelineno-36-21></a>            <span class=n>features</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>get_location_features</span><span class=p>(</span><span class=n>context</span><span class=p>[</span><span class=s1>&#39;location&#39;</span><span class=p>]))</span>
</span><span id=__span-36-22><a id=__codelineno-36-22 name=__codelineno-36-22 href=#__codelineno-36-22></a>
</span><span id=__span-36-23><a id=__codelineno-36-23 name=__codelineno-36-23 href=#__codelineno-36-23></a>        <span class=c1># Get real-time computed features</span>
</span><span id=__span-36-24><a id=__codelineno-36-24 name=__codelineno-36-24 href=#__codelineno-36-24></a>        <span class=n>recent_behavior</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_recent_user_behavior</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span><span id=__span-36-25><a id=__codelineno-36-25 name=__codelineno-36-25 href=#__codelineno-36-25></a>        <span class=n>features</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>compute_behavior_features</span><span class=p>(</span><span class=n>recent_behavior</span><span class=p>))</span>
</span><span id=__span-36-26><a id=__codelineno-36-26 name=__codelineno-36-26 href=#__codelineno-36-26></a>
</span><span id=__span-36-27><a id=__codelineno-36-27 name=__codelineno-36-27 href=#__codelineno-36-27></a>        <span class=k>return</span> <span class=n>features</span>
</span><span id=__span-36-28><a id=__codelineno-36-28 name=__codelineno-36-28 href=#__codelineno-36-28></a>
</span><span id=__span-36-29><a id=__codelineno-36-29 name=__codelineno-36-29 href=#__codelineno-36-29></a>    <span class=k>def</span><span class=w> </span><span class=nf>compute_behavior_features</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>recent_behavior</span><span class=p>):</span>
</span><span id=__span-36-30><a id=__codelineno-36-30 name=__codelineno-36-30 href=#__codelineno-36-30></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Compute features from recent user behavior.&quot;&quot;&quot;</span>
</span><span id=__span-36-31><a id=__codelineno-36-31 name=__codelineno-36-31 href=#__codelineno-36-31></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>recent_behavior</span><span class=p>:</span>
</span><span id=__span-36-32><a id=__codelineno-36-32 name=__codelineno-36-32 href=#__codelineno-36-32></a>            <span class=k>return</span> <span class=p>{}</span>
</span><span id=__span-36-33><a id=__codelineno-36-33 name=__codelineno-36-33 href=#__codelineno-36-33></a>
</span><span id=__span-36-34><a id=__codelineno-36-34 name=__codelineno-36-34 href=#__codelineno-36-34></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-36-35><a id=__codelineno-36-35 name=__codelineno-36-35 href=#__codelineno-36-35></a>            <span class=s1>&#39;recent_click_count&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>recent_behavior</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;clicks&#39;</span><span class=p>,</span> <span class=p>[])),</span>
</span><span id=__span-36-36><a id=__codelineno-36-36 name=__codelineno-36-36 href=#__codelineno-36-36></a>            <span class=s1>&#39;recent_purchase_count&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>recent_behavior</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;purchases&#39;</span><span class=p>,</span> <span class=p>[])),</span>
</span><span id=__span-36-37><a id=__codelineno-36-37 name=__codelineno-36-37 href=#__codelineno-36-37></a>            <span class=s1>&#39;avg_session_duration&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>([</span>
</span><span id=__span-36-38><a id=__codelineno-36-38 name=__codelineno-36-38 href=#__codelineno-36-38></a>                <span class=n>s</span><span class=p>[</span><span class=s1>&#39;duration&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=n>recent_behavior</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;sessions&#39;</span><span class=p>,</span> <span class=p>[])</span>
</span><span id=__span-36-39><a id=__codelineno-36-39 name=__codelineno-36-39 href=#__codelineno-36-39></a>            <span class=p>])</span> <span class=k>if</span> <span class=n>recent_behavior</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;sessions&#39;</span><span class=p>)</span> <span class=k>else</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-36-40><a id=__codelineno-36-40 name=__codelineno-36-40 href=#__codelineno-36-40></a>            <span class=s1>&#39;time_since_last_action&#39;</span><span class=p>:</span> <span class=p>(</span>
</span><span id=__span-36-41><a id=__codelineno-36-41 name=__codelineno-36-41 href=#__codelineno-36-41></a>                <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>recent_behavior</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;last_action_time&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span><span id=__span-36-42><a id=__codelineno-36-42 name=__codelineno-36-42 href=#__codelineno-36-42></a>            <span class=p>)</span> <span class=k>if</span> <span class=n>recent_behavior</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;last_action_time&#39;</span><span class=p>)</span> <span class=k>else</span> <span class=nb>float</span><span class=p>(</span><span class=s1>&#39;inf&#39;</span><span class=p>)</span>
</span><span id=__span-36-43><a id=__codelineno-36-43 name=__codelineno-36-43 href=#__codelineno-36-43></a>        <span class=p>}</span>
</span></code></pre></div> <h4 id=monitoring-real-time-systems><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#monitoring-real-time-systems>Monitoring Real-Time Systems</a></h4> <p>Real-time ML systems require specialized monitoring:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=k>class</span><span class=w> </span><span class=nc>RealTimeMonitor</span><span class=p>:</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-37-3><a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics_buffer</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-37-4><a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>alert_rules</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-37-5><a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a>
</span><span id=__span-37-6><a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a>    <span class=k>def</span><span class=w> </span><span class=nf>record_prediction_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>prediction_data</span><span class=p>):</span>
</span><span id=__span-37-7><a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Record metrics for a single prediction.&quot;&quot;&quot;</span>
</span><span id=__span-37-8><a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a>        <span class=n>metrics</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-37-9><a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>(),</span>
</span><span id=__span-37-10><a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a>            <span class=s1>&#39;user_id&#39;</span><span class=p>:</span> <span class=n>prediction_data</span><span class=p>[</span><span class=s1>&#39;user_id&#39;</span><span class=p>],</span>
</span><span id=__span-37-11><a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a>            <span class=s1>&#39;latency&#39;</span><span class=p>:</span> <span class=n>prediction_data</span><span class=p>[</span><span class=s1>&#39;latency&#39;</span><span class=p>],</span>
</span><span id=__span-37-12><a id=__codelineno-37-12 name=__codelineno-37-12 href=#__codelineno-37-12></a>            <span class=s1>&#39;cache_hit&#39;</span><span class=p>:</span> <span class=n>prediction_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;cache_hit&#39;</span><span class=p>,</span> <span class=kc>False</span><span class=p>),</span>
</span><span id=__span-37-13><a id=__codelineno-37-13 name=__codelineno-37-13 href=#__codelineno-37-13></a>            <span class=s1>&#39;fallback_used&#39;</span><span class=p>:</span> <span class=n>prediction_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;fallback_used&#39;</span><span class=p>,</span> <span class=kc>False</span><span class=p>),</span>
</span><span id=__span-37-14><a id=__codelineno-37-14 name=__codelineno-37-14 href=#__codelineno-37-14></a>            <span class=s1>&#39;feature_fetch_time&#39;</span><span class=p>:</span> <span class=n>prediction_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;feature_fetch_time&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
</span><span id=__span-37-15><a id=__codelineno-37-15 name=__codelineno-37-15 href=#__codelineno-37-15></a>            <span class=s1>&#39;model_inference_time&#39;</span><span class=p>:</span> <span class=n>prediction_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;model_inference_time&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span><span id=__span-37-16><a id=__codelineno-37-16 name=__codelineno-37-16 href=#__codelineno-37-16></a>        <span class=p>}</span>
</span><span id=__span-37-17><a id=__codelineno-37-17 name=__codelineno-37-17 href=#__codelineno-37-17></a>
</span><span id=__span-37-18><a id=__codelineno-37-18 name=__codelineno-37-18 href=#__codelineno-37-18></a>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics_buffer</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>metrics</span><span class=p>)</span>
</span><span id=__span-37-19><a id=__codelineno-37-19 name=__codelineno-37-19 href=#__codelineno-37-19></a>
</span><span id=__span-37-20><a id=__codelineno-37-20 name=__codelineno-37-20 href=#__codelineno-37-20></a>        <span class=c1># Check for immediate alerts</span>
</span><span id=__span-37-21><a id=__codelineno-37-21 name=__codelineno-37-21 href=#__codelineno-37-21></a>        <span class=k>if</span> <span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;latency&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mf>0.200</span><span class=p>:</span>  <span class=c1># 200ms threshold</span>
</span><span id=__span-37-22><a id=__codelineno-37-22 name=__codelineno-37-22 href=#__codelineno-37-22></a>            <span class=bp>self</span><span class=o>.</span><span class=n>trigger_alert</span><span class=p>(</span><span class=s1>&#39;high_latency&#39;</span><span class=p>,</span> <span class=n>metrics</span><span class=p>)</span>
</span><span id=__span-37-23><a id=__codelineno-37-23 name=__codelineno-37-23 href=#__codelineno-37-23></a>
</span><span id=__span-37-24><a id=__codelineno-37-24 name=__codelineno-37-24 href=#__codelineno-37-24></a>        <span class=k>if</span> <span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;fallback_used&#39;</span><span class=p>]:</span>
</span><span id=__span-37-25><a id=__codelineno-37-25 name=__codelineno-37-25 href=#__codelineno-37-25></a>            <span class=bp>self</span><span class=o>.</span><span class=n>trigger_alert</span><span class=p>(</span><span class=s1>&#39;fallback_used&#39;</span><span class=p>,</span> <span class=n>metrics</span><span class=p>)</span>
</span><span id=__span-37-26><a id=__codelineno-37-26 name=__codelineno-37-26 href=#__codelineno-37-26></a>
</span><span id=__span-37-27><a id=__codelineno-37-27 name=__codelineno-37-27 href=#__codelineno-37-27></a>    <span class=k>def</span><span class=w> </span><span class=nf>calculate_real_time_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>window_seconds</span><span class=o>=</span><span class=mi>60</span><span class=p>):</span>
</span><span id=__span-37-28><a id=__codelineno-37-28 name=__codelineno-37-28 href=#__codelineno-37-28></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Calculate metrics over a rolling time window.&quot;&quot;&quot;</span>
</span><span id=__span-37-29><a id=__codelineno-37-29 name=__codelineno-37-29 href=#__codelineno-37-29></a>        <span class=n>current_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span><span id=__span-37-30><a id=__codelineno-37-30 name=__codelineno-37-30 href=#__codelineno-37-30></a>        <span class=n>window_start</span> <span class=o>=</span> <span class=n>current_time</span> <span class=o>-</span> <span class=n>window_seconds</span>
</span><span id=__span-37-31><a id=__codelineno-37-31 name=__codelineno-37-31 href=#__codelineno-37-31></a>
</span><span id=__span-37-32><a id=__codelineno-37-32 name=__codelineno-37-32 href=#__codelineno-37-32></a>        <span class=n>window_metrics</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-37-33><a id=__codelineno-37-33 name=__codelineno-37-33 href=#__codelineno-37-33></a>            <span class=n>m</span> <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics_buffer</span>
</span><span id=__span-37-34><a id=__codelineno-37-34 name=__codelineno-37-34 href=#__codelineno-37-34></a>            <span class=k>if</span> <span class=n>m</span><span class=p>[</span><span class=s1>&#39;timestamp&#39;</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=n>window_start</span>
</span><span id=__span-37-35><a id=__codelineno-37-35 name=__codelineno-37-35 href=#__codelineno-37-35></a>        <span class=p>]</span>
</span><span id=__span-37-36><a id=__codelineno-37-36 name=__codelineno-37-36 href=#__codelineno-37-36></a>
</span><span id=__span-37-37><a id=__codelineno-37-37 name=__codelineno-37-37 href=#__codelineno-37-37></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>window_metrics</span><span class=p>:</span>
</span><span id=__span-37-38><a id=__codelineno-37-38 name=__codelineno-37-38 href=#__codelineno-37-38></a>            <span class=k>return</span> <span class=p>{}</span>
</span><span id=__span-37-39><a id=__codelineno-37-39 name=__codelineno-37-39 href=#__codelineno-37-39></a>
</span><span id=__span-37-40><a id=__codelineno-37-40 name=__codelineno-37-40 href=#__codelineno-37-40></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-37-41><a id=__codelineno-37-41 name=__codelineno-37-41 href=#__codelineno-37-41></a>            <span class=s1>&#39;request_count&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>window_metrics</span><span class=p>),</span>
</span><span id=__span-37-42><a id=__codelineno-37-42 name=__codelineno-37-42 href=#__codelineno-37-42></a>            <span class=s1>&#39;avg_latency&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>([</span><span class=n>m</span><span class=p>[</span><span class=s1>&#39;latency&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>window_metrics</span><span class=p>]),</span>
</span><span id=__span-37-43><a id=__codelineno-37-43 name=__codelineno-37-43 href=#__codelineno-37-43></a>            <span class=s1>&#39;p95_latency&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>percentile</span><span class=p>([</span><span class=n>m</span><span class=p>[</span><span class=s1>&#39;latency&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>window_metrics</span><span class=p>],</span> <span class=mi>95</span><span class=p>),</span>
</span><span id=__span-37-44><a id=__codelineno-37-44 name=__codelineno-37-44 href=#__codelineno-37-44></a>            <span class=s1>&#39;cache_hit_rate&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>([</span><span class=n>m</span><span class=p>[</span><span class=s1>&#39;cache_hit&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>window_metrics</span><span class=p>]),</span>
</span><span id=__span-37-45><a id=__codelineno-37-45 name=__codelineno-37-45 href=#__codelineno-37-45></a>            <span class=s1>&#39;fallback_rate&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>([</span><span class=n>m</span><span class=p>[</span><span class=s1>&#39;fallback_used&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>window_metrics</span><span class=p>]),</span>
</span><span id=__span-37-46><a id=__codelineno-37-46 name=__codelineno-37-46 href=#__codelineno-37-46></a>            <span class=s1>&#39;error_rate&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>([</span><span class=n>m</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span> <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>window_metrics</span><span class=p>])</span>
</span><span id=__span-37-47><a id=__codelineno-37-47 name=__codelineno-37-47 href=#__codelineno-37-47></a>        <span class=p>}</span>
</span></code></pre></div> <h3 id=data-management><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#data-management>Data Management in Production ML</a></h3> <p>Data management is often the most underestimated aspect of MLOps. Poor data management can undermine even the best ML models.</p> <h4 id=data-versioning-and-lineage><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#data-versioning-and-lineage>Data Versioning and Lineage</a></h4> <p>One of the critical challenges we faced at Firstleaf was ensuring reproducibility of model training. This required comprehensive data versioning:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=k>class</span><span class=w> </span><span class=nc>DataVersionManager</span><span class=p>:</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>storage_backend</span><span class=p>,</span> <span class=n>metadata_store</span><span class=p>):</span>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a>        <span class=bp>self</span><span class=o>.</span><span class=n>storage</span> <span class=o>=</span> <span class=n>storage_backend</span>
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>metadata</span> <span class=o>=</span> <span class=n>metadata_store</span>
</span><span id=__span-38-5><a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a>
</span><span id=__span-38-6><a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a>    <span class=k>def</span><span class=w> </span><span class=nf>create_dataset_version</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>dataset_name</span><span class=p>,</span> <span class=n>data_sources</span><span class=p>,</span> <span class=n>transformations</span><span class=p>):</span>
</span><span id=__span-38-7><a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create a new version of a dataset.&quot;&quot;&quot;</span>
</span><span id=__span-38-8><a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a>        <span class=n>version_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_version_id</span><span class=p>()</span>
</span><span id=__span-38-9><a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a>
</span><span id=__span-38-10><a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a>        <span class=c1># Apply transformations and store data</span>
</span><span id=__span-38-11><a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a>        <span class=n>processed_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>apply_transformations</span><span class=p>(</span><span class=n>data_sources</span><span class=p>,</span> <span class=n>transformations</span><span class=p>)</span>
</span><span id=__span-38-12><a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a>        <span class=n>data_path</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;datasets/</span><span class=si>{</span><span class=n>dataset_name</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>version_id</span><span class=si>}</span><span class=s2>/&quot;</span>
</span><span id=__span-38-13><a id=__codelineno-38-13 name=__codelineno-38-13 href=#__codelineno-38-13></a>        <span class=bp>self</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>processed_data</span><span class=p>,</span> <span class=n>data_path</span><span class=p>)</span>
</span><span id=__span-38-14><a id=__codelineno-38-14 name=__codelineno-38-14 href=#__codelineno-38-14></a>
</span><span id=__span-38-15><a id=__codelineno-38-15 name=__codelineno-38-15 href=#__codelineno-38-15></a>        <span class=c1># Store metadata</span>
</span><span id=__span-38-16><a id=__codelineno-38-16 name=__codelineno-38-16 href=#__codelineno-38-16></a>        <span class=n>metadata</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-38-17><a id=__codelineno-38-17 name=__codelineno-38-17 href=#__codelineno-38-17></a>            <span class=s1>&#39;version_id&#39;</span><span class=p>:</span> <span class=n>version_id</span><span class=p>,</span>
</span><span id=__span-38-18><a id=__codelineno-38-18 name=__codelineno-38-18 href=#__codelineno-38-18></a>            <span class=s1>&#39;dataset_name&#39;</span><span class=p>:</span> <span class=n>dataset_name</span><span class=p>,</span>
</span><span id=__span-38-19><a id=__codelineno-38-19 name=__codelineno-38-19 href=#__codelineno-38-19></a>            <span class=s1>&#39;created_at&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span><span id=__span-38-20><a id=__codelineno-38-20 name=__codelineno-38-20 href=#__codelineno-38-20></a>            <span class=s1>&#39;data_sources&#39;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-38-21><a id=__codelineno-38-21 name=__codelineno-38-21 href=#__codelineno-38-21></a>                <span class=p>{</span>
</span><span id=__span-38-22><a id=__codelineno-38-22 name=__codelineno-38-22 href=#__codelineno-38-22></a>                    <span class=s1>&#39;source&#39;</span><span class=p>:</span> <span class=n>source</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>],</span>
</span><span id=__span-38-23><a id=__codelineno-38-23 name=__codelineno-38-23 href=#__codelineno-38-23></a>                    <span class=s1>&#39;version&#39;</span><span class=p>:</span> <span class=n>source</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;version&#39;</span><span class=p>),</span>
</span><span id=__span-38-24><a id=__codelineno-38-24 name=__codelineno-38-24 href=#__codelineno-38-24></a>                    <span class=s1>&#39;checksum&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_checksum</span><span class=p>(</span><span class=n>source</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>])</span>
</span><span id=__span-38-25><a id=__codelineno-38-25 name=__codelineno-38-25 href=#__codelineno-38-25></a>                <span class=p>}</span>
</span><span id=__span-38-26><a id=__codelineno-38-26 name=__codelineno-38-26 href=#__codelineno-38-26></a>                <span class=k>for</span> <span class=n>source</span> <span class=ow>in</span> <span class=n>data_sources</span>
</span><span id=__span-38-27><a id=__codelineno-38-27 name=__codelineno-38-27 href=#__codelineno-38-27></a>            <span class=p>],</span>
</span><span id=__span-38-28><a id=__codelineno-38-28 name=__codelineno-38-28 href=#__codelineno-38-28></a>            <span class=s1>&#39;transformations&#39;</span><span class=p>:</span> <span class=n>transformations</span><span class=p>,</span>
</span><span id=__span-38-29><a id=__codelineno-38-29 name=__codelineno-38-29 href=#__codelineno-38-29></a>            <span class=s1>&#39;schema&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>infer_schema</span><span class=p>(</span><span class=n>processed_data</span><span class=p>),</span>
</span><span id=__span-38-30><a id=__codelineno-38-30 name=__codelineno-38-30 href=#__codelineno-38-30></a>            <span class=s1>&#39;statistics&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_statistics</span><span class=p>(</span><span class=n>processed_data</span><span class=p>),</span>
</span><span id=__span-38-31><a id=__codelineno-38-31 name=__codelineno-38-31 href=#__codelineno-38-31></a>            <span class=s1>&#39;lineage&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>build_lineage_graph</span><span class=p>(</span><span class=n>data_sources</span><span class=p>,</span> <span class=n>transformations</span><span class=p>)</span>
</span><span id=__span-38-32><a id=__codelineno-38-32 name=__codelineno-38-32 href=#__codelineno-38-32></a>        <span class=p>}</span>
</span><span id=__span-38-33><a id=__codelineno-38-33 name=__codelineno-38-33 href=#__codelineno-38-33></a>
</span><span id=__span-38-34><a id=__codelineno-38-34 name=__codelineno-38-34 href=#__codelineno-38-34></a>        <span class=bp>self</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>save_dataset_version</span><span class=p>(</span><span class=n>metadata</span><span class=p>)</span>
</span><span id=__span-38-35><a id=__codelineno-38-35 name=__codelineno-38-35 href=#__codelineno-38-35></a>        <span class=k>return</span> <span class=n>version_id</span>
</span><span id=__span-38-36><a id=__codelineno-38-36 name=__codelineno-38-36 href=#__codelineno-38-36></a>
</span><span id=__span-38-37><a id=__codelineno-38-37 name=__codelineno-38-37 href=#__codelineno-38-37></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_dataset_lineage</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>dataset_name</span><span class=p>,</span> <span class=n>version_id</span><span class=p>):</span>
</span><span id=__span-38-38><a id=__codelineno-38-38 name=__codelineno-38-38 href=#__codelineno-38-38></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get the complete lineage for a dataset version.&quot;&quot;&quot;</span>
</span><span id=__span-38-39><a id=__codelineno-38-39 name=__codelineno-38-39 href=#__codelineno-38-39></a>        <span class=n>metadata</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>get_dataset_version</span><span class=p>(</span><span class=n>dataset_name</span><span class=p>,</span> <span class=n>version_id</span><span class=p>)</span>
</span><span id=__span-38-40><a id=__codelineno-38-40 name=__codelineno-38-40 href=#__codelineno-38-40></a>
</span><span id=__span-38-41><a id=__codelineno-38-41 name=__codelineno-38-41 href=#__codelineno-38-41></a>        <span class=n>lineage_graph</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-38-42><a id=__codelineno-38-42 name=__codelineno-38-42 href=#__codelineno-38-42></a>            <span class=s1>&#39;dataset&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-38-43><a id=__codelineno-38-43 name=__codelineno-38-43 href=#__codelineno-38-43></a>                <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=n>dataset_name</span><span class=p>,</span>
</span><span id=__span-38-44><a id=__codelineno-38-44 name=__codelineno-38-44 href=#__codelineno-38-44></a>                <span class=s1>&#39;version&#39;</span><span class=p>:</span> <span class=n>version_id</span>
</span><span id=__span-38-45><a id=__codelineno-38-45 name=__codelineno-38-45 href=#__codelineno-38-45></a>            <span class=p>},</span>
</span><span id=__span-38-46><a id=__codelineno-38-46 name=__codelineno-38-46 href=#__codelineno-38-46></a>            <span class=s1>&#39;sources&#39;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-38-47><a id=__codelineno-38-47 name=__codelineno-38-47 href=#__codelineno-38-47></a>            <span class=s1>&#39;transformations&#39;</span><span class=p>:</span> <span class=n>metadata</span><span class=p>[</span><span class=s1>&#39;transformations&#39;</span><span class=p>]</span>
</span><span id=__span-38-48><a id=__codelineno-38-48 name=__codelineno-38-48 href=#__codelineno-38-48></a>        <span class=p>}</span>
</span><span id=__span-38-49><a id=__codelineno-38-49 name=__codelineno-38-49 href=#__codelineno-38-49></a>
</span><span id=__span-38-50><a id=__codelineno-38-50 name=__codelineno-38-50 href=#__codelineno-38-50></a>        <span class=k>for</span> <span class=n>source</span> <span class=ow>in</span> <span class=n>metadata</span><span class=p>[</span><span class=s1>&#39;data_sources&#39;</span><span class=p>]:</span>
</span><span id=__span-38-51><a id=__codelineno-38-51 name=__codelineno-38-51 href=#__codelineno-38-51></a>            <span class=n>source_lineage</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-38-52><a id=__codelineno-38-52 name=__codelineno-38-52 href=#__codelineno-38-52></a>                <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=n>source</span><span class=p>[</span><span class=s1>&#39;source&#39;</span><span class=p>],</span>
</span><span id=__span-38-53><a id=__codelineno-38-53 name=__codelineno-38-53 href=#__codelineno-38-53></a>                <span class=s1>&#39;version&#39;</span><span class=p>:</span> <span class=n>source</span><span class=p>[</span><span class=s1>&#39;version&#39;</span><span class=p>],</span>
</span><span id=__span-38-54><a id=__codelineno-38-54 name=__codelineno-38-54 href=#__codelineno-38-54></a>                <span class=s1>&#39;checksum&#39;</span><span class=p>:</span> <span class=n>source</span><span class=p>[</span><span class=s1>&#39;checksum&#39;</span><span class=p>]</span>
</span><span id=__span-38-55><a id=__codelineno-38-55 name=__codelineno-38-55 href=#__codelineno-38-55></a>            <span class=p>}</span>
</span><span id=__span-38-56><a id=__codelineno-38-56 name=__codelineno-38-56 href=#__codelineno-38-56></a>
</span><span id=__span-38-57><a id=__codelineno-38-57 name=__codelineno-38-57 href=#__codelineno-38-57></a>            <span class=c1># Recursively get source lineage if it&#39;s a derived dataset</span>
</span><span id=__span-38-58><a id=__codelineno-38-58 name=__codelineno-38-58 href=#__codelineno-38-58></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_derived_dataset</span><span class=p>(</span><span class=n>source</span><span class=p>[</span><span class=s1>&#39;source&#39;</span><span class=p>]):</span>
</span><span id=__span-38-59><a id=__codelineno-38-59 name=__codelineno-38-59 href=#__codelineno-38-59></a>                <span class=n>source_lineage</span><span class=p>[</span><span class=s1>&#39;upstream&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_dataset_lineage</span><span class=p>(</span>
</span><span id=__span-38-60><a id=__codelineno-38-60 name=__codelineno-38-60 href=#__codelineno-38-60></a>                    <span class=n>source</span><span class=p>[</span><span class=s1>&#39;source&#39;</span><span class=p>],</span> <span class=n>source</span><span class=p>[</span><span class=s1>&#39;version&#39;</span><span class=p>]</span>
</span><span id=__span-38-61><a id=__codelineno-38-61 name=__codelineno-38-61 href=#__codelineno-38-61></a>                <span class=p>)</span>
</span><span id=__span-38-62><a id=__codelineno-38-62 name=__codelineno-38-62 href=#__codelineno-38-62></a>
</span><span id=__span-38-63><a id=__codelineno-38-63 name=__codelineno-38-63 href=#__codelineno-38-63></a>            <span class=n>lineage_graph</span><span class=p>[</span><span class=s1>&#39;sources&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>source_lineage</span><span class=p>)</span>
</span><span id=__span-38-64><a id=__codelineno-38-64 name=__codelineno-38-64 href=#__codelineno-38-64></a>
</span><span id=__span-38-65><a id=__codelineno-38-65 name=__codelineno-38-65 href=#__codelineno-38-65></a>        <span class=k>return</span> <span class=n>lineage_graph</span>
</span></code></pre></div> <h4 id=data-quality-monitoring><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#data-quality-monitoring>Data Quality Monitoring</a></h4> <p>Automated data quality monitoring is essential for production ML systems:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=k>class</span><span class=w> </span><span class=nc>DataQualityMonitor</span><span class=p>:</span>
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>schema_config</span><span class=p>,</span> <span class=n>quality_rules</span><span class=p>):</span>
</span><span id=__span-39-3><a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a>        <span class=bp>self</span><span class=o>.</span><span class=n>schema</span> <span class=o>=</span> <span class=n>schema_config</span>
</span><span id=__span-39-4><a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>quality_rules</span> <span class=o>=</span> <span class=n>quality_rules</span>
</span><span id=__span-39-5><a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a>        <span class=bp>self</span><span class=o>.</span><span class=n>baseline_stats</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-39-6><a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a>
</span><span id=__span-39-7><a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a>    <span class=k>def</span><span class=w> </span><span class=nf>validate_data_batch</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data_batch</span><span class=p>,</span> <span class=n>dataset_name</span><span class=p>):</span>
</span><span id=__span-39-8><a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Validate a batch of incoming data.&quot;&quot;&quot;</span>
</span><span id=__span-39-9><a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a>        <span class=n>validation_results</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-39-10><a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a>            <span class=s1>&#39;batch_id&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_batch_id</span><span class=p>(),</span>
</span><span id=__span-39-11><a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a>            <span class=s1>&#39;dataset_name&#39;</span><span class=p>:</span> <span class=n>dataset_name</span><span class=p>,</span>
</span><span id=__span-39-12><a id=__codelineno-39-12 name=__codelineno-39-12 href=#__codelineno-39-12></a>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span><span id=__span-39-13><a id=__codelineno-39-13 name=__codelineno-39-13 href=#__codelineno-39-13></a>            <span class=s1>&#39;record_count&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>data_batch</span><span class=p>),</span>
</span><span id=__span-39-14><a id=__codelineno-39-14 name=__codelineno-39-14 href=#__codelineno-39-14></a>            <span class=s1>&#39;schema_violations&#39;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-39-15><a id=__codelineno-39-15 name=__codelineno-39-15 href=#__codelineno-39-15></a>            <span class=s1>&#39;quality_violations&#39;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-39-16><a id=__codelineno-39-16 name=__codelineno-39-16 href=#__codelineno-39-16></a>            <span class=s1>&#39;statistics&#39;</span><span class=p>:</span> <span class=p>{}</span>
</span><span id=__span-39-17><a id=__codelineno-39-17 name=__codelineno-39-17 href=#__codelineno-39-17></a>        <span class=p>}</span>
</span><span id=__span-39-18><a id=__codelineno-39-18 name=__codelineno-39-18 href=#__codelineno-39-18></a>
</span><span id=__span-39-19><a id=__codelineno-39-19 name=__codelineno-39-19 href=#__codelineno-39-19></a>        <span class=c1># Schema validation</span>
</span><span id=__span-39-20><a id=__codelineno-39-20 name=__codelineno-39-20 href=#__codelineno-39-20></a>        <span class=n>schema_violations</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>validate_schema</span><span class=p>(</span><span class=n>data_batch</span><span class=p>)</span>
</span><span id=__span-39-21><a id=__codelineno-39-21 name=__codelineno-39-21 href=#__codelineno-39-21></a>        <span class=n>validation_results</span><span class=p>[</span><span class=s1>&#39;schema_violations&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>schema_violations</span>
</span><span id=__span-39-22><a id=__codelineno-39-22 name=__codelineno-39-22 href=#__codelineno-39-22></a>
</span><span id=__span-39-23><a id=__codelineno-39-23 name=__codelineno-39-23 href=#__codelineno-39-23></a>        <span class=c1># Quality rule validation</span>
</span><span id=__span-39-24><a id=__codelineno-39-24 name=__codelineno-39-24 href=#__codelineno-39-24></a>        <span class=n>quality_violations</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>validate_quality_rules</span><span class=p>(</span><span class=n>data_batch</span><span class=p>)</span>
</span><span id=__span-39-25><a id=__codelineno-39-25 name=__codelineno-39-25 href=#__codelineno-39-25></a>        <span class=n>validation_results</span><span class=p>[</span><span class=s1>&#39;quality_violations&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>quality_violations</span>
</span><span id=__span-39-26><a id=__codelineno-39-26 name=__codelineno-39-26 href=#__codelineno-39-26></a>
</span><span id=__span-39-27><a id=__codelineno-39-27 name=__codelineno-39-27 href=#__codelineno-39-27></a>        <span class=c1># Statistical analysis</span>
</span><span id=__span-39-28><a id=__codelineno-39-28 name=__codelineno-39-28 href=#__codelineno-39-28></a>        <span class=n>current_stats</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_batch_statistics</span><span class=p>(</span><span class=n>data_batch</span><span class=p>)</span>
</span><span id=__span-39-29><a id=__codelineno-39-29 name=__codelineno-39-29 href=#__codelineno-39-29></a>        <span class=n>validation_results</span><span class=p>[</span><span class=s1>&#39;statistics&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>current_stats</span>
</span><span id=__span-39-30><a id=__codelineno-39-30 name=__codelineno-39-30 href=#__codelineno-39-30></a>
</span><span id=__span-39-31><a id=__codelineno-39-31 name=__codelineno-39-31 href=#__codelineno-39-31></a>        <span class=c1># Compare with baseline</span>
</span><span id=__span-39-32><a id=__codelineno-39-32 name=__codelineno-39-32 href=#__codelineno-39-32></a>        <span class=k>if</span> <span class=n>dataset_name</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>baseline_stats</span><span class=p>:</span>
</span><span id=__span-39-33><a id=__codelineno-39-33 name=__codelineno-39-33 href=#__codelineno-39-33></a>            <span class=n>drift_analysis</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>detect_statistical_drift</span><span class=p>(</span>
</span><span id=__span-39-34><a id=__codelineno-39-34 name=__codelineno-39-34 href=#__codelineno-39-34></a>                <span class=bp>self</span><span class=o>.</span><span class=n>baseline_stats</span><span class=p>[</span><span class=n>dataset_name</span><span class=p>],</span> <span class=n>current_stats</span>
</span><span id=__span-39-35><a id=__codelineno-39-35 name=__codelineno-39-35 href=#__codelineno-39-35></a>            <span class=p>)</span>
</span><span id=__span-39-36><a id=__codelineno-39-36 name=__codelineno-39-36 href=#__codelineno-39-36></a>            <span class=n>validation_results</span><span class=p>[</span><span class=s1>&#39;drift_analysis&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>drift_analysis</span>
</span><span id=__span-39-37><a id=__codelineno-39-37 name=__codelineno-39-37 href=#__codelineno-39-37></a>
</span><span id=__span-39-38><a id=__codelineno-39-38 name=__codelineno-39-38 href=#__codelineno-39-38></a>        <span class=c1># Update baseline if data is good</span>
</span><span id=__span-39-39><a id=__codelineno-39-39 name=__codelineno-39-39 href=#__codelineno-39-39></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>schema_violations</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>quality_violations</span><span class=p>:</span>
</span><span id=__span-39-40><a id=__codelineno-39-40 name=__codelineno-39-40 href=#__codelineno-39-40></a>            <span class=bp>self</span><span class=o>.</span><span class=n>update_baseline_stats</span><span class=p>(</span><span class=n>dataset_name</span><span class=p>,</span> <span class=n>current_stats</span><span class=p>)</span>
</span><span id=__span-39-41><a id=__codelineno-39-41 name=__codelineno-39-41 href=#__codelineno-39-41></a>
</span><span id=__span-39-42><a id=__codelineno-39-42 name=__codelineno-39-42 href=#__codelineno-39-42></a>        <span class=k>return</span> <span class=n>validation_results</span>
</span><span id=__span-39-43><a id=__codelineno-39-43 name=__codelineno-39-43 href=#__codelineno-39-43></a>
</span><span id=__span-39-44><a id=__codelineno-39-44 name=__codelineno-39-44 href=#__codelineno-39-44></a>    <span class=k>def</span><span class=w> </span><span class=nf>validate_quality_rules</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data_batch</span><span class=p>):</span>
</span><span id=__span-39-45><a id=__codelineno-39-45 name=__codelineno-39-45 href=#__codelineno-39-45></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Apply custom quality rules to data.&quot;&quot;&quot;</span>
</span><span id=__span-39-46><a id=__codelineno-39-46 name=__codelineno-39-46 href=#__codelineno-39-46></a>        <span class=n>violations</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-39-47><a id=__codelineno-39-47 name=__codelineno-39-47 href=#__codelineno-39-47></a>
</span><span id=__span-39-48><a id=__codelineno-39-48 name=__codelineno-39-48 href=#__codelineno-39-48></a>        <span class=k>for</span> <span class=n>rule</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>quality_rules</span><span class=p>:</span>
</span><span id=__span-39-49><a id=__codelineno-39-49 name=__codelineno-39-49 href=#__codelineno-39-49></a>            <span class=n>rule_name</span> <span class=o>=</span> <span class=n>rule</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span>
</span><span id=__span-39-50><a id=__codelineno-39-50 name=__codelineno-39-50 href=#__codelineno-39-50></a>            <span class=n>rule_type</span> <span class=o>=</span> <span class=n>rule</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span>
</span><span id=__span-39-51><a id=__codelineno-39-51 name=__codelineno-39-51 href=#__codelineno-39-51></a>
</span><span id=__span-39-52><a id=__codelineno-39-52 name=__codelineno-39-52 href=#__codelineno-39-52></a>            <span class=k>if</span> <span class=n>rule_type</span> <span class=o>==</span> <span class=s1>&#39;completeness&#39;</span><span class=p>:</span>
</span><span id=__span-39-53><a id=__codelineno-39-53 name=__codelineno-39-53 href=#__codelineno-39-53></a>                <span class=c1># Check for null values</span>
</span><span id=__span-39-54><a id=__codelineno-39-54 name=__codelineno-39-54 href=#__codelineno-39-54></a>                <span class=n>null_threshold</span> <span class=o>=</span> <span class=n>rule</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;null_threshold&#39;</span><span class=p>,</span> <span class=mf>0.05</span><span class=p>)</span>
</span><span id=__span-39-55><a id=__codelineno-39-55 name=__codelineno-39-55 href=#__codelineno-39-55></a>                <span class=k>for</span> <span class=n>column</span> <span class=ow>in</span> <span class=n>rule</span><span class=p>[</span><span class=s1>&#39;columns&#39;</span><span class=p>]:</span>
</span><span id=__span-39-56><a id=__codelineno-39-56 name=__codelineno-39-56 href=#__codelineno-39-56></a>                    <span class=n>null_rate</span> <span class=o>=</span> <span class=n>data_batch</span><span class=p>[</span><span class=n>column</span><span class=p>]</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-39-57><a id=__codelineno-39-57 name=__codelineno-39-57 href=#__codelineno-39-57></a>                    <span class=k>if</span> <span class=n>null_rate</span> <span class=o>&gt;</span> <span class=n>null_threshold</span><span class=p>:</span>
</span><span id=__span-39-58><a id=__codelineno-39-58 name=__codelineno-39-58 href=#__codelineno-39-58></a>                        <span class=n>violations</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-39-59><a id=__codelineno-39-59 name=__codelineno-39-59 href=#__codelineno-39-59></a>                            <span class=s1>&#39;rule&#39;</span><span class=p>:</span> <span class=n>rule_name</span><span class=p>,</span>
</span><span id=__span-39-60><a id=__codelineno-39-60 name=__codelineno-39-60 href=#__codelineno-39-60></a>                            <span class=s1>&#39;column&#39;</span><span class=p>:</span> <span class=n>column</span><span class=p>,</span>
</span><span id=__span-39-61><a id=__codelineno-39-61 name=__codelineno-39-61 href=#__codelineno-39-61></a>                            <span class=s1>&#39;violation_type&#39;</span><span class=p>:</span> <span class=s1>&#39;high_null_rate&#39;</span><span class=p>,</span>
</span><span id=__span-39-62><a id=__codelineno-39-62 name=__codelineno-39-62 href=#__codelineno-39-62></a>                            <span class=s1>&#39;value&#39;</span><span class=p>:</span> <span class=n>null_rate</span><span class=p>,</span>
</span><span id=__span-39-63><a id=__codelineno-39-63 name=__codelineno-39-63 href=#__codelineno-39-63></a>                            <span class=s1>&#39;threshold&#39;</span><span class=p>:</span> <span class=n>null_threshold</span>
</span><span id=__span-39-64><a id=__codelineno-39-64 name=__codelineno-39-64 href=#__codelineno-39-64></a>                        <span class=p>})</span>
</span><span id=__span-39-65><a id=__codelineno-39-65 name=__codelineno-39-65 href=#__codelineno-39-65></a>
</span><span id=__span-39-66><a id=__codelineno-39-66 name=__codelineno-39-66 href=#__codelineno-39-66></a>            <span class=k>elif</span> <span class=n>rule_type</span> <span class=o>==</span> <span class=s1>&#39;uniqueness&#39;</span><span class=p>:</span>
</span><span id=__span-39-67><a id=__codelineno-39-67 name=__codelineno-39-67 href=#__codelineno-39-67></a>                <span class=c1># Check for duplicates</span>
</span><span id=__span-39-68><a id=__codelineno-39-68 name=__codelineno-39-68 href=#__codelineno-39-68></a>                <span class=n>duplicate_threshold</span> <span class=o>=</span> <span class=n>rule</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;duplicate_threshold&#39;</span><span class=p>,</span> <span class=mf>0.01</span><span class=p>)</span>
</span><span id=__span-39-69><a id=__codelineno-39-69 name=__codelineno-39-69 href=#__codelineno-39-69></a>                <span class=k>for</span> <span class=n>column</span> <span class=ow>in</span> <span class=n>rule</span><span class=p>[</span><span class=s1>&#39;columns&#39;</span><span class=p>]:</span>
</span><span id=__span-39-70><a id=__codelineno-39-70 name=__codelineno-39-70 href=#__codelineno-39-70></a>                    <span class=n>duplicate_rate</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>-</span> <span class=p>(</span><span class=n>data_batch</span><span class=p>[</span><span class=n>column</span><span class=p>]</span><span class=o>.</span><span class=n>nunique</span><span class=p>()</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>data_batch</span><span class=p>))</span>
</span><span id=__span-39-71><a id=__codelineno-39-71 name=__codelineno-39-71 href=#__codelineno-39-71></a>                    <span class=k>if</span> <span class=n>duplicate_rate</span> <span class=o>&gt;</span> <span class=n>duplicate_threshold</span><span class=p>:</span>
</span><span id=__span-39-72><a id=__codelineno-39-72 name=__codelineno-39-72 href=#__codelineno-39-72></a>                        <span class=n>violations</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-39-73><a id=__codelineno-39-73 name=__codelineno-39-73 href=#__codelineno-39-73></a>                            <span class=s1>&#39;rule&#39;</span><span class=p>:</span> <span class=n>rule_name</span><span class=p>,</span>
</span><span id=__span-39-74><a id=__codelineno-39-74 name=__codelineno-39-74 href=#__codelineno-39-74></a>                            <span class=s1>&#39;column&#39;</span><span class=p>:</span> <span class=n>column</span><span class=p>,</span>
</span><span id=__span-39-75><a id=__codelineno-39-75 name=__codelineno-39-75 href=#__codelineno-39-75></a>                            <span class=s1>&#39;violation_type&#39;</span><span class=p>:</span> <span class=s1>&#39;high_duplicate_rate&#39;</span><span class=p>,</span>
</span><span id=__span-39-76><a id=__codelineno-39-76 name=__codelineno-39-76 href=#__codelineno-39-76></a>                            <span class=s1>&#39;value&#39;</span><span class=p>:</span> <span class=n>duplicate_rate</span><span class=p>,</span>
</span><span id=__span-39-77><a id=__codelineno-39-77 name=__codelineno-39-77 href=#__codelineno-39-77></a>                            <span class=s1>&#39;threshold&#39;</span><span class=p>:</span> <span class=n>duplicate_threshold</span>
</span><span id=__span-39-78><a id=__codelineno-39-78 name=__codelineno-39-78 href=#__codelineno-39-78></a>                        <span class=p>})</span>
</span><span id=__span-39-79><a id=__codelineno-39-79 name=__codelineno-39-79 href=#__codelineno-39-79></a>
</span><span id=__span-39-80><a id=__codelineno-39-80 name=__codelineno-39-80 href=#__codelineno-39-80></a>            <span class=k>elif</span> <span class=n>rule_type</span> <span class=o>==</span> <span class=s1>&#39;range&#39;</span><span class=p>:</span>
</span><span id=__span-39-81><a id=__codelineno-39-81 name=__codelineno-39-81 href=#__codelineno-39-81></a>                <span class=c1># Check value ranges</span>
</span><span id=__span-39-82><a id=__codelineno-39-82 name=__codelineno-39-82 href=#__codelineno-39-82></a>                <span class=k>for</span> <span class=n>column</span> <span class=ow>in</span> <span class=n>rule</span><span class=p>[</span><span class=s1>&#39;columns&#39;</span><span class=p>]:</span>
</span><span id=__span-39-83><a id=__codelineno-39-83 name=__codelineno-39-83 href=#__codelineno-39-83></a>                    <span class=n>min_val</span><span class=p>,</span> <span class=n>max_val</span> <span class=o>=</span> <span class=n>rule</span><span class=p>[</span><span class=s1>&#39;range&#39;</span><span class=p>]</span>
</span><span id=__span-39-84><a id=__codelineno-39-84 name=__codelineno-39-84 href=#__codelineno-39-84></a>                    <span class=n>out_of_range</span> <span class=o>=</span> <span class=p>(</span>
</span><span id=__span-39-85><a id=__codelineno-39-85 name=__codelineno-39-85 href=#__codelineno-39-85></a>                        <span class=p>(</span><span class=n>data_batch</span><span class=p>[</span><span class=n>column</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>min_val</span><span class=p>)</span> <span class=o>|</span>
</span><span id=__span-39-86><a id=__codelineno-39-86 name=__codelineno-39-86 href=#__codelineno-39-86></a>                        <span class=p>(</span><span class=n>data_batch</span><span class=p>[</span><span class=n>column</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>max_val</span><span class=p>)</span>
</span><span id=__span-39-87><a id=__codelineno-39-87 name=__codelineno-39-87 href=#__codelineno-39-87></a>                    <span class=p>)</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-39-88><a id=__codelineno-39-88 name=__codelineno-39-88 href=#__codelineno-39-88></a>
</span><span id=__span-39-89><a id=__codelineno-39-89 name=__codelineno-39-89 href=#__codelineno-39-89></a>                    <span class=k>if</span> <span class=n>out_of_range</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-39-90><a id=__codelineno-39-90 name=__codelineno-39-90 href=#__codelineno-39-90></a>                        <span class=n>violations</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-39-91><a id=__codelineno-39-91 name=__codelineno-39-91 href=#__codelineno-39-91></a>                            <span class=s1>&#39;rule&#39;</span><span class=p>:</span> <span class=n>rule_name</span><span class=p>,</span>
</span><span id=__span-39-92><a id=__codelineno-39-92 name=__codelineno-39-92 href=#__codelineno-39-92></a>                            <span class=s1>&#39;column&#39;</span><span class=p>:</span> <span class=n>column</span><span class=p>,</span>
</span><span id=__span-39-93><a id=__codelineno-39-93 name=__codelineno-39-93 href=#__codelineno-39-93></a>                            <span class=s1>&#39;violation_type&#39;</span><span class=p>:</span> <span class=s1>&#39;out_of_range&#39;</span><span class=p>,</span>
</span><span id=__span-39-94><a id=__codelineno-39-94 name=__codelineno-39-94 href=#__codelineno-39-94></a>                            <span class=s1>&#39;count&#39;</span><span class=p>:</span> <span class=n>out_of_range</span><span class=p>,</span>
</span><span id=__span-39-95><a id=__codelineno-39-95 name=__codelineno-39-95 href=#__codelineno-39-95></a>                            <span class=s1>&#39;range&#39;</span><span class=p>:</span> <span class=p>[</span><span class=n>min_val</span><span class=p>,</span> <span class=n>max_val</span><span class=p>]</span>
</span><span id=__span-39-96><a id=__codelineno-39-96 name=__codelineno-39-96 href=#__codelineno-39-96></a>                        <span class=p>})</span>
</span><span id=__span-39-97><a id=__codelineno-39-97 name=__codelineno-39-97 href=#__codelineno-39-97></a>
</span><span id=__span-39-98><a id=__codelineno-39-98 name=__codelineno-39-98 href=#__codelineno-39-98></a>        <span class=k>return</span> <span class=n>violations</span>
</span></code></pre></div> <h3 id=business-integration><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#business-integration>Business Integration and Value Realization</a></h3> <p>One of the biggest challenges in MLOps is demonstrating and measuring business value. Technical metrics like model accuracy are important, but business stakeholders care about impact on revenue, customer satisfaction, and operational efficiency.</p> <h4 id=measuring-business-impact><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#measuring-business-impact>Measuring Business Impact</a></h4> <p>At Firstleaf, we developed a comprehensive system for measuring the business impact of our ML models:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=k>class</span><span class=w> </span><span class=nc>BusinessImpactTracker</span><span class=p>:</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>):</span>
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a>        <span class=bp>self</span><span class=o>.</span><span class=n>impact_metrics</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;impact_metrics&#39;</span><span class=p>]</span>
</span><span id=__span-40-4><a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>attribution_window</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;attribution_window&#39;</span><span class=p>]</span>
</span><span id=__span-40-5><a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a>        <span class=bp>self</span><span class=o>.</span><span class=n>control_group_size</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;control_group_size&#39;</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>)</span>
</span><span id=__span-40-6><a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a>
</span><span id=__span-40-7><a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a>    <span class=k>def</span><span class=w> </span><span class=nf>track_recommendation_impact</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>,</span> <span class=n>recommendations</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>):</span>
</span><span id=__span-40-8><a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Track the business impact of recommendations.&quot;&quot;&quot;</span>
</span><span id=__span-40-9><a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a>
</span><span id=__span-40-10><a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a>        <span class=c1># Store the recommendations</span>
</span><span id=__span-40-11><a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a>        <span class=bp>self</span><span class=o>.</span><span class=n>store_recommendation_event</span><span class=p>({</span>
</span><span id=__span-40-12><a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a>            <span class=s1>&#39;user_id&#39;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span>
</span><span id=__span-40-13><a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a>            <span class=s1>&#39;recommendations&#39;</span><span class=p>:</span> <span class=n>recommendations</span><span class=p>,</span>
</span><span id=__span-40-14><a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>timestamp</span><span class=p>,</span>
</span><span id=__span-40-15><a id=__codelineno-40-15 name=__codelineno-40-15 href=#__codelineno-40-15></a>            <span class=s1>&#39;model_version&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_current_model_version</span><span class=p>(),</span>
</span><span id=__span-40-16><a id=__codelineno-40-16 name=__codelineno-40-16 href=#__codelineno-40-16></a>            <span class=s1>&#39;treatment_group&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_user_treatment_group</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span><span id=__span-40-17><a id=__codelineno-40-17 name=__codelineno-40-17 href=#__codelineno-40-17></a>        <span class=p>})</span>
</span><span id=__span-40-18><a id=__codelineno-40-18 name=__codelineno-40-18 href=#__codelineno-40-18></a>
</span><span id=__span-40-19><a id=__codelineno-40-19 name=__codelineno-40-19 href=#__codelineno-40-19></a>        <span class=c1># Set up tracking for downstream events</span>
</span><span id=__span-40-20><a id=__codelineno-40-20 name=__codelineno-40-20 href=#__codelineno-40-20></a>        <span class=bp>self</span><span class=o>.</span><span class=n>setup_conversion_tracking</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>)</span>
</span><span id=__span-40-21><a id=__codelineno-40-21 name=__codelineno-40-21 href=#__codelineno-40-21></a>
</span><span id=__span-40-22><a id=__codelineno-40-22 name=__codelineno-40-22 href=#__codelineno-40-22></a>    <span class=k>def</span><span class=w> </span><span class=nf>calculate_recommendation_lift</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>time_period</span><span class=p>):</span>
</span><span id=__span-40-23><a id=__codelineno-40-23 name=__codelineno-40-23 href=#__codelineno-40-23></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Calculate the lift from ML recommendations vs. control group.&quot;&quot;&quot;</span>
</span><span id=__span-40-24><a id=__codelineno-40-24 name=__codelineno-40-24 href=#__codelineno-40-24></a>
</span><span id=__span-40-25><a id=__codelineno-40-25 name=__codelineno-40-25 href=#__codelineno-40-25></a>        <span class=c1># Get treatment and control group data</span>
</span><span id=__span-40-26><a id=__codelineno-40-26 name=__codelineno-40-26 href=#__codelineno-40-26></a>        <span class=n>treatment_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_user_events</span><span class=p>(</span>
</span><span id=__span-40-27><a id=__codelineno-40-27 name=__codelineno-40-27 href=#__codelineno-40-27></a>            <span class=n>time_period</span><span class=p>,</span>
</span><span id=__span-40-28><a id=__codelineno-40-28 name=__codelineno-40-28 href=#__codelineno-40-28></a>            <span class=n>treatment_group</span><span class=o>=</span><span class=s1>&#39;ml_recommendations&#39;</span>
</span><span id=__span-40-29><a id=__codelineno-40-29 name=__codelineno-40-29 href=#__codelineno-40-29></a>        <span class=p>)</span>
</span><span id=__span-40-30><a id=__codelineno-40-30 name=__codelineno-40-30 href=#__codelineno-40-30></a>        <span class=n>control_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_user_events</span><span class=p>(</span>
</span><span id=__span-40-31><a id=__codelineno-40-31 name=__codelineno-40-31 href=#__codelineno-40-31></a>            <span class=n>time_period</span><span class=p>,</span>
</span><span id=__span-40-32><a id=__codelineno-40-32 name=__codelineno-40-32 href=#__codelineno-40-32></a>            <span class=n>treatment_group</span><span class=o>=</span><span class=s1>&#39;non_personalized&#39;</span>
</span><span id=__span-40-33><a id=__codelineno-40-33 name=__codelineno-40-33 href=#__codelineno-40-33></a>        <span class=p>)</span>
</span><span id=__span-40-34><a id=__codelineno-40-34 name=__codelineno-40-34 href=#__codelineno-40-34></a>
</span><span id=__span-40-35><a id=__codelineno-40-35 name=__codelineno-40-35 href=#__codelineno-40-35></a>        <span class=c1># Calculate key metrics for both groups</span>
</span><span id=__span-40-36><a id=__codelineno-40-36 name=__codelineno-40-36 href=#__codelineno-40-36></a>        <span class=n>treatment_metrics</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_group_metrics</span><span class=p>(</span><span class=n>treatment_data</span><span class=p>)</span>
</span><span id=__span-40-37><a id=__codelineno-40-37 name=__codelineno-40-37 href=#__codelineno-40-37></a>        <span class=n>control_metrics</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_group_metrics</span><span class=p>(</span><span class=n>control_data</span><span class=p>)</span>
</span><span id=__span-40-38><a id=__codelineno-40-38 name=__codelineno-40-38 href=#__codelineno-40-38></a>
</span><span id=__span-40-39><a id=__codelineno-40-39 name=__codelineno-40-39 href=#__codelineno-40-39></a>        <span class=c1># Calculate lift</span>
</span><span id=__span-40-40><a id=__codelineno-40-40 name=__codelineno-40-40 href=#__codelineno-40-40></a>        <span class=n>lift_results</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-40-41><a id=__codelineno-40-41 name=__codelineno-40-41 href=#__codelineno-40-41></a>        <span class=k>for</span> <span class=n>metric_name</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>impact_metrics</span><span class=p>:</span>
</span><span id=__span-40-42><a id=__codelineno-40-42 name=__codelineno-40-42 href=#__codelineno-40-42></a>            <span class=n>treatment_value</span> <span class=o>=</span> <span class=n>treatment_metrics</span><span class=p>[</span><span class=n>metric_name</span><span class=p>]</span>
</span><span id=__span-40-43><a id=__codelineno-40-43 name=__codelineno-40-43 href=#__codelineno-40-43></a>            <span class=n>control_value</span> <span class=o>=</span> <span class=n>control_metrics</span><span class=p>[</span><span class=n>metric_name</span><span class=p>]</span>
</span><span id=__span-40-44><a id=__codelineno-40-44 name=__codelineno-40-44 href=#__codelineno-40-44></a>
</span><span id=__span-40-45><a id=__codelineno-40-45 name=__codelineno-40-45 href=#__codelineno-40-45></a>            <span class=k>if</span> <span class=n>control_value</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-40-46><a id=__codelineno-40-46 name=__codelineno-40-46 href=#__codelineno-40-46></a>                <span class=n>lift</span> <span class=o>=</span> <span class=p>(</span><span class=n>treatment_value</span> <span class=o>-</span> <span class=n>control_value</span><span class=p>)</span> <span class=o>/</span> <span class=n>control_value</span>
</span><span id=__span-40-47><a id=__codelineno-40-47 name=__codelineno-40-47 href=#__codelineno-40-47></a>                <span class=n>lift_results</span><span class=p>[</span><span class=n>metric_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-40-48><a id=__codelineno-40-48 name=__codelineno-40-48 href=#__codelineno-40-48></a>                    <span class=s1>&#39;treatment_value&#39;</span><span class=p>:</span> <span class=n>treatment_value</span><span class=p>,</span>
</span><span id=__span-40-49><a id=__codelineno-40-49 name=__codelineno-40-49 href=#__codelineno-40-49></a>                    <span class=s1>&#39;control_value&#39;</span><span class=p>:</span> <span class=n>control_value</span><span class=p>,</span>
</span><span id=__span-40-50><a id=__codelineno-40-50 name=__codelineno-40-50 href=#__codelineno-40-50></a>                    <span class=s1>&#39;lift_percentage&#39;</span><span class=p>:</span> <span class=n>lift</span> <span class=o>*</span> <span class=mi>100</span><span class=p>,</span>
</span><span id=__span-40-51><a id=__codelineno-40-51 name=__codelineno-40-51 href=#__codelineno-40-51></a>                    <span class=s1>&#39;absolute_difference&#39;</span><span class=p>:</span> <span class=n>treatment_value</span> <span class=o>-</span> <span class=n>control_value</span>
</span><span id=__span-40-52><a id=__codelineno-40-52 name=__codelineno-40-52 href=#__codelineno-40-52></a>                <span class=p>}</span>
</span><span id=__span-40-53><a id=__codelineno-40-53 name=__codelineno-40-53 href=#__codelineno-40-53></a>
</span><span id=__span-40-54><a id=__codelineno-40-54 name=__codelineno-40-54 href=#__codelineno-40-54></a>        <span class=k>return</span> <span class=n>lift_results</span>
</span><span id=__span-40-55><a id=__codelineno-40-55 name=__codelineno-40-55 href=#__codelineno-40-55></a>
</span><span id=__span-40-56><a id=__codelineno-40-56 name=__codelineno-40-56 href=#__codelineno-40-56></a>    <span class=k>def</span><span class=w> </span><span class=nf>calculate_group_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>group_data</span><span class=p>):</span>
</span><span id=__span-40-57><a id=__codelineno-40-57 name=__codelineno-40-57 href=#__codelineno-40-57></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Calculate business metrics for a group of users.&quot;&quot;&quot;</span>
</span><span id=__span-40-58><a id=__codelineno-40-58 name=__codelineno-40-58 href=#__codelineno-40-58></a>        <span class=n>metrics</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-40-59><a id=__codelineno-40-59 name=__codelineno-40-59 href=#__codelineno-40-59></a>
</span><span id=__span-40-60><a id=__codelineno-40-60 name=__codelineno-40-60 href=#__codelineno-40-60></a>        <span class=c1># Revenue metrics</span>
</span><span id=__span-40-61><a id=__codelineno-40-61 name=__codelineno-40-61 href=#__codelineno-40-61></a>        <span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;revenue_per_user&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>group_data</span><span class=p>[</span><span class=s1>&#39;revenue&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span> <span class=o>/</span> <span class=n>group_data</span><span class=p>[</span><span class=s1>&#39;user_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>nunique</span><span class=p>()</span>
</span><span id=__span-40-62><a id=__codelineno-40-62 name=__codelineno-40-62 href=#__codelineno-40-62></a>        <span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;conversion_rate&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>group_data</span><span class=p>[</span><span class=s1>&#39;converted&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-40-63><a id=__codelineno-40-63 name=__codelineno-40-63 href=#__codelineno-40-63></a>        <span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;average_order_value&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>group_data</span><span class=p>[</span><span class=n>group_data</span><span class=p>[</span><span class=s1>&#39;converted&#39;</span><span class=p>]][</span><span class=s1>&#39;revenue&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-40-64><a id=__codelineno-40-64 name=__codelineno-40-64 href=#__codelineno-40-64></a>
</span><span id=__span-40-65><a id=__codelineno-40-65 name=__codelineno-40-65 href=#__codelineno-40-65></a>        <span class=c1># Engagement metrics</span>
</span><span id=__span-40-66><a id=__codelineno-40-66 name=__codelineno-40-66 href=#__codelineno-40-66></a>        <span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;click_through_rate&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>group_data</span><span class=p>[</span><span class=s1>&#39;clicked&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-40-67><a id=__codelineno-40-67 name=__codelineno-40-67 href=#__codelineno-40-67></a>        <span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;time_to_conversion&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>group_data</span><span class=p>[</span><span class=n>group_data</span><span class=p>[</span><span class=s1>&#39;converted&#39;</span><span class=p>]][</span><span class=s1>&#39;time_to_conversion&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-40-68><a id=__codelineno-40-68 name=__codelineno-40-68 href=#__codelineno-40-68></a>
</span><span id=__span-40-69><a id=__codelineno-40-69 name=__codelineno-40-69 href=#__codelineno-40-69></a>        <span class=c1># Retention metrics</span>
</span><span id=__span-40-70><a id=__codelineno-40-70 name=__codelineno-40-70 href=#__codelineno-40-70></a>        <span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;repeat_purchase_rate&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_repeat_purchase_rate</span><span class=p>(</span><span class=n>group_data</span><span class=p>)</span>
</span><span id=__span-40-71><a id=__codelineno-40-71 name=__codelineno-40-71 href=#__codelineno-40-71></a>
</span><span id=__span-40-72><a id=__codelineno-40-72 name=__codelineno-40-72 href=#__codelineno-40-72></a>        <span class=k>return</span> <span class=n>metrics</span>
</span><span id=__span-40-73><a id=__codelineno-40-73 name=__codelineno-40-73 href=#__codelineno-40-73></a>
</span><span id=__span-40-74><a id=__codelineno-40-74 name=__codelineno-40-74 href=#__codelineno-40-74></a>    <span class=k>def</span><span class=w> </span><span class=nf>generate_business_report</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>time_period</span><span class=p>):</span>
</span><span id=__span-40-75><a id=__codelineno-40-75 name=__codelineno-40-75 href=#__codelineno-40-75></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Generate a comprehensive business impact report.&quot;&quot;&quot;</span>
</span><span id=__span-40-76><a id=__codelineno-40-76 name=__codelineno-40-76 href=#__codelineno-40-76></a>
</span><span id=__span-40-77><a id=__codelineno-40-77 name=__codelineno-40-77 href=#__codelineno-40-77></a>        <span class=n>lift_analysis</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_recommendation_lift</span><span class=p>(</span><span class=n>time_period</span><span class=p>)</span>
</span><span id=__span-40-78><a id=__codelineno-40-78 name=__codelineno-40-78 href=#__codelineno-40-78></a>
</span><span id=__span-40-79><a id=__codelineno-40-79 name=__codelineno-40-79 href=#__codelineno-40-79></a>        <span class=c1># Calculate total business impact</span>
</span><span id=__span-40-80><a id=__codelineno-40-80 name=__codelineno-40-80 href=#__codelineno-40-80></a>        <span class=n>total_users</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_total_users_in_treatment</span><span class=p>(</span><span class=n>time_period</span><span class=p>)</span>
</span><span id=__span-40-81><a id=__codelineno-40-81 name=__codelineno-40-81 href=#__codelineno-40-81></a>        <span class=n>control_baseline</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_control_group_baseline</span><span class=p>(</span><span class=n>time_period</span><span class=p>)</span>
</span><span id=__span-40-82><a id=__codelineno-40-82 name=__codelineno-40-82 href=#__codelineno-40-82></a>
</span><span id=__span-40-83><a id=__codelineno-40-83 name=__codelineno-40-83 href=#__codelineno-40-83></a>        <span class=n>total_impact</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-40-84><a id=__codelineno-40-84 name=__codelineno-40-84 href=#__codelineno-40-84></a>        <span class=k>for</span> <span class=n>metric_name</span><span class=p>,</span> <span class=n>lift_data</span> <span class=ow>in</span> <span class=n>lift_analysis</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-40-85><a id=__codelineno-40-85 name=__codelineno-40-85 href=#__codelineno-40-85></a>            <span class=k>if</span> <span class=s1>&#39;revenue&#39;</span> <span class=ow>in</span> <span class=n>metric_name</span><span class=p>:</span>
</span><span id=__span-40-86><a id=__codelineno-40-86 name=__codelineno-40-86 href=#__codelineno-40-86></a>                <span class=c1># Calculate total additional revenue</span>
</span><span id=__span-40-87><a id=__codelineno-40-87 name=__codelineno-40-87 href=#__codelineno-40-87></a>                <span class=n>additional_revenue</span> <span class=o>=</span> <span class=p>(</span>
</span><span id=__span-40-88><a id=__codelineno-40-88 name=__codelineno-40-88 href=#__codelineno-40-88></a>                    <span class=n>lift_data</span><span class=p>[</span><span class=s1>&#39;absolute_difference&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=n>total_users</span>
</span><span id=__span-40-89><a id=__codelineno-40-89 name=__codelineno-40-89 href=#__codelineno-40-89></a>                <span class=p>)</span>
</span><span id=__span-40-90><a id=__codelineno-40-90 name=__codelineno-40-90 href=#__codelineno-40-90></a>                <span class=n>total_impact</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;additional_</span><span class=si>{</span><span class=n>metric_name</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>additional_revenue</span>
</span><span id=__span-40-91><a id=__codelineno-40-91 name=__codelineno-40-91 href=#__codelineno-40-91></a>
</span><span id=__span-40-92><a id=__codelineno-40-92 name=__codelineno-40-92 href=#__codelineno-40-92></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-40-93><a id=__codelineno-40-93 name=__codelineno-40-93 href=#__codelineno-40-93></a>            <span class=s1>&#39;time_period&#39;</span><span class=p>:</span> <span class=n>time_period</span><span class=p>,</span>
</span><span id=__span-40-94><a id=__codelineno-40-94 name=__codelineno-40-94 href=#__codelineno-40-94></a>            <span class=s1>&#39;lift_analysis&#39;</span><span class=p>:</span> <span class=n>lift_analysis</span><span class=p>,</span>
</span><span id=__span-40-95><a id=__codelineno-40-95 name=__codelineno-40-95 href=#__codelineno-40-95></a>            <span class=s1>&#39;total_impact&#39;</span><span class=p>:</span> <span class=n>total_impact</span><span class=p>,</span>
</span><span id=__span-40-96><a id=__codelineno-40-96 name=__codelineno-40-96 href=#__codelineno-40-96></a>            <span class=s1>&#39;model_performance&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_model_performance_summary</span><span class=p>(</span><span class=n>time_period</span><span class=p>),</span>
</span><span id=__span-40-97><a id=__codelineno-40-97 name=__codelineno-40-97 href=#__codelineno-40-97></a>            <span class=s1>&#39;recommendations&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_recommendations_for_improvement</span><span class=p>()</span>
</span><span id=__span-40-98><a id=__codelineno-40-98 name=__codelineno-40-98 href=#__codelineno-40-98></a>        <span class=p>}</span>
</span></code></pre></div> <h4 id=ab-testing-for-ml-systems><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#ab-testing-for-ml-systems>A/B Testing for ML Systems</a></h4> <p>Proper A/B testing is crucial for measuring ML impact:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=k>class</span><span class=w> </span><span class=nc>MLABTestFramework</span><span class=p>:</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>):</span>
</span><span id=__span-41-3><a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a>        <span class=bp>self</span><span class=o>.</span><span class=n>config</span> <span class=o>=</span> <span class=n>config</span>
</span><span id=__span-41-4><a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>experiment_store</span> <span class=o>=</span> <span class=n>ExperimentStore</span><span class=p>()</span>
</span><span id=__span-41-5><a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a>        <span class=bp>self</span><span class=o>.</span><span class=n>assignment_service</span> <span class=o>=</span> <span class=n>UserAssignmentService</span><span class=p>()</span>
</span><span id=__span-41-6><a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a>
</span><span id=__span-41-7><a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a>    <span class=k>def</span><span class=w> </span><span class=nf>create_experiment</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>experiment_config</span><span class=p>):</span>
</span><span id=__span-41-8><a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create a new ML A/B test experiment.&quot;&quot;&quot;</span>
</span><span id=__span-41-9><a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a>
</span><span id=__span-41-10><a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a>        <span class=n>experiment</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-41-11><a id=__codelineno-41-11 name=__codelineno-41-11 href=#__codelineno-41-11></a>            <span class=s1>&#39;experiment_id&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_experiment_id</span><span class=p>(),</span>
</span><span id=__span-41-12><a id=__codelineno-41-12 name=__codelineno-41-12 href=#__codelineno-41-12></a>            <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=n>experiment_config</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>],</span>
</span><span id=__span-41-13><a id=__codelineno-41-13 name=__codelineno-41-13 href=#__codelineno-41-13></a>            <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=n>experiment_config</span><span class=p>[</span><span class=s1>&#39;description&#39;</span><span class=p>],</span>
</span><span id=__span-41-14><a id=__codelineno-41-14 name=__codelineno-41-14 href=#__codelineno-41-14></a>            <span class=s1>&#39;start_date&#39;</span><span class=p>:</span> <span class=n>experiment_config</span><span class=p>[</span><span class=s1>&#39;start_date&#39;</span><span class=p>],</span>
</span><span id=__span-41-15><a id=__codelineno-41-15 name=__codelineno-41-15 href=#__codelineno-41-15></a>            <span class=s1>&#39;end_date&#39;</span><span class=p>:</span> <span class=n>experiment_config</span><span class=p>[</span><span class=s1>&#39;end_date&#39;</span><span class=p>],</span>
</span><span id=__span-41-16><a id=__codelineno-41-16 name=__codelineno-41-16 href=#__codelineno-41-16></a>            <span class=s1>&#39;traffic_allocation&#39;</span><span class=p>:</span> <span class=n>experiment_config</span><span class=p>[</span><span class=s1>&#39;traffic_allocation&#39;</span><span class=p>],</span>
</span><span id=__span-41-17><a id=__codelineno-41-17 name=__codelineno-41-17 href=#__codelineno-41-17></a>            <span class=s1>&#39;variants&#39;</span><span class=p>:</span> <span class=n>experiment_config</span><span class=p>[</span><span class=s1>&#39;variants&#39;</span><span class=p>],</span>
</span><span id=__span-41-18><a id=__codelineno-41-18 name=__codelineno-41-18 href=#__codelineno-41-18></a>            <span class=s1>&#39;success_metrics&#39;</span><span class=p>:</span> <span class=n>experiment_config</span><span class=p>[</span><span class=s1>&#39;success_metrics&#39;</span><span class=p>],</span>
</span><span id=__span-41-19><a id=__codelineno-41-19 name=__codelineno-41-19 href=#__codelineno-41-19></a>            <span class=s1>&#39;guardrail_metrics&#39;</span><span class=p>:</span> <span class=n>experiment_config</span><span class=p>[</span><span class=s1>&#39;guardrail_metrics&#39;</span><span class=p>],</span>
</span><span id=__span-41-20><a id=__codelineno-41-20 name=__codelineno-41-20 href=#__codelineno-41-20></a>            <span class=s1>&#39;minimum_detectable_effect&#39;</span><span class=p>:</span> <span class=n>experiment_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;mde&#39;</span><span class=p>,</span> <span class=mf>0.05</span><span class=p>),</span>
</span><span id=__span-41-21><a id=__codelineno-41-21 name=__codelineno-41-21 href=#__codelineno-41-21></a>            <span class=s1>&#39;statistical_power&#39;</span><span class=p>:</span> <span class=n>experiment_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;power&#39;</span><span class=p>,</span> <span class=mf>0.8</span><span class=p>)</span>
</span><span id=__span-41-22><a id=__codelineno-41-22 name=__codelineno-41-22 href=#__codelineno-41-22></a>        <span class=p>}</span>
</span><span id=__span-41-23><a id=__codelineno-41-23 name=__codelineno-41-23 href=#__codelineno-41-23></a>
</span><span id=__span-41-24><a id=__codelineno-41-24 name=__codelineno-41-24 href=#__codelineno-41-24></a>        <span class=c1># Calculate required sample size</span>
</span><span id=__span-41-25><a id=__codelineno-41-25 name=__codelineno-41-25 href=#__codelineno-41-25></a>        <span class=n>sample_size</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_sample_size</span><span class=p>(</span><span class=n>experiment</span><span class=p>)</span>
</span><span id=__span-41-26><a id=__codelineno-41-26 name=__codelineno-41-26 href=#__codelineno-41-26></a>        <span class=n>experiment</span><span class=p>[</span><span class=s1>&#39;required_sample_size&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>sample_size</span>
</span><span id=__span-41-27><a id=__codelineno-41-27 name=__codelineno-41-27 href=#__codelineno-41-27></a>
</span><span id=__span-41-28><a id=__codelineno-41-28 name=__codelineno-41-28 href=#__codelineno-41-28></a>        <span class=c1># Store experiment configuration</span>
</span><span id=__span-41-29><a id=__codelineno-41-29 name=__codelineno-41-29 href=#__codelineno-41-29></a>        <span class=bp>self</span><span class=o>.</span><span class=n>experiment_store</span><span class=o>.</span><span class=n>save_experiment</span><span class=p>(</span><span class=n>experiment</span><span class=p>)</span>
</span><span id=__span-41-30><a id=__codelineno-41-30 name=__codelineno-41-30 href=#__codelineno-41-30></a>
</span><span id=__span-41-31><a id=__codelineno-41-31 name=__codelineno-41-31 href=#__codelineno-41-31></a>        <span class=k>return</span> <span class=n>experiment</span><span class=p>[</span><span class=s1>&#39;experiment_id&#39;</span><span class=p>]</span>
</span><span id=__span-41-32><a id=__codelineno-41-32 name=__codelineno-41-32 href=#__codelineno-41-32></a>
</span><span id=__span-41-33><a id=__codelineno-41-33 name=__codelineno-41-33 href=#__codelineno-41-33></a>    <span class=k>def</span><span class=w> </span><span class=nf>assign_user_to_variant</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>,</span> <span class=n>experiment_id</span><span class=p>):</span>
</span><span id=__span-41-34><a id=__codelineno-41-34 name=__codelineno-41-34 href=#__codelineno-41-34></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Assign a user to an experiment variant.&quot;&quot;&quot;</span>
</span><span id=__span-41-35><a id=__codelineno-41-35 name=__codelineno-41-35 href=#__codelineno-41-35></a>
</span><span id=__span-41-36><a id=__codelineno-41-36 name=__codelineno-41-36 href=#__codelineno-41-36></a>        <span class=n>experiment</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>experiment_store</span><span class=o>.</span><span class=n>get_experiment</span><span class=p>(</span><span class=n>experiment_id</span><span class=p>)</span>
</span><span id=__span-41-37><a id=__codelineno-41-37 name=__codelineno-41-37 href=#__codelineno-41-37></a>
</span><span id=__span-41-38><a id=__codelineno-41-38 name=__codelineno-41-38 href=#__codelineno-41-38></a>        <span class=c1># Check if experiment is active</span>
</span><span id=__span-41-39><a id=__codelineno-41-39 name=__codelineno-41-39 href=#__codelineno-41-39></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_experiment_active</span><span class=p>(</span><span class=n>experiment</span><span class=p>):</span>
</span><span id=__span-41-40><a id=__codelineno-41-40 name=__codelineno-41-40 href=#__codelineno-41-40></a>            <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-41-41><a id=__codelineno-41-41 name=__codelineno-41-41 href=#__codelineno-41-41></a>
</span><span id=__span-41-42><a id=__codelineno-41-42 name=__codelineno-41-42 href=#__codelineno-41-42></a>        <span class=c1># Check if user is eligible</span>
</span><span id=__span-41-43><a id=__codelineno-41-43 name=__codelineno-41-43 href=#__codelineno-41-43></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_user_eligible</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>experiment</span><span class=p>):</span>
</span><span id=__span-41-44><a id=__codelineno-41-44 name=__codelineno-41-44 href=#__codelineno-41-44></a>            <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-41-45><a id=__codelineno-41-45 name=__codelineno-41-45 href=#__codelineno-41-45></a>
</span><span id=__span-41-46><a id=__codelineno-41-46 name=__codelineno-41-46 href=#__codelineno-41-46></a>        <span class=c1># Get or create assignment</span>
</span><span id=__span-41-47><a id=__codelineno-41-47 name=__codelineno-41-47 href=#__codelineno-41-47></a>        <span class=n>assignment</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>assignment_service</span><span class=o>.</span><span class=n>get_assignment</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>experiment_id</span><span class=p>)</span>
</span><span id=__span-41-48><a id=__codelineno-41-48 name=__codelineno-41-48 href=#__codelineno-41-48></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>assignment</span><span class=p>:</span>
</span><span id=__span-41-49><a id=__codelineno-41-49 name=__codelineno-41-49 href=#__codelineno-41-49></a>            <span class=n>assignment</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>assignment_service</span><span class=o>.</span><span class=n>create_assignment</span><span class=p>(</span>
</span><span id=__span-41-50><a id=__codelineno-41-50 name=__codelineno-41-50 href=#__codelineno-41-50></a>                <span class=n>user_id</span><span class=p>,</span> <span class=n>experiment_id</span><span class=p>,</span> <span class=n>experiment</span><span class=p>[</span><span class=s1>&#39;variants&#39;</span><span class=p>]</span>
</span><span id=__span-41-51><a id=__codelineno-41-51 name=__codelineno-41-51 href=#__codelineno-41-51></a>            <span class=p>)</span>
</span><span id=__span-41-52><a id=__codelineno-41-52 name=__codelineno-41-52 href=#__codelineno-41-52></a>
</span><span id=__span-41-53><a id=__codelineno-41-53 name=__codelineno-41-53 href=#__codelineno-41-53></a>        <span class=k>return</span> <span class=n>assignment</span><span class=p>[</span><span class=s1>&#39;variant&#39;</span><span class=p>]</span>
</span><span id=__span-41-54><a id=__codelineno-41-54 name=__codelineno-41-54 href=#__codelineno-41-54></a>
</span><span id=__span-41-55><a id=__codelineno-41-55 name=__codelineno-41-55 href=#__codelineno-41-55></a>    <span class=k>def</span><span class=w> </span><span class=nf>analyze_experiment_results</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>experiment_id</span><span class=p>):</span>
</span><span id=__span-41-56><a id=__codelineno-41-56 name=__codelineno-41-56 href=#__codelineno-41-56></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Analyze the results of an A/B test experiment.&quot;&quot;&quot;</span>
</span><span id=__span-41-57><a id=__codelineno-41-57 name=__codelineno-41-57 href=#__codelineno-41-57></a>
</span><span id=__span-41-58><a id=__codelineno-41-58 name=__codelineno-41-58 href=#__codelineno-41-58></a>        <span class=n>experiment</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>experiment_store</span><span class=o>.</span><span class=n>get_experiment</span><span class=p>(</span><span class=n>experiment_id</span><span class=p>)</span>
</span><span id=__span-41-59><a id=__codelineno-41-59 name=__codelineno-41-59 href=#__codelineno-41-59></a>        <span class=n>assignments</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>assignment_service</span><span class=o>.</span><span class=n>get_experiment_assignments</span><span class=p>(</span><span class=n>experiment_id</span><span class=p>)</span>
</span><span id=__span-41-60><a id=__codelineno-41-60 name=__codelineno-41-60 href=#__codelineno-41-60></a>
</span><span id=__span-41-61><a id=__codelineno-41-61 name=__codelineno-41-61 href=#__codelineno-41-61></a>        <span class=c1># Collect metrics for each variant</span>
</span><span id=__span-41-62><a id=__codelineno-41-62 name=__codelineno-41-62 href=#__codelineno-41-62></a>        <span class=n>variant_results</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-41-63><a id=__codelineno-41-63 name=__codelineno-41-63 href=#__codelineno-41-63></a>        <span class=k>for</span> <span class=n>variant</span> <span class=ow>in</span> <span class=n>experiment</span><span class=p>[</span><span class=s1>&#39;variants&#39;</span><span class=p>]:</span>
</span><span id=__span-41-64><a id=__codelineno-41-64 name=__codelineno-41-64 href=#__codelineno-41-64></a>            <span class=n>variant_users</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-41-65><a id=__codelineno-41-65 name=__codelineno-41-65 href=#__codelineno-41-65></a>                <span class=n>a</span><span class=p>[</span><span class=s1>&#39;user_id&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>a</span> <span class=ow>in</span> <span class=n>assignments</span>
</span><span id=__span-41-66><a id=__codelineno-41-66 name=__codelineno-41-66 href=#__codelineno-41-66></a>                <span class=k>if</span> <span class=n>a</span><span class=p>[</span><span class=s1>&#39;variant&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=n>variant</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span>
</span><span id=__span-41-67><a id=__codelineno-41-67 name=__codelineno-41-67 href=#__codelineno-41-67></a>            <span class=p>]</span>
</span><span id=__span-41-68><a id=__codelineno-41-68 name=__codelineno-41-68 href=#__codelineno-41-68></a>
</span><span id=__span-41-69><a id=__codelineno-41-69 name=__codelineno-41-69 href=#__codelineno-41-69></a>            <span class=n>variant_metrics</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>collect_user_metrics</span><span class=p>(</span>
</span><span id=__span-41-70><a id=__codelineno-41-70 name=__codelineno-41-70 href=#__codelineno-41-70></a>                <span class=n>variant_users</span><span class=p>,</span>
</span><span id=__span-41-71><a id=__codelineno-41-71 name=__codelineno-41-71 href=#__codelineno-41-71></a>                <span class=n>experiment</span><span class=p>[</span><span class=s1>&#39;start_date&#39;</span><span class=p>],</span>
</span><span id=__span-41-72><a id=__codelineno-41-72 name=__codelineno-41-72 href=#__codelineno-41-72></a>                <span class=n>experiment</span><span class=p>[</span><span class=s1>&#39;end_date&#39;</span><span class=p>]</span>
</span><span id=__span-41-73><a id=__codelineno-41-73 name=__codelineno-41-73 href=#__codelineno-41-73></a>            <span class=p>)</span>
</span><span id=__span-41-74><a id=__codelineno-41-74 name=__codelineno-41-74 href=#__codelineno-41-74></a>
</span><span id=__span-41-75><a id=__codelineno-41-75 name=__codelineno-41-75 href=#__codelineno-41-75></a>            <span class=n>variant_results</span><span class=p>[</span><span class=n>variant</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]]</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-41-76><a id=__codelineno-41-76 name=__codelineno-41-76 href=#__codelineno-41-76></a>                <span class=s1>&#39;user_count&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>variant_users</span><span class=p>),</span>
</span><span id=__span-41-77><a id=__codelineno-41-77 name=__codelineno-41-77 href=#__codelineno-41-77></a>                <span class=s1>&#39;metrics&#39;</span><span class=p>:</span> <span class=n>variant_metrics</span>
</span><span id=__span-41-78><a id=__codelineno-41-78 name=__codelineno-41-78 href=#__codelineno-41-78></a>            <span class=p>}</span>
</span><span id=__span-41-79><a id=__codelineno-41-79 name=__codelineno-41-79 href=#__codelineno-41-79></a>
</span><span id=__span-41-80><a id=__codelineno-41-80 name=__codelineno-41-80 href=#__codelineno-41-80></a>        <span class=c1># Perform statistical analysis</span>
</span><span id=__span-41-81><a id=__codelineno-41-81 name=__codelineno-41-81 href=#__codelineno-41-81></a>        <span class=n>statistical_results</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>perform_statistical_tests</span><span class=p>(</span>
</span><span id=__span-41-82><a id=__codelineno-41-82 name=__codelineno-41-82 href=#__codelineno-41-82></a>            <span class=n>variant_results</span><span class=p>,</span> <span class=n>experiment</span><span class=p>[</span><span class=s1>&#39;success_metrics&#39;</span><span class=p>]</span>
</span><span id=__span-41-83><a id=__codelineno-41-83 name=__codelineno-41-83 href=#__codelineno-41-83></a>        <span class=p>)</span>
</span><span id=__span-41-84><a id=__codelineno-41-84 name=__codelineno-41-84 href=#__codelineno-41-84></a>
</span><span id=__span-41-85><a id=__codelineno-41-85 name=__codelineno-41-85 href=#__codelineno-41-85></a>        <span class=c1># Check guardrail metrics</span>
</span><span id=__span-41-86><a id=__codelineno-41-86 name=__codelineno-41-86 href=#__codelineno-41-86></a>        <span class=n>guardrail_results</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>check_guardrail_metrics</span><span class=p>(</span>
</span><span id=__span-41-87><a id=__codelineno-41-87 name=__codelineno-41-87 href=#__codelineno-41-87></a>            <span class=n>variant_results</span><span class=p>,</span> <span class=n>experiment</span><span class=p>[</span><span class=s1>&#39;guardrail_metrics&#39;</span><span class=p>]</span>
</span><span id=__span-41-88><a id=__codelineno-41-88 name=__codelineno-41-88 href=#__codelineno-41-88></a>        <span class=p>)</span>
</span><span id=__span-41-89><a id=__codelineno-41-89 name=__codelineno-41-89 href=#__codelineno-41-89></a>
</span><span id=__span-41-90><a id=__codelineno-41-90 name=__codelineno-41-90 href=#__codelineno-41-90></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-41-91><a id=__codelineno-41-91 name=__codelineno-41-91 href=#__codelineno-41-91></a>            <span class=s1>&#39;experiment_id&#39;</span><span class=p>:</span> <span class=n>experiment_id</span><span class=p>,</span>
</span><span id=__span-41-92><a id=__codelineno-41-92 name=__codelineno-41-92 href=#__codelineno-41-92></a>            <span class=s1>&#39;variant_results&#39;</span><span class=p>:</span> <span class=n>variant_results</span><span class=p>,</span>
</span><span id=__span-41-93><a id=__codelineno-41-93 name=__codelineno-41-93 href=#__codelineno-41-93></a>            <span class=s1>&#39;statistical_results&#39;</span><span class=p>:</span> <span class=n>statistical_results</span><span class=p>,</span>
</span><span id=__span-41-94><a id=__codelineno-41-94 name=__codelineno-41-94 href=#__codelineno-41-94></a>            <span class=s1>&#39;guardrail_results&#39;</span><span class=p>:</span> <span class=n>guardrail_results</span><span class=p>,</span>
</span><span id=__span-41-95><a id=__codelineno-41-95 name=__codelineno-41-95 href=#__codelineno-41-95></a>            <span class=s1>&#39;recommendation&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_experiment_recommendation</span><span class=p>(</span>
</span><span id=__span-41-96><a id=__codelineno-41-96 name=__codelineno-41-96 href=#__codelineno-41-96></a>                <span class=n>statistical_results</span><span class=p>,</span> <span class=n>guardrail_results</span>
</span><span id=__span-41-97><a id=__codelineno-41-97 name=__codelineno-41-97 href=#__codelineno-41-97></a>            <span class=p>)</span>
</span><span id=__span-41-98><a id=__codelineno-41-98 name=__codelineno-41-98 href=#__codelineno-41-98></a>        <span class=p>}</span>
</span></code></pre></div> <h3 id=talent-shortage><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#talent-shortage>The Talent Shortage Reality</a></h3> <p>One of the biggest challenges facing MLOps adoption is the shortage of qualified talent. This isn't just about finding data scientists - it's about finding people who understand both ML and operations at scale.</p> <h4 id=the-skills-gap><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#the-skills-gap>The Skills Gap</a></h4> <p>From my experience hiring and building ML teams, the talent shortage manifests in several ways:</p> <ol> <li><strong>ML Engineers</strong>: People who can build and deploy ML systems at scale are rare</li> <li><strong>MLOps Engineers</strong>: Even rarer are people who understand both ML and DevOps practices</li> <li><strong>Product-Aware Data Scientists</strong>: Many data scientists lack understanding of how their models will be used in production</li> <li><strong>Business-Technical Bridge</strong>: Few people can translate between technical ML capabilities and business requirements</li> </ol> <h4 id=building-internal-capability><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#building-internal-capability>Building Internal Capability</a></h4> <p>Rather than competing for scarce external talent, many organizations are better served by building internal capabilities:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=k>class</span><span class=w> </span><span class=nc>MLOpsTrainingProgram</span><span class=p>:</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a>        <span class=bp>self</span><span class=o>.</span><span class=n>curriculum</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>define_curriculum</span><span class=p>()</span>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>hands_on_projects</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>define_projects</span><span class=p>()</span>
</span><span id=__span-42-5><a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a>        <span class=bp>self</span><span class=o>.</span><span class=n>mentorship_program</span> <span class=o>=</span> <span class=n>MentorshipProgram</span><span class=p>()</span>
</span><span id=__span-42-6><a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a>
</span><span id=__span-42-7><a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a>    <span class=k>def</span><span class=w> </span><span class=nf>define_curriculum</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-42-8><a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Define the MLOps training curriculum.&quot;&quot;&quot;</span>
</span><span id=__span-42-9><a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-42-10><a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a>            <span class=s1>&#39;fundamentals&#39;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-42-11><a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a>                <span class=s1>&#39;ML Lifecycle Management&#39;</span><span class=p>,</span>
</span><span id=__span-42-12><a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a>                <span class=s1>&#39;Model Versioning and Reproducibility&#39;</span><span class=p>,</span>
</span><span id=__span-42-13><a id=__codelineno-42-13 name=__codelineno-42-13 href=#__codelineno-42-13></a>                <span class=s1>&#39;Data Pipeline Design&#39;</span><span class=p>,</span>
</span><span id=__span-42-14><a id=__codelineno-42-14 name=__codelineno-42-14 href=#__codelineno-42-14></a>                <span class=s1>&#39;Model Monitoring and Alerting&#39;</span>
</span><span id=__span-42-15><a id=__codelineno-42-15 name=__codelineno-42-15 href=#__codelineno-42-15></a>            <span class=p>],</span>
</span><span id=__span-42-16><a id=__codelineno-42-16 name=__codelineno-42-16 href=#__codelineno-42-16></a>            <span class=s1>&#39;infrastructure&#39;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-42-17><a id=__codelineno-42-17 name=__codelineno-42-17 href=#__codelineno-42-17></a>                <span class=s1>&#39;Container Orchestration for ML&#39;</span><span class=p>,</span>
</span><span id=__span-42-18><a id=__codelineno-42-18 name=__codelineno-42-18 href=#__codelineno-42-18></a>                <span class=s1>&#39;Feature Store Architecture&#39;</span><span class=p>,</span>
</span><span id=__span-42-19><a id=__codelineno-42-19 name=__codelineno-42-19 href=#__codelineno-42-19></a>                <span class=s1>&#39;Model Serving Patterns&#39;</span><span class=p>,</span>
</span><span id=__span-42-20><a id=__codelineno-42-20 name=__codelineno-42-20 href=#__codelineno-42-20></a>                <span class=s1>&#39;Scalable Training Infrastructure&#39;</span>
</span><span id=__span-42-21><a id=__codelineno-42-21 name=__codelineno-42-21 href=#__codelineno-42-21></a>            <span class=p>],</span>
</span><span id=__span-42-22><a id=__codelineno-42-22 name=__codelineno-42-22 href=#__codelineno-42-22></a>            <span class=s1>&#39;governance&#39;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-42-23><a id=__codelineno-42-23 name=__codelineno-42-23 href=#__codelineno-42-23></a>                <span class=s1>&#39;Model Risk Management&#39;</span><span class=p>,</span>
</span><span id=__span-42-24><a id=__codelineno-42-24 name=__codelineno-42-24 href=#__codelineno-42-24></a>                <span class=s1>&#39;Bias Detection and Mitigation&#39;</span><span class=p>,</span>
</span><span id=__span-42-25><a id=__codelineno-42-25 name=__codelineno-42-25 href=#__codelineno-42-25></a>                <span class=s1>&#39;Explainability and Interpretability&#39;</span><span class=p>,</span>
</span><span id=__span-42-26><a id=__codelineno-42-26 name=__codelineno-42-26 href=#__codelineno-42-26></a>                <span class=s1>&#39;Regulatory Compliance&#39;</span>
</span><span id=__span-42-27><a id=__codelineno-42-27 name=__codelineno-42-27 href=#__codelineno-42-27></a>            <span class=p>],</span>
</span><span id=__span-42-28><a id=__codelineno-42-28 name=__codelineno-42-28 href=#__codelineno-42-28></a>            <span class=s1>&#39;business_integration&#39;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-42-29><a id=__codelineno-42-29 name=__codelineno-42-29 href=#__codelineno-42-29></a>                <span class=s1>&#39;A/B Testing for ML&#39;</span><span class=p>,</span>
</span><span id=__span-42-30><a id=__codelineno-42-30 name=__codelineno-42-30 href=#__codelineno-42-30></a>                <span class=s1>&#39;Business Impact Measurement&#39;</span><span class=p>,</span>
</span><span id=__span-42-31><a id=__codelineno-42-31 name=__codelineno-42-31 href=#__codelineno-42-31></a>                <span class=s1>&#39;Stakeholder Communication&#39;</span><span class=p>,</span>
</span><span id=__span-42-32><a id=__codelineno-42-32 name=__codelineno-42-32 href=#__codelineno-42-32></a>                <span class=s1>&#39;ROI Analysis for ML Projects&#39;</span>
</span><span id=__span-42-33><a id=__codelineno-42-33 name=__codelineno-42-33 href=#__codelineno-42-33></a>            <span class=p>]</span>
</span><span id=__span-42-34><a id=__codelineno-42-34 name=__codelineno-42-34 href=#__codelineno-42-34></a>        <span class=p>}</span>
</span><span id=__span-42-35><a id=__codelineno-42-35 name=__codelineno-42-35 href=#__codelineno-42-35></a>
</span><span id=__span-42-36><a id=__codelineno-42-36 name=__codelineno-42-36 href=#__codelineno-42-36></a>    <span class=k>def</span><span class=w> </span><span class=nf>create_learning_path</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>employee_background</span><span class=p>,</span> <span class=n>target_role</span><span class=p>):</span>
</span><span id=__span-42-37><a id=__codelineno-42-37 name=__codelineno-42-37 href=#__codelineno-42-37></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create a personalized learning path.&quot;&quot;&quot;</span>
</span><span id=__span-42-38><a id=__codelineno-42-38 name=__codelineno-42-38 href=#__codelineno-42-38></a>
</span><span id=__span-42-39><a id=__codelineno-42-39 name=__codelineno-42-39 href=#__codelineno-42-39></a>        <span class=k>if</span> <span class=n>employee_background</span> <span class=o>==</span> <span class=s1>&#39;software_engineer&#39;</span><span class=p>:</span>
</span><span id=__span-42-40><a id=__codelineno-42-40 name=__codelineno-42-40 href=#__codelineno-42-40></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>software_engineer_to_mlopsdeveloper</span><span class=p>()</span>
</span><span id=__span-42-41><a id=__codelineno-42-41 name=__codelineno-42-41 href=#__codelineno-42-41></a>        <span class=k>elif</span> <span class=n>employee_background</span> <span class=o>==</span> <span class=s1>&#39;data_scientist&#39;</span><span class=p>:</span>
</span><span id=__span-42-42><a id=__codelineno-42-42 name=__codelineno-42-42 href=#__codelineno-42-42></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>data_scientist_to_ml_engineer</span><span class=p>()</span>
</span><span id=__span-42-43><a id=__codelineno-42-43 name=__codelineno-42-43 href=#__codelineno-42-43></a>        <span class=k>elif</span> <span class=n>employee_background</span> <span class=o>==</span> <span class=s1>&#39;devops_engineer&#39;</span><span class=p>:</span>
</span><span id=__span-42-44><a id=__codelineno-42-44 name=__codelineno-42-44 href=#__codelineno-42-44></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>devops_to_mlops_engineer</span><span class=p>()</span>
</span><span id=__span-42-45><a id=__codelineno-42-45 name=__codelineno-42-45 href=#__codelineno-42-45></a>
</span><span id=__span-42-46><a id=__codelineno-42-46 name=__codelineno-42-46 href=#__codelineno-42-46></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>general_mlops_path</span><span class=p>()</span>
</span><span id=__span-42-47><a id=__codelineno-42-47 name=__codelineno-42-47 href=#__codelineno-42-47></a>
</span><span id=__span-42-48><a id=__codelineno-42-48 name=__codelineno-42-48 href=#__codelineno-42-48></a>    <span class=k>def</span><span class=w> </span><span class=nf>software_engineer_to_mlopsdeveloper</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-42-49><a id=__codelineno-42-49 name=__codelineno-42-49 href=#__codelineno-42-49></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Learning path for software engineers transitioning to MLOps.&quot;&quot;&quot;</span>
</span><span id=__span-42-50><a id=__codelineno-42-50 name=__codelineno-42-50 href=#__codelineno-42-50></a>        <span class=k>return</span> <span class=p>[</span>
</span><span id=__span-42-51><a id=__codelineno-42-51 name=__codelineno-42-51 href=#__codelineno-42-51></a>            <span class=c1># Build on existing software engineering skills</span>
</span><span id=__span-42-52><a id=__codelineno-42-52 name=__codelineno-42-52 href=#__codelineno-42-52></a>            <span class=s1>&#39;ML Fundamentals for Engineers&#39;</span><span class=p>,</span>
</span><span id=__span-42-53><a id=__codelineno-42-53 name=__codelineno-42-53 href=#__codelineno-42-53></a>            <span class=s1>&#39;Data Pipeline Architecture&#39;</span><span class=p>,</span>
</span><span id=__span-42-54><a id=__codelineno-42-54 name=__codelineno-42-54 href=#__codelineno-42-54></a>            <span class=s1>&#39;Model Serving and APIs&#39;</span><span class=p>,</span>
</span><span id=__span-42-55><a id=__codelineno-42-55 name=__codelineno-42-55 href=#__codelineno-42-55></a>            <span class=s1>&#39;ML System Design Patterns&#39;</span><span class=p>,</span>
</span><span id=__span-42-56><a id=__codelineno-42-56 name=__codelineno-42-56 href=#__codelineno-42-56></a>            <span class=c1># New skills specific to ML</span>
</span><span id=__span-42-57><a id=__codelineno-42-57 name=__codelineno-42-57 href=#__codelineno-42-57></a>            <span class=s1>&#39;Feature Engineering Patterns&#39;</span><span class=p>,</span>
</span><span id=__span-42-58><a id=__codelineno-42-58 name=__codelineno-42-58 href=#__codelineno-42-58></a>            <span class=s1>&#39;Model Monitoring and Observability&#39;</span><span class=p>,</span>
</span><span id=__span-42-59><a id=__codelineno-42-59 name=__codelineno-42-59 href=#__codelineno-42-59></a>            <span class=s1>&#39;ML Testing Strategies&#39;</span><span class=p>,</span>
</span><span id=__span-42-60><a id=__codelineno-42-60 name=__codelineno-42-60 href=#__codelineno-42-60></a>            <span class=s1>&#39;Business Impact Measurement&#39;</span>
</span><span id=__span-42-61><a id=__codelineno-42-61 name=__codelineno-42-61 href=#__codelineno-42-61></a>        <span class=p>]</span>
</span></code></pre></div> <h4 id=creating-cross-functional-teams><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#creating-cross-functional-teams>Creating Cross-Functional Teams</a></h4> <p>Successful MLOps often requires cross-functional collaboration rather than individual expertise:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=k>class</span><span class=w> </span><span class=nc>CrossFunctionalMLTeam</span><span class=p>:</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>team_composition</span><span class=p>):</span>
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a>        <span class=bp>self</span><span class=o>.</span><span class=n>team_members</span> <span class=o>=</span> <span class=n>team_composition</span>
</span><span id=__span-43-4><a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>collaboration_tools</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>setup_collaboration_tools</span><span class=p>()</span>
</span><span id=__span-43-5><a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a>        <span class=bp>self</span><span class=o>.</span><span class=n>shared_responsibilities</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>define_shared_responsibilities</span><span class=p>()</span>
</span><span id=__span-43-6><a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a>
</span><span id=__span-43-7><a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a>    <span class=k>def</span><span class=w> </span><span class=nf>define_shared_responsibilities</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-43-8><a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Define how responsibilities are shared across the team.&quot;&quot;&quot;</span>
</span><span id=__span-43-9><a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-43-10><a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a>            <span class=s1>&#39;model_development&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-43-11><a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a>                <span class=s1>&#39;primary&#39;</span><span class=p>:</span> <span class=s1>&#39;data_scientist&#39;</span><span class=p>,</span>
</span><span id=__span-43-12><a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a>                <span class=s1>&#39;supporting&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;ml_engineer&#39;</span><span class=p>,</span> <span class=s1>&#39;domain_expert&#39;</span><span class=p>],</span>
</span><span id=__span-43-13><a id=__codelineno-43-13 name=__codelineno-43-13 href=#__codelineno-43-13></a>                <span class=s1>&#39;review&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;senior_data_scientist&#39;</span><span class=p>,</span> <span class=s1>&#39;ml_architect&#39;</span><span class=p>]</span>
</span><span id=__span-43-14><a id=__codelineno-43-14 name=__codelineno-43-14 href=#__codelineno-43-14></a>            <span class=p>},</span>
</span><span id=__span-43-15><a id=__codelineno-43-15 name=__codelineno-43-15 href=#__codelineno-43-15></a>            <span class=s1>&#39;deployment_pipeline&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-43-16><a id=__codelineno-43-16 name=__codelineno-43-16 href=#__codelineno-43-16></a>                <span class=s1>&#39;primary&#39;</span><span class=p>:</span> <span class=s1>&#39;ml_engineer&#39;</span><span class=p>,</span>
</span><span id=__span-43-17><a id=__codelineno-43-17 name=__codelineno-43-17 href=#__codelineno-43-17></a>                <span class=s1>&#39;supporting&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;devops_engineer&#39;</span><span class=p>,</span> <span class=s1>&#39;data_scientist&#39;</span><span class=p>],</span>
</span><span id=__span-43-18><a id=__codelineno-43-18 name=__codelineno-43-18 href=#__codelineno-43-18></a>                <span class=s1>&#39;review&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;platform_engineer&#39;</span><span class=p>]</span>
</span><span id=__span-43-19><a id=__codelineno-43-19 name=__codelineno-43-19 href=#__codelineno-43-19></a>            <span class=p>},</span>
</span><span id=__span-43-20><a id=__codelineno-43-20 name=__codelineno-43-20 href=#__codelineno-43-20></a>            <span class=s1>&#39;monitoring_setup&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-43-21><a id=__codelineno-43-21 name=__codelineno-43-21 href=#__codelineno-43-21></a>                <span class=s1>&#39;primary&#39;</span><span class=p>:</span> <span class=s1>&#39;ml_engineer&#39;</span><span class=p>,</span>
</span><span id=__span-43-22><a id=__codelineno-43-22 name=__codelineno-43-22 href=#__codelineno-43-22></a>                <span class=s1>&#39;supporting&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;devops_engineer&#39;</span><span class=p>,</span> <span class=s1>&#39;data_scientist&#39;</span><span class=p>],</span>
</span><span id=__span-43-23><a id=__codelineno-43-23 name=__codelineno-43-23 href=#__codelineno-43-23></a>                <span class=s1>&#39;review&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;sre_engineer&#39;</span><span class=p>]</span>
</span><span id=__span-43-24><a id=__codelineno-43-24 name=__codelineno-43-24 href=#__codelineno-43-24></a>            <span class=p>},</span>
</span><span id=__span-43-25><a id=__codelineno-43-25 name=__codelineno-43-25 href=#__codelineno-43-25></a>            <span class=s1>&#39;business_impact_analysis&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-43-26><a id=__codelineno-43-26 name=__codelineno-43-26 href=#__codelineno-43-26></a>                <span class=s1>&#39;primary&#39;</span><span class=p>:</span> <span class=s1>&#39;product_manager&#39;</span><span class=p>,</span>
</span><span id=__span-43-27><a id=__codelineno-43-27 name=__codelineno-43-27 href=#__codelineno-43-27></a>                <span class=s1>&#39;supporting&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;data_scientist&#39;</span><span class=p>,</span> <span class=s1>&#39;business_analyst&#39;</span><span class=p>],</span>
</span><span id=__span-43-28><a id=__codelineno-43-28 name=__codelineno-43-28 href=#__codelineno-43-28></a>                <span class=s1>&#39;review&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;data_science_manager&#39;</span><span class=p>]</span>
</span><span id=__span-43-29><a id=__codelineno-43-29 name=__codelineno-43-29 href=#__codelineno-43-29></a>            <span class=p>}</span>
</span><span id=__span-43-30><a id=__codelineno-43-30 name=__codelineno-43-30 href=#__codelineno-43-30></a>        <span class=p>}</span>
</span><span id=__span-43-31><a id=__codelineno-43-31 name=__codelineno-43-31 href=#__codelineno-43-31></a>
</span><span id=__span-43-32><a id=__codelineno-43-32 name=__codelineno-43-32 href=#__codelineno-43-32></a>    <span class=k>def</span><span class=w> </span><span class=nf>coordinate_project_workflow</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_requirements</span><span class=p>):</span>
</span><span id=__span-43-33><a id=__codelineno-43-33 name=__codelineno-43-33 href=#__codelineno-43-33></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Coordinate workflow across team members.&quot;&quot;&quot;</span>
</span><span id=__span-43-34><a id=__codelineno-43-34 name=__codelineno-43-34 href=#__codelineno-43-34></a>
</span><span id=__span-43-35><a id=__codelineno-43-35 name=__codelineno-43-35 href=#__codelineno-43-35></a>        <span class=n>workflow_stages</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-43-36><a id=__codelineno-43-36 name=__codelineno-43-36 href=#__codelineno-43-36></a>            <span class=p>{</span>
</span><span id=__span-43-37><a id=__codelineno-43-37 name=__codelineno-43-37 href=#__codelineno-43-37></a>                <span class=s1>&#39;stage&#39;</span><span class=p>:</span> <span class=s1>&#39;problem_definition&#39;</span><span class=p>,</span>
</span><span id=__span-43-38><a id=__codelineno-43-38 name=__codelineno-43-38 href=#__codelineno-43-38></a>                <span class=s1>&#39;owner&#39;</span><span class=p>:</span> <span class=s1>&#39;product_manager&#39;</span><span class=p>,</span>
</span><span id=__span-43-39><a id=__codelineno-43-39 name=__codelineno-43-39 href=#__codelineno-43-39></a>                <span class=s1>&#39;inputs&#39;</span><span class=p>:</span> <span class=n>project_requirements</span><span class=p>,</span>
</span><span id=__span-43-40><a id=__codelineno-43-40 name=__codelineno-43-40 href=#__codelineno-43-40></a>                <span class=s1>&#39;outputs&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;problem_statement&#39;</span><span class=p>,</span> <span class=s1>&#39;success_criteria&#39;</span><span class=p>],</span>
</span><span id=__span-43-41><a id=__codelineno-43-41 name=__codelineno-43-41 href=#__codelineno-43-41></a>                <span class=s1>&#39;duration_days&#39;</span><span class=p>:</span> <span class=mi>5</span>
</span><span id=__span-43-42><a id=__codelineno-43-42 name=__codelineno-43-42 href=#__codelineno-43-42></a>            <span class=p>},</span>
</span><span id=__span-43-43><a id=__codelineno-43-43 name=__codelineno-43-43 href=#__codelineno-43-43></a>            <span class=p>{</span>
</span><span id=__span-43-44><a id=__codelineno-43-44 name=__codelineno-43-44 href=#__codelineno-43-44></a>                <span class=s1>&#39;stage&#39;</span><span class=p>:</span> <span class=s1>&#39;data_exploration&#39;</span><span class=p>,</span>
</span><span id=__span-43-45><a id=__codelineno-43-45 name=__codelineno-43-45 href=#__codelineno-43-45></a>                <span class=s1>&#39;owner&#39;</span><span class=p>:</span> <span class=s1>&#39;data_scientist&#39;</span><span class=p>,</span>
</span><span id=__span-43-46><a id=__codelineno-43-46 name=__codelineno-43-46 href=#__codelineno-43-46></a>                <span class=s1>&#39;inputs&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;problem_statement&#39;</span><span class=p>,</span> <span class=s1>&#39;data_sources&#39;</span><span class=p>],</span>
</span><span id=__span-43-47><a id=__codelineno-43-47 name=__codelineno-43-47 href=#__codelineno-43-47></a>                <span class=s1>&#39;outputs&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;data_analysis_report&#39;</span><span class=p>,</span> <span class=s1>&#39;feature_recommendations&#39;</span><span class=p>],</span>
</span><span id=__span-43-48><a id=__codelineno-43-48 name=__codelineno-43-48 href=#__codelineno-43-48></a>                <span class=s1>&#39;duration_days&#39;</span><span class=p>:</span> <span class=mi>10</span>
</span><span id=__span-43-49><a id=__codelineno-43-49 name=__codelineno-43-49 href=#__codelineno-43-49></a>            <span class=p>},</span>
</span><span id=__span-43-50><a id=__codelineno-43-50 name=__codelineno-43-50 href=#__codelineno-43-50></a>            <span class=p>{</span>
</span><span id=__span-43-51><a id=__codelineno-43-51 name=__codelineno-43-51 href=#__codelineno-43-51></a>                <span class=s1>&#39;stage&#39;</span><span class=p>:</span> <span class=s1>&#39;infrastructure_setup&#39;</span><span class=p>,</span>
</span><span id=__span-43-52><a id=__codelineno-43-52 name=__codelineno-43-52 href=#__codelineno-43-52></a>                <span class=s1>&#39;owner&#39;</span><span class=p>:</span> <span class=s1>&#39;ml_engineer&#39;</span><span class=p>,</span>
</span><span id=__span-43-53><a id=__codelineno-43-53 name=__codelineno-43-53 href=#__codelineno-43-53></a>                <span class=s1>&#39;inputs&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;feature_recommendations&#39;</span><span class=p>,</span> <span class=s1>&#39;scale_requirements&#39;</span><span class=p>],</span>
</span><span id=__span-43-54><a id=__codelineno-43-54 name=__codelineno-43-54 href=#__codelineno-43-54></a>                <span class=s1>&#39;outputs&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;training_pipeline&#39;</span><span class=p>,</span> <span class=s1>&#39;serving_infrastructure&#39;</span><span class=p>],</span>
</span><span id=__span-43-55><a id=__codelineno-43-55 name=__codelineno-43-55 href=#__codelineno-43-55></a>                <span class=s1>&#39;duration_days&#39;</span><span class=p>:</span> <span class=mi>8</span><span class=p>,</span>
</span><span id=__span-43-56><a id=__codelineno-43-56 name=__codelineno-43-56 href=#__codelineno-43-56></a>                <span class=s1>&#39;parallel_with&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;data_exploration&#39;</span><span class=p>]</span>
</span><span id=__span-43-57><a id=__codelineno-43-57 name=__codelineno-43-57 href=#__codelineno-43-57></a>            <span class=p>},</span>
</span><span id=__span-43-58><a id=__codelineno-43-58 name=__codelineno-43-58 href=#__codelineno-43-58></a>            <span class=p>{</span>
</span><span id=__span-43-59><a id=__codelineno-43-59 name=__codelineno-43-59 href=#__codelineno-43-59></a>                <span class=s1>&#39;stage&#39;</span><span class=p>:</span> <span class=s1>&#39;model_development&#39;</span><span class=p>,</span>
</span><span id=__span-43-60><a id=__codelineno-43-60 name=__codelineno-43-60 href=#__codelineno-43-60></a>                <span class=s1>&#39;owner&#39;</span><span class=p>:</span> <span class=s1>&#39;data_scientist&#39;</span><span class=p>,</span>
</span><span id=__span-43-61><a id=__codelineno-43-61 name=__codelineno-43-61 href=#__codelineno-43-61></a>                <span class=s1>&#39;inputs&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;training_pipeline&#39;</span><span class=p>,</span> <span class=s1>&#39;processed_data&#39;</span><span class=p>],</span>
</span><span id=__span-43-62><a id=__codelineno-43-62 name=__codelineno-43-62 href=#__codelineno-43-62></a>                <span class=s1>&#39;outputs&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;trained_model&#39;</span><span class=p>,</span> <span class=s1>&#39;evaluation_report&#39;</span><span class=p>],</span>
</span><span id=__span-43-63><a id=__codelineno-43-63 name=__codelineno-43-63 href=#__codelineno-43-63></a>                <span class=s1>&#39;duration_days&#39;</span><span class=p>:</span> <span class=mi>15</span>
</span><span id=__span-43-64><a id=__codelineno-43-64 name=__codelineno-43-64 href=#__codelineno-43-64></a>            <span class=p>},</span>
</span><span id=__span-43-65><a id=__codelineno-43-65 name=__codelineno-43-65 href=#__codelineno-43-65></a>            <span class=p>{</span>
</span><span id=__span-43-66><a id=__codelineno-43-66 name=__codelineno-43-66 href=#__codelineno-43-66></a>                <span class=s1>&#39;stage&#39;</span><span class=p>:</span> <span class=s1>&#39;deployment_prep&#39;</span><span class=p>,</span>
</span><span id=__span-43-67><a id=__codelineno-43-67 name=__codelineno-43-67 href=#__codelineno-43-67></a>                <span class=s1>&#39;owner&#39;</span><span class=p>:</span> <span class=s1>&#39;ml_engineer&#39;</span><span class=p>,</span>
</span><span id=__span-43-68><a id=__codelineno-43-68 name=__codelineno-43-68 href=#__codelineno-43-68></a>                <span class=s1>&#39;inputs&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;trained_model&#39;</span><span class=p>,</span> <span class=s1>&#39;serving_infrastructure&#39;</span><span class=p>],</span>
</span><span id=__span-43-69><a id=__codelineno-43-69 name=__codelineno-43-69 href=#__codelineno-43-69></a>                <span class=s1>&#39;outputs&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;deployment_package&#39;</span><span class=p>,</span> <span class=s1>&#39;monitoring_setup&#39;</span><span class=p>],</span>
</span><span id=__span-43-70><a id=__codelineno-43-70 name=__codelineno-43-70 href=#__codelineno-43-70></a>                <span class=s1>&#39;duration_days&#39;</span><span class=p>:</span> <span class=mi>5</span>
</span><span id=__span-43-71><a id=__codelineno-43-71 name=__codelineno-43-71 href=#__codelineno-43-71></a>            <span class=p>},</span>
</span><span id=__span-43-72><a id=__codelineno-43-72 name=__codelineno-43-72 href=#__codelineno-43-72></a>            <span class=p>{</span>
</span><span id=__span-43-73><a id=__codelineno-43-73 name=__codelineno-43-73 href=#__codelineno-43-73></a>                <span class=s1>&#39;stage&#39;</span><span class=p>:</span> <span class=s1>&#39;production_validation&#39;</span><span class=p>,</span>
</span><span id=__span-43-74><a id=__codelineno-43-74 name=__codelineno-43-74 href=#__codelineno-43-74></a>                <span class=s1>&#39;owner&#39;</span><span class=p>:</span> <span class=s1>&#39;product_manager&#39;</span><span class=p>,</span>
</span><span id=__span-43-75><a id=__codelineno-43-75 name=__codelineno-43-75 href=#__codelineno-43-75></a>                <span class=s1>&#39;inputs&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;deployment_package&#39;</span><span class=p>,</span> <span class=s1>&#39;success_criteria&#39;</span><span class=p>],</span>
</span><span id=__span-43-76><a id=__codelineno-43-76 name=__codelineno-43-76 href=#__codelineno-43-76></a>                <span class=s1>&#39;outputs&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;launch_decision&#39;</span><span class=p>,</span> <span class=s1>&#39;rollout_plan&#39;</span><span class=p>],</span>
</span><span id=__span-43-77><a id=__codelineno-43-77 name=__codelineno-43-77 href=#__codelineno-43-77></a>                <span class=s1>&#39;duration_days&#39;</span><span class=p>:</span> <span class=mi>3</span>
</span><span id=__span-43-78><a id=__codelineno-43-78 name=__codelineno-43-78 href=#__codelineno-43-78></a>            <span class=p>}</span>
</span><span id=__span-43-79><a id=__codelineno-43-79 name=__codelineno-43-79 href=#__codelineno-43-79></a>        <span class=p>]</span>
</span><span id=__span-43-80><a id=__codelineno-43-80 name=__codelineno-43-80 href=#__codelineno-43-80></a>
</span><span id=__span-43-81><a id=__codelineno-43-81 name=__codelineno-43-81 href=#__codelineno-43-81></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_project_timeline</span><span class=p>(</span><span class=n>workflow_stages</span><span class=p>)</span>
</span></code></pre></div> <h3 id=cultural-adoption><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#cultural-adoption>Cultural Adoption and Organizational Change</a></h3> <p>Perhaps the biggest challenge in MLOps adoption is cultural change. Moving from ad-hoc ML experimentation to systematic, production-oriented practices requires significant organizational shifts.</p> <h4 id=common-cultural-barriers><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#common-cultural-barriers>Common Cultural Barriers</a></h4> <ol> <li><strong>Research vs. Production Mindset</strong>: Data scientists trained in research environments may resist production constraints</li> <li><strong>Perfectionism vs. Iteration</strong>: Academic backgrounds often emphasize perfect solutions over iterative improvement</li> <li><strong>Individual vs. Team Ownership</strong>: Transitioning from individual notebook development to collaborative systems</li> <li><strong>Technical Debt Tolerance</strong>: Different comfort levels with technical debt between research and engineering teams</li> </ol> <h4 id=strategies-for-cultural-change><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#strategies-for-cultural-change>Strategies for Cultural Change</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=k>class</span><span class=w> </span><span class=nc>MLOpsCultureInitiative</span><span class=p>:</span>
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>organization_context</span><span class=p>):</span>
</span><span id=__span-44-3><a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a>        <span class=bp>self</span><span class=o>.</span><span class=n>org_context</span> <span class=o>=</span> <span class=n>organization_context</span>
</span><span id=__span-44-4><a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>change_management</span> <span class=o>=</span> <span class=n>ChangeManagementFramework</span><span class=p>()</span>
</span><span id=__span-44-5><a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a>        <span class=bp>self</span><span class=o>.</span><span class=n>success_metrics</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>define_culture_metrics</span><span class=p>()</span>
</span><span id=__span-44-6><a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a>
</span><span id=__span-44-7><a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a>    <span class=k>def</span><span class=w> </span><span class=nf>assess_current_culture</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-44-8><a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Assess the current ML culture in the organization.&quot;&quot;&quot;</span>
</span><span id=__span-44-9><a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a>
</span><span id=__span-44-10><a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a>        <span class=n>assessment_areas</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-44-11><a id=__codelineno-44-11 name=__codelineno-44-11 href=#__codelineno-44-11></a>            <span class=s1>&#39;collaboration_patterns&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>assess_collaboration</span><span class=p>(),</span>
</span><span id=__span-44-12><a id=__codelineno-44-12 name=__codelineno-44-12 href=#__codelineno-44-12></a>            <span class=s1>&#39;quality_standards&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>assess_quality_practices</span><span class=p>(),</span>
</span><span id=__span-44-13><a id=__codelineno-44-13 name=__codelineno-44-13 href=#__codelineno-44-13></a>            <span class=s1>&#39;learning_mindset&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>assess_learning_culture</span><span class=p>(),</span>
</span><span id=__span-44-14><a id=__codelineno-44-14 name=__codelineno-44-14 href=#__codelineno-44-14></a>            <span class=s1>&#39;production_readiness&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>assess_production_mindset</span><span class=p>(),</span>
</span><span id=__span-44-15><a id=__codelineno-44-15 name=__codelineno-44-15 href=#__codelineno-44-15></a>            <span class=s1>&#39;measurement_culture&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>assess_measurement_practices</span><span class=p>()</span>
</span><span id=__span-44-16><a id=__codelineno-44-16 name=__codelineno-44-16 href=#__codelineno-44-16></a>        <span class=p>}</span>
</span><span id=__span-44-17><a id=__codelineno-44-17 name=__codelineno-44-17 href=#__codelineno-44-17></a>
</span><span id=__span-44-18><a id=__codelineno-44-18 name=__codelineno-44-18 href=#__codelineno-44-18></a>        <span class=k>return</span> <span class=n>assessment_areas</span>
</span><span id=__span-44-19><a id=__codelineno-44-19 name=__codelineno-44-19 href=#__codelineno-44-19></a>
</span><span id=__span-44-20><a id=__codelineno-44-20 name=__codelineno-44-20 href=#__codelineno-44-20></a>    <span class=k>def</span><span class=w> </span><span class=nf>design_culture_intervention</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>assessment_results</span><span class=p>):</span>
</span><span id=__span-44-21><a id=__codelineno-44-21 name=__codelineno-44-21 href=#__codelineno-44-21></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Design interventions based on culture assessment.&quot;&quot;&quot;</span>
</span><span id=__span-44-22><a id=__codelineno-44-22 name=__codelineno-44-22 href=#__codelineno-44-22></a>
</span><span id=__span-44-23><a id=__codelineno-44-23 name=__codelineno-44-23 href=#__codelineno-44-23></a>        <span class=n>interventions</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-44-24><a id=__codelineno-44-24 name=__codelineno-44-24 href=#__codelineno-44-24></a>
</span><span id=__span-44-25><a id=__codelineno-44-25 name=__codelineno-44-25 href=#__codelineno-44-25></a>        <span class=c1># Address collaboration gaps</span>
</span><span id=__span-44-26><a id=__codelineno-44-26 name=__codelineno-44-26 href=#__codelineno-44-26></a>        <span class=k>if</span> <span class=n>assessment_results</span><span class=p>[</span><span class=s1>&#39;collaboration_patterns&#39;</span><span class=p>][</span><span class=s1>&#39;score&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mi>7</span><span class=p>:</span>
</span><span id=__span-44-27><a id=__codelineno-44-27 name=__codelineno-44-27 href=#__codelineno-44-27></a>            <span class=n>interventions</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-44-28><a id=__codelineno-44-28 name=__codelineno-44-28 href=#__codelineno-44-28></a>                <span class=s1>&#39;type&#39;</span><span class=p>:</span> <span class=s1>&#39;process_change&#39;</span><span class=p>,</span>
</span><span id=__span-44-29><a id=__codelineno-44-29 name=__codelineno-44-29 href=#__codelineno-44-29></a>                <span class=s1>&#39;intervention&#39;</span><span class=p>:</span> <span class=s1>&#39;cross_functional_ml_teams&#39;</span><span class=p>,</span>
</span><span id=__span-44-30><a id=__codelineno-44-30 name=__codelineno-44-30 href=#__codelineno-44-30></a>                <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=s1>&#39;Form cross-functional teams with shared ownership&#39;</span><span class=p>,</span>
</span><span id=__span-44-31><a id=__codelineno-44-31 name=__codelineno-44-31 href=#__codelineno-44-31></a>                <span class=s1>&#39;success_criteria&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;improved_handoff_times&#39;</span><span class=p>,</span> <span class=s1>&#39;reduced_production_issues&#39;</span><span class=p>]</span>
</span><span id=__span-44-32><a id=__codelineno-44-32 name=__codelineno-44-32 href=#__codelineno-44-32></a>            <span class=p>})</span>
</span><span id=__span-44-33><a id=__codelineno-44-33 name=__codelineno-44-33 href=#__codelineno-44-33></a>
</span><span id=__span-44-34><a id=__codelineno-44-34 name=__codelineno-44-34 href=#__codelineno-44-34></a>        <span class=c1># Address quality standards</span>
</span><span id=__span-44-35><a id=__codelineno-44-35 name=__codelineno-44-35 href=#__codelineno-44-35></a>        <span class=k>if</span> <span class=n>assessment_results</span><span class=p>[</span><span class=s1>&#39;quality_standards&#39;</span><span class=p>][</span><span class=s1>&#39;score&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mi>6</span><span class=p>:</span>
</span><span id=__span-44-36><a id=__codelineno-44-36 name=__codelineno-44-36 href=#__codelineno-44-36></a>            <span class=n>interventions</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-44-37><a id=__codelineno-44-37 name=__codelineno-44-37 href=#__codelineno-44-37></a>                <span class=s1>&#39;type&#39;</span><span class=p>:</span> <span class=s1>&#39;practice_adoption&#39;</span><span class=p>,</span>
</span><span id=__span-44-38><a id=__codelineno-44-38 name=__codelineno-44-38 href=#__codelineno-44-38></a>                <span class=s1>&#39;intervention&#39;</span><span class=p>:</span> <span class=s1>&#39;ml_code_review_process&#39;</span><span class=p>,</span>
</span><span id=__span-44-39><a id=__codelineno-44-39 name=__codelineno-44-39 href=#__codelineno-44-39></a>                <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=s1>&#39;Implement peer review for ML code and experiments&#39;</span><span class=p>,</span>
</span><span id=__span-44-40><a id=__codelineno-44-40 name=__codelineno-44-40 href=#__codelineno-44-40></a>                <span class=s1>&#39;success_criteria&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;code_review_coverage&#39;</span><span class=p>,</span> <span class=s1>&#39;defect_reduction&#39;</span><span class=p>]</span>
</span><span id=__span-44-41><a id=__codelineno-44-41 name=__codelineno-44-41 href=#__codelineno-44-41></a>            <span class=p>})</span>
</span><span id=__span-44-42><a id=__codelineno-44-42 name=__codelineno-44-42 href=#__codelineno-44-42></a>
</span><span id=__span-44-43><a id=__codelineno-44-43 name=__codelineno-44-43 href=#__codelineno-44-43></a>        <span class=c1># Address production mindset</span>
</span><span id=__span-44-44><a id=__codelineno-44-44 name=__codelineno-44-44 href=#__codelineno-44-44></a>        <span class=k>if</span> <span class=n>assessment_results</span><span class=p>[</span><span class=s1>&#39;production_readiness&#39;</span><span class=p>][</span><span class=s1>&#39;score&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mi>5</span><span class=p>:</span>
</span><span id=__span-44-45><a id=__codelineno-44-45 name=__codelineno-44-45 href=#__codelineno-44-45></a>            <span class=n>interventions</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-44-46><a id=__codelineno-44-46 name=__codelineno-44-46 href=#__codelineno-44-46></a>                <span class=s1>&#39;type&#39;</span><span class=p>:</span> <span class=s1>&#39;mindset_shift&#39;</span><span class=p>,</span>
</span><span id=__span-44-47><a id=__codelineno-44-47 name=__codelineno-44-47 href=#__codelineno-44-47></a>                <span class=s1>&#39;intervention&#39;</span><span class=p>:</span> <span class=s1>&#39;production_shadowing_program&#39;</span><span class=p>,</span>
</span><span id=__span-44-48><a id=__codelineno-44-48 name=__codelineno-44-48 href=#__codelineno-44-48></a>                <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=s1>&#39;Data scientists shadow production deployments&#39;</span><span class=p>,</span>
</span><span id=__span-44-49><a id=__codelineno-44-49 name=__codelineno-44-49 href=#__codelineno-44-49></a>                <span class=s1>&#39;success_criteria&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;production_awareness&#39;</span><span class=p>,</span> <span class=s1>&#39;deployment_success_rate&#39;</span><span class=p>]</span>
</span><span id=__span-44-50><a id=__codelineno-44-50 name=__codelineno-44-50 href=#__codelineno-44-50></a>            <span class=p>})</span>
</span><span id=__span-44-51><a id=__codelineno-44-51 name=__codelineno-44-51 href=#__codelineno-44-51></a>
</span><span id=__span-44-52><a id=__codelineno-44-52 name=__codelineno-44-52 href=#__codelineno-44-52></a>        <span class=k>return</span> <span class=n>interventions</span>
</span><span id=__span-44-53><a id=__codelineno-44-53 name=__codelineno-44-53 href=#__codelineno-44-53></a>
</span><span id=__span-44-54><a id=__codelineno-44-54 name=__codelineno-44-54 href=#__codelineno-44-54></a>    <span class=k>def</span><span class=w> </span><span class=nf>implement_gradual_adoption</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>interventions</span><span class=p>):</span>
</span><span id=__span-44-55><a id=__codelineno-44-55 name=__codelineno-44-55 href=#__codelineno-44-55></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Implement gradual adoption of MLOps practices.&quot;&quot;&quot;</span>
</span><span id=__span-44-56><a id=__codelineno-44-56 name=__codelineno-44-56 href=#__codelineno-44-56></a>
</span><span id=__span-44-57><a id=__codelineno-44-57 name=__codelineno-44-57 href=#__codelineno-44-57></a>        <span class=n>adoption_phases</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-44-58><a id=__codelineno-44-58 name=__codelineno-44-58 href=#__codelineno-44-58></a>            <span class=p>{</span>
</span><span id=__span-44-59><a id=__codelineno-44-59 name=__codelineno-44-59 href=#__codelineno-44-59></a>                <span class=s1>&#39;phase&#39;</span><span class=p>:</span> <span class=s1>&#39;foundation&#39;</span><span class=p>,</span>
</span><span id=__span-44-60><a id=__codelineno-44-60 name=__codelineno-44-60 href=#__codelineno-44-60></a>                <span class=s1>&#39;duration_months&#39;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
</span><span id=__span-44-61><a id=__codelineno-44-61 name=__codelineno-44-61 href=#__codelineno-44-61></a>                <span class=s1>&#39;goals&#39;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-44-62><a id=__codelineno-44-62 name=__codelineno-44-62 href=#__codelineno-44-62></a>                    <span class=s1>&#39;Establish basic version control for ML code&#39;</span><span class=p>,</span>
</span><span id=__span-44-63><a id=__codelineno-44-63 name=__codelineno-44-63 href=#__codelineno-44-63></a>                    <span class=s1>&#39;Implement simple model evaluation practices&#39;</span><span class=p>,</span>
</span><span id=__span-44-64><a id=__codelineno-44-64 name=__codelineno-44-64 href=#__codelineno-44-64></a>                    <span class=s1>&#39;Create shared experiment tracking&#39;</span>
</span><span id=__span-44-65><a id=__codelineno-44-65 name=__codelineno-44-65 href=#__codelineno-44-65></a>                <span class=p>],</span>
</span><span id=__span-44-66><a id=__codelineno-44-66 name=__codelineno-44-66 href=#__codelineno-44-66></a>                <span class=s1>&#39;success_criteria&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-44-67><a id=__codelineno-44-67 name=__codelineno-44-67 href=#__codelineno-44-67></a>                    <span class=s1>&#39;version_control_adoption&#39;</span><span class=p>:</span> <span class=mf>0.8</span><span class=p>,</span>
</span><span id=__span-44-68><a id=__codelineno-44-68 name=__codelineno-44-68 href=#__codelineno-44-68></a>                    <span class=s1>&#39;experiment_tracking_usage&#39;</span><span class=p>:</span> <span class=mf>0.6</span><span class=p>,</span>
</span><span id=__span-44-69><a id=__codelineno-44-69 name=__codelineno-44-69 href=#__codelineno-44-69></a>                    <span class=s1>&#39;model_evaluation_consistency&#39;</span><span class=p>:</span> <span class=mf>0.7</span>
</span><span id=__span-44-70><a id=__codelineno-44-70 name=__codelineno-44-70 href=#__codelineno-44-70></a>                <span class=p>}</span>
</span><span id=__span-44-71><a id=__codelineno-44-71 name=__codelineno-44-71 href=#__codelineno-44-71></a>            <span class=p>},</span>
</span><span id=__span-44-72><a id=__codelineno-44-72 name=__codelineno-44-72 href=#__codelineno-44-72></a>            <span class=p>{</span>
</span><span id=__span-44-73><a id=__codelineno-44-73 name=__codelineno-44-73 href=#__codelineno-44-73></a>                <span class=s1>&#39;phase&#39;</span><span class=p>:</span> <span class=s1>&#39;systematization&#39;</span><span class=p>,</span>
</span><span id=__span-44-74><a id=__codelineno-44-74 name=__codelineno-44-74 href=#__codelineno-44-74></a>                <span class=s1>&#39;duration_months&#39;</span><span class=p>:</span> <span class=mi>6</span><span class=p>,</span>
</span><span id=__span-44-75><a id=__codelineno-44-75 name=__codelineno-44-75 href=#__codelineno-44-75></a>                <span class=s1>&#39;goals&#39;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-44-76><a id=__codelineno-44-76 name=__codelineno-44-76 href=#__codelineno-44-76></a>                    <span class=s1>&#39;Deploy automated training pipelines&#39;</span><span class=p>,</span>
</span><span id=__span-44-77><a id=__codelineno-44-77 name=__codelineno-44-77 href=#__codelineno-44-77></a>                    <span class=s1>&#39;Implement model monitoring&#39;</span><span class=p>,</span>
</span><span id=__span-44-78><a id=__codelineno-44-78 name=__codelineno-44-78 href=#__codelineno-44-78></a>                    <span class=s1>&#39;Establish deployment standards&#39;</span>
</span><span id=__span-44-79><a id=__codelineno-44-79 name=__codelineno-44-79 href=#__codelineno-44-79></a>                <span class=p>],</span>
</span><span id=__span-44-80><a id=__codelineno-44-80 name=__codelineno-44-80 href=#__codelineno-44-80></a>                <span class=s1>&#39;success_criteria&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-44-81><a id=__codelineno-44-81 name=__codelineno-44-81 href=#__codelineno-44-81></a>                    <span class=s1>&#39;automated_pipeline_coverage&#39;</span><span class=p>:</span> <span class=mf>0.5</span><span class=p>,</span>
</span><span id=__span-44-82><a id=__codelineno-44-82 name=__codelineno-44-82 href=#__codelineno-44-82></a>                    <span class=s1>&#39;monitoring_implementation&#39;</span><span class=p>:</span> <span class=mf>0.8</span><span class=p>,</span>
</span><span id=__span-44-83><a id=__codelineno-44-83 name=__codelineno-44-83 href=#__codelineno-44-83></a>                    <span class=s1>&#39;deployment_standard_compliance&#39;</span><span class=p>:</span> <span class=mf>0.7</span>
</span><span id=__span-44-84><a id=__codelineno-44-84 name=__codelineno-44-84 href=#__codelineno-44-84></a>                <span class=p>}</span>
</span><span id=__span-44-85><a id=__codelineno-44-85 name=__codelineno-44-85 href=#__codelineno-44-85></a>            <span class=p>},</span>
</span><span id=__span-44-86><a id=__codelineno-44-86 name=__codelineno-44-86 href=#__codelineno-44-86></a>            <span class=p>{</span>
</span><span id=__span-44-87><a id=__codelineno-44-87 name=__codelineno-44-87 href=#__codelineno-44-87></a>                <span class=s1>&#39;phase&#39;</span><span class=p>:</span> <span class=s1>&#39;optimization&#39;</span><span class=p>,</span>
</span><span id=__span-44-88><a id=__codelineno-44-88 name=__codelineno-44-88 href=#__codelineno-44-88></a>                <span class=s1>&#39;duration_months&#39;</span><span class=p>:</span> <span class=mi>6</span><span class=p>,</span>
</span><span id=__span-44-89><a id=__codelineno-44-89 name=__codelineno-44-89 href=#__codelineno-44-89></a>                <span class=s1>&#39;goals&#39;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-44-90><a id=__codelineno-44-90 name=__codelineno-44-90 href=#__codelineno-44-90></a>                    <span class=s1>&#39;Advanced monitoring and alerting&#39;</span><span class=p>,</span>
</span><span id=__span-44-91><a id=__codelineno-44-91 name=__codelineno-44-91 href=#__codelineno-44-91></a>                    <span class=s1>&#39;Automated model retraining&#39;</span><span class=p>,</span>
</span><span id=__span-44-92><a id=__codelineno-44-92 name=__codelineno-44-92 href=#__codelineno-44-92></a>                    <span class=s1>&#39;Business impact measurement&#39;</span>
</span><span id=__span-44-93><a id=__codelineno-44-93 name=__codelineno-44-93 href=#__codelineno-44-93></a>                <span class=p>],</span>
</span><span id=__span-44-94><a id=__codelineno-44-94 name=__codelineno-44-94 href=#__codelineno-44-94></a>                <span class=s1>&#39;success_criteria&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-44-95><a id=__codelineno-44-95 name=__codelineno-44-95 href=#__codelineno-44-95></a>                    <span class=s1>&#39;advanced_monitoring_coverage&#39;</span><span class=p>:</span> <span class=mf>0.8</span><span class=p>,</span>
</span><span id=__span-44-96><a id=__codelineno-44-96 name=__codelineno-44-96 href=#__codelineno-44-96></a>                    <span class=s1>&#39;automated_retraining_adoption&#39;</span><span class=p>:</span> <span class=mf>0.6</span><span class=p>,</span>
</span><span id=__span-44-97><a id=__codelineno-44-97 name=__codelineno-44-97 href=#__codelineno-44-97></a>                    <span class=s1>&#39;business_impact_tracking&#39;</span><span class=p>:</span> <span class=mf>0.9</span>
</span><span id=__span-44-98><a id=__codelineno-44-98 name=__codelineno-44-98 href=#__codelineno-44-98></a>                <span class=p>}</span>
</span><span id=__span-44-99><a id=__codelineno-44-99 name=__codelineno-44-99 href=#__codelineno-44-99></a>            <span class=p>}</span>
</span><span id=__span-44-100><a id=__codelineno-44-100 name=__codelineno-44-100 href=#__codelineno-44-100></a>        <span class=p>]</span>
</span><span id=__span-44-101><a id=__codelineno-44-101 name=__codelineno-44-101 href=#__codelineno-44-101></a>
</span><span id=__span-44-102><a id=__codelineno-44-102 name=__codelineno-44-102 href=#__codelineno-44-102></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>execute_phased_rollout</span><span class=p>(</span><span class=n>adoption_phases</span><span class=p>)</span>
</span></code></pre></div> <h4 id=measuring-cultural-change><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#measuring-cultural-change>Measuring Cultural Change</a></h4> <p>It's important to measure the success of cultural initiatives:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=k>def</span><span class=w> </span><span class=nf>measure_mlops_culture_maturity</span><span class=p>(</span><span class=n>organization</span><span class=p>):</span>
</span><span id=__span-45-2><a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Measure MLOps culture maturity across dimensions.&quot;&quot;&quot;</span>
</span><span id=__span-45-3><a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a>
</span><span id=__span-45-4><a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a>    <span class=n>dimensions</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-45-5><a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a>        <span class=s1>&#39;collaboration&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-45-6><a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a>            <span class=s1>&#39;metrics&#39;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-45-7><a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a>                <span class=s1>&#39;cross_team_project_percentage&#39;</span><span class=p>,</span>
</span><span id=__span-45-8><a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a>                <span class=s1>&#39;shared_ownership_incidents&#39;</span><span class=p>,</span>
</span><span id=__span-45-9><a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a>                <span class=s1>&#39;knowledge_sharing_frequency&#39;</span>
</span><span id=__span-45-10><a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a>            <span class=p>],</span>
</span><span id=__span-45-11><a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a>            <span class=s1>&#39;weight&#39;</span><span class=p>:</span> <span class=mf>0.25</span>
</span><span id=__span-45-12><a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a>        <span class=p>},</span>
</span><span id=__span-45-13><a id=__codelineno-45-13 name=__codelineno-45-13 href=#__codelineno-45-13></a>        <span class=s1>&#39;quality_focus&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-45-14><a id=__codelineno-45-14 name=__codelineno-45-14 href=#__codelineno-45-14></a>            <span class=s1>&#39;metrics&#39;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-45-15><a id=__codelineno-45-15 name=__codelineno-45-15 href=#__codelineno-45-15></a>                <span class=s1>&#39;code_review_coverage&#39;</span><span class=p>,</span>
</span><span id=__span-45-16><a id=__codelineno-45-16 name=__codelineno-45-16 href=#__codelineno-45-16></a>                <span class=s1>&#39;testing_adoption_rate&#39;</span><span class=p>,</span>
</span><span id=__span-45-17><a id=__codelineno-45-17 name=__codelineno-45-17 href=#__codelineno-45-17></a>                <span class=s1>&#39;documentation_completeness&#39;</span>
</span><span id=__span-45-18><a id=__codelineno-45-18 name=__codelineno-45-18 href=#__codelineno-45-18></a>            <span class=p>],</span>
</span><span id=__span-45-19><a id=__codelineno-45-19 name=__codelineno-45-19 href=#__codelineno-45-19></a>            <span class=s1>&#39;weight&#39;</span><span class=p>:</span> <span class=mf>0.25</span>
</span><span id=__span-45-20><a id=__codelineno-45-20 name=__codelineno-45-20 href=#__codelineno-45-20></a>        <span class=p>},</span>
</span><span id=__span-45-21><a id=__codelineno-45-21 name=__codelineno-45-21 href=#__codelineno-45-21></a>        <span class=s1>&#39;production_mindset&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-45-22><a id=__codelineno-45-22 name=__codelineno-45-22 href=#__codelineno-45-22></a>            <span class=s1>&#39;metrics&#39;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-45-23><a id=__codelineno-45-23 name=__codelineno-45-23 href=#__codelineno-45-23></a>                <span class=s1>&#39;production_ready_model_percentage&#39;</span><span class=p>,</span>
</span><span id=__span-45-24><a id=__codelineno-45-24 name=__codelineno-45-24 href=#__codelineno-45-24></a>                <span class=s1>&#39;deployment_success_rate&#39;</span><span class=p>,</span>
</span><span id=__span-45-25><a id=__codelineno-45-25 name=__codelineno-45-25 href=#__codelineno-45-25></a>                <span class=s1>&#39;monitoring_coverage&#39;</span>
</span><span id=__span-45-26><a id=__codelineno-45-26 name=__codelineno-45-26 href=#__codelineno-45-26></a>            <span class=p>],</span>
</span><span id=__span-45-27><a id=__codelineno-45-27 name=__codelineno-45-27 href=#__codelineno-45-27></a>            <span class=s1>&#39;weight&#39;</span><span class=p>:</span> <span class=mf>0.25</span>
</span><span id=__span-45-28><a id=__codelineno-45-28 name=__codelineno-45-28 href=#__codelineno-45-28></a>        <span class=p>},</span>
</span><span id=__span-45-29><a id=__codelineno-45-29 name=__codelineno-45-29 href=#__codelineno-45-29></a>        <span class=s1>&#39;continuous_improvement&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-45-30><a id=__codelineno-45-30 name=__codelineno-45-30 href=#__codelineno-45-30></a>            <span class=s1>&#39;metrics&#39;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-45-31><a id=__codelineno-45-31 name=__codelineno-45-31 href=#__codelineno-45-31></a>                <span class=s1>&#39;experiment_velocity&#39;</span><span class=p>,</span>
</span><span id=__span-45-32><a id=__codelineno-45-32 name=__codelineno-45-32 href=#__codelineno-45-32></a>                <span class=s1>&#39;feedback_loop_completion_rate&#39;</span><span class=p>,</span>
</span><span id=__span-45-33><a id=__codelineno-45-33 name=__codelineno-45-33 href=#__codelineno-45-33></a>                <span class=s1>&#39;learning_from_failures_score&#39;</span>
</span><span id=__span-45-34><a id=__codelineno-45-34 name=__codelineno-45-34 href=#__codelineno-45-34></a>            <span class=p>],</span>
</span><span id=__span-45-35><a id=__codelineno-45-35 name=__codelineno-45-35 href=#__codelineno-45-35></a>            <span class=s1>&#39;weight&#39;</span><span class=p>:</span> <span class=mf>0.25</span>
</span><span id=__span-45-36><a id=__codelineno-45-36 name=__codelineno-45-36 href=#__codelineno-45-36></a>        <span class=p>}</span>
</span><span id=__span-45-37><a id=__codelineno-45-37 name=__codelineno-45-37 href=#__codelineno-45-37></a>    <span class=p>}</span>
</span><span id=__span-45-38><a id=__codelineno-45-38 name=__codelineno-45-38 href=#__codelineno-45-38></a>
</span><span id=__span-45-39><a id=__codelineno-45-39 name=__codelineno-45-39 href=#__codelineno-45-39></a>    <span class=n>maturity_score</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-45-40><a id=__codelineno-45-40 name=__codelineno-45-40 href=#__codelineno-45-40></a>    <span class=n>dimension_scores</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-45-41><a id=__codelineno-45-41 name=__codelineno-45-41 href=#__codelineno-45-41></a>
</span><span id=__span-45-42><a id=__codelineno-45-42 name=__codelineno-45-42 href=#__codelineno-45-42></a>    <span class=k>for</span> <span class=n>dimension</span><span class=p>,</span> <span class=n>config</span> <span class=ow>in</span> <span class=n>dimensions</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-45-43><a id=__codelineno-45-43 name=__codelineno-45-43 href=#__codelineno-45-43></a>        <span class=n>dimension_score</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-45-44><a id=__codelineno-45-44 name=__codelineno-45-44 href=#__codelineno-45-44></a>        <span class=k>for</span> <span class=n>metric</span> <span class=ow>in</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;metrics&#39;</span><span class=p>]:</span>
</span><span id=__span-45-45><a id=__codelineno-45-45 name=__codelineno-45-45 href=#__codelineno-45-45></a>            <span class=n>metric_value</span> <span class=o>=</span> <span class=n>organization</span><span class=o>.</span><span class=n>get_metric_value</span><span class=p>(</span><span class=n>metric</span><span class=p>)</span>
</span><span id=__span-45-46><a id=__codelineno-45-46 name=__codelineno-45-46 href=#__codelineno-45-46></a>            <span class=n>normalized_score</span> <span class=o>=</span> <span class=n>normalize_metric_score</span><span class=p>(</span><span class=n>metric</span><span class=p>,</span> <span class=n>metric_value</span><span class=p>)</span>
</span><span id=__span-45-47><a id=__codelineno-45-47 name=__codelineno-45-47 href=#__codelineno-45-47></a>            <span class=n>dimension_score</span> <span class=o>+=</span> <span class=n>normalized_score</span>
</span><span id=__span-45-48><a id=__codelineno-45-48 name=__codelineno-45-48 href=#__codelineno-45-48></a>
</span><span id=__span-45-49><a id=__codelineno-45-49 name=__codelineno-45-49 href=#__codelineno-45-49></a>        <span class=n>dimension_score</span> <span class=o>=</span> <span class=n>dimension_score</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;metrics&#39;</span><span class=p>])</span>
</span><span id=__span-45-50><a id=__codelineno-45-50 name=__codelineno-45-50 href=#__codelineno-45-50></a>        <span class=n>dimension_scores</span><span class=p>[</span><span class=n>dimension</span><span class=p>]</span> <span class=o>=</span> <span class=n>dimension_score</span>
</span><span id=__span-45-51><a id=__codelineno-45-51 name=__codelineno-45-51 href=#__codelineno-45-51></a>        <span class=n>maturity_score</span> <span class=o>+=</span> <span class=n>dimension_score</span> <span class=o>*</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;weight&#39;</span><span class=p>]</span>
</span><span id=__span-45-52><a id=__codelineno-45-52 name=__codelineno-45-52 href=#__codelineno-45-52></a>
</span><span id=__span-45-53><a id=__codelineno-45-53 name=__codelineno-45-53 href=#__codelineno-45-53></a>    <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-45-54><a id=__codelineno-45-54 name=__codelineno-45-54 href=#__codelineno-45-54></a>        <span class=s1>&#39;overall_maturity&#39;</span><span class=p>:</span> <span class=n>maturity_score</span><span class=p>,</span>
</span><span id=__span-45-55><a id=__codelineno-45-55 name=__codelineno-45-55 href=#__codelineno-45-55></a>        <span class=s1>&#39;dimension_scores&#39;</span><span class=p>:</span> <span class=n>dimension_scores</span><span class=p>,</span>
</span><span id=__span-45-56><a id=__codelineno-45-56 name=__codelineno-45-56 href=#__codelineno-45-56></a>        <span class=s1>&#39;maturity_level&#39;</span><span class=p>:</span> <span class=n>classify_maturity_level</span><span class=p>(</span><span class=n>maturity_score</span><span class=p>),</span>
</span><span id=__span-45-57><a id=__codelineno-45-57 name=__codelineno-45-57 href=#__codelineno-45-57></a>        <span class=s1>&#39;improvement_recommendations&#39;</span><span class=p>:</span> <span class=n>generate_recommendations</span><span class=p>(</span><span class=n>dimension_scores</span><span class=p>)</span>
</span><span id=__span-45-58><a id=__codelineno-45-58 name=__codelineno-45-58 href=#__codelineno-45-58></a>    <span class=p>}</span>
</span></code></pre></div> <h3 id=practical-recommendations><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#practical-recommendations>Practical Recommendations</a></h3> <p>Based on my experience implementing MLOps at scale, here are practical recommendations for organizations looking to improve their ML operations maturity.</p> <h4 id=start-small-think-big><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#start-small-think-big>Start Small, Think Big</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=k>class</span><span class=w> </span><span class=nc>MLOpsAdoptionStrategy</span><span class=p>:</span>
</span><span id=__span-46-2><a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>organization_size</span><span class=p>,</span> <span class=n>current_ml_maturity</span><span class=p>):</span>
</span><span id=__span-46-3><a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a>        <span class=bp>self</span><span class=o>.</span><span class=n>org_size</span> <span class=o>=</span> <span class=n>organization_size</span>
</span><span id=__span-46-4><a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>current_maturity</span> <span class=o>=</span> <span class=n>current_ml_maturity</span>
</span><span id=__span-46-5><a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a>        <span class=bp>self</span><span class=o>.</span><span class=n>recommended_path</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>determine_adoption_path</span><span class=p>()</span>
</span><span id=__span-46-6><a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a>
</span><span id=__span-46-7><a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a>    <span class=k>def</span><span class=w> </span><span class=nf>determine_adoption_path</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-46-8><a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Determine the appropriate MLOps adoption path.&quot;&quot;&quot;</span>
</span><span id=__span-46-9><a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a>
</span><span id=__span-46-10><a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>current_maturity</span> <span class=o>==</span> <span class=s1>&#39;experimental&#39;</span><span class=p>:</span>
</span><span id=__span-46-11><a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>experimental_to_basic_path</span><span class=p>()</span>
</span><span id=__span-46-12><a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a>        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>current_maturity</span> <span class=o>==</span> <span class=s1>&#39;basic_production&#39;</span><span class=p>:</span>
</span><span id=__span-46-13><a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>basic_to_intermediate_path</span><span class=p>()</span>
</span><span id=__span-46-14><a id=__codelineno-46-14 name=__codelineno-46-14 href=#__codelineno-46-14></a>        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>current_maturity</span> <span class=o>==</span> <span class=s1>&#39;intermediate&#39;</span><span class=p>:</span>
</span><span id=__span-46-15><a id=__codelineno-46-15 name=__codelineno-46-15 href=#__codelineno-46-15></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>intermediate_to_advanced_path</span><span class=p>()</span>
</span><span id=__span-46-16><a id=__codelineno-46-16 name=__codelineno-46-16 href=#__codelineno-46-16></a>
</span><span id=__span-46-17><a id=__codelineno-46-17 name=__codelineno-46-17 href=#__codelineno-46-17></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>starting_from_scratch_path</span><span class=p>()</span>
</span><span id=__span-46-18><a id=__codelineno-46-18 name=__codelineno-46-18 href=#__codelineno-46-18></a>
</span><span id=__span-46-19><a id=__codelineno-46-19 name=__codelineno-46-19 href=#__codelineno-46-19></a>    <span class=k>def</span><span class=w> </span><span class=nf>experimental_to_basic_path</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-46-20><a id=__codelineno-46-20 name=__codelineno-46-20 href=#__codelineno-46-20></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Path for organizations with only experimental ML.&quot;&quot;&quot;</span>
</span><span id=__span-46-21><a id=__codelineno-46-21 name=__codelineno-46-21 href=#__codelineno-46-21></a>        <span class=k>return</span> <span class=p>[</span>
</span><span id=__span-46-22><a id=__codelineno-46-22 name=__codelineno-46-22 href=#__codelineno-46-22></a>            <span class=p>{</span>
</span><span id=__span-46-23><a id=__codelineno-46-23 name=__codelineno-46-23 href=#__codelineno-46-23></a>                <span class=s1>&#39;step&#39;</span><span class=p>:</span> <span class=s1>&#39;establish_version_control&#39;</span><span class=p>,</span>
</span><span id=__span-46-24><a id=__codelineno-46-24 name=__codelineno-46-24 href=#__codelineno-46-24></a>                <span class=s1>&#39;priority&#39;</span><span class=p>:</span> <span class=s1>&#39;high&#39;</span><span class=p>,</span>
</span><span id=__span-46-25><a id=__codelineno-46-25 name=__codelineno-46-25 href=#__codelineno-46-25></a>                <span class=s1>&#39;effort&#39;</span><span class=p>:</span> <span class=s1>&#39;low&#39;</span><span class=p>,</span>
</span><span id=__span-46-26><a id=__codelineno-46-26 name=__codelineno-46-26 href=#__codelineno-46-26></a>                <span class=s1>&#39;timeline_weeks&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span><span id=__span-46-27><a id=__codelineno-46-27 name=__codelineno-46-27 href=#__codelineno-46-27></a>                <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=s1>&#39;Get all ML code into version control&#39;</span><span class=p>,</span>
</span><span id=__span-46-28><a id=__codelineno-46-28 name=__codelineno-46-28 href=#__codelineno-46-28></a>                <span class=s1>&#39;success_criteria&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;All ML code versioned&#39;</span><span class=p>,</span> <span class=s1>&#39;Basic branching strategy adopted&#39;</span><span class=p>]</span>
</span><span id=__span-46-29><a id=__codelineno-46-29 name=__codelineno-46-29 href=#__codelineno-46-29></a>            <span class=p>},</span>
</span><span id=__span-46-30><a id=__codelineno-46-30 name=__codelineno-46-30 href=#__codelineno-46-30></a>            <span class=p>{</span>
</span><span id=__span-46-31><a id=__codelineno-46-31 name=__codelineno-46-31 href=#__codelineno-46-31></a>                <span class=s1>&#39;step&#39;</span><span class=p>:</span> <span class=s1>&#39;implement_experiment_tracking&#39;</span><span class=p>,</span>
</span><span id=__span-46-32><a id=__codelineno-46-32 name=__codelineno-46-32 href=#__codelineno-46-32></a>                <span class=s1>&#39;priority&#39;</span><span class=p>:</span> <span class=s1>&#39;high&#39;</span><span class=p>,</span>
</span><span id=__span-46-33><a id=__codelineno-46-33 name=__codelineno-46-33 href=#__codelineno-46-33></a>                <span class=s1>&#39;effort&#39;</span><span class=p>:</span> <span class=s1>&#39;medium&#39;</span><span class=p>,</span>
</span><span id=__span-46-34><a id=__codelineno-46-34 name=__codelineno-46-34 href=#__codelineno-46-34></a>                <span class=s1>&#39;timeline_weeks&#39;</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span>
</span><span id=__span-46-35><a id=__codelineno-46-35 name=__codelineno-46-35 href=#__codelineno-46-35></a>                <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=s1>&#39;Track experiments and model performance&#39;</span><span class=p>,</span>
</span><span id=__span-46-36><a id=__codelineno-46-36 name=__codelineno-46-36 href=#__codelineno-46-36></a>                <span class=s1>&#39;tools&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;MLflow&#39;</span><span class=p>,</span> <span class=s1>&#39;Weights &amp; Biases&#39;</span><span class=p>,</span> <span class=s1>&#39;Neptune&#39;</span><span class=p>],</span>
</span><span id=__span-46-37><a id=__codelineno-46-37 name=__codelineno-46-37 href=#__codelineno-46-37></a>                <span class=s1>&#39;success_criteria&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;Experiment reproducibility&#39;</span><span class=p>,</span> <span class=s1>&#39;Model comparison capability&#39;</span><span class=p>]</span>
</span><span id=__span-46-38><a id=__codelineno-46-38 name=__codelineno-46-38 href=#__codelineno-46-38></a>            <span class=p>},</span>
</span><span id=__span-46-39><a id=__codelineno-46-39 name=__codelineno-46-39 href=#__codelineno-46-39></a>            <span class=p>{</span>
</span><span id=__span-46-40><a id=__codelineno-46-40 name=__codelineno-46-40 href=#__codelineno-46-40></a>                <span class=s1>&#39;step&#39;</span><span class=p>:</span> <span class=s1>&#39;create_simple_deployment_pipeline&#39;</span><span class=p>,</span>
</span><span id=__span-46-41><a id=__codelineno-46-41 name=__codelineno-46-41 href=#__codelineno-46-41></a>                <span class=s1>&#39;priority&#39;</span><span class=p>:</span> <span class=s1>&#39;medium&#39;</span><span class=p>,</span>
</span><span id=__span-46-42><a id=__codelineno-46-42 name=__codelineno-46-42 href=#__codelineno-46-42></a>                <span class=s1>&#39;effort&#39;</span><span class=p>:</span> <span class=s1>&#39;medium&#39;</span><span class=p>,</span>
</span><span id=__span-46-43><a id=__codelineno-46-43 name=__codelineno-46-43 href=#__codelineno-46-43></a>                <span class=s1>&#39;timeline_weeks&#39;</span><span class=p>:</span> <span class=mi>6</span><span class=p>,</span>
</span><span id=__span-46-44><a id=__codelineno-46-44 name=__codelineno-46-44 href=#__codelineno-46-44></a>                <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=s1>&#39;Automate model deployment to staging environment&#39;</span><span class=p>,</span>
</span><span id=__span-46-45><a id=__codelineno-46-45 name=__codelineno-46-45 href=#__codelineno-46-45></a>                <span class=s1>&#39;success_criteria&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;Automated deployment&#39;</span><span class=p>,</span> <span class=s1>&#39;Basic testing in staging&#39;</span><span class=p>]</span>
</span><span id=__span-46-46><a id=__codelineno-46-46 name=__codelineno-46-46 href=#__codelineno-46-46></a>            <span class=p>},</span>
</span><span id=__span-46-47><a id=__codelineno-46-47 name=__codelineno-46-47 href=#__codelineno-46-47></a>            <span class=p>{</span>
</span><span id=__span-46-48><a id=__codelineno-46-48 name=__codelineno-46-48 href=#__codelineno-46-48></a>                <span class=s1>&#39;step&#39;</span><span class=p>:</span> <span class=s1>&#39;establish_basic_monitoring&#39;</span><span class=p>,</span>
</span><span id=__span-46-49><a id=__codelineno-46-49 name=__codelineno-46-49 href=#__codelineno-46-49></a>                <span class=s1>&#39;priority&#39;</span><span class=p>:</span> <span class=s1>&#39;medium&#39;</span><span class=p>,</span>
</span><span id=__span-46-50><a id=__codelineno-46-50 name=__codelineno-46-50 href=#__codelineno-46-50></a>                <span class=s1>&#39;effort&#39;</span><span class=p>:</span> <span class=s1>&#39;medium&#39;</span><span class=p>,</span>
</span><span id=__span-46-51><a id=__codelineno-46-51 name=__codelineno-46-51 href=#__codelineno-46-51></a>                <span class=s1>&#39;timeline_weeks&#39;</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span>
</span><span id=__span-46-52><a id=__codelineno-46-52 name=__codelineno-46-52 href=#__codelineno-46-52></a>                <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=s1>&#39;Monitor model performance in production&#39;</span><span class=p>,</span>
</span><span id=__span-46-53><a id=__codelineno-46-53 name=__codelineno-46-53 href=#__codelineno-46-53></a>                <span class=s1>&#39;success_criteria&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;Model health dashboards&#39;</span><span class=p>,</span> <span class=s1>&#39;Basic alerting&#39;</span><span class=p>]</span>
</span><span id=__span-46-54><a id=__codelineno-46-54 name=__codelineno-46-54 href=#__codelineno-46-54></a>            <span class=p>}</span>
</span><span id=__span-46-55><a id=__codelineno-46-55 name=__codelineno-46-55 href=#__codelineno-46-55></a>        <span class=p>]</span>
</span><span id=__span-46-56><a id=__codelineno-46-56 name=__codelineno-46-56 href=#__codelineno-46-56></a>
</span><span id=__span-46-57><a id=__codelineno-46-57 name=__codelineno-46-57 href=#__codelineno-46-57></a>    <span class=k>def</span><span class=w> </span><span class=nf>basic_to_intermediate_path</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-46-58><a id=__codelineno-46-58 name=__codelineno-46-58 href=#__codelineno-46-58></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Path for organizations with basic ML in production.&quot;&quot;&quot;</span>
</span><span id=__span-46-59><a id=__codelineno-46-59 name=__codelineno-46-59 href=#__codelineno-46-59></a>        <span class=k>return</span> <span class=p>[</span>
</span><span id=__span-46-60><a id=__codelineno-46-60 name=__codelineno-46-60 href=#__codelineno-46-60></a>            <span class=p>{</span>
</span><span id=__span-46-61><a id=__codelineno-46-61 name=__codelineno-46-61 href=#__codelineno-46-61></a>                <span class=s1>&#39;step&#39;</span><span class=p>:</span> <span class=s1>&#39;implement_feature_store&#39;</span><span class=p>,</span>
</span><span id=__span-46-62><a id=__codelineno-46-62 name=__codelineno-46-62 href=#__codelineno-46-62></a>                <span class=s1>&#39;priority&#39;</span><span class=p>:</span> <span class=s1>&#39;high&#39;</span><span class=p>,</span>
</span><span id=__span-46-63><a id=__codelineno-46-63 name=__codelineno-46-63 href=#__codelineno-46-63></a>                <span class=s1>&#39;effort&#39;</span><span class=p>:</span> <span class=s1>&#39;high&#39;</span><span class=p>,</span>
</span><span id=__span-46-64><a id=__codelineno-46-64 name=__codelineno-46-64 href=#__codelineno-46-64></a>                <span class=s1>&#39;timeline_weeks&#39;</span><span class=p>:</span> <span class=mi>12</span><span class=p>,</span>
</span><span id=__span-46-65><a id=__codelineno-46-65 name=__codelineno-46-65 href=#__codelineno-46-65></a>                <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=s1>&#39;Centralize feature management and serving&#39;</span><span class=p>,</span>
</span><span id=__span-46-66><a id=__codelineno-46-66 name=__codelineno-46-66 href=#__codelineno-46-66></a>                <span class=s1>&#39;success_criteria&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;Feature reusability&#39;</span><span class=p>,</span> <span class=s1>&#39;Training/serving consistency&#39;</span><span class=p>]</span>
</span><span id=__span-46-67><a id=__codelineno-46-67 name=__codelineno-46-67 href=#__codelineno-46-67></a>            <span class=p>},</span>
</span><span id=__span-46-68><a id=__codelineno-46-68 name=__codelineno-46-68 href=#__codelineno-46-68></a>            <span class=p>{</span>
</span><span id=__span-46-69><a id=__codelineno-46-69 name=__codelineno-46-69 href=#__codelineno-46-69></a>                <span class=s1>&#39;step&#39;</span><span class=p>:</span> <span class=s1>&#39;advanced_monitoring_and_alerting&#39;</span><span class=p>,</span>
</span><span id=__span-46-70><a id=__codelineno-46-70 name=__codelineno-46-70 href=#__codelineno-46-70></a>                <span class=s1>&#39;priority&#39;</span><span class=p>:</span> <span class=s1>&#39;high&#39;</span><span class=p>,</span>
</span><span id=__span-46-71><a id=__codelineno-46-71 name=__codelineno-46-71 href=#__codelineno-46-71></a>                <span class=s1>&#39;effort&#39;</span><span class=p>:</span> <span class=s1>&#39;medium&#39;</span><span class=p>,</span>
</span><span id=__span-46-72><a id=__codelineno-46-72 name=__codelineno-46-72 href=#__codelineno-46-72></a>                <span class=s1>&#39;timeline_weeks&#39;</span><span class=p>:</span> <span class=mi>8</span><span class=p>,</span>
</span><span id=__span-46-73><a id=__codelineno-46-73 name=__codelineno-46-73 href=#__codelineno-46-73></a>                <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=s1>&#39;Implement data drift and model performance monitoring&#39;</span><span class=p>,</span>
</span><span id=__span-46-74><a id=__codelineno-46-74 name=__codelineno-46-74 href=#__codelineno-46-74></a>                <span class=s1>&#39;success_criteria&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;Automated drift detection&#39;</span><span class=p>,</span> <span class=s1>&#39;Performance alerting&#39;</span><span class=p>]</span>
</span><span id=__span-46-75><a id=__codelineno-46-75 name=__codelineno-46-75 href=#__codelineno-46-75></a>            <span class=p>},</span>
</span><span id=__span-46-76><a id=__codelineno-46-76 name=__codelineno-46-76 href=#__codelineno-46-76></a>            <span class=p>{</span>
</span><span id=__span-46-77><a id=__codelineno-46-77 name=__codelineno-46-77 href=#__codelineno-46-77></a>                <span class=s1>&#39;step&#39;</span><span class=p>:</span> <span class=s1>&#39;automated_retraining_pipelines&#39;</span><span class=p>,</span>
</span><span id=__span-46-78><a id=__codelineno-46-78 name=__codelineno-46-78 href=#__codelineno-46-78></a>                <span class=s1>&#39;priority&#39;</span><span class=p>:</span> <span class=s1>&#39;medium&#39;</span><span class=p>,</span>
</span><span id=__span-46-79><a id=__codelineno-46-79 name=__codelineno-46-79 href=#__codelineno-46-79></a>                <span class=s1>&#39;effort&#39;</span><span class=p>:</span> <span class=s1>&#39;high&#39;</span><span class=p>,</span>
</span><span id=__span-46-80><a id=__codelineno-46-80 name=__codelineno-46-80 href=#__codelineno-46-80></a>                <span class=s1>&#39;timeline_weeks&#39;</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span>
</span><span id=__span-46-81><a id=__codelineno-46-81 name=__codelineno-46-81 href=#__codelineno-46-81></a>                <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=s1>&#39;Automate model retraining based on performance metrics&#39;</span><span class=p>,</span>
</span><span id=__span-46-82><a id=__codelineno-46-82 name=__codelineno-46-82 href=#__codelineno-46-82></a>                <span class=s1>&#39;success_criteria&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;Automatic retraining triggers&#39;</span><span class=p>,</span> <span class=s1>&#39;Model validation gates&#39;</span><span class=p>]</span>
</span><span id=__span-46-83><a id=__codelineno-46-83 name=__codelineno-46-83 href=#__codelineno-46-83></a>            <span class=p>},</span>
</span><span id=__span-46-84><a id=__codelineno-46-84 name=__codelineno-46-84 href=#__codelineno-46-84></a>            <span class=p>{</span>
</span><span id=__span-46-85><a id=__codelineno-46-85 name=__codelineno-46-85 href=#__codelineno-46-85></a>                <span class=s1>&#39;step&#39;</span><span class=p>:</span> <span class=s1>&#39;a_b_testing_framework&#39;</span><span class=p>,</span>
</span><span id=__span-46-86><a id=__codelineno-46-86 name=__codelineno-46-86 href=#__codelineno-46-86></a>                <span class=s1>&#39;priority&#39;</span><span class=p>:</span> <span class=s1>&#39;medium&#39;</span><span class=p>,</span>
</span><span id=__span-46-87><a id=__codelineno-46-87 name=__codelineno-46-87 href=#__codelineno-46-87></a>                <span class=s1>&#39;effort&#39;</span><span class=p>:</span> <span class=s1>&#39;medium&#39;</span><span class=p>,</span>
</span><span id=__span-46-88><a id=__codelineno-46-88 name=__codelineno-46-88 href=#__codelineno-46-88></a>                <span class=s1>&#39;timeline_weeks&#39;</span><span class=p>:</span> <span class=mi>6</span><span class=p>,</span>
</span><span id=__span-46-89><a id=__codelineno-46-89 name=__codelineno-46-89 href=#__codelineno-46-89></a>                <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=s1>&#39;Implement systematic A/B testing for model improvements&#39;</span><span class=p>,</span>
</span><span id=__span-46-90><a id=__codelineno-46-90 name=__codelineno-46-90 href=#__codelineno-46-90></a>                <span class=s1>&#39;success_criteria&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;Controlled model rollouts&#39;</span><span class=p>,</span> <span class=s1>&#39;Statistical significance testing&#39;</span><span class=p>]</span>
</span><span id=__span-46-91><a id=__codelineno-46-91 name=__codelineno-46-91 href=#__codelineno-46-91></a>            <span class=p>}</span>
</span><span id=__span-46-92><a id=__codelineno-46-92 name=__codelineno-46-92 href=#__codelineno-46-92></a>        <span class=p>]</span>
</span><span id=__span-46-93><a id=__codelineno-46-93 name=__codelineno-46-93 href=#__codelineno-46-93></a>
</span><span id=__span-46-94><a id=__codelineno-46-94 name=__codelineno-46-94 href=#__codelineno-46-94></a><span class=k>def</span><span class=w> </span><span class=nf>prioritize_mlops_initiatives</span><span class=p>(</span><span class=n>current_state</span><span class=p>,</span> <span class=n>business_goals</span><span class=p>,</span> <span class=n>constraints</span><span class=p>):</span>
</span><span id=__span-46-95><a id=__codelineno-46-95 name=__codelineno-46-95 href=#__codelineno-46-95></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Prioritize MLOps initiatives based on context.&quot;&quot;&quot;</span>
</span><span id=__span-46-96><a id=__codelineno-46-96 name=__codelineno-46-96 href=#__codelineno-46-96></a>
</span><span id=__span-46-97><a id=__codelineno-46-97 name=__codelineno-46-97 href=#__codelineno-46-97></a>    <span class=c1># Define potential initiatives</span>
</span><span id=__span-46-98><a id=__codelineno-46-98 name=__codelineno-46-98 href=#__codelineno-46-98></a>    <span class=n>initiatives</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-46-99><a id=__codelineno-46-99 name=__codelineno-46-99 href=#__codelineno-46-99></a>        <span class=p>{</span>
</span><span id=__span-46-100><a id=__codelineno-46-100 name=__codelineno-46-100 href=#__codelineno-46-100></a>            <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;model_monitoring&#39;</span><span class=p>,</span>
</span><span id=__span-46-101><a id=__codelineno-46-101 name=__codelineno-46-101 href=#__codelineno-46-101></a>            <span class=s1>&#39;business_impact&#39;</span><span class=p>:</span> <span class=s1>&#39;high&#39;</span><span class=p>,</span>
</span><span id=__span-46-102><a id=__codelineno-46-102 name=__codelineno-46-102 href=#__codelineno-46-102></a>            <span class=s1>&#39;technical_complexity&#39;</span><span class=p>:</span> <span class=s1>&#39;medium&#39;</span><span class=p>,</span>
</span><span id=__span-46-103><a id=__codelineno-46-103 name=__codelineno-46-103 href=#__codelineno-46-103></a>            <span class=s1>&#39;time_to_value&#39;</span><span class=p>:</span> <span class=s1>&#39;short&#39;</span><span class=p>,</span>
</span><span id=__span-46-104><a id=__codelineno-46-104 name=__codelineno-46-104 href=#__codelineno-46-104></a>            <span class=s1>&#39;prerequisites&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;deployed_models&#39;</span><span class=p>],</span>
</span><span id=__span-46-105><a id=__codelineno-46-105 name=__codelineno-46-105 href=#__codelineno-46-105></a>            <span class=s1>&#39;addresses_goals&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;reliability&#39;</span><span class=p>,</span> <span class=s1>&#39;risk_management&#39;</span><span class=p>]</span>
</span><span id=__span-46-106><a id=__codelineno-46-106 name=__codelineno-46-106 href=#__codelineno-46-106></a>        <span class=p>},</span>
</span><span id=__span-46-107><a id=__codelineno-46-107 name=__codelineno-46-107 href=#__codelineno-46-107></a>        <span class=p>{</span>
</span><span id=__span-46-108><a id=__codelineno-46-108 name=__codelineno-46-108 href=#__codelineno-46-108></a>            <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;automated_retraining&#39;</span><span class=p>,</span>
</span><span id=__span-46-109><a id=__codelineno-46-109 name=__codelineno-46-109 href=#__codelineno-46-109></a>            <span class=s1>&#39;business_impact&#39;</span><span class=p>:</span> <span class=s1>&#39;high&#39;</span><span class=p>,</span>
</span><span id=__span-46-110><a id=__codelineno-46-110 name=__codelineno-46-110 href=#__codelineno-46-110></a>            <span class=s1>&#39;technical_complexity&#39;</span><span class=p>:</span> <span class=s1>&#39;high&#39;</span><span class=p>,</span>
</span><span id=__span-46-111><a id=__codelineno-46-111 name=__codelineno-46-111 href=#__codelineno-46-111></a>            <span class=s1>&#39;time_to_value&#39;</span><span class=p>:</span> <span class=s1>&#39;medium&#39;</span><span class=p>,</span>
</span><span id=__span-46-112><a id=__codelineno-46-112 name=__codelineno-46-112 href=#__codelineno-46-112></a>            <span class=s1>&#39;prerequisites&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;model_monitoring&#39;</span><span class=p>,</span> <span class=s1>&#39;data_pipelines&#39;</span><span class=p>],</span>
</span><span id=__span-46-113><a id=__codelineno-46-113 name=__codelineno-46-113 href=#__codelineno-46-113></a>            <span class=s1>&#39;addresses_goals&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;efficiency&#39;</span><span class=p>,</span> <span class=s1>&#39;model_performance&#39;</span><span class=p>]</span>
</span><span id=__span-46-114><a id=__codelineno-46-114 name=__codelineno-46-114 href=#__codelineno-46-114></a>        <span class=p>},</span>
</span><span id=__span-46-115><a id=__codelineno-46-115 name=__codelineno-46-115 href=#__codelineno-46-115></a>        <span class=p>{</span>
</span><span id=__span-46-116><a id=__codelineno-46-116 name=__codelineno-46-116 href=#__codelineno-46-116></a>            <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;feature_store&#39;</span><span class=p>,</span>
</span><span id=__span-46-117><a id=__codelineno-46-117 name=__codelineno-46-117 href=#__codelineno-46-117></a>            <span class=s1>&#39;business_impact&#39;</span><span class=p>:</span> <span class=s1>&#39;medium&#39;</span><span class=p>,</span>
</span><span id=__span-46-118><a id=__codelineno-46-118 name=__codelineno-46-118 href=#__codelineno-46-118></a>            <span class=s1>&#39;technical_complexity&#39;</span><span class=p>:</span> <span class=s1>&#39;high&#39;</span><span class=p>,</span>
</span><span id=__span-46-119><a id=__codelineno-46-119 name=__codelineno-46-119 href=#__codelineno-46-119></a>            <span class=s1>&#39;time_to_value&#39;</span><span class=p>:</span> <span class=s1>&#39;long&#39;</span><span class=p>,</span>
</span><span id=__span-46-120><a id=__codelineno-46-120 name=__codelineno-46-120 href=#__codelineno-46-120></a>            <span class=s1>&#39;prerequisites&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;data_infrastructure&#39;</span><span class=p>],</span>
</span><span id=__span-46-121><a id=__codelineno-46-121 name=__codelineno-46-121 href=#__codelineno-46-121></a>            <span class=s1>&#39;addresses_goals&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;efficiency&#39;</span><span class=p>,</span> <span class=s1>&#39;consistency&#39;</span><span class=p>]</span>
</span><span id=__span-46-122><a id=__codelineno-46-122 name=__codelineno-46-122 href=#__codelineno-46-122></a>        <span class=p>},</span>
</span><span id=__span-46-123><a id=__codelineno-46-123 name=__codelineno-46-123 href=#__codelineno-46-123></a>        <span class=p>{</span>
</span><span id=__span-46-124><a id=__codelineno-46-124 name=__codelineno-46-124 href=#__codelineno-46-124></a>            <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;experiment_tracking&#39;</span><span class=p>,</span>
</span><span id=__span-46-125><a id=__codelineno-46-125 name=__codelineno-46-125 href=#__codelineno-46-125></a>            <span class=s1>&#39;business_impact&#39;</span><span class=p>:</span> <span class=s1>&#39;medium&#39;</span><span class=p>,</span>
</span><span id=__span-46-126><a id=__codelineno-46-126 name=__codelineno-46-126 href=#__codelineno-46-126></a>            <span class=s1>&#39;technical_complexity&#39;</span><span class=p>:</span> <span class=s1>&#39;low&#39;</span><span class=p>,</span>
</span><span id=__span-46-127><a id=__codelineno-46-127 name=__codelineno-46-127 href=#__codelineno-46-127></a>            <span class=s1>&#39;time_to_value&#39;</span><span class=p>:</span> <span class=s1>&#39;short&#39;</span><span class=p>,</span>
</span><span id=__span-46-128><a id=__codelineno-46-128 name=__codelineno-46-128 href=#__codelineno-46-128></a>            <span class=s1>&#39;prerequisites&#39;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-46-129><a id=__codelineno-46-129 name=__codelineno-46-129 href=#__codelineno-46-129></a>            <span class=s1>&#39;addresses_goals&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;reproducibility&#39;</span><span class=p>,</span> <span class=s1>&#39;collaboration&#39;</span><span class=p>]</span>
</span><span id=__span-46-130><a id=__codelineno-46-130 name=__codelineno-46-130 href=#__codelineno-46-130></a>        <span class=p>}</span>
</span><span id=__span-46-131><a id=__codelineno-46-131 name=__codelineno-46-131 href=#__codelineno-46-131></a>    <span class=p>]</span>
</span><span id=__span-46-132><a id=__codelineno-46-132 name=__codelineno-46-132 href=#__codelineno-46-132></a>
</span><span id=__span-46-133><a id=__codelineno-46-133 name=__codelineno-46-133 href=#__codelineno-46-133></a>    <span class=c1># Score each initiative</span>
</span><span id=__span-46-134><a id=__codelineno-46-134 name=__codelineno-46-134 href=#__codelineno-46-134></a>    <span class=n>scored_initiatives</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-46-135><a id=__codelineno-46-135 name=__codelineno-46-135 href=#__codelineno-46-135></a>    <span class=k>for</span> <span class=n>initiative</span> <span class=ow>in</span> <span class=n>initiatives</span><span class=p>:</span>
</span><span id=__span-46-136><a id=__codelineno-46-136 name=__codelineno-46-136 href=#__codelineno-46-136></a>        <span class=n>score</span> <span class=o>=</span> <span class=n>calculate_initiative_score</span><span class=p>(</span>
</span><span id=__span-46-137><a id=__codelineno-46-137 name=__codelineno-46-137 href=#__codelineno-46-137></a>            <span class=n>initiative</span><span class=p>,</span> <span class=n>business_goals</span><span class=p>,</span> <span class=n>constraints</span><span class=p>,</span> <span class=n>current_state</span>
</span><span id=__span-46-138><a id=__codelineno-46-138 name=__codelineno-46-138 href=#__codelineno-46-138></a>        <span class=p>)</span>
</span><span id=__span-46-139><a id=__codelineno-46-139 name=__codelineno-46-139 href=#__codelineno-46-139></a>        <span class=n>scored_initiatives</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>initiative</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>],</span> <span class=n>score</span><span class=p>,</span> <span class=n>initiative</span><span class=p>))</span>
</span><span id=__span-46-140><a id=__codelineno-46-140 name=__codelineno-46-140 href=#__codelineno-46-140></a>
</span><span id=__span-46-141><a id=__codelineno-46-141 name=__codelineno-46-141 href=#__codelineno-46-141></a>    <span class=c1># Sort by score and check prerequisites</span>
</span><span id=__span-46-142><a id=__codelineno-46-142 name=__codelineno-46-142 href=#__codelineno-46-142></a>    <span class=n>scored_initiatives</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-46-143><a id=__codelineno-46-143 name=__codelineno-46-143 href=#__codelineno-46-143></a>
</span><span id=__span-46-144><a id=__codelineno-46-144 name=__codelineno-46-144 href=#__codelineno-46-144></a>    <span class=c1># Create prioritized roadmap</span>
</span><span id=__span-46-145><a id=__codelineno-46-145 name=__codelineno-46-145 href=#__codelineno-46-145></a>    <span class=n>roadmap</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-46-146><a id=__codelineno-46-146 name=__codelineno-46-146 href=#__codelineno-46-146></a>    <span class=n>completed_initiatives</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>current_state</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;completed_initiatives&#39;</span><span class=p>,</span> <span class=p>[]))</span>
</span><span id=__span-46-147><a id=__codelineno-46-147 name=__codelineno-46-147 href=#__codelineno-46-147></a>
</span><span id=__span-46-148><a id=__codelineno-46-148 name=__codelineno-46-148 href=#__codelineno-46-148></a>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>score</span><span class=p>,</span> <span class=n>initiative</span> <span class=ow>in</span> <span class=n>scored_initiatives</span><span class=p>:</span>
</span><span id=__span-46-149><a id=__codelineno-46-149 name=__codelineno-46-149 href=#__codelineno-46-149></a>        <span class=k>if</span> <span class=nb>all</span><span class=p>(</span><span class=n>prereq</span> <span class=ow>in</span> <span class=n>completed_initiatives</span> <span class=k>for</span> <span class=n>prereq</span> <span class=ow>in</span> <span class=n>initiative</span><span class=p>[</span><span class=s1>&#39;prerequisites&#39;</span><span class=p>]):</span>
</span><span id=__span-46-150><a id=__codelineno-46-150 name=__codelineno-46-150 href=#__codelineno-46-150></a>            <span class=n>roadmap</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>initiative</span><span class=p>)</span>
</span><span id=__span-46-151><a id=__codelineno-46-151 name=__codelineno-46-151 href=#__codelineno-46-151></a>            <span class=n>completed_initiatives</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span><span id=__span-46-152><a id=__codelineno-46-152 name=__codelineno-46-152 href=#__codelineno-46-152></a>
</span><span id=__span-46-153><a id=__codelineno-46-153 name=__codelineno-46-153 href=#__codelineno-46-153></a>    <span class=k>return</span> <span class=n>roadmap</span>
</span><span id=__span-46-154><a id=__codelineno-46-154 name=__codelineno-46-154 href=#__codelineno-46-154></a>
</span><span id=__span-46-155><a id=__codelineno-46-155 name=__codelineno-46-155 href=#__codelineno-46-155></a><span class=k>def</span><span class=w> </span><span class=nf>calculate_initiative_score</span><span class=p>(</span><span class=n>initiative</span><span class=p>,</span> <span class=n>business_goals</span><span class=p>,</span> <span class=n>constraints</span><span class=p>,</span> <span class=n>current_state</span><span class=p>):</span>
</span><span id=__span-46-156><a id=__codelineno-46-156 name=__codelineno-46-156 href=#__codelineno-46-156></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Calculate a score for an MLOps initiative.&quot;&quot;&quot;</span>
</span><span id=__span-46-157><a id=__codelineno-46-157 name=__codelineno-46-157 href=#__codelineno-46-157></a>
</span><span id=__span-46-158><a id=__codelineno-46-158 name=__codelineno-46-158 href=#__codelineno-46-158></a>    <span class=n>score</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-46-159><a id=__codelineno-46-159 name=__codelineno-46-159 href=#__codelineno-46-159></a>
</span><span id=__span-46-160><a id=__codelineno-46-160 name=__codelineno-46-160 href=#__codelineno-46-160></a>    <span class=c1># Business impact scoring</span>
</span><span id=__span-46-161><a id=__codelineno-46-161 name=__codelineno-46-161 href=#__codelineno-46-161></a>    <span class=n>impact_weights</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;high&#39;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span> <span class=s1>&#39;medium&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span> <span class=s1>&#39;low&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>}</span>
</span><span id=__span-46-162><a id=__codelineno-46-162 name=__codelineno-46-162 href=#__codelineno-46-162></a>    <span class=n>score</span> <span class=o>+=</span> <span class=n>impact_weights</span><span class=p>[</span><span class=n>initiative</span><span class=p>[</span><span class=s1>&#39;business_impact&#39;</span><span class=p>]]</span> <span class=o>*</span> <span class=mi>3</span>
</span><span id=__span-46-163><a id=__codelineno-46-163 name=__codelineno-46-163 href=#__codelineno-46-163></a>
</span><span id=__span-46-164><a id=__codelineno-46-164 name=__codelineno-46-164 href=#__codelineno-46-164></a>    <span class=c1># Goal alignment scoring</span>
</span><span id=__span-46-165><a id=__codelineno-46-165 name=__codelineno-46-165 href=#__codelineno-46-165></a>    <span class=n>goal_alignment</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>initiative</span><span class=p>[</span><span class=s1>&#39;addresses_goals&#39;</span><span class=p>])</span> <span class=o>&amp;</span> <span class=nb>set</span><span class=p>(</span><span class=n>business_goals</span><span class=p>))</span>
</span><span id=__span-46-166><a id=__codelineno-46-166 name=__codelineno-46-166 href=#__codelineno-46-166></a>    <span class=n>score</span> <span class=o>+=</span> <span class=n>goal_alignment</span> <span class=o>*</span> <span class=mi>2</span>
</span><span id=__span-46-167><a id=__codelineno-46-167 name=__codelineno-46-167 href=#__codelineno-46-167></a>
</span><span id=__span-46-168><a id=__codelineno-46-168 name=__codelineno-46-168 href=#__codelineno-46-168></a>    <span class=c1># Complexity penalty</span>
</span><span id=__span-46-169><a id=__codelineno-46-169 name=__codelineno-46-169 href=#__codelineno-46-169></a>    <span class=n>complexity_penalty</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;low&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;medium&#39;</span><span class=p>:</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;high&#39;</span><span class=p>:</span> <span class=o>-</span><span class=mi>2</span><span class=p>}</span>
</span><span id=__span-46-170><a id=__codelineno-46-170 name=__codelineno-46-170 href=#__codelineno-46-170></a>    <span class=n>score</span> <span class=o>+=</span> <span class=n>complexity_penalty</span><span class=p>[</span><span class=n>initiative</span><span class=p>[</span><span class=s1>&#39;technical_complexity&#39;</span><span class=p>]]</span>
</span><span id=__span-46-171><a id=__codelineno-46-171 name=__codelineno-46-171 href=#__codelineno-46-171></a>
</span><span id=__span-46-172><a id=__codelineno-46-172 name=__codelineno-46-172 href=#__codelineno-46-172></a>    <span class=c1># Time to value bonus</span>
</span><span id=__span-46-173><a id=__codelineno-46-173 name=__codelineno-46-173 href=#__codelineno-46-173></a>    <span class=n>time_bonus</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;short&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span> <span class=s1>&#39;medium&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;long&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>}</span>
</span><span id=__span-46-174><a id=__codelineno-46-174 name=__codelineno-46-174 href=#__codelineno-46-174></a>    <span class=n>score</span> <span class=o>+=</span> <span class=n>time_bonus</span><span class=p>[</span><span class=n>initiative</span><span class=p>[</span><span class=s1>&#39;time_to_value&#39;</span><span class=p>]]</span>
</span><span id=__span-46-175><a id=__codelineno-46-175 name=__codelineno-46-175 href=#__codelineno-46-175></a>
</span><span id=__span-46-176><a id=__codelineno-46-176 name=__codelineno-46-176 href=#__codelineno-46-176></a>    <span class=c1># Resource constraint check</span>
</span><span id=__span-46-177><a id=__codelineno-46-177 name=__codelineno-46-177 href=#__codelineno-46-177></a>    <span class=k>if</span> <span class=n>constraints</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;budget&#39;</span><span class=p>)</span> <span class=o>==</span> <span class=s1>&#39;limited&#39;</span> <span class=ow>and</span> <span class=n>initiative</span><span class=p>[</span><span class=s1>&#39;technical_complexity&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;high&#39;</span><span class=p>:</span>
</span><span id=__span-46-178><a id=__codelineno-46-178 name=__codelineno-46-178 href=#__codelineno-46-178></a>        <span class=n>score</span> <span class=o>-=</span> <span class=mi>2</span>
</span><span id=__span-46-179><a id=__codelineno-46-179 name=__codelineno-46-179 href=#__codelineno-46-179></a>
</span><span id=__span-46-180><a id=__codelineno-46-180 name=__codelineno-46-180 href=#__codelineno-46-180></a>    <span class=k>if</span> <span class=n>constraints</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;timeline&#39;</span><span class=p>)</span> <span class=o>==</span> <span class=s1>&#39;urgent&#39;</span> <span class=ow>and</span> <span class=n>initiative</span><span class=p>[</span><span class=s1>&#39;time_to_value&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;long&#39;</span><span class=p>:</span>
</span><span id=__span-46-181><a id=__codelineno-46-181 name=__codelineno-46-181 href=#__codelineno-46-181></a>        <span class=n>score</span> <span class=o>-=</span> <span class=mi>3</span>
</span><span id=__span-46-182><a id=__codelineno-46-182 name=__codelineno-46-182 href=#__codelineno-46-182></a>
</span><span id=__span-46-183><a id=__codelineno-46-183 name=__codelineno-46-183 href=#__codelineno-46-183></a>    <span class=k>return</span> <span class=n>score</span>
</span></code></pre></div> <h4 id=focus-on-business-value-first><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#focus-on-business-value-first>Focus on Business Value First</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=k>class</span><span class=w> </span><span class=nc>BusinessValueMLOpsFramework</span><span class=p>:</span>
</span><span id=__span-47-2><a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-47-3><a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a>        <span class=bp>self</span><span class=o>.</span><span class=n>value_drivers</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-47-4><a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a>            <span class=s1>&#39;revenue_increase&#39;</span><span class=p>,</span>
</span><span id=__span-47-5><a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a>            <span class=s1>&#39;cost_reduction&#39;</span><span class=p>,</span>
</span><span id=__span-47-6><a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a>            <span class=s1>&#39;risk_mitigation&#39;</span><span class=p>,</span>
</span><span id=__span-47-7><a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a>            <span class=s1>&#39;customer_satisfaction&#39;</span><span class=p>,</span>
</span><span id=__span-47-8><a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a>            <span class=s1>&#39;operational_efficiency&#39;</span>
</span><span id=__span-47-9><a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a>        <span class=p>]</span>
</span><span id=__span-47-10><a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a>
</span><span id=__span-47-11><a id=__codelineno-47-11 name=__codelineno-47-11 href=#__codelineno-47-11></a>    <span class=k>def</span><span class=w> </span><span class=nf>align_mlops_with_business_value</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>business_priorities</span><span class=p>):</span>
</span><span id=__span-47-12><a id=__codelineno-47-12 name=__codelineno-47-12 href=#__codelineno-47-12></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Align MLOps initiatives with business value drivers.&quot;&quot;&quot;</span>
</span><span id=__span-47-13><a id=__codelineno-47-13 name=__codelineno-47-13 href=#__codelineno-47-13></a>
</span><span id=__span-47-14><a id=__codelineno-47-14 name=__codelineno-47-14 href=#__codelineno-47-14></a>        <span class=n>value_alignment</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-47-15><a id=__codelineno-47-15 name=__codelineno-47-15 href=#__codelineno-47-15></a>
</span><span id=__span-47-16><a id=__codelineno-47-16 name=__codelineno-47-16 href=#__codelineno-47-16></a>        <span class=k>for</span> <span class=n>priority</span> <span class=ow>in</span> <span class=n>business_priorities</span><span class=p>:</span>
</span><span id=__span-47-17><a id=__codelineno-47-17 name=__codelineno-47-17 href=#__codelineno-47-17></a>            <span class=k>if</span> <span class=n>priority</span> <span class=o>==</span> <span class=s1>&#39;increase_revenue&#39;</span><span class=p>:</span>
</span><span id=__span-47-18><a id=__codelineno-47-18 name=__codelineno-47-18 href=#__codelineno-47-18></a>                <span class=n>value_alignment</span><span class=p>[</span><span class=n>priority</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-47-19><a id=__codelineno-47-19 name=__codelineno-47-19 href=#__codelineno-47-19></a>                    <span class=s1>&#39;recommendation_system_optimization&#39;</span><span class=p>,</span>
</span><span id=__span-47-20><a id=__codelineno-47-20 name=__codelineno-47-20 href=#__codelineno-47-20></a>                    <span class=s1>&#39;dynamic_pricing_models&#39;</span><span class=p>,</span>
</span><span id=__span-47-21><a id=__codelineno-47-21 name=__codelineno-47-21 href=#__codelineno-47-21></a>                    <span class=s1>&#39;customer_lifetime_value_prediction&#39;</span><span class=p>,</span>
</span><span id=__span-47-22><a id=__codelineno-47-22 name=__codelineno-47-22 href=#__codelineno-47-22></a>                    <span class=s1>&#39;personalization_engines&#39;</span>
</span><span id=__span-47-23><a id=__codelineno-47-23 name=__codelineno-47-23 href=#__codelineno-47-23></a>                <span class=p>]</span>
</span><span id=__span-47-24><a id=__codelineno-47-24 name=__codelineno-47-24 href=#__codelineno-47-24></a>            <span class=k>elif</span> <span class=n>priority</span> <span class=o>==</span> <span class=s1>&#39;reduce_operational_costs&#39;</span><span class=p>:</span>
</span><span id=__span-47-25><a id=__codelineno-47-25 name=__codelineno-47-25 href=#__codelineno-47-25></a>                <span class=n>value_alignment</span><span class=p>[</span><span class=n>priority</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-47-26><a id=__codelineno-47-26 name=__codelineno-47-26 href=#__codelineno-47-26></a>                    <span class=s1>&#39;automated_model_retraining&#39;</span><span class=p>,</span>
</span><span id=__span-47-27><a id=__codelineno-47-27 name=__codelineno-47-27 href=#__codelineno-47-27></a>                    <span class=s1>&#39;infrastructure_optimization&#39;</span><span class=p>,</span>
</span><span id=__span-47-28><a id=__codelineno-47-28 name=__codelineno-47-28 href=#__codelineno-47-28></a>                    <span class=s1>&#39;anomaly_detection_for_operations&#39;</span><span class=p>,</span>
</span><span id=__span-47-29><a id=__codelineno-47-29 name=__codelineno-47-29 href=#__codelineno-47-29></a>                    <span class=s1>&#39;predictive_maintenance&#39;</span>
</span><span id=__span-47-30><a id=__codelineno-47-30 name=__codelineno-47-30 href=#__codelineno-47-30></a>                <span class=p>]</span>
</span><span id=__span-47-31><a id=__codelineno-47-31 name=__codelineno-47-31 href=#__codelineno-47-31></a>            <span class=k>elif</span> <span class=n>priority</span> <span class=o>==</span> <span class=s1>&#39;improve_customer_experience&#39;</span><span class=p>:</span>
</span><span id=__span-47-32><a id=__codelineno-47-32 name=__codelineno-47-32 href=#__codelineno-47-32></a>                <span class=n>value_alignment</span><span class=p>[</span><span class=n>priority</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-47-33><a id=__codelineno-47-33 name=__codelineno-47-33 href=#__codelineno-47-33></a>                    <span class=s1>&#39;real_time_personalization&#39;</span><span class=p>,</span>
</span><span id=__span-47-34><a id=__codelineno-47-34 name=__codelineno-47-34 href=#__codelineno-47-34></a>                    <span class=s1>&#39;chatbot_and_support_automation&#39;</span><span class=p>,</span>
</span><span id=__span-47-35><a id=__codelineno-47-35 name=__codelineno-47-35 href=#__codelineno-47-35></a>                    <span class=s1>&#39;fraud_detection_optimization&#39;</span><span class=p>,</span>
</span><span id=__span-47-36><a id=__codelineno-47-36 name=__codelineno-47-36 href=#__codelineno-47-36></a>                    <span class=s1>&#39;recommendation_quality_improvement&#39;</span>
</span><span id=__span-47-37><a id=__codelineno-47-37 name=__codelineno-47-37 href=#__codelineno-47-37></a>                <span class=p>]</span>
</span><span id=__span-47-38><a id=__codelineno-47-38 name=__codelineno-47-38 href=#__codelineno-47-38></a>            <span class=k>elif</span> <span class=n>priority</span> <span class=o>==</span> <span class=s1>&#39;manage_risk&#39;</span><span class=p>:</span>
</span><span id=__span-47-39><a id=__codelineno-47-39 name=__codelineno-47-39 href=#__codelineno-47-39></a>                <span class=n>value_alignment</span><span class=p>[</span><span class=n>priority</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-47-40><a id=__codelineno-47-40 name=__codelineno-47-40 href=#__codelineno-47-40></a>                    <span class=s1>&#39;model_monitoring_and_alerting&#39;</span><span class=p>,</span>
</span><span id=__span-47-41><a id=__codelineno-47-41 name=__codelineno-47-41 href=#__codelineno-47-41></a>                    <span class=s1>&#39;bias_detection_and_mitigation&#39;</span><span class=p>,</span>
</span><span id=__span-47-42><a id=__codelineno-47-42 name=__codelineno-47-42 href=#__codelineno-47-42></a>                    <span class=s1>&#39;model_explainability_systems&#39;</span><span class=p>,</span>
</span><span id=__span-47-43><a id=__codelineno-47-43 name=__codelineno-47-43 href=#__codelineno-47-43></a>                    <span class=s1>&#39;regulatory_compliance_automation&#39;</span>
</span><span id=__span-47-44><a id=__codelineno-47-44 name=__codelineno-47-44 href=#__codelineno-47-44></a>                <span class=p>]</span>
</span><span id=__span-47-45><a id=__codelineno-47-45 name=__codelineno-47-45 href=#__codelineno-47-45></a>
</span><span id=__span-47-46><a id=__codelineno-47-46 name=__codelineno-47-46 href=#__codelineno-47-46></a>        <span class=k>return</span> <span class=n>value_alignment</span>
</span><span id=__span-47-47><a id=__codelineno-47-47 name=__codelineno-47-47 href=#__codelineno-47-47></a>
</span><span id=__span-47-48><a id=__codelineno-47-48 name=__codelineno-47-48 href=#__codelineno-47-48></a>    <span class=k>def</span><span class=w> </span><span class=nf>measure_business_impact</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>mlops_initiative</span><span class=p>,</span> <span class=n>baseline_metrics</span><span class=p>):</span>
</span><span id=__span-47-49><a id=__codelineno-47-49 name=__codelineno-47-49 href=#__codelineno-47-49></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Measure the business impact of MLOps initiatives.&quot;&quot;&quot;</span>
</span><span id=__span-47-50><a id=__codelineno-47-50 name=__codelineno-47-50 href=#__codelineno-47-50></a>
</span><span id=__span-47-51><a id=__codelineno-47-51 name=__codelineno-47-51 href=#__codelineno-47-51></a>        <span class=n>impact_framework</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-47-52><a id=__codelineno-47-52 name=__codelineno-47-52 href=#__codelineno-47-52></a>            <span class=s1>&#39;model_monitoring&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-47-53><a id=__codelineno-47-53 name=__codelineno-47-53 href=#__codelineno-47-53></a>                <span class=s1>&#39;primary_metrics&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;model_downtime_reduction&#39;</span><span class=p>,</span> <span class=s1>&#39;incident_detection_time&#39;</span><span class=p>],</span>
</span><span id=__span-47-54><a id=__codelineno-47-54 name=__codelineno-47-54 href=#__codelineno-47-54></a>                <span class=s1>&#39;secondary_metrics&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;customer_satisfaction&#39;</span><span class=p>,</span> <span class=s1>&#39;operational_cost&#39;</span><span class=p>],</span>
</span><span id=__span-47-55><a id=__codelineno-47-55 name=__codelineno-47-55 href=#__codelineno-47-55></a>                <span class=s1>&#39;measurement_period&#39;</span><span class=p>:</span> <span class=s1>&#39;3_months&#39;</span><span class=p>,</span>
</span><span id=__span-47-56><a id=__codelineno-47-56 name=__codelineno-47-56 href=#__codelineno-47-56></a>                <span class=s1>&#39;expected_improvement&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;downtime&#39;</span><span class=p>:</span> <span class=o>-</span><span class=mi>50</span><span class=p>,</span> <span class=s1>&#39;detection_time&#39;</span><span class=p>:</span> <span class=o>-</span><span class=mi>75</span><span class=p>}</span>
</span><span id=__span-47-57><a id=__codelineno-47-57 name=__codelineno-47-57 href=#__codelineno-47-57></a>            <span class=p>},</span>
</span><span id=__span-47-58><a id=__codelineno-47-58 name=__codelineno-47-58 href=#__codelineno-47-58></a>            <span class=s1>&#39;automated_retraining&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-47-59><a id=__codelineno-47-59 name=__codelineno-47-59 href=#__codelineno-47-59></a>                <span class=s1>&#39;primary_metrics&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;model_accuracy_maintenance&#39;</span><span class=p>,</span> <span class=s1>&#39;manual_effort_reduction&#39;</span><span class=p>],</span>
</span><span id=__span-47-60><a id=__codelineno-47-60 name=__codelineno-47-60 href=#__codelineno-47-60></a>                <span class=s1>&#39;secondary_metrics&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;time_to_deploy_updates&#39;</span><span class=p>,</span> <span class=s1>&#39;model_performance_consistency&#39;</span><span class=p>],</span>
</span><span id=__span-47-61><a id=__codelineno-47-61 name=__codelineno-47-61 href=#__codelineno-47-61></a>                <span class=s1>&#39;measurement_period&#39;</span><span class=p>:</span> <span class=s1>&#39;6_months&#39;</span><span class=p>,</span>
</span><span id=__span-47-62><a id=__codelineno-47-62 name=__codelineno-47-62 href=#__codelineno-47-62></a>                <span class=s1>&#39;expected_improvement&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;accuracy_decay&#39;</span><span class=p>:</span> <span class=o>-</span><span class=mi>60</span><span class=p>,</span> <span class=s1>&#39;manual_effort&#39;</span><span class=p>:</span> <span class=o>-</span><span class=mi>80</span><span class=p>}</span>
</span><span id=__span-47-63><a id=__codelineno-47-63 name=__codelineno-47-63 href=#__codelineno-47-63></a>            <span class=p>},</span>
</span><span id=__span-47-64><a id=__codelineno-47-64 name=__codelineno-47-64 href=#__codelineno-47-64></a>            <span class=s1>&#39;feature_store&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-47-65><a id=__codelineno-47-65 name=__codelineno-47-65 href=#__codelineno-47-65></a>                <span class=s1>&#39;primary_metrics&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;feature_development_time&#39;</span><span class=p>,</span> <span class=s1>&#39;feature_reuse_rate&#39;</span><span class=p>],</span>
</span><span id=__span-47-66><a id=__codelineno-47-66 name=__codelineno-47-66 href=#__codelineno-47-66></a>                <span class=s1>&#39;secondary_metrics&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;model_training_time&#39;</span><span class=p>,</span> <span class=s1>&#39;feature_consistency_errors&#39;</span><span class=p>],</span>
</span><span id=__span-47-67><a id=__codelineno-47-67 name=__codelineno-47-67 href=#__codelineno-47-67></a>                <span class=s1>&#39;measurement_period&#39;</span><span class=p>:</span> <span class=s1>&#39;9_months&#39;</span><span class=p>,</span>
</span><span id=__span-47-68><a id=__codelineno-47-68 name=__codelineno-47-68 href=#__codelineno-47-68></a>                <span class=s1>&#39;expected_improvement&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;development_time&#39;</span><span class=p>:</span> <span class=o>-</span><span class=mi>40</span><span class=p>,</span> <span class=s1>&#39;reuse_rate&#39;</span><span class=p>:</span> <span class=mi>200</span><span class=p>}</span>
</span><span id=__span-47-69><a id=__codelineno-47-69 name=__codelineno-47-69 href=#__codelineno-47-69></a>            <span class=p>}</span>
</span><span id=__span-47-70><a id=__codelineno-47-70 name=__codelineno-47-70 href=#__codelineno-47-70></a>        <span class=p>}</span>
</span><span id=__span-47-71><a id=__codelineno-47-71 name=__codelineno-47-71 href=#__codelineno-47-71></a>
</span><span id=__span-47-72><a id=__codelineno-47-72 name=__codelineno-47-72 href=#__codelineno-47-72></a>        <span class=k>return</span> <span class=n>impact_framework</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>mlops_initiative</span><span class=p>,</span> <span class=p>{})</span>
</span></code></pre></div> <h3 id=conclusion><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#conclusion>Conclusion</a></h3> <p>MLOps represents a fundamental shift in how organizations approach machine learning - from experimental, one-off projects to systematic, production-ready systems that deliver measurable business value. The journey from basic ML experimentation to mature MLOps practices is complex and requires careful attention to technical, cultural, and organizational factors.</p> <h4 id=key-takeaways><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#key-takeaways>Key Takeaways</a></h4> <ol> <li><strong>Start with the Foundation</strong>: Proper loop closure and monitoring are more important than sophisticated tooling</li> <li><strong>Focus on Business Value</strong>: Align MLOps initiatives with clear business outcomes and measure impact</li> <li><strong>Invest in People</strong>: The talent shortage is real, but internal development and cross-functional teams can bridge the gap</li> <li><strong>Culture First</strong>: Technical solutions without cultural change will fail</li> <li><strong>Iterate and Improve</strong>: MLOps maturity is a journey, not a destination</li> </ol> <h4 id=the-path-forward><a class=toclink href=../../2023/09/15/notes_on_mlops_industry_analysis_and_practical_insights/#the-path-forward>The Path Forward</a></h4> <p>The organizations that succeed with MLOps will be those that:</p> <ul> <li>Take a systematic approach to implementation</li> <li>Measure and optimize for business impact</li> <li>Invest in people and culture change</li> <li>Build robust, reliable systems from the ground up</li> <li>Maintain a focus on continuous improvement</li> </ul> <p>As the field continues to evolve, the fundamentals outlined in this analysis will remain relevant. The specific tools and technologies will change, but the core principles of systematic ML operations, business value focus, and organizational alignment will continue to drive success.</p> <p>The future of MLOps lies not in pursuing the latest technologies, but in building sustainable, value-driven practices that enable organizations to reliably deploy and maintain machine learning systems at scale. This requires patience, investment, and a long-term perspective on organizational capability building.</p> <p>For organizations just beginning their MLOps journey, the most important step is simply to start - with clear goals, proper measurement, and a commitment to continuous improvement. The complexity can be overwhelming, but the business value of getting it right makes the investment worthwhile.</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=https://github.com/mutaku.png alt="Matthew Martz, PhD"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2020-11-14 00:00:00+00:00">Saturday, November 14, 2020</time></li> <li class=md-meta__item> in <a href=./ class=md-meta__link>Technology</a>, <a href=../data-science/ class=md-meta__link>Data Science</a></li> <li class=md-meta__item> 6 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=nested-dictionary-lookups-in-python><a href=../../2020/11/14/nested_dictionary_lookups_in_python/ class=toclink>Nested Dictionary Lookups in Python</a></h2> <p>Mastering efficient techniques for accessing nested dictionary structures in Python - from basic navigation to performance optimization strategies.</p> <nav class=md-post__action> <a href=../../2020/11/14/nested_dictionary_lookups_in_python/ > Continue reading </a> </nav> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=https://github.com/mutaku.png alt="Matthew Martz, PhD"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2020-11-13 00:00:00+00:00">Friday, November 13, 2020</time></li> <li class=md-meta__item> in <a href=./ class=md-meta__link>Technology</a>, <a href=../data-science/ class=md-meta__link>Data Science</a></li> <li class=md-meta__item> 5 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=python-generators-and-comprehension><a href=../../2020/11/13/python_generators_and_comprehension/ class=toclink>Python Generators and Comprehension</a></h2> <p>Digging into generators and comprehension - from basics to implementation in a comprehensive tutorial. This is a walkthrough for beginners that will build up to real world examples.</p> <div class="admonition info"> <p class=admonition-title>Draft Status</p> <p>This is an in-progress draft that continues to be updated with additional examples and use cases.</p> </div> <nav class=md-post__action> <a href=../../2020/11/13/python_generators_and_comprehension/ > Continue reading </a> </nav> </div> </article> <nav class=md-pagination> </nav> </div> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023-2025 Matthew Martz </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/mutaku target=_blank rel=noopener title=GitHub class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://twitter.com/backpropagating target=_blank rel=noopener title=Twitter class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg> </a> <a href=https://linkedin.com/in/matthew-martz-phd target=_blank rel=noopener title=LinkedIn class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href=mailto:matthew@mutaku.io target=_blank rel=noopener title=Email class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.path", "navigation.top", "search.highlight", "search.suggest", "content.code.copy", "content.code.select", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../../assets/javascripts/bundle.f55a23d4.min.js></script> <script src=../../../javascripts/extra.js></script> </body> </html>