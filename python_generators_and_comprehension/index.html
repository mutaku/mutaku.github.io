
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Python Generators and Comprehension &#8212; Mutaku  documentation</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../about/" />
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" /> 
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" /> 
<link
  rel="alternate"
  type="application/atom+xml"
  href="../blog/atom.xml"
  title="Mutaku"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="../">
    
      <img src="../_static/plot_header.png" class="logo" alt="logo" />
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../about/">About Matthew Martz</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/mutaku/" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
          <li class="nav-item">
            <a class="nav-link" href="https://twitter.com/backpropagating" target="_blank" rel="noopener">
              <span><i class="fab fa-twitter-square"></i></span>
            </a>
          </li>
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><div class="logo"><img src="../_static/profile.jpg"></div>
<div class="snippet">
    <div class="name">Matthew Martz, PhD</div>
    <div class="title">Head of Data Science/ML/AI and Technical Lead / Strategic Vision at AgBiome</div>
    <div class="specialties">Machine Learning | Predictive Modeling | Data Science | Biomedical Research | Strategy</div>
</div>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                 <div class="section" id="python-generators-and-comprehension">
<h1>Python Generators and Comprehension<a class="headerlink" href="#python-generators-and-comprehension" title="Permalink to this headline">¶</a></h1>
<p>Digging into generators and comprehension - from basics to
to implementation in a comprehensive tutorial. This is a walkthrough
for beginners that will build up to real world examples.</p>
<div class="sphinx-bs container pb-4 docutils">
<div class="row docutils">
<div class="d-flex col-lg-12 p-0 docutils">
<div class="card w-100 shadow docutils">
<div class="card-header font-weight-bold bg-info docutils">
<p class="card-text">Note</p>
</div>
<div class="card-body docutils">
<p class="card-text">This is an in-progress draft.</p>
</div>
</div>
</div>
</div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">string</span>
</pre></div>
</div>
<p>Here we will build a dictionary of items that we can use for examples.
Let’s make it keyed on alphabetical characters and random integers.</p>
<p>The algorithm for this will be like:</p>
<p>Do something 20 times so we can have 20 items as (key, value). For each
of the 20 iterations, choose a random lowercase alphabetical character
as string and a positive integer up to 100.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">)</span>
<span class="n">collection</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">alpha</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">collection</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;i&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
 <span class="s1">&#39;u&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
 <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="mi">74</span><span class="p">,</span>
 <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">93</span><span class="p">,</span>
 <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
 <span class="s1">&#39;v&#39;</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span>
 <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
 <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="mi">93</span><span class="p">,</span>
 <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
 <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
 <span class="s1">&#39;o&#39;</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span>
 <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">48</span><span class="p">,</span>
 <span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span>
 <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">55</span><span class="p">,</span>
 <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
 <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mi">53</span><span class="p">}</span>
</pre></div>
</div>
<p>We did this through a method called dictionary comprehension where we
build a dictionary object on the fly. You can spot these comprehension
methods (dictionaries or lists) by iteration code within <code class="docutils literal notranslate"><span class="pre">{}</span></code> or
<code class="docutils literal notranslate"><span class="pre">[]</span></code> for dictionary or list comprehension, respectively.</p>
<p>Building our dictionary collection, we iterate over <code class="docutils literal notranslate"><span class="pre">range(20)</span></code> so we
will have 20 key:value pairs. Since we are not using the number yielded
from the <code class="docutils literal notranslate"><span class="pre">range</span></code> function, we use the python internal reference
variable name <code class="docutils literal notranslate"><span class="pre">_</span></code> to indicate to the user that we are not utilizing
this variable; our range is simply letting us do something 20 times.</p>
<p>For each iteration generated by iterating over <code class="docutils literal notranslate"><span class="pre">range</span></code>, we randomly
sample alpha using <code class="docutils literal notranslate"><span class="pre">numpy.random.choice</span></code>. <code class="docutils literal notranslate"><span class="pre">alpha</span></code> contains the
english language alphabet in lower case by way of
<code class="docutils literal notranslate"><span class="pre">string.ascii_lowercase</span></code> and we call <code class="docutils literal notranslate"><span class="pre">list</span></code> on this because
<code class="docutils literal notranslate"><span class="pre">string.ascii_lowercase</span></code> is a generator. We must have the complete
list to sample with numpy otherwise we would not know our choices if
only observing one object yielded to us.</p>
<p>Next, our value is assigned by randomly selecting an integer up to 100
with <code class="docutils literal notranslate"><span class="pre">numpy.random.randint</span></code>.</p>
<p>In order to tell our comprehension these are key:value pairs, our key
(<code class="docutils literal notranslate"><span class="pre">numpy.random.choice(alpha)</span></code>) is assigned first, followed by <code class="docutils literal notranslate"><span class="pre">:</span></code>,
then our value (<code class="docutils literal notranslate"><span class="pre">numpy.random.randint(100)</span></code>). This gives us our
<code class="docutils literal notranslate"><span class="pre">key:</span> <span class="pre">value</span></code>. These will all be collected within <code class="docutils literal notranslate"><span class="pre">{}</span></code> and assigned
to the variable <code class="docutils literal notranslate"><span class="pre">collection</span></code>, which we can call and the <code class="docutils literal notranslate"><span class="pre">__repr__</span></code>
function of our <code class="docutils literal notranslate"><span class="pre">collection</span></code> object (a <code class="docutils literal notranslate"><span class="pre">dict</span></code> class) will return a
string representation.</p>
<p>Now let’s demonstrate a few things we can do with this <code class="docutils literal notranslate"><span class="pre">collection</span></code>
dictionary.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="n">value_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">value_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="mi">93</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">74</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">55</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">53</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">collections.Counter</span></code> allows us to feed it an array of data and have
it tabulate occurrences. We call the <code class="docutils literal notranslate"><span class="pre">most_common</span></code> function to sort
the counts descending by occurrence. We could have also called
<code class="docutils literal notranslate"><span class="pre">collections.Counter.most_common(5)</span></code> to get the top 5, for example.</p>
<p>This is really doing something like the following.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">value_counts</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">value_counts</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="nb">sorted</span><span class="p">(</span><span class="n">value_counts</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">count</span><span class="p">:</span> <span class="n">count</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="mi">93</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">74</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">55</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">53</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
<p>First we set an empty dictionary object to which we will tabulate our
value occurrences. We then iterate our collection values through the
<code class="docutils literal notranslate"><span class="pre">collection.values()</span></code> generator. For each value, we will assign
<code class="docutils literal notranslate"><span class="pre">value_counts</span></code> a key of that value and increment it’s value by 1 for
each observation. To do this, we get the current value, <code class="docutils literal notranslate"><span class="pre">val</span></code>, by
calling <code class="docutils literal notranslate"><span class="pre">value_counts.get(val)</span></code>. But if this does not yet exist, we
get an error. So we use a default value of zero by calling this function
like <code class="docutils literal notranslate"><span class="pre">value_counts.get(val,</span> <span class="pre">0)</span></code>. Then we can take the actual value, or
default starting point of 0 and add 1 for this observation.</p>
<p>Next, to get things sorted like <code class="docutils literal notranslate"><span class="pre">collections.Counter.most_common</span></code> we
will sort our list using <code class="docutils literal notranslate"><span class="pre">sorted</span></code>. We iterate over key:value pairs,
and we tell it that the sorting key is value where <code class="docutils literal notranslate"><span class="pre">count</span></code> represents
the <code class="docutils literal notranslate"><span class="pre">tuple(key,</span> <span class="pre">value)</span></code> and we use the value by setting the key as
<code class="docutils literal notranslate"><span class="pre">count[1]</span></code> which is the value position of our iteration tuple.
<code class="docutils literal notranslate"><span class="pre">lambda</span></code> is letting is call in inline function and we could do any
sort of operation. Maybe this value is an error and we need to square
it: <code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">count:</span> <span class="pre">count[1]</span> <span class="pre">**</span> <span class="pre">2</span></code>. However, we would be better doing
that in a seperate operation since it obfuscates from the user that we
are sorting on error and not the original value. Finally,
<code class="docutils literal notranslate"><span class="pre">reverse=True</span></code> tells <code class="docutils literal notranslate"><span class="pre">sorted</span></code> we want max -&gt; min.</p>
<p>So we have taken our random collection of alphabetical keys and
generated the most common integer value occurrences. We could have
easily done the same for the alphabetical keys by calling
<code class="docutils literal notranslate"><span class="pre">collections.Counter(collection.keys()).most_common()</span></code>.</p>
<p>Now let’s do some conditional selection. We will first find all keys
whose value is gt 40.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">gt40keys</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">k</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">40</span>
<span class="p">]</span>
<span class="n">gt40keys</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>That used list comprehension (the list method of how we generated our
collection by way of dictionary comprehension) to iterate through key:
value pairs of collection and collect the key if the value is gt 40. The
result is a list for keys.</p>
<p>We could have returned the full key: value pair with
<code class="docutils literal notranslate"><span class="pre">(k,</span> <span class="pre">v)</span> <span class="pre">for</span> <span class="pre">(k,</span> <span class="pre">v)</span> <span class="pre">in</span> <span class="pre">collection.items()</span> <span class="pre">...</span></code> or we could have made a
new dictionary of only those key: value pairs matching that condition.
Let’s do that because it is a common routine.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">gt40collection</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">40</span>
<span class="p">}</span>
<span class="n">gt40collection</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="mi">74</span><span class="p">,</span>
 <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">93</span><span class="p">,</span>
 <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
 <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="mi">93</span><span class="p">,</span>
 <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
 <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">48</span><span class="p">,</span>
 <span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span>
 <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">55</span><span class="p">,</span>
 <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mi">53</span><span class="p">}</span>
</pre></div>
</div>
<p>So this looks just like our previous list comprehension, but to generate
a dictionary we use <code class="docutils literal notranslate"><span class="pre">{}</span></code> to make it a dictionary comprehension, we
assign key <code class="docutils literal notranslate"><span class="pre">k</span></code> the value <code class="docutils literal notranslate"><span class="pre">v</span></code> by <code class="docutils literal notranslate"><span class="pre">k:</span> <span class="pre">v</span></code> as we normally do but only
if the value is gt 40. The result is a dictionary that is a subset of
<code class="docutils literal notranslate"><span class="pre">collection</span></code> with only entries matching our criteria.</p>
<p>But what if we want to search for a value. Let’s say we want create a
new dictionary that is a subset of <code class="docutils literal notranslate"><span class="pre">collection</span></code> where the values equal
93. We will do this just like above.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">equals93collection</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">93</span>
<span class="p">}</span>
<span class="n">equals93collection</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">93</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="mi">93</span><span class="p">}</span>
</pre></div>
</div>
<p>So we have 2 key: value pairs where the value met the condition we set.
The result is a dictionary.</p>
<p>Before we go on, as a bit of an aside, what if we simply wanted to
double check how many values are equal to 93. Nothing more, nothing
less. We can combine a few of the methods we’ve highlight to get
something like the following.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">number_values_equal_to_93</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
    <span class="mi">1</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">93</span>
<span class="p">)</span>
<span class="n">number_values_equal_to_93</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span>
</pre></div>
</div>
<p>This might look slightly different, but it’s really all the same as we
have done. Let’s start inside and work out. first we are iterating over
the values of <code class="docutils literal notranslate"><span class="pre">collection</span></code> and since we only need the values and new
key: value pairs, we use <code class="docutils literal notranslate"><span class="pre">collection.values</span></code> (and if we were looking
at keys we would use <code class="docutils literal notranslate"><span class="pre">collection.keys</span></code>, but we would never be counting
key occurrences with an equivalency because remember, we cannot have two
of the same key in a dictionary). We are testing if the value equals 93
and accumulating an integer 1 rather than the value. We use 1 because we
want to count the occurrences, not operate on them by summing the
values. Finally, we count up these ones with <code class="docutils literal notranslate"><span class="pre">sum</span></code>.</p>
<p>Okay, I just wanted to highlight searching with comprehension and how we
can use sum and specific values. Let’s move on.</p>
<p>While this was a “search” for values that equaled 93, we simple iterated
over the entire collection to test each and every value. While this is
common, another more “search”-like operation is to identify key: value
entries where we now a condition is met, and we know how many exist.
This could be finding the single user who’s hash equals a specific
value.</p>
<p>Let’s first use our collection to find the two keys whose value equals
93, and since we know there exists only two entries, let’s do this with
a generator so that we can stop as soon as we have found our two data
points. There’s no reason we should search further than that; if 93
occurs at position 0 and 1, why should we be searching through the
remainder of collection?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">93</span><span class="p">:</span>
            <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="n">found</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>As you see, this is just like the previous method where we accumulated
key: value pairs where the value equaled 93. The syntax is different,
but the operation is very similar. The difference here is that we stop
iterating over the items as soon as we find our known matches of 2.</p>
<p>However, there are some issues here if we were working with much larger
data objects. When we call <code class="docutils literal notranslate"><span class="pre">collection.items()</span></code> we generate the entire
list of key: value pairs for <code class="docutils literal notranslate"><span class="pre">collection</span></code>. This puts all of those in
memory upon creation, and <em>then</em> we starting iterating over them. While
it’s better in that we stop iterating as soon as our 2 are found, we
still generate the entirety of <code class="docutils literal notranslate"><span class="pre">collection</span></code>’s key: value pairings.</p>
<p>Let’s make this better by only creating one key: value pair, check it,
then move on if we need to do so.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">93</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found a 93 on loop </span><span class="si">{</span><span class="n">i</span><span class="si">=}</span><span class="s1"> for </span><span class="si">{</span><span class="n">k</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">continue</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;collection is </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span><span class="si">=}</span><span class="s1"> and we searched through </span><span class="si">{</span><span class="n">i</span><span class="si">=}</span><span class="s1"> key: value pairs&#39;</span><span class="p">)</span>
<span class="n">found</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Found</span> <span class="n">a</span> <span class="mi">93</span> <span class="n">on</span> <span class="n">loop</span> <span class="n">i</span><span class="o">=</span><span class="mi">3</span> <span class="k">for</span> <span class="n">k</span><span class="o">=</span><span class="s1">&#39;x&#39;</span>
<span class="n">Found</span> <span class="n">a</span> <span class="mi">93</span> <span class="n">on</span> <span class="n">loop</span> <span class="n">i</span><span class="o">=</span><span class="mi">8</span> <span class="k">for</span> <span class="n">k</span><span class="o">=</span><span class="s1">&#39;m&#39;</span>
<span class="n">collection</span> <span class="ow">is</span> <span class="nb">len</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span><span class="o">=</span><span class="mi">17</span> <span class="ow">and</span> <span class="n">we</span> <span class="n">searched</span> <span class="n">through</span> <span class="n">i</span><span class="o">=</span><span class="mi">8</span> <span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="n">pairs</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>So you can see this almost identical to our last attempt, but we have
created a generator using <code class="docutils literal notranslate"><span class="pre">enumerate</span></code> over our function. We then
iterate this generator as it yields an integer telling us the iteration
loop number (like a counter) and the <code class="docutils literal notranslate"><span class="pre">tuple(key,</span> <span class="pre">value)</span></code>. So we assign
each yield as (i, (k, v)), check if the value <code class="docutils literal notranslate"><span class="pre">v</span></code> equals 93, and if
so, we can print out which loop count we are at, the key <code class="docutils literal notranslate"><span class="pre">k</span></code> it was
associated with, and then append the key to our found list. If we have
found 2, as <code class="docutils literal notranslate"><span class="pre">len(found)</span> <span class="pre">==</span> <span class="pre">2</span></code>, then we <code class="docutils literal notranslate"><span class="pre">break</span></code> out of our loop,
otherwise we <code class="docutils literal notranslate"><span class="pre">continue</span></code> to the next iterable.</p>
<p>You can then see that of our collection of length 17, we only searched
through 9 pairs (<code class="docutils literal notranslate"><span class="pre">enumerate</span></code> started at 0 and ended at i=8 so that is
8 + 1 pairs). Pretty cool, especially if we are searching in the
billions, or our search criteria is a lot more complex than an identify
test. What if we were searching for the key were some costly function
<code class="docutils literal notranslate"><span class="pre">f(x)</span></code> which took several {seconds/minutes/MBs/GBs} to compute yielded
the resultant value <code class="docutils literal notranslate"><span class="pre">v</span></code> of our <code class="docutils literal notranslate"><span class="pre">tuple(k,</span> <span class="pre">v)</span></code> pair?</p>
<p>Another important feature is that we are storing in ram the current
iterable, we are not inherently accumulating everything we have already
iterated over. We are looking at things one at a time and moving on.
It’s like we are at a market and searching for a good fruit. We sample
many fruits by taking one, looking it over, and either keeping it
because it matches our criteria for ripeness, or we put it back. We do
not stash in our arms every fruit we sample and then only after
exhausting the entire bin of fruits do we put them down, keeping our
selections. For shopping the market, iterating by <code class="docutils literal notranslate"><span class="pre">yield</span></code>ing one
fruit at a time, our arms (and the farmer) are thankful. For our
programming, our RAM capacity is thankful.</p>
<p>We see this commonly with operating on file objects where we readily can
encounter files &gt;&gt; size of our usable memory. This also extremely common
with large arrays and networks when using a GPU.</p>
<p>Let’s make a quick generator just to see what’s really different here.
First, though, let’s make a version like our list comprehension to see
what that looks like, and then do the same thing with a generator to
compare.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">list_building</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate a list of size 10&quot;&quot;&quot;</span>
    <span class="n">created_array</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">created_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">created_array</span>

<span class="k">def</span> <span class="nf">generator_list_building</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">i</span>


<span class="n">complete_list</span> <span class="o">=</span> <span class="n">list_building</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complete_list</span><span class="si">=}</span><span class="s1"> is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">complete_list</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">iterable_list</span> <span class="o">=</span> <span class="n">generator_list_building</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">iterable_list</span><span class="si">=}</span><span class="s1"> is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">iterable_list</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>complete_list=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9] is type(complete_list)=&lt;class &#39;list&#39;&gt;
iterable_list=&lt;generator object generator_list_building at 0x7f8f315e9f90&gt; is type(iterable_list)=&lt;class &#39;generator&#39;&gt;
</pre></div>
</div>
<p>As you can see both by method, but also by inspection, the first list
building routine creates, then returns the entire array of 10 integers.
However, the generator method creates an in-memory generator which can
later by iterated over. You can see the difference by printing out the
result. <code class="docutils literal notranslate"><span class="pre">complete_list</span></code> contains a complete, 10 integer array.
However, <code class="docutils literal notranslate"><span class="pre">iterable_list</span></code> has no data and is instead a generator
object.</p>
<p>But how do we get something out of the generator? Let’s say for our list
of objects, we wanted an array of squared values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">squared_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">complete_list</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">squared_list</span><span class="p">)</span>

<span class="n">squared_generator_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">iterable_list</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">squared_generator_list</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">81</span><span class="p">]</span>
<span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">81</span><span class="p">]</span>
</pre></div>
</div>
<p>Both resulted in our list of squared original values. However, with the
first method what do we have in memory? We have the original list
<code class="docutils literal notranslate"><span class="pre">complete_list</span></code> which is of length 10. We now also have a squared list
<code class="docutils literal notranslate"><span class="pre">squared_list</span></code> also of length 10. These are small, but what if we
simply wanted our squared list and it was to be a billion integers?
Further, do we need the original if we just want squares. We could use
<code class="docutils literal notranslate"><span class="pre">del</span> <span class="pre">complete_list</span></code> but we still had both complete lists in memory at
some point for some duration.</p>
<p>The second, though started only with a generator. When we were done, we
only had a resultant list and an empty generator. That’s because we told
it what it <em>will</em> <code class="docutils literal notranslate"><span class="pre">yield</span></code>, we then iterated it having it <code class="docutils literal notranslate"><span class="pre">yield</span></code> a
particular integer, we operated on that iterable and accumulated it, and
we then threw away our yielded iterable before moving on. So as we
iterate over the generator, we yield and then move on. Just like our
fruit inspection at the market.</p>
<p>The great thing is, our squaring operation looks the same! Nice and
simple, right? But our functions were a bit crude — can we write them
in our comprehension style? Can we make a comprehension generator? Yes!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">comprehension_based_complete_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">comprehension_based_complete_list</span><span class="si">=}</span><span class="s1"> is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">comprehension_based_complete_list</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">comprehension_based_iterable_list</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">comprehension_based_iterable_list</span><span class="si">=}</span><span class="s1"> is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">comprehension_based_iterable_list</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>comprehension_based_complete_list=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9] is type(comprehension_based_complete_list)=&lt;class &#39;list&#39;&gt;
comprehension_based_iterable_list=&lt;generator object &lt;genexpr&gt; at 0x7f8f308f4890&gt; is type(comprehension_based_iterable_list)=&lt;class &#39;generator&#39;&gt;
</pre></div>
</div>
<p>Okay, there we have it. The same functions we already did but with list
and generator comprehension. Remember, this is done through the subtle
difference in using either <code class="docutils literal notranslate"><span class="pre">[]</span></code> for a list or <code class="docutils literal notranslate"><span class="pre">()</span></code> for a generator
around the comprehension logic.</p>
<p>Now, this is not the best example. That’s because in Python 3, range is
already a generator. So these would simply be <code class="docutils literal notranslate"><span class="pre">list(range(10))</span></code> and
<code class="docutils literal notranslate"><span class="pre">range(10)</span></code>, respectively. But you should be able to see that what we
are doing to make the data could be anything. Finally, as an exercise,
let’s just combine everything in the last few functions to make a
squared value list and generator. This should be a better example than
<code class="docutils literal notranslate"><span class="pre">range</span></code> alone, and it will allow us to write something more succinct
than the multi-step functions above.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">comprehension_based_squared_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">i</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">comprehension_based_squared_list</span><span class="si">=}</span><span class="s1"> is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">comprehension_based_squared_list</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">comprehension_based_squared_iterable</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">i</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">comprehension_based_squared_iterable</span><span class="si">=}</span><span class="s1"> is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">comprehension_based_squared_iterable</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>comprehension_based_squared_list=[0, 1, 4, 9, 16, 25, 36, 49, 64, 81] is type(comprehension_based_squared_list)=&lt;class &#39;list&#39;&gt;
comprehension_based_squared_iterable=&lt;generator object &lt;genexpr&gt; at 0x7f8f308f4ac0&gt; is type(comprehension_based_squared_iterable)=&lt;class &#39;generator&#39;&gt;
</pre></div>
</div>
<p>So we have a squared list and a squared generator.</p>
<p>Let’s get back to our “searching”. Remember way back we used
<code class="docutils literal notranslate"><span class="pre">enumerate</span></code> to create a generator-based version of our data for which
we could iterate. Let’s take a look at another way we can do this.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">collections_generator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

<span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">collections_generator</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">93</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found a 93 for </span><span class="si">{</span><span class="n">k</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

<span class="n">found</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Found</span> <span class="n">a</span> <span class="mi">93</span> <span class="k">for</span> <span class="n">k</span><span class="o">=</span><span class="s1">&#39;x&#39;</span>
<span class="n">Found</span> <span class="n">a</span> <span class="mi">93</span> <span class="k">for</span> <span class="n">k</span><span class="o">=</span><span class="s1">&#39;m&#39;</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Here we created our own generate using <code class="docutils literal notranslate"><span class="pre">iter</span></code> which let’s us work
through any collection of data (list, array, dict, tuple). We then use a
<code class="docutils literal notranslate"><span class="pre">while</span></code> routine to iterate through the data until we have found our 2
matches collected under <code class="docutils literal notranslate"><span class="pre">found</span></code> and assessed with <code class="docutils literal notranslate"><span class="pre">len(found)</span></code>. We
yield and iteration of key: value by calling <code class="docutils literal notranslate"><span class="pre">next</span></code> on our generator,
check if value <code class="docutils literal notranslate"><span class="pre">v</span></code> is equal to 93, and if so, we append it to found.</p>
<p>Great, works just like before but much more concise using <code class="docutils literal notranslate"><span class="pre">while</span></code> and
using <code class="docutils literal notranslate"><span class="pre">iter</span></code> our own data object, we can make it adaptable. The
benefit of <code class="docutils literal notranslate"><span class="pre">enumerate</span></code> is that we don’t have to yield the data
ourselves using <code class="docutils literal notranslate"><span class="pre">next</span></code> and we also get the added feature of a built-in
counter as the first value in the yielded
<code class="docutils literal notranslate"><span class="pre">tuple(count,</span> <span class="pre">iterable_item)</span></code> where our iterable_item is a key: value
pair as <code class="docutils literal notranslate"><span class="pre">tuple(k,</span> <span class="pre">v)</span></code> since we are iterating <code class="docutils literal notranslate"><span class="pre">collection.items()</span></code>.</p>
<p>Either works, fine and there are some pros and cons to each beyond what
we just discussed. Generally it comes down to habit and I find myself
using both almost equally.</p>
<p>Now one caveat of our generator. What if we couldn’t find our second
match. Either we were not working on immuatable data and it changed
since we began the search, or set our match criteria with our prior
knowledge. We will hit an iteration error and break. We always want to
catch such exceptions, deal with them gracefully, and move on so we do
not break our code.</p>
<p>So how do we go about doing this here?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">collections_generator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

<span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">collections_generator</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">53</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found a 53 for </span><span class="si">{</span><span class="n">k</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;We ran out of data to search&#39;</span><span class="p">)</span>
        <span class="k">break</span>

<span class="n">found</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Found</span> <span class="n">a</span> <span class="mi">53</span> <span class="k">for</span> <span class="n">k</span><span class="o">=</span><span class="s1">&#39;t&#39;</span>
<span class="n">We</span> <span class="n">ran</span> <span class="n">out</span> <span class="n">of</span> <span class="n">data</span> <span class="n">to</span> <span class="n">search</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>To catch this issue, we nest our iterable assignment and condition check
within a <code class="docutils literal notranslate"><span class="pre">try/except</span></code> routine. Here, we will try to get the next
iterable and test it. However, if we run out because there is nothing
left to yield when we call <code class="docutils literal notranslate"><span class="pre">next</span></code>, <code class="docutils literal notranslate"><span class="pre">iter</span></code> will
<code class="docutils literal notranslate"><span class="pre">raise</span> <span class="pre">StopIteration</span></code>. We catch this specific (and we always want to
be specific) exception with <code class="docutils literal notranslate"><span class="pre">except</span> <span class="pre">StopIteration</span></code>.</p>
<p>To ensure we had a scenario where this exception would throw, we
searched for a value where we know from our previous exercises that it
occurred only once, here <code class="docutils literal notranslate"><span class="pre">53</span></code>.</p>
<p>Pretty simple. But two important things to note.</p>
<ol class="arabic simple">
<li><p>We explicitly use <code class="docutils literal notranslate"><span class="pre">except</span> <span class="pre">StopIteration</span></code> to only catch this error.
We do not want to catch any other issues that might arise as it would
obfuscate any other errors since we assume running out of choices is
all that could happen.</p></li>
<li><p><strong>More critically</strong> we must make sure that whatever we do in our
<code class="docutils literal notranslate"><span class="pre">exception</span></code> handling, whether it’s simply print out an issue
warning, like here, or maybe we try and do something else, we have to
call <code class="docutils literal notranslate"><span class="pre">break</span></code>.</p></li>
</ol>
<p>If we do not call <code class="docutils literal notranslate"><span class="pre">break</span></code> when we run out of iterables, what will
happen with our <code class="docutils literal notranslate"><span class="pre">while</span></code> routine? Well, we’ll never meet the condition
<code class="docutils literal notranslate"><span class="pre">len(found)</span> <span class="pre">&lt;</span> <span class="pre">2</span></code> and we will loop to infinite. (Okay, not really. We
will generally hit a recursion warning in most environments, but it’s
equally bad. Think about this happening in product!)</p>
<p>Another consideration is that we can use <code class="docutils literal notranslate"><span class="pre">else</span></code> and <code class="docutils literal notranslate"><span class="pre">finally</span></code> with
our <code class="docutils literal notranslate"><span class="pre">try/except</span></code> routine. While I’ll leave that for another time, in
brief, it allows us to run a secondary operation if the first exception
does not through, and a way to always run a cleanup regardless if we
succeeded or not (think file object close, etc). So <code class="docutils literal notranslate"><span class="pre">else</span></code> only runs
if no exception was caught with <code class="docutils literal notranslate"><span class="pre">except</span></code> and <code class="docutils literal notranslate"><span class="pre">finally</span></code> will always
run no matter the prior outcome.</p>
<p>Okay, I think we hit a lot of good stuff so far. We discussed
constructing objects through comprehension building (list or
dictionary), and generating some random toy data in doing so. We ran
through a few different ways to summarize and understand our data using
either built-ins or from scratch methods. We saw how we can “search”
conditionally to find data or simply count occurrences. We then dove
into using generators and iterating to optimize our searching. Finally,
we briefly touched on adding some error handling.</p>
<p>Let’s take a look at one last method. What if we either knew our data
had only one match, for example, our user with a specific. Let’s create
a simple class object, <code class="docutils literal notranslate"><span class="pre">User</span></code> and highlight to things we can do wrap
up everything we’ve gone over thus far.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">active</span>

    <span class="k">def</span> <span class="nf">toggle_active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&lt;User&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">=}</span><span class="s1"> | </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="si">=}</span><span class="s1"> | </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>Okay, we now have a <code class="docutils literal notranslate"><span class="pre">User</span></code> class that represents a user with a
<code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">age</span></code>, and an <code class="docutils literal notranslate"><span class="pre">active</span></code> status. We also have a function
that we can call on a <code class="docutils literal notranslate"><span class="pre">User</span></code> that will toggle the active status. We
also set a <code class="docutils literal notranslate"><span class="pre">__repr__</span></code> function so we can get a string representation
of our users.</p>
<p>Let’s add some users, and we will store them in a list. So let’s do this
with some list comprehension!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">user_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Patrick&#39;</span><span class="p">,</span> <span class="s1">&#39;Matthew&#39;</span><span class="p">,</span> <span class="s1">&#39;Linux Admin&#39;</span><span class="p">,</span> <span class="s1">&#39;Operating Doctor&#39;</span><span class="p">,</span> <span class="s1">&#39;Data Scientist&#39;</span><span class="p">]</span>
<span class="n">users</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">80</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">user_names</span>
<span class="p">]</span>
<span class="n">users</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Patrick&#39;</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="mi">3</span> <span class="o">|</span> <span class="kc">True</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Matthew&#39;</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="mi">45</span> <span class="o">|</span> <span class="kc">True</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Linux Admin&#39;</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="mi">12</span> <span class="o">|</span> <span class="kc">True</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Operating Doctor&#39;</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="mi">46</span> <span class="o">|</span> <span class="kc">True</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Data Scientist&#39;</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="mi">74</span> <span class="o">|</span> <span class="kc">True</span><span class="p">]</span>
</pre></div>
</div>
<p>So we used our list comprehension to build out a list of users as
<code class="docutils literal notranslate"><span class="pre">users</span></code> from our preset user names array <code class="docutils literal notranslate"><span class="pre">user_names</span></code>. In doing so
we assigned them a random age up to 80 with
<code class="docutils literal notranslate"><span class="pre">numpy.random.randint(80)</span></code>, similar to what we did with
<code class="docutils literal notranslate"><span class="pre">collection</span></code>. Also note since we did not supply an active argument, it
defaulted to <code class="docutils literal notranslate"><span class="pre">True</span></code> as we set in <code class="docutils literal notranslate"><span class="pre">User.__init__</span></code>. And because we
made a nice <code class="docutils literal notranslate"><span class="pre">__repr__</span></code>, we get an informative string representation of
all of our users in <code class="docutils literal notranslate"><span class="pre">users</span></code>.</p>
<p>Now let’s use what we have done already to perform a few somewhat real
world operations.</p>
<p>I see two users whose age is under 18. Patrick and Linux Admin should
not be active on our platform without additional parental consent. Let’s
go ahead and take care of that. But let’s highlight a few methods to do
this. I will comment out the first few methods and only run the last
since we only want to toggle this once, but we want to highlight them
all.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Pretty standard approach</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;</span> <span class="mi">18</span><span class="p">:</span>
        <span class="n">user</span><span class="o">.</span><span class="n">toggle_active</span><span class="p">()</span>

<span class="c1"># # This works, but map is a generator so to perform the mapped function we</span>
<span class="c1"># # have to iterate it - so for our simple purpose this is a bit terse</span>
<span class="c1"># list(map(lambda user: user.toggle_active(), (user for user in users if user.age &lt; 18))</span>

<span class="c1"># # If we wanted to do the mapped approach, we could do it in a list comprehension</span>
<span class="c1"># # further, since we return True after toggling as long as there is no thrown error</span>
<span class="c1"># # we could add a check to make sure all requested toggling ran successfully</span>
<span class="c1"># assert all(user.toggle_active() for user in users if user.age &lt; 18)</span>

<span class="n">users</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Patrick&#39;</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="mi">3</span> <span class="o">|</span> <span class="kc">False</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Matthew&#39;</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="mi">45</span> <span class="o">|</span> <span class="kc">True</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Linux Admin&#39;</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="mi">12</span> <span class="o">|</span> <span class="kc">False</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Operating Doctor&#39;</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="mi">46</span> <span class="o">|</span> <span class="kc">True</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Data Scientist&#39;</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="mi">74</span> <span class="o">|</span> <span class="kc">True</span><span class="p">]</span>
</pre></div>
</div>
<p>As you can see, we simply ran a very readable loop to run
<code class="docutils literal notranslate"><span class="pre">User.toggle_active()</span></code> on any user we encounter who’s age is less than
18. And we can see that, yes, it did indeed work.</p>
<p>I also commented out a few other approaches using more advanced, or in
some cases merely more confusing, examples. The version with an
<code class="docutils literal notranslate"><span class="pre">assert</span></code>ion is pretty handy. You’d do something like this if we were
unit testing, however, you don’t usually want any assertions in your
production code. In production, though, we might say
<code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">not</span> <span class="pre">all(blah):</span> <span class="pre">send_alert(&quot;status</span> <span class="pre">toggle</span> <span class="pre">failures&quot;)</span></code> or something
like that. And again, we can do that without inspecting the users simply
because we <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">True</span></code> if the code executes properly. But remember,
that’s not checking that the toggle resulted in the correct status
state, only that it actually ran without raising an exception.</p>
<p>Okay, so we have our users setup, and their status is no age
appropriate. Let’s come back to our techniques. Let’s find users who’s
age is over 30 (so similar to what we just did) but now we want to do a
bit more than a simple one-time function execution.</p>
<p>Remember, we can do this with a list or generator. Let’s pretend that
our set of patients now should go into a new class object. Let’s also
set the caveat that the number of users we find will be &gt;&gt; the actual 2
in our example. We might also assume that each <code class="docutils literal notranslate"><span class="pre">User</span></code> in <code class="docutils literal notranslate"><span class="pre">users</span></code>
also contains addition attributes where one contains health history that
might be megabytes in size. So because we have a few things we want to
do with our found users, and each found user is memory intensive and
already exists somewhere in the <code class="docutils literal notranslate"><span class="pre">users</span></code> list, we do not want to copy
an entire subset of that list.</p>
<p>We are also going to pretend that our conditional patients can only
accumulate in our intensive care unit so much before we fill our
capacity. So because every bit of memory is important, remember all that
patient history we naively read into memory when making our <code class="docutils literal notranslate"><span class="pre">User</span></code>s?
And because we can only take so many, let’s use our generator approach.</p>
<p>*Note: if we were really memory intensive here and speed was important,
we could use indexing and other tricks. But let’s assume we are
somewhere between our example of 5 and Google big data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">users_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
<span class="n">max_capacity</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">intensive_care_patients</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">intensive_care_patients</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_capacity</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">patient</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">users_iter</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">patient</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">intensive_care_patients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patient</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;We still have capacity!&#39;</span><span class="p">)</span>

<span class="n">intensive_care_patients</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;Matthew&#39;</span><span class="p">,</span> <span class="s1">&#39;Operating Doctor&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>This should all seem standard fare now. So I will leave the breakdown to
you at this point.</p>
<p>Notice how we only used the patient name in our resultant list? Again,
we are assuming it’s incredibly expensive to hold a <code class="docutils literal notranslate"><span class="pre">User</span></code> in memory
so let’s not duplicate things unless we have to do so. In reality, we
might reference a database table primary key, or maybe a unique user
hash since names are common. We also do not want people causing havoc on
the system by guessing actual data references (thus, why we normally use
hashes or other unpredictable identifiers), but I digress.</p>
<p>Okay, remember what I just said about copying. Well in reality, we could
just reference the original object so we have a list of objects and
another list of references to that object. But for our purposes, let’s
just assume we are dealing with copies above where maybe we would
otherwise attach additional information making the reference and the
original no longer equivalent and causing us to have two objects for one
user.</p>
<p>If we wanted to make ICU patient objects, we could have simply done so
above. Rather than appending the <code class="docutils literal notranslate"><span class="pre">User.name</span></code> to a list, we could have
simply made those objects and collected them. Let’s do that quick here
just as an example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">VulnerablePatient</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patient</span> <span class="o">=</span> <span class="n">patient</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&lt;VulnerablePatient&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">patient</span><span class="si">}</span><span class="s1">&#39;</span>


<span class="n">users_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
<span class="n">max_capacity</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">intensive_care_patients</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">intensive_care_patients</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_capacity</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">patient</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">users_iter</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">patient</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">intensive_care_patients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">VulnerablePatient</span><span class="p">(</span><span class="n">patient</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;We still have capacity!&#39;</span><span class="p">)</span>

<span class="n">intensive_care_patients</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">VulnerablePatient</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Matthew&#39;</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="mi">45</span> <span class="o">|</span> <span class="kc">True</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">VulnerablePatient</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Operating Doctor&#39;</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="mi">46</span> <span class="o">|</span> <span class="kc">True</span><span class="p">]</span>
</pre></div>
</div>
<p>Okay, so one thing we did different here is that we passed the entire
<code class="docutils literal notranslate"><span class="pre">User</span></code> object as the patient to our <code class="docutils literal notranslate"><span class="pre">VulnerablePatient</span></code> object. I
will also point out that it may or may not be obvious that here we rely
on the <code class="docutils literal notranslate"><span class="pre">User.__repr__</span></code> to provide the actual patient information in
<code class="docutils literal notranslate"><span class="pre">VulnerablePatient.__repr__</span></code>.</p>
<p>Here is where we can check to see if we have made two patients, one a
<code class="docutils literal notranslate"><span class="pre">User</span></code> and one user <code class="docutils literal notranslate"><span class="pre">User</span></code> within <code class="docutils literal notranslate"><span class="pre">VulnerablePatient</span></code> or we are
referencing the same <code class="docutils literal notranslate"><span class="pre">User</span></code> object and thus same memory block. Let’s
check.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">check_user</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
    <span class="n">user</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span>
    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">30</span>
<span class="p">)</span>
<span class="n">compare_vulnerable_patient</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
    <span class="n">patient</span> <span class="k">for</span> <span class="n">patient</span> <span class="ow">in</span> <span class="n">intensive_care_patients</span>
    <span class="k">if</span> <span class="n">patient</span><span class="o">.</span><span class="n">patient</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">check_user</span><span class="o">.</span><span class="n">name</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">check_user</span><span class="p">,</span> <span class="n">compare_vulnerable_patient</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Matthew&#39;</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="mi">45</span> <span class="o">|</span> <span class="kc">True</span> <span class="o">&lt;</span><span class="n">VulnerablePatient</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Matthew&#39;</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="mi">45</span> <span class="o">|</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Okay two things here. First, the simplest, jump down to the last line of
code and the output after. We can see that the user we grabbed as
<code class="docutils literal notranslate"><span class="pre">check_user</span></code> that met our condition for which we made ICU patients is
properly found and is the same <code class="docutils literal notranslate"><span class="pre">VulnerablePatient</span></code>. How we condition
that should be familiar now if it wasn’t before we started.</p>
<p>The second thing to note is that we combine a few of our methods,
finally, into a nice and concise example.</p>
<p>We first want to get a user that we know would be a
<code class="docutils literal notranslate"><span class="pre">VulnerablePatient</span></code> by conditioning the same way, here, age &gt; 30. We
do this in a generator because we now love them, but more imporantly we
want to just get the first user that meets these conditions. We <em>do not</em>
want to generate a full list of condition matching users because,
remember, they are expensive, and we only need one and really fast. So
to do this, we use a generator that will yield matching conditions, and
we use <code class="docutils literal notranslate"><span class="pre">next</span></code> one time so we get the first iteration that is yielded.</p>
<p>You will see we do this in a shortcut by using a generator comprehension
that is wrapped in <code class="docutils literal notranslate"><span class="pre">next</span></code>. We could have also done this like
<code class="docutils literal notranslate"><span class="pre">(generator</span> <span class="pre">comprehension).next()</span></code>, but that’s not as clean, nor is it
necessary in modern Python.</p>
<p>You’ll then see we do the same with our ICU patients list, but here we
condition on the name being the same as our single <code class="docutils literal notranslate"><span class="pre">check_user</span></code> we
just found. So we search for a single match (even though we know there
are more) and then again, we search for a single match (but here we know
there should be only one - yet our syntax is the same for our purposes).
You might note, we did not break this out to catch a <code class="docutils literal notranslate"><span class="pre">StopIteration</span></code>
because we know the data exists and each will successfully return. (<em>We
say that all the time in production and then things blow up, don’t
they?</em>)</p>
<p>Okay, back to it. We now have a <code class="docutils literal notranslate"><span class="pre">User</span></code> and a <code class="docutils literal notranslate"><span class="pre">VulnerablePatient</span></code>
that should be the same person. But is this a copy or a reference to one
memory block? Let’s check.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="n">check_user</span><span class="p">)</span><span class="si">=}</span><span class="s1">, </span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="n">compare_vulnerable_patient</span><span class="p">)</span><span class="si">=}</span><span class="s1">, and </span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="n">compare_vulnerable_patient</span><span class="o">.</span><span class="n">patient</span><span class="p">)</span><span class="si">=}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">assert_equivalency</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Assert the equivalency of two objects&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj2</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj1</span><span class="si">=}</span><span class="s1"> and </span><span class="si">{</span><span class="n">obj2</span><span class="si">=}</span><span class="s1"> are not equivalent&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj1</span><span class="si">=}</span><span class="s1"> and </span><span class="si">{</span><span class="n">obj2</span><span class="si">=}</span><span class="s1"> are equivalent&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="n">assert_equivalency</span><span class="p">(</span><span class="n">check_user</span><span class="p">,</span> <span class="n">compare_vulnerable_patient</span><span class="p">)</span>
<span class="n">assert_equivalency</span><span class="p">(</span><span class="n">check_user</span><span class="p">,</span> <span class="n">compare_vulnerable_patient</span><span class="o">.</span><span class="n">patient</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="n">check_user</span><span class="p">)</span><span class="o">=</span><span class="mi">140252981884720</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">compare_vulnerable_patient</span><span class="p">)</span><span class="o">=</span><span class="mi">140252983924240</span><span class="p">,</span> <span class="ow">and</span> <span class="nb">id</span><span class="p">(</span><span class="n">compare_vulnerable_patient</span><span class="o">.</span><span class="n">patient</span><span class="p">)</span><span class="o">=</span><span class="mi">140252981884720</span><span class="p">)</span>

<span class="n">obj1</span><span class="o">=&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Matthew&#39;</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="mi">45</span> <span class="o">|</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">obj2</span><span class="o">=&lt;</span><span class="n">VulnerablePatient</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Matthew&#39;</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="mi">45</span> <span class="o">|</span> <span class="kc">True</span> <span class="n">are</span> <span class="ow">not</span> <span class="n">equivalent</span>

<span class="n">obj1</span><span class="o">=&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Matthew&#39;</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="mi">45</span> <span class="o">|</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">obj2</span><span class="o">=&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Matthew&#39;</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="mi">45</span> <span class="o">|</span> <span class="kc">True</span> <span class="n">are</span> <span class="n">equivalent</span>
</pre></div>
</div>
<p>So a few ways to look at it. The first we simply print the result of the
<code class="docutils literal notranslate"><span class="pre">id</span></code> function which will tell us the object’s unique identifier in
memory. The second way is to <code class="docutils literal notranslate"><span class="pre">assert</span></code> the equivalency of the <code class="docutils literal notranslate"><span class="pre">id</span></code>.
And the third was is to directly check equivalency by comparing.</p>
<p>As you can see, all three methods work and give us the same result.
While the <code class="docutils literal notranslate"><span class="pre">User</span></code> and the <code class="docutils literal notranslate"><span class="pre">VulnerableUser</span></code> are not the same object,
which is what we expect, the <code class="docutils literal notranslate"><span class="pre">VulnerableUser.patient</span></code> and the <code class="docutils literal notranslate"><span class="pre">User</span></code>
are the same. So we did not create a second in-memory patient when we
put them in a <code class="docutils literal notranslate"><span class="pre">VulnerableUser</span></code> object.</p>
<p>Okay, this last part was a bit of a tangent from what we were going
through up to this point. However, we did a nice culmination of our
methods in getting <code class="docutils literal notranslate"><span class="pre">check_user</span></code> and <code class="docutils literal notranslate"><span class="pre">compare_vulnerable_patient</span></code>,
and then hopefully the explanation of in-memory and referencing, and how
we can check these things, proves to be helpful.</p>
<p>I think that should do it for generators and generator comprehensions,
and when we might want to use them over lists and list comprehensions.</p>
</div>

<div class="section">
    

<div class="section">
  <span style="float: left">
     Previous:
    
    <a href="../nested_dictionary_lookups/">
       Dictionary Lookup - Exploring the Depths
    </a>
    
  </span>
  <span>&nbsp;</span>
  <span style="float: right">
     Next: 
    <a href="../notes_on_mlops_one/">
      Notes on MLOps - One 
    </a>
    
  </span>
</div>
  
</div>

              </div>
              
              
              <div class='prev-next-bottom'>
                

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2023, Matthew Martz.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>